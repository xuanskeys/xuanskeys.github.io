<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Netty</title>
      <link href="/2025/05/13/Netty/"/>
      <url>/2025/05/13/Netty/</url>
      
        <content type="html"><![CDATA[<h1><span id="netty">Netty</span></h1><p>netty官网: <a href="https://netty.io/">https://netty.io/</a></p><h2><span id="什么是netty">什么是Netty？</span></h2><ul><li>Netty 是 一个异步事件驱动的网络应用程序框架，用于快速开发可维护的高性能协议服务器和客户端。</li><li>Netty 是一个 NIO 客户端服务器框架，可以快速轻松地开发网络应用程序（例如协议服务器和客户端）。它极大地简化了 TCP 和 UDP 套接字服务器等网络编程。</li></ul><h2><span id="java-io">Java IO</span></h2><h3><span id="什么是java-io">什么是Java IO？</span></h3><p>官方文档：<a href="https://docs.oracle.com/javase/tutorial/essential/io/">https://docs.oracle.com/javase/tutorial/essential/io/</a></p><p><strong>I&#x2F;O（Input&#x2F;Output）</strong> 是计算机与外部设备（磁盘、网络、键盘等）进行数据交换的过程</p><h3><span id="分类">分类</span></h3><h4><span id="1bio-阻塞io">1.BIO (阻塞IO)</span></h4><p>每当有一个客户端与服务器进行连接，服务器就会创建一个线程去处理当前连接，当通道没有数据的时候，线程会阻塞等待</p><p><img src="/../images/image-20250511211425582.png" alt="image-20250511211425582"></p><p><img src="/../images/image-20250511215626687.png" alt="image-20250511215626687"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BioDemo1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.创建服务器监听端口Socket</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">socketServer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">3333</span>);</span><br><span class="line">        log.info(<span class="string">&quot;服务器启动成功&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.等待客户端连接</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> socketServer.accept();</span><br><span class="line">            log.info(<span class="string">&quot;有客户端连接了&quot;</span> + socket.getRemoteSocketAddress());</span><br><span class="line">            <span class="comment">// 3.创建线程处理客户端连接</span></span><br><span class="line">            executorService.execute(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    handle(socket);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理客户端连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> socket</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Socket socket)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (socket.isClosed()) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// 1.打印线程信息</span></span><br><span class="line">        log.info(<span class="string">&quot;线程信息：&#123;&#125;&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2.读取通道数据</span></span><br><span class="line">            inputStream = socket.getInputStream();</span><br><span class="line">            <span class="comment">// 2.1 获取输入流</span></span><br><span class="line">            <span class="comment">// 2.2 读取数据</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>]; <span class="comment">// 创建一个缓存数组</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> inputStream.read(bytes);</span><br><span class="line">                <span class="keyword">if</span> (read == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                log.info(<span class="string">&quot;客户端发送的数据：&#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>(bytes, <span class="number">0</span>, read));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;客户端断开连接&quot;</span> + socket.getRemoteSocketAddress());</span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) inputStream.close();</span><br><span class="line">            socket.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250511215651785.png" alt="image-20250511215651785"></p><p><strong>文件传输</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDemoServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;file/test01.txt&quot;</span>);</span><br><span class="line">        <span class="type">RandomAccessFile</span> <span class="variable">randomAccessFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(file, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">        randomAccessFile.read(bytes); <span class="comment">// 读取文件</span></span><br><span class="line">        <span class="comment">// 创建服务端 等待客户端连接发送文件</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">3333</span>);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> client.getOutputStream();</span><br><span class="line">        outputStream.write(bytes);</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDemoClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>();</span><br><span class="line">        socket.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        inputStream.read(bytes);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="2nio-非阻塞io">2.NIO （非阻塞IO）</span></h4><p>官方文档：<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/package-summary.html">https://docs.oracle.com/javase/8/docs/api/java/nio/package-summary.html</a></p><ul><li>NIO是面向缓冲区或者面向块编程的</li><li>核心组成是Selector、Channel、Buffer</li></ul><h5><span id="1channel通道">1.Channel（通道）</span></h5><ul><li><strong>作用</strong>：双向数据传输管道（支持读和写），替代传统 BIO 的流（Stream）。</li><li><strong>类型</strong>：<ul><li><code>SocketChannel</code>：TCP 客户端通道。</li><li><code>ServerSocketChannel</code>：TCP 服务端监听通道。</li><li><code>FileChannel</code>：文件读写通道。</li></ul></li></ul><h5><span id="2-buffer缓冲区">2. <strong>Buffer（缓冲区）</strong></span></h5><ul><li><p><strong>作用</strong>：数据暂存容器，减少直接操作底层数据源的次数。</p></li><li><p><strong>类型</strong>：<code>ByteBuffer</code>（最常用）、<code>CharBuffer</code>、<code>IntBuffer</code> 等。</p></li><li><p><strong>关键方法</strong>：</p><ul><li><code>put()</code>：写入数据。</li><li><code>get()</code>：读取数据。</li><li><code>flip()</code>：切换读写模式。</li><li><code>clear()</code>：清空缓冲区（可复用）。</li></ul><p><img src="/../images/image-20250511223235244.png" alt="image-20250511223235244"></p><p>Buffer类中很重要的几个字段：</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 标记位置，默认为-1，表示尚未设置标记</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">mark</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当前位置，用于指示当前操作的位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">position</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 限制位置，表示可以操作的最大位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> limit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 容量，表示最大容量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5><span id="3-selector选择器">3. <strong>Selector（选择器）</strong></span></h5><ul><li><strong>作用</strong>：单线程监听多个通道的 I&#x2F;O 事件（如连接、读、写），实现多路复用。</li><li><strong>核心事件</strong>：<ul><li><code>OP_ACCEPT</code>：服务端接收新连接。</li><li><code>OP_CONNECT</code>：客户端完成连接。</li><li><code>OP_READ</code>：数据可读。</li><li><code>OP_WRITE</code>：数据可写。</li></ul></li></ul><p><img src="/../images/image-20250511220614709.png" alt="image-20250511220614709"></p><h4><span id="3-ix2fo-多路复用">3. <strong>I&#x2F;O 多路复用</strong></span></h4><ul><li><strong>特点</strong>：通过 <strong>Selector&#x2F;Epoll</strong> 监控多个 I&#x2F;O 事件，当某个通道就绪时通知线程处理。</li><li><strong>优点</strong>：单线程高效管理多个连接，减少线程切换开销。</li><li><strong>核心组件</strong>：<ul><li><code>Selector</code>（Java NIO）</li><li><code>epoll</code>（Linux）</li><li><code>kqueue</code>（BSD）</li></ul></li><li><strong>应用场景</strong>：高并发服务器（如 Netty、Nginx）。</li></ul><h4><span id="4aio">4.AIO</span></h4><p><strong>异步 I&#x2F;O（Asynchronous I&#x2F;O，AIO）</strong></p><ul><li><strong>特点</strong>：线程发起 I&#x2F;O 操作后立即返回，内核负责将数据从内核缓冲区拷贝到用户缓冲区，完成后通知线程。</li><li><strong>优点</strong>：完全非阻塞，无轮询或等待。</li><li><strong>缺点</strong>：实现复杂，依赖操作系统支持（如 Linux AIO 不完善）。</li><li><strong>应用场景</strong>：文件操作或高吞吐场景（如 Java <code>AsynchronousFileChannel</code>）。</li></ul><h2><span id="nio">NIO</span></h2><p><img src="/./../images/image-20250512095154867.png" alt="image-20250512095154867"></p><h3><span id="1buffer缓冲区">1.Buffer(缓冲区)</span></h3><p><img src="/./../images/image-20250512094837223.png" alt="image-20250512094837223"></p><p>核心属性：</p><table><thead><tr><th align="left">属性</th><th align="left">描述</th><th align="left">初始值</th><th align="left">约束条件</th></tr></thead><tbody><tr><td align="left"><strong><code>capacity</code></strong></td><td align="left">缓冲区的总容量（元素个数），创建时确定后不可修改。</td><td align="left">由 <code>allocate()</code> 或 <code>wrap()</code> 确定</td><td align="left"><code>capacity ≥ 0</code></td></tr><tr><td align="left"><strong><code>position</code></strong></td><td align="left">下一个要读&#x2F;写的索引位置。初始为 <code>0</code>，每读&#x2F;写一个元素递增 <code>1</code>。</td><td align="left"><code>0</code></td><td align="left"><code>0 ≤ position ≤ limit</code></td></tr><tr><td align="left"><strong><code>limit</code></strong></td><td align="left">第一个不能读&#x2F;写的索引（即读写操作的终点）。初始等于 <code>capacity</code>，可动态调整。</td><td align="left"><code>capacity</code></td><td align="left"><code>0 ≤ limit ≤ capacity</code></td></tr><tr><td align="left"><strong><code>mark</code></strong></td><td align="left">标记一个临时位置，后续可通过 <code>reset()</code> 将 <code>position</code> 恢复到此值。默认未标记（<code>-1</code>）。</td><td align="left"></td><td align="left"></td></tr></tbody></table><p>Buffer类是一个抽象类，有很多子类继承其方法完成特定数据的缓冲操作</p><p><img src="/./../images/image-20250512092025041.png" alt="image-20250512092025041"></p><p>Buffer类中包括的方法：</p><p><img src="/./../images/image-20250512092214379.png" alt="image-20250512092214379"></p><h4><span id="1核心方法">（1）核心方法：</span></h4><p>这些方法用于管理缓冲区的核心属性：<strong>容量（Capacity）</strong>、<strong>位置（Position）</strong>、<strong>限制（Limit）</strong>。</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>int capacity()</code></td><td align="left">返回缓冲区的总容量，创建后不可修改。</td></tr><tr><td align="left"><code>int position()</code></td><td align="left">返回当前读写位置（索引）。</td></tr><tr><td align="left"><code>Buffer position(int p)</code></td><td align="left">设置当前读写位置，需满足 <code>0 ≤ p ≤ limit</code>。</td></tr><tr><td align="left"><code>int limit()</code></td><td align="left">返回缓冲区的读写限制（<code>position</code> 不能超过此值）。</td></tr><tr><td align="left"><code>Buffer limit(int l)</code></td><td align="left">设置读写限制，需满足 <code>0 ≤ l ≤ capacity</code>。</td></tr></tbody></table><h4><span id="2状态切换">（2）状态切换</span></h4><p>用于在<strong>读模式</strong>和<strong>写模式</strong>之间切换缓冲区的状态。</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>Buffer clear()</code></td><td align="left">重置缓冲区为写模式：<code>position=0</code>, <code>limit=capacity</code>，数据未清除，但可被覆盖。</td></tr><tr><td align="left"><code>Buffer flip()</code></td><td align="left">切换为读模式：<code>limit=position</code>, <code>position=0</code>，通常在写入数据后调用。</td></tr><tr><td align="left"><code>Buffer rewind()</code></td><td align="left">重置 <code>position=0</code>，保持 <code>limit</code> 不变，用于重新读取数据。</td></tr><tr><td align="left"><code>Buffer compact()</code></td><td align="left">（子类实现，如 <code>ByteBuffer</code>）压缩缓冲区，将未读数据移到头部，准备继续写入。</td></tr></tbody></table><h4><span id="3读写方法">（3）读写方法</span></h4><p>用于向缓冲区写入数据（<code>put</code>）或从缓冲区读取数据（<code>get</code>），具体方法由子类实现。</p><h5><span id="1-基本读写方法">1. 基本读写方法</span></h5><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>ByteBuffer put(byte b)</code></td><td align="left">写入一个字节，<code>position</code> 递增。</td></tr><tr><td align="left"><code>ByteBuffer put(byte[] src)</code></td><td align="left">写入字节数组。</td></tr><tr><td align="left"><code>byte get()</code></td><td align="left">读取一个字节，<code>position</code> 递增。</td></tr><tr><td align="left"><code>ByteBuffer get(byte[] dst)</code></td><td align="left">读取字节到数组。</td></tr></tbody></table><p><img src="/./../images/image-20250512092633915.png" alt="image-20250512092633915"></p><h5><span id="2批量读写">2.批量读写</span></h5><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>Buffer put(Buffer src)</code></td><td align="left">将另一个缓冲区的数据复制到当前缓冲区。</td></tr><tr><td align="left"><code>Buffer get(byte[] dst, int offset, int length)</code></td><td align="left">从缓冲区读取数据到数组的指定位置。</td></tr></tbody></table><h4><span id="4标记与重置">（4）<strong>标记与重置</strong></span></h4><p>用于标记和恢复 <code>position</code> 的位置。</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>Buffer mark()</code></td><td align="left">标记当前 <code>position</code>，后续可通过 <code>reset()</code> 恢复到此位置。</td></tr><tr><td align="left"><code>Buffer reset()</code></td><td align="left">将 <code>position</code> 重置到之前标记的位置。</td></tr></tbody></table><h4><span id="5工具方法">（5）<strong>工具方法</strong></span></h4><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>int remaining()</code></td><td align="left">返回剩余可操作的元素数量：<code>limit - position</code>。</td></tr><tr><td align="left"><code>boolean hasRemaining()</code></td><td align="left">检查是否还有剩余元素可操作（<code>position &lt; limit</code>）。</td></tr><tr><td align="left"><code>boolean isReadOnly()</code></td><td align="left">判断缓冲区是否为只读。</td></tr><tr><td align="left"><code>boolean isDirect()</code></td><td align="left">（如 <code>ByteBuffer</code>）判断是否是直接内存（堆外内存）缓冲区。</td></tr></tbody></table><hr><h4><span id="6视图与复制"><strong>（6）视图与复制</strong></span></h4><p>用于创建缓冲区的视图或副本，共享底层数据但独立维护属性。</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>Buffer duplicate()</code></td><td align="left">创建缓冲区的副本，共享数据但独立维护 <code>position</code>、<code>limit</code> 等属性。</td></tr><tr><td align="left"><code>Buffer slice()</code></td><td align="left">创建当前缓冲区的一个子视图，范围从 <code>position</code> 到 <code>limit</code>。</td></tr></tbody></table><h3><span id="2channel">2.Channel</span></h3><p>在 Java NIO 中，<strong>Channel（通道）</strong> 是用于在数据源（如文件、网络套接字）和缓冲区（<code>Buffer</code>）之间高效传输数据的抽象。它与传统 I&#x2F;O 的流（<code>InputStream</code>&#x2F;<code>OutputStream</code>）类似，但具有更强大的功能，如支持非阻塞模式、双向读写（部分实现）以及内存映射文件操作。</p><p>Channel在Java中是一个接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Channel</span> <span class="keyword">extends</span> <span class="title class_">Closeable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isOpen</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="区别channel和stream">区别（Channel和Stream）：</span></h4><p>1.Channel可以同时进行读写，流只能读或写</p><p>2.通道可以实现异步读写</p><p>3。通道可以写数据到缓冲区，也可以从缓冲区读数据</p><h4><span id="实现子类">实现子类：</span></h4><p><img src="/./../images/image-20250512095859173.png" alt="image-20250512095859173"></p><table><thead><tr><th align="left"><strong>Channel 子类</strong></th><th align="left"><strong>应用场景</strong></th><th align="left"><strong>关键特性</strong></th></tr></thead><tbody><tr><td align="left"><code>FileChannel</code></td><td align="left">文件读写</td><td align="left">内存映射、零拷贝传输</td></tr><tr><td align="left"><code>SocketChannel</code></td><td align="left">TCP 客户端通信</td><td align="left">非阻塞模式、Selector 多路复用</td></tr><tr><td align="left"><code>ServerSocketChannel</code></td><td align="left">TCP 服务端监听</td><td align="left">接受客户端连接</td></tr><tr><td align="left"><code>DatagramChannel</code></td><td align="left">UDP 数据报通信</td><td align="left">无连接、支持广播</td></tr><tr><td align="left"><code>Pipe.Source/SinkChannel</code></td><td align="left">线程间通信</td><td align="left">单向数据传输</td></tr><tr><td align="left"><code>AsynchronousFileChannel</code></td><td align="left">异步文件操作</td><td align="left">回调或 Future 模式</td></tr><tr><td align="left"><code>AsynchronousSocketChannel</code></td><td align="left">异步 TCP 通信</td><td align="left">非阻塞、高并发支持</td></tr></tbody></table><h4><span id="filechannel类">FileChannel类</span></h4><p>用于文件的读写、内存映射及零拷贝传输。</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong>读写操作</strong></td><td align="left"></td></tr><tr><td align="left"><code>int read(ByteBuffer dst)</code></td><td align="left">从通道读取数据到 <code>ByteBuffer</code>，返回实际读取的字节数（可能为 <code>0</code>）。</td></tr><tr><td align="left"><code>int write(ByteBuffer src)</code></td><td align="left">将 <code>ByteBuffer</code> 中的数据写入通道，返回实际写入的字节数。</td></tr><tr><td align="left"><strong>定位与截断</strong></td><td align="left"></td></tr><tr><td align="left"><code>long position()</code></td><td align="left">返回当前文件指针的位置。</td></tr><tr><td align="left"><code>FileChannel position(long newPosition)</code></td><td align="left">设置文件指针的位置（用于随机读写）。</td></tr><tr><td align="left"><code>FileChannel truncate(long size)</code></td><td align="left">截断文件到指定大小（丢弃超出部分）。</td></tr><tr><td align="left"><strong>内存映射与零拷贝</strong></td><td align="left"></td></tr><tr><td align="left"><code>MappedByteBuffer map(MapMode mode, long position, long size)</code></td><td align="left">将文件映射到内存，返回 <code>MappedByteBuffer</code>。模式包括：<code>READ_ONLY</code>、<code>READ_WRITE</code>、<code>PRIVATE</code>。</td></tr><tr><td align="left"><code>long transferTo(long position, long count, WritableByteChannel target)</code></td><td align="left">将文件数据从 <code>position</code> 开始的 <code>count</code> 字节直接传输到目标通道（零拷贝优化）。</td></tr><tr><td align="left"><code>long transferFrom(ReadableByteChannel src, long position, long count)</code></td><td align="left">从源通道读取数据，直接写入文件的指定位置（零拷贝优化）。</td></tr><tr><td align="left"><strong>文件锁</strong></td><td align="left"></td></tr><tr><td align="left"><code>FileLock lock()</code></td><td align="left">获取文件的独占锁（阻塞直到获取成功）。</td></tr><tr><td align="left"><code>FileLock tryLock()</code></td><td align="left">尝试非阻塞获取锁，失败返回 <code>null</code>。</td></tr></tbody></table><p><img src="/./../images/image-20250512100231746.png" alt="image-20250512100231746"></p><h4><span id="socketchannel类">SocketChannel类</span></h4><p>（TCP 客户端）</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>boolean connect(SocketAddress remote)</code></td><td align="left">连接到服务端地址。在非阻塞模式下可能返回 <code>false</code>，需后续调用 <code>finishConnect()</code> 完成连接。</td></tr><tr><td align="left"><code>boolean finishConnect()</code></td><td align="left">完成非阻塞模式下的连接过程（需循环检查）。</td></tr><tr><td align="left"><code>boolean isConnected()</code></td><td align="left">检查是否已成功连接到服务端。</td></tr><tr><td align="left"><strong>非阻塞模式</strong></td><td align="left"></td></tr><tr><td align="left"><code>SocketChannel configureBlocking(boolean block)</code></td><td align="left">设置阻塞模式（<code>true</code> 为阻塞，默认值）。</td></tr><tr><td align="left"><strong>注册到 Selector</strong></td><td align="left"></td></tr><tr><td align="left"><code>SelectionKey register(Selector sel, int ops)</code></td><td align="left">将通道注册到 <code>Selector</code>，监听指定事件（如 <code>SelectionKey.OP</code></td></tr></tbody></table><p><img src="/./../images/image-20250512100841362.png" alt="image-20250512100841362"></p><h4><span id="serversocketchannel类">ServerSocketChannel类</span></h4><p>（TCP 服务端）</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>ServerSocketChannel bind(SocketAddress local)</code></td><td align="left">绑定到指定端口（如 <code>new InetSocketAddress(8080)</code>）。</td></tr><tr><td align="left"><code>SocketChannel accept()</code></td><td align="left">接受客户端连接请求，返回对应的 <code>SocketChannel</code>（阻塞模式下会等待连接）。</td></tr><tr><td align="left"><strong>非阻塞模式</strong></td><td align="left"></td></tr><tr><td align="left"><code>configureBlocking(boolean block)</code></td><td align="left">设置非阻塞模式后，<code>accept()</code> 可能立即返回 <code>null</code>。</td></tr></tbody></table><p><img src="/./../images/image-20250512100908934.png" alt="image-20250512100908934"></p><h4><span id="datagramchannel类">DatagramChannel类</span></h4><p>（UDP 通信）</p><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><code>DatagramChannel bind(SocketAddress local)</code></td><td align="left">绑定本地端口接收数据（如 <code>new InetSocketAddress(9090)</code>）。</td></tr><tr><td align="left"><code>int send(ByteBuffer src, SocketAddress target)</code></td><td align="left">发送数据包到目标地址。</td></tr><tr><td align="left"><code>SocketAddress receive(ByteBuffer dst)</code></td><td align="left">接收数据包到 <code>ByteBuffer</code>，返回发送方的地址。</td></tr></tbody></table><p><img src="/./../images/image-20250512100938931.png" alt="image-20250512100938931"></p><h3><span id="3selector">3.Selector</span></h3><p>用一个线程处理多个客户端连接，就会用到Selector，可以检测注册的多个通道中是否有事件发生，只有通道有读写事件发生时才会进行读写操作，不必为每个连接都创建线程，减少系统开销</p><p>Selector是一个抽象类</p><p><img src="/./../images/image-20250512101426081.png" alt="image-20250512101426081"></p><h4><span id="核心特点">核心特点：</span></h4><ol><li><strong>多路复用</strong>：单线程可管理多个 <code>Channel</code>，减少线程资源消耗。</li><li><strong>非阻塞模式</strong>：需将 <code>Channel</code> 设置为非阻塞模式（<code>configureBlocking(false)</code>）才能注册到 <code>Selector</code>。</li><li><strong>事件驱动</strong>：通过监听 <code>SelectionKey</code> 标识的事件（如 <code>OP_READ</code>、<code>OP_WRITE</code>）触发操作。</li></ol><h4><span id="常用方法"><strong>常用方法</strong></span></h4><table><thead><tr><th align="left">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left"><strong><code>static Selector open()</code></strong></td><td align="left">创建一个新的 <code>Selector</code> 实例。</td></tr><tr><td align="left"><strong><code>int select()</code></strong></td><td align="left">阻塞等待至少一个已注册的 <code>Channel</code> 就绪事件，返回就绪事件的数量。</td></tr><tr><td align="left"><strong><code>int select(long timeout)</code></strong></td><td align="left">阻塞最多 <code>timeout</code> 毫秒，超时返回 <code>0</code>。</td></tr><tr><td align="left"><strong><code>int selectNow()</code></strong></td><td align="left">非阻塞检查就绪事件，立即返回当前就绪数量。</td></tr><tr><td align="left"><strong><code>Set&lt;SelectionKey&gt; selectedKeys()</code></strong></td><td align="left">返回已就绪的事件集合（需手动清理已处理的 <code>SelectionKey</code>）。</td></tr><tr><td align="left"><strong><code>Set&lt;SelectionKey&gt; keys()</code></strong></td><td align="left">返回所有注册到该 <code>Selector</code> 的 <code>SelectionKey</code> 集合（不可直接修改）。</td></tr><tr><td align="left"><strong><code>Selector wakeup()</code></strong></td><td align="left">唤醒因 <code>select()</code> 阻塞的线程。</td></tr><tr><td align="left"><strong><code>void close()</code></strong></td><td align="left">关闭 <code>Selector</code> 并释放资源。</td></tr></tbody></table><h3><span id="聊天案例">聊天案例</span></h3><p><img src="/./../images/image-20250512155357167.png" alt="image-20250512155357167"></p><h4><span id="服务端">服务端</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.nio.chat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="comment">// 存储当前群聊的所有在线用户</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;SocketChannel&gt; clients = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;SocketChannel&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.创建服务器通道并绑定端口</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        <span class="comment">// 2.绑定端口并设置为非阻塞</span></span><br><span class="line">        server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">        server.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器启动成功&quot;</span> + server.getLocalAddress());</span><br><span class="line">        <span class="comment">// 3.创建选择器</span></span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">        <span class="comment">// 4.注册服务器通道到选择器中</span></span><br><span class="line">        server.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 5.等待客户端连接</span></span><br><span class="line">            selector.select();</span><br><span class="line">            <span class="comment">// 6.获取选择器中所有注册的通道</span></span><br><span class="line">            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">            <span class="comment">// 7.遍历选择器中的所有通道</span></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();</span><br><span class="line">            <span class="comment">// 8.处理每个通道</span></span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                iterator.remove(); <span class="comment">// 必须移除已处理的 key</span></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">                    <span class="comment">// 9.处理新连接</span></span><br><span class="line">                    handleAccept(key, selector);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                    <span class="comment">// 10.处理数据读取</span></span><br><span class="line">                    handleRead(key);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理新连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> selector</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleAccept</span><span class="params">(SelectionKey key, Selector selector)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ServerSocketChannel</span> <span class="variable">serverChannel</span> <span class="operator">=</span> (ServerSocketChannel) key.channel(); <span class="comment">// 获取服务器通道</span></span><br><span class="line">            <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverChannel.accept(); <span class="comment">// 获取客户端通道</span></span><br><span class="line">            clients.add(socketChannel);</span><br><span class="line">            socketChannel.configureBlocking(<span class="literal">false</span>); <span class="comment">// 设置为非阻塞</span></span><br><span class="line">            socketChannel.register(selector, SelectionKey.OP_READ); <span class="comment">// 注册到选择器中</span></span><br><span class="line">            System.out.println(<span class="string">&quot;客户端连接: &quot;</span> + socketChannel.getRemoteAddress());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理读写</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleRead</span><span class="params">(SelectionKey key)</span>&#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">clientChannel</span> <span class="operator">=</span> (SocketChannel) key.channel();</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bytesRead = clientChannel.read(buffer);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            closeClient(clientChannel);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">            closeClient(clientChannel);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (bytesRead &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[buffer.remaining()];</span><br><span class="line">            buffer.get(data);</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(data).trim();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;客户端收到消息 [&quot;</span> + clientChannel.getRemoteAddress() + <span class="string">&quot;]: &quot;</span> + message);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 广播给其他客户端</span></span><br><span class="line">            broadcastMessage(message, clientChannel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">broadcastMessage</span><span class="params">(String message, SocketChannel clientChannel)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (clients.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line">       <span class="type">ByteBuffer</span> <span class="variable">byteBuffer</span> <span class="operator">=</span> ByteBuffer.wrap((message + <span class="string">&#x27;\n&#x27;</span>).getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap((message + <span class="string">&quot;\n&quot;</span>).getBytes());</span><br><span class="line">        <span class="keyword">for</span> (SocketChannel client : clients) &#123;</span><br><span class="line">            <span class="keyword">if</span> (client != clientChannel &amp;&amp; client.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    client.write(buffer);</span><br><span class="line">                    buffer.rewind(); <span class="comment">// 重置buffer供下次写入</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    closeClient(client);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeClient</span><span class="params">(SocketChannel clientChannel)</span> &#123;</span><br><span class="line">        clients.remove(clientChannel);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;客户端断开连接: &quot;</span> + clientChannel.getRemoteAddress());</span><br><span class="line">            clientChannel.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="客户端">客户端</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.nio.chat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">        client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        client.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;连接服务器...&quot;</span>);</span><br><span class="line">        <span class="comment">// 等待连接完成</span></span><br><span class="line">        <span class="keyword">while</span> (!client.finishConnect()) &#123;</span><br><span class="line">            <span class="comment">// 可以做一些其他处理或者等待</span></span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;等待连接...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 开启线程读取服务端推送的消息</span></span><br><span class="line">        <span class="comment">// 启动读取线程</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 从缓冲区读取数据</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> client.read(buffer);</span><br><span class="line">                    <span class="keyword">if</span> (bytesRead &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        System.out.println(<span class="string">&quot;[群消息] &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, bytesRead));</span><br><span class="line">                        buffer.clear();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">        <span class="comment">// 循环发送消息</span></span><br><span class="line">        <span class="comment">// 控制台输入</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">            <span class="comment">// 发送给服务器端</span></span><br><span class="line">            client.write(ByteBuffer.wrap(msg.getBytes()));</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;exit&quot;</span>.equals(msg)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="零拷贝">零拷贝</span></h3><h4><span id="什么是零拷贝">什么是零拷贝？</span></h4><blockquote><p>​零拷贝（Zero-copy）技术指在计算机执行操作时，<strong>CPU 不需要先将数据从⼀个内存区域复制到另⼀个内存区域</strong>，从⽽可以减少上下⽂切换以及 CPU 的拷贝时间。它的作用是在数据从网络设备到⽤户程序空间传递的过程中，<strong>减少数据拷贝次数，减少系统调用，实现 CPU 的零参与，彻底消除 CPU 在这方面的负载</strong>。</p><p>　　实现零拷贝用到的最主要技术是 <strong>DMA 数据传输技术</strong>和<strong>内存区域映射技术</strong>。</p><p>　　零拷贝机制可以减少数据在内核缓冲区和⽤户进程缓冲区之间反复的 I&#x2F;O 拷贝操作。零拷贝机制可以减少用户进程地址空间和内核地址空间之间因为上下⽂切换⽽带来的 CPU 开销。在 Java 程序中，常⽤的零拷贝有 mmap（内存映射）和 sendFile。</p><p>源自：<a href="https://www.cnblogs.com/liconglong/p/15211413.html">https://www.cnblogs.com/liconglong/p/15211413.html</a></p></blockquote><h4><span id="传统-ix2fo-的数据拷贝流程"><strong>传统 I&#x2F;O 的数据拷贝流程</strong></span></h4><p><strong>4 次上下文切换 + 4 次数据拷贝（其中 2 次由 CPU 参与），效率较低。</strong></p><p>在传统 I&#x2F;O 操作中（例如从文件读取数据并发送到网络），数据需要经历多次拷贝和上下文切换：</p><ol><li><strong>磁盘 → 内核缓冲区</strong>：数据从磁盘读取到内核空间的缓冲区（通过 DMA 技术）。</li><li><strong>内核缓冲区 → 用户缓冲区</strong>：数据从内核空间拷贝到用户空间的应用程序缓冲区（需要 CPU 参与）。</li><li><strong>用户缓冲区 → Socket 缓冲区</strong>：应用程序将数据从用户缓冲区拷贝到内核空间的 Socket 缓冲区（再次 CPU 参与）。</li><li><strong>Socket 缓冲区 → 网卡</strong>：数据从 Socket 缓冲区发送到网络设备（通过 DMA）。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDemoServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;file/test01.txt&quot;</span>);</span><br><span class="line">        <span class="type">RandomAccessFile</span> <span class="variable">randomAccessFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RandomAccessFile</span>(file, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[(<span class="type">int</span>) file.length()];</span><br><span class="line">        randomAccessFile.read(bytes); <span class="comment">// 读取文件</span></span><br><span class="line">        <span class="comment">// 创建服务端 等待客户端连接发送文件</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">3333</span>);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> client.getOutputStream();</span><br><span class="line">        outputStream.write(bytes);</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileDemoClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>();</span><br><span class="line">        socket.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        inputStream.read(bytes);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="零拷贝的两种常见实现"><strong>零拷贝的两种常见实现</strong></span></h4><ol><li><strong><code>sendfile</code> 系统调用</strong>：<ul><li>数据直接从文件描述符传输到 Socket 描述符，无需用户态参与。</li><li>适用于文件到网络的传输（如 HTTP 文件下载）。</li></ul></li><li><strong>内存映射文件（<code>mmap</code>）</strong>：<ul><li>将文件映射到用户态虚拟内存，用户程序直接操作内存，减少拷贝次数。</li><li>适用于需要频繁修改文件的场景（如数据库）</li></ul></li></ol><h4><span id="mmap-和-sendfile-的区别"><strong>mmap</strong> <strong>和</strong> <strong>sendFile</strong> <strong>的区别</strong></span></h4><p>1.mmap 适合小数据量读写，sendFile 适合大文件传输。</p><p>2.mmap 需要 4 次上下文切换，3 次数据拷贝；sendFile 需要 3 次上下文切换，最少 2 次数据拷贝。</p><p>3.sendFile 可以利用 DMA 方式，减少 CPU 拷贝，mmap 则不能（必须从内核拷贝到 Socket 缓冲区）。</p><h4><span id="传统-ix2fo-vs-nio-零拷贝的对比"><strong>传统 I&#x2F;O vs NIO 零拷贝的对比</strong></span></h4><table><thead><tr><th align="left"><strong>步骤</strong></th><th align="left"><strong>传统 I&#x2F;O</strong></th><th align="left"><strong>NIO + 零拷贝</strong></th></tr></thead><tbody><tr><td align="left"><strong>数据拷贝次数</strong></td><td align="left">4 次（2 次用户态↔内核态）</td><td align="left">2 次（仅内核态内拷贝）</td></tr><tr><td align="left"><strong>CPU 参与次数</strong></td><td align="left">2 次（用户态↔内核态拷贝）</td><td align="left">0 次（DMA 完成）</td></tr><tr><td align="left"><strong>上下文切换次数</strong></td><td align="left">4 次（读&#x2F;写各 2 次）</td><td align="left">2 次（系统调用发起和完成）</td></tr><tr><td align="left"><strong>典型实现</strong></td><td align="left"><code>FileInputStream.read()</code> + <code>Socket.send()</code></td><td align="left"><code>FileChannel.transferTo()</code></td></tr></tbody></table><h4><span id="dma和内存映射">DMA和内存映射</span></h4><table><thead><tr><th align="left"><strong>技术</strong></th><th align="left"><strong>核心作用</strong></th><th align="left"><strong>应用场景</strong></th></tr></thead><tbody><tr><td align="left"><strong>DMA</strong></td><td align="left">外设与内存直接传输数据，减少 CPU 参与</td><td align="left">磁盘 I&#x2F;O、网络通信、GPU 渲染</td></tr><tr><td align="left"><strong>内存区域映射</strong></td><td align="left">将外设或文件映射到内存，实现零拷贝访问</td><td align="left">文件高效读写、硬件控制、进程间通信</td></tr></tbody></table><h4><span id="零拷贝性能分析">零拷贝性能分析</span></h4><p>（服务端向客户端发送大文件）</p><h5><span id="不使用零拷贝">不使用零拷贝：</span></h5><p>OldServer.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OldServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">        server.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">        server.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        selector.select(); <span class="comment">// 阻塞等待客户端连接</span></span><br><span class="line">        Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">        <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (SelectionKey selectionKey : selectionKeys) &#123;</span><br><span class="line">            <span class="keyword">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class="line">                handle(selectionKey, selector);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">t2</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时：&quot;</span> + (t2 - t1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> selector</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(SelectionKey key, Selector selector)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;file/protoc-3.6.1-win32.zip&quot;</span>);</span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> (ServerSocketChannel) key.channel();</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">        <span class="comment">// 注册</span></span><br><span class="line">        client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        client.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">// 获取文件输入流</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (fileInputStream.available() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br><span class="line">            fileInputStream.read(bytes);</span><br><span class="line">            <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> client.write(ByteBuffer.wrap(bytes));</span><br><span class="line">            System.out.println(<span class="string">&quot;发送了：&quot;</span> + sum + <span class="string">&quot;字节&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fileInputStream.close();</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OldClient.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OldClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">        client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        client.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;连接服务器...&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (!client.finishConnect()) &#123;</span><br><span class="line">            <span class="comment">// 可以做一些其他处理或者等待</span></span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;等待连接完成...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;连接完成...&quot;</span>);</span><br><span class="line">        <span class="comment">// 从服务器读取数据</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">while</span>  (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">4096</span>];</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(bytes);</span><br><span class="line">            <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> client.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (read == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">t2</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时：&quot;</span> + (t2 - t1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5><span id="使用零拷贝">使用零拷贝：</span></h5><p>NewServer.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewServer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        server.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        server.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">        <span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line">        server.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        selector.select();</span><br><span class="line">        Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">        <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">for</span> (SelectionKey selectionKey : selectionKeys) &#123;</span><br><span class="line">            <span class="keyword">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class="line">                handle(selectionKey, selector);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">t2</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时：&quot;</span> + (t2 - t1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(SelectionKey key, Selector selector)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">server</span> <span class="operator">=</span> (ServerSocketChannel) key.channel();</span><br><span class="line">        <span class="comment">// 1.获得客户端</span></span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> server.accept();</span><br><span class="line">        client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 2.注册</span></span><br><span class="line">        client.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">// 3.获得文件输出流</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="string">&quot;file/protoc-3.6.1-win32.zip&quot;</span>;</span><br><span class="line">        <span class="type">FileChannel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename).getChannel();</span><br><span class="line">        <span class="comment">// 4.使用transferTo实现零拷贝传输</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum</span> <span class="operator">=</span> channel.transferTo(<span class="number">0</span>, channel.size(), client);</span><br><span class="line">        System.out.println(<span class="string">&quot;发送了&quot;</span> + sum + <span class="string">&quot;字节&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>NewClient.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = SocketChannel.open();</span><br><span class="line">            client.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">            client.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">3333</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;连接服务器...&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!client.finishConnect()) &#123;</span><br><span class="line">                <span class="comment">// 等待连接完成</span></span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;正在连接中。。。&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">4096</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    read = client.read(buffer);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    client.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (read == -<span class="number">1</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;服务端已关闭连接&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (read &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;收到服务端的消息：&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, read));</span><br><span class="line">                    buffer.clear(); <span class="comment">// 清空 buffer 以便下次读取</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>); <span class="comment">// 等待数据到达</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;连接已关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>性能比较：</p><p><img src="/../images/image-20250513143311587.png" alt="image-20250513143311587"></p><p><img src="/./../images/image-20250513143341454.png" alt="image-20250513143341454"></p><blockquote><p>很显然零拷贝性能要高很多</p></blockquote><h1><span id="reactor模式">Reactor模式</span></h1><h2><span id="什么是reactor模式">什么是Reactor模式？</span></h2><p>Reactor 模式是一种事件驱动模型，核心思想是 <strong>通过一个或多个线程监听 I&#x2F;O 事件（如连接、读写），并将事件分发给对应的处理器</strong>。常见的 Reactor 变体包括：</p><ul><li><strong>单 Reactor 单线程</strong>：所有操作（连接、I&#x2F;O）由一个线程完成，简单但性能受限。</li><li><strong>单 Reactor 多线程</strong>：主线程处理连接，I&#x2F;O 操作交给线程池，但主线程可能成为瓶颈。</li><li><strong>主从 Reactor 多线程</strong>：主 Reactor 处理连接，子 Reactor 处理 I&#x2F;O，Netty 默认采用此模式。</li></ul><p><img src="/./../images/image-20250513224534582.png" alt="image-20250513224534582"></p><h3><span id="理解">理解：</span></h3><p>reactor可以认为是一种设计模式，用于处理客户端的事件，主要是通过select和dispatch操作来监听事件发生和处理事件</p><h3><span id="主要逻辑">主要逻辑：</span></h3><blockquote><p>1.服务器注册到selector中，为其连接事件分配一个Handler（其实是一个Runnable对象， 名称可以定义为Acceptor）</p><p>2.Reactor监听事件发生，当事件发生时，会通过dispatch将时间分发给具体的处理器</p><p>3.dispatch通过SelectionKey（可以认为是selector实例对象中的事件id）的attachment来获取具体的Handler</p><p>4.执行具体的Handler逻辑</p></blockquote><h2><span id="单reactor单线程">单Reactor单线程</span></h2><h3><span id="键值存储服务器">键值存储服务器:</span></h3><p>SingleThreadReactorKVStore.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单线程 Reactor 模式的键值存储服务器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleThreadReactorKVStore</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerSocketChannel serverChannel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; store = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(); <span class="comment">// 内存键值存储</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数，初始化服务器通道和选择器，并监听指定端口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port 服务器监听的端口号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 如果初始化通道或选择器时发生I/O错误</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SingleThreadReactorKVStore</span><span class="params">(<span class="type">int</span> port)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        selector = Selector.open();</span><br><span class="line">        serverChannel = ServerSocketChannel.open();</span><br><span class="line">        serverChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(port));</span><br><span class="line">        serverChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 注册 Accept 事件到 Reactor</span></span><br><span class="line">        serverChannel.register(selector, SelectionKey.OP_ACCEPT, <span class="keyword">new</span> <span class="title class_">Acceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动服务器，进入事件循环</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Reactor thread: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.interrupted()) &#123;</span><br><span class="line">                selector.select(); <span class="comment">// 阻塞等待事件</span></span><br><span class="line">                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">                Iterator&lt;SelectionKey&gt; it = keys.iterator();</span><br><span class="line">                <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> it.next();</span><br><span class="line">                    dispatch(key); <span class="comment">// 根据事件类型分发事件到具体的处理器</span></span><br><span class="line">                    it.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                serverChannel.close();</span><br><span class="line">                selector.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分发事件到对应的处理器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 事件的 SelectionKey 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dispatch</span><span class="params">(SelectionKey key)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取与键关联的附件，这里附件是一个Runnable对象</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">handler</span> <span class="operator">=</span> (Runnable) key.attachment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查获取到的handler是否为null</span></span><br><span class="line">        <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">            handler.run(); <span class="comment">// 执行 Handler（Acceptor 或 IOHandler）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理 连接事件 的 Handler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Acceptor</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Acceptor thread: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">SocketChannel</span> <span class="variable">clientChannel</span> <span class="operator">=</span> serverChannel.accept();</span><br><span class="line">                System.out.println(<span class="string">&quot;客户端新连接 : &quot;</span> + clientChannel.getRemoteAddress());</span><br><span class="line">                <span class="keyword">if</span> (clientChannel != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">IOHandler</span>(clientChannel); <span class="comment">// 处理新连接的 I/O</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理 I/O 的 Handler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">IOHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SocketChannel channel;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 构造函数，初始化 SocketChannel 并注册读事件到选择器</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> channel 接收到的客户端通道</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> IOException 如果配置通道时发生I/O错误</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">IOHandler</span><span class="params">(SocketChannel channel)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="built_in">this</span>.channel = channel;</span><br><span class="line">            channel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">// 注册读事件到 Reactor</span></span><br><span class="line">            channel.register(selector, SelectionKey.OP_READ, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;IOHandler thread: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 检查通道是否已经关闭，如果关闭则直接返回</span></span><br><span class="line">                <span class="keyword">if</span> (!channel.isOpen()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 清空缓冲区以准备读取新的数据</span></span><br><span class="line">                buffer.clear();</span><br><span class="line">                <span class="comment">// 读取数据到缓冲区</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line">                <span class="comment">// 如果没有更多数据可读，关闭通道并返回</span></span><br><span class="line">                <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 解析请求并执行业务逻辑（单线程处理）</span></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="type">String</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.limit()).trim();</span><br><span class="line">                <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> processCommand(request);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 返回响应</span></span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">respBuffer</span> <span class="operator">=</span> ByteBuffer.wrap((response + <span class="string">&quot;\n&quot;</span>).getBytes());</span><br><span class="line">                channel.write(respBuffer);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="comment">// 如果发生IO异常，尝试关闭通道</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    <span class="comment">// 如果关闭通道时发生异常，打印异常信息</span></span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 业务逻辑处理（单线程执行）</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> request 客户端请求的字符串</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> 处理结果的字符串</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> String <span class="title function_">processCommand</span><span class="params">(String request)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Processing command: &quot;</span> + request);</span><br><span class="line">            String[] parts = request.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (parts.length &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="string">&quot;ERROR: Invalid command&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> parts[<span class="number">0</span>].toUpperCase();</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> parts[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (cmd) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;SET&quot;</span>:</span><br><span class="line">                    <span class="keyword">if</span> (parts.length &lt; <span class="number">3</span>) <span class="keyword">return</span> <span class="string">&quot;ERROR: Missing value&quot;</span>;</span><br><span class="line">                    store.put(key, parts[<span class="number">2</span>]);</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> store.getOrDefault(key, <span class="string">&quot;(nil)&quot;</span>);</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;ERROR: Unknown command&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">SingleThreadReactorKVStore</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleThreadReactorKVStore</span>(<span class="number">3333</span>);</span><br><span class="line">        server.start(); <span class="comment">// 单一线程运行所有逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Client.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicBoolean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicBoolean</span> <span class="variable">isConnected</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicBoolean</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">        socketChannel.configureBlocking(<span class="literal">false</span>); <span class="comment">// 非阻塞模式</span></span><br><span class="line">        socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">3333</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待连接完成</span></span><br><span class="line">        <span class="keyword">while</span> (!socketChannel.finishConnect()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;等待连接完成...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;已连接到服务器&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 监听服务器消息（包括连接关闭）</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">readThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (isConnected.get()) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> socketChannel.read(buffer);</span><br><span class="line">                    <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="comment">// 服务器关闭连接</span></span><br><span class="line">                        System.out.println(<span class="string">&quot;[服务器已关闭连接]&quot;</span>);</span><br><span class="line">                        isConnected.set(<span class="literal">false</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bytesRead &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        buffer.flip();</span><br><span class="line">                        System.out.println(<span class="string">&quot;[服务器消息] &quot;</span> +</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, bytesRead));</span><br><span class="line">                        buffer.clear();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isConnected.get()) &#123;</span><br><span class="line">                    System.err.println(<span class="string">&quot;连接异常: &quot;</span> + e.getMessage());</span><br><span class="line">                    isConnected.set(<span class="literal">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                closeChannel(socketChannel);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        readThread.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送消息循环</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in)) &#123;</span><br><span class="line">            <span class="keyword">while</span> (isConnected.get()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;exit&quot;</span>.equals(line)) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!isConnected.get()) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;连接已断开，无法发送消息&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(line.getBytes());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    socketChannel.write(buffer);</span><br><span class="line">                    System.out.println(<span class="string">&quot;已发送: &quot;</span> + line);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    System.err.println(<span class="string">&quot;发送失败: &quot;</span> + e.getMessage());</span><br><span class="line">                    isConnected.set(<span class="literal">false</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭连接</span></span><br><span class="line">        closeChannel(socketChannel);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeChannel</span><span class="params">(SocketChannel channel)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (channel != <span class="literal">null</span> &amp;&amp; channel.isOpen()) &#123;</span><br><span class="line">                channel.close();</span><br><span class="line">                System.out.println(<span class="string">&quot;连接已关闭&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src="/./../images/image-20250513220737289.png" alt="image-20250513220737289"></p><h2><span id="单-reactor-多线程">单 Reactor 多线程</span></h2><h3><span id="简单http-服务器">简单HTTP 服务器：</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单 Reactor 多线程的 HTTP 服务器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleReactorMultiThreadServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Selector selector;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ServerSocketChannel serverChannel;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">businessPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">4</span>); <span class="comment">// 业务线程池</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SingleReactorMultiThreadServer</span><span class="params">(<span class="type">int</span> port)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        selector = Selector.open();</span><br><span class="line">        serverChannel = ServerSocketChannel.open();</span><br><span class="line">        serverChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(port));</span><br><span class="line">        serverChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        serverChannel.register(selector, SelectionKey.OP_ACCEPT, <span class="keyword">new</span> <span class="title class_">Acceptor</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Reactor thread: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.interrupted()) &#123;</span><br><span class="line">                selector.select();</span><br><span class="line">                Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">                Iterator&lt;SelectionKey&gt; it = keys.iterator();</span><br><span class="line">                <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> it.next();</span><br><span class="line">                    dispatch(key);</span><br><span class="line">                    it.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dispatch</span><span class="params">(SelectionKey key)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">handler</span> <span class="operator">=</span> (Runnable) key.attachment();</span><br><span class="line">        <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">            handler.run();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  处理新连接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Acceptor</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">SocketChannel</span> <span class="variable">client</span> <span class="operator">=</span> serverChannel.accept();</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">IOHandler</span>(client); <span class="comment">// 注册读事件</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理 I/O 和业务逻辑</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">IOHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SocketChannel channel;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">IOHandler</span><span class="params">(SocketChannel channel)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="built_in">this</span>.channel = channel;</span><br><span class="line">            channel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">            channel.register(selector, SelectionKey.OP_READ, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!channel.isOpen()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Reactor 线程处理读事件（非阻塞）</span></span><br><span class="line">                buffer.clear();</span><br><span class="line">                <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line">                <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 解析请求（示例：HTTP GET）</span></span><br><span class="line">                buffer.flip();</span><br><span class="line">                <span class="type">String</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.limit());</span><br><span class="line">                <span class="keyword">if</span> (request.startsWith(<span class="string">&quot;GET&quot;</span>)) &#123;</span><br><span class="line">                    <span class="comment">// 提交耗时任务到线程池</span></span><br><span class="line">                    businessPool.submit(() -&gt; &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            processRequest(request);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (ClosedChannelException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(String request)</span> <span class="keyword">throws</span> ClosedChannelException &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Business thread: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Length: 12\r\n\r\nHello World!&quot;</span>;</span><br><span class="line">            <span class="comment">// 传递 channel 到 WriteHandler</span></span><br><span class="line">            channel.register(selector, SelectionKey.OP_WRITE, <span class="keyword">new</span> <span class="title class_">WriteHandler</span>(channel, response));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理 写操作 的  Handler</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">WriteHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SocketChannel channel;  <span class="comment">// 新增成员变量</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String response;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">WriteHandler</span><span class="params">(SocketChannel channel, String response)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.channel = channel;</span><br><span class="line">            <span class="built_in">this</span>.response = response;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(response.getBytes());</span><br><span class="line">                channel.write(buffer);</span><br><span class="line">                channel.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">SingleReactorMultiThreadServer</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleReactorMultiThreadServer</span>(<span class="number">3333</span>);</span><br><span class="line">        server.start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="/./../images/image-20250513215117104.png" alt="image-20250513215117104"></p><p><img src="/./../images/image-20250513215203737.png" alt="image-20250513215203737"></p><h2><span id="主从-reactor-多线程案例">主从 Reactor 多线程案例</span></h2><h3><span id="简易http服务器">简易Http服务器：</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentLinkedQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主从Reactor模式下的简易Http服务器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MasterSlaveReactorServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主 Reactor 线程组（单线程）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Reactor bossReactor;</span><br><span class="line">    <span class="comment">// 从 Reactor 线程组（多线程）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Reactor[] workerReactors;</span><br><span class="line">    <span class="comment">// 轮询计数器，用于分配连接给 Worker</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">workerIndex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 业务线程池（处理耗时任务）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ExecutorService</span> <span class="variable">businessPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MasterSlaveReactorServer</span><span class="params">(<span class="type">int</span> port, <span class="type">int</span> workerCount)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 初始化主 Reactor</span></span><br><span class="line">        bossReactor = <span class="keyword">new</span> <span class="title class_">Reactor</span>(<span class="string">&quot;Boss&quot;</span>);</span><br><span class="line">        <span class="comment">// 初始化从 Reactor 组</span></span><br><span class="line">        workerReactors = <span class="keyword">new</span> <span class="title class_">Reactor</span>[workerCount];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; workerCount; i++) &#123;</span><br><span class="line">            workerReactors[i] = <span class="keyword">new</span> <span class="title class_">Reactor</span>(<span class="string">&quot;Worker-&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主 Reactor 绑定 ServerSocketChannel</span></span><br><span class="line">        <span class="type">ServerSocketChannel</span> <span class="variable">serverChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">        serverChannel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(port));</span><br><span class="line">        serverChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">        bossReactor.register(serverChannel, SelectionKey.OP_ACCEPT, <span class="keyword">new</span> <span class="title class_">Acceptor</span>(serverChannel));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动主从 Reactor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        bossReactor.start();</span><br><span class="line">        <span class="keyword">for</span> (Reactor worker : workerReactors) &#123;</span><br><span class="line">            worker.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主 Reactor 的 Acceptor，处理新连接</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Acceptor</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ServerSocketChannel serverChannel;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Acceptor</span><span class="params">(ServerSocketChannel serverChannel)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.serverChannel = serverChannel;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主Reactor-thread : &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">SocketChannel</span> <span class="variable">clientChannel</span> <span class="operator">=</span> serverChannel.accept();</span><br><span class="line">                <span class="keyword">if</span> (clientChannel != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 轮询选择一个 Worker Reactor</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> workerIndex.getAndIncrement() % workerReactors.length;</span><br><span class="line">                    <span class="type">Reactor</span> <span class="variable">worker</span> <span class="operator">=</span> workerReactors[index];</span><br><span class="line">                    <span class="comment">// 将新连接注册到 Worker Reactor</span></span><br><span class="line">                    worker.registerChannel(clientChannel);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reactor 线程（主和从共用）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">Reactor</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Selector selector;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;Runnable&gt; taskQueue = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Reactor</span><span class="params">(String name)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="built_in">super</span>(name);</span><br><span class="line">            selector = Selector.open();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册 Channel 到当前 Reactor</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerChannel</span><span class="params">(SocketChannel channel)</span> &#123;</span><br><span class="line">            <span class="comment">// 异步提交注册任务，避免线程阻塞</span></span><br><span class="line">            addTask(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                    <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> channel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                    key.attach(<span class="keyword">new</span> <span class="title class_">IOHandler</span>(channel, key));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            selector.wakeup(); <span class="comment">// 唤醒 select() 阻塞</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加异步任务（线程安全）</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addTask</span><span class="params">(Runnable task)</span> &#123;</span><br><span class="line">            taskQueue.offer(task);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;从Reactor : &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (!Thread.interrupted()) &#123;</span><br><span class="line">                    selector.select(<span class="number">1000</span>); <span class="comment">// 超时 1 秒，避免无法唤醒</span></span><br><span class="line">                    processSelectedKeys();</span><br><span class="line">                    processPendingTasks();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理已就绪的 SelectionKey</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processSelectedKeys</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; it = keys.iterator();</span><br><span class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> it.next();</span><br><span class="line">                it.remove();</span><br><span class="line">                <span class="keyword">if</span> (key.isValid()) &#123;</span><br><span class="line">                    <span class="type">Runnable</span> <span class="variable">handler</span> <span class="operator">=</span> (Runnable) key.attachment();</span><br><span class="line">                    <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                        handler.run();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理异步任务队列</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processPendingTasks</span><span class="params">()</span> &#123;</span><br><span class="line">            Runnable task;</span><br><span class="line">            <span class="keyword">while</span> ((task = taskQueue.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                task.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(ServerSocketChannel serverChannel, <span class="type">int</span> opAccept, Acceptor acceptor)</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                serverChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">                serverChannel.register(selector, opAccept, acceptor);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// I/O 处理器（从 Reactor 线程执行）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">IOHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SocketChannel channel;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SelectionKey key;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">IOHandler</span><span class="params">(SocketChannel channel, SelectionKey key)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.channel = channel;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;IOHandler-thread : &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!channel.isOpen()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 处理读事件</span></span><br><span class="line">                <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">                    buffer.clear();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">bytesRead</span> <span class="operator">=</span> channel.read(buffer);</span><br><span class="line">                    <span class="keyword">if</span> (bytesRead == -<span class="number">1</span>) &#123;</span><br><span class="line">                        channel.close();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 提交业务逻辑到线程池</span></span><br><span class="line">                    buffer.flip();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array(), <span class="number">0</span>, buffer.limit());</span><br><span class="line">                    businessPool.submit(() -&gt; processRequest(request));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 处理写事件（示例省略，实际需注册 OP_WRITE）</span></span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    channel.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 业务处理（在线程池执行）</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(String request)</span> &#123;</span><br><span class="line">            <span class="comment">// 模拟耗时操作</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="string">&quot;HTTP/1.1 200 OK\r\nContent-Length: 13\r\n\r\nHello Reactor!&quot;</span>;</span><br><span class="line">            <span class="comment">// 写回响应（需切换回 Reactor 线程）</span></span><br><span class="line">            key.interestOps(SelectionKey.OP_WRITE);</span><br><span class="line">            key.attach(<span class="keyword">new</span> <span class="title class_">WriteHandler</span>(channel, response));</span><br><span class="line">            key.selector().wakeup(); <span class="comment">// 唤醒 Selector</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写处理器（由 Reactor 线程执行）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">WriteHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String response;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SocketChannel channel;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改构造函数，传入 channel</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">WriteHandler</span><span class="params">(SocketChannel channel, String response)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.channel = channel;</span><br><span class="line">            <span class="built_in">this</span>.response = response;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;WriteHandler-thread : &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(response.getBytes());</span><br><span class="line">                channel.write(buffer);</span><br><span class="line">                channel.close(); <span class="comment">// 短连接示例，关闭连接</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 启动服务器：1 个主 Reactor，4 个从 Reactor</span></span><br><span class="line">        <span class="type">MasterSlaveReactorServer</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MasterSlaveReactorServer</span>(<span class="number">3333</span>, <span class="number">4</span>);</span><br><span class="line">        server.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器已启动，主从 Reactor 模式运行中...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/./../images/image-20250513231248851.png" alt="image-20250513231248851"></p><p><img src="/./../images/image-20250513231314582.png" alt="image-20250513231314582"></p><h1><span id="netty">Netty</span></h1><h2><span id="介绍">介绍</span></h2><ul><li>Netty 是一个 <strong>NIO 客户端服务器框架</strong>，可以快速轻松地开发网络应用程序（例如协议服务器和客户端）。它极大地简化了 TCP 和 UDP 套接字服务器等网络编程。</li><li>它基于 Java NIO（Non-blocking I&#x2F;O）技术，简化了网络编程的复杂性，广泛应用于实时通信、游戏服务器、分布式系统等领域（如 Dubbo、RocketMQ 等框架的底层通信）。</li></ul><p>官方文档：<a href="https://netty.io/4.2/api/index.html">https://netty.io/4.2/api/index.html</a></p><p><img src="/./../images/1708060-20211110224700852-1182764791.png" alt="1708060-20211110224700852-1182764791"></p><p>图源：<a href="https://img2020.cnblogs.com/blog/1708060/202111/1708060-20211110224700852-1182764791.png">https://img2020.cnblogs.com/blog/1708060/202111/1708060-20211110224700852-1182764791.png</a></p><p>Netty启动流程：</p><p><img src="/./../images/be1c82f1634c1c3af59ebb114297733f.png" alt="img"></p><p>图源：<a href="https://cloud.tencent.cn/developer/article/2146079">https://cloud.tencent.cn/developer/article/2146079</a></p><h2><span id="线程模式">线程模式</span></h2><p>Netty 基于 Reactor 模式设计，主要有三种线程模型：</p><ul><li><strong>单线程模型</strong>：所有 IO 操作由一个线程处理</li><li><strong>多线程模型</strong>：Acceptor 和 IO 处理器分离为不同线程组</li><li><strong>主从多线程模型</strong>：Acceptor 也使用线程池处理</li></ul><h2><span id="核心组件">核心组件</span></h2><h3><span id="serverbootstrap服务器启动类"><strong>ServerBootstrap（服务器启动类）</strong></span></h3><h4><span id="核心作用"><strong>核心作用</strong></span></h4><ul><li>用于配置和启动 Netty 服务器。</li><li>管理两个<code>EventLoopGroup</code>：BossGroup（接受连接）和 WorkerGroup（处理 IO）。</li></ul><h4><span id="关键方法"><strong>关键方法</strong></span></h4><ul><li><code>group(EventLoopGroup bossGroup, EventLoopGroup workerGroup)</code>：设置主从线程组。</li><li><code>channel(Class&lt;? extends ServerChannel&gt; channelClass)</code>：设置服务器通道类型（如<code>NioServerSocketChannel</code>）。</li><li><code>childHandler(ChannelHandler childHandler)</code>：设置子通道处理器（客户端连接的 Pipeline）。</li><li><code>option(ChannelOption option, T value)</code>：设置服务器通道选项（如<code>SO_BACKLOG</code>）。</li><li><code>childOption(ChannelOption option, T value)</code>：设置子通道选项（如<code>SO_KEEPALIVE</code>）。</li><li><code>bind(int port)</code>：绑定端口并启动服务器。</li></ul><h3><span id="bootstrap客户端启动类"><strong>Bootstrap（客户端启动类）</strong></span></h3><h4><span id="核心作用"><strong>核心作用</strong></span></h4><ul><li>用于配置和启动 Netty 客户端。</li><li>只需要一个<code>EventLoopGroup</code>处理所有连接和 IO 操作。</li></ul><h4><span id="关键方法"><strong>关键方法</strong></span></h4><ul><li><code>group(EventLoopGroup group)</code>：设置线程组。</li><li><code>channel(Class&lt;? extends Channel&gt; channelClass)</code>：设置客户端通道类型（如<code>NioSocketChannel</code>）。</li><li><code>handler(ChannelHandler handler)</code>：设置通道处理器（客户端 Pipeline）。</li><li><code>option(ChannelOption option, T value)</code>：设置通道选项（如<code>SO_KEEPALIVE</code>）。</li><li><code>connect(String host, int port)</code>：连接到远程服务器。</li></ul><h3><span id="eventloopgroup-与-eventloop"><strong>EventLoopGroup 与 EventLoop</strong></span></h3><ul><li><strong>EventLoopGroup</strong>：线程池，管理多个<code>EventLoop</code>。</li><li><strong>EventLoop</strong>：单线程执行器，负责处理 IO 事件（连接、读写）和任务队列。</li></ul><p><strong>分类</strong></p><ul><li><strong>NioEventLoopGroup</strong>：基于 Java NIO，跨平台。</li><li><strong>EpollEventLoopGroup</strong>：基于 Linux epoll，性能更高。</li></ul><h3><span id="channel"><strong>Channel</strong></span></h3><ul><li><code>NioSocketChannel</code>：客户端 TCP 连接。</li><li><code>NioServerSocketChannel</code>：服务器 TCP 监听。</li><li><code>NioDatagramChannel</code>：UDP 连接。</li></ul><h3><span id="channelpipeline"><strong>ChannelPipeline</strong></span></h3><ul><li><strong>入站（Inbound）</strong>：数据从网络到应用（如<code>channelRead()</code>）。</li><li><strong>出站（Outbound）</strong>：数据从应用到网络（如<code>write()</code>）。</li></ul><h3><span id="channelhandler"><strong>ChannelHandler</strong></span></h3><ul><li><strong>ChannelInboundHandler</strong>：处理入站数据。</li><li><strong>ChannelOutboundHandler</strong>：处理出站数据。</li></ul><p><strong>关键接口&#x2F;抽象类：</strong></p><ul><li><strong>ChannelInboundHandlerAdapter</strong>：入站处理器基类。</li><li><strong>ChannelOutboundHandlerAdapter</strong>：出站处理器基类。</li><li><strong>SimpleChannelInboundHandler</strong>：自动释放资源的入站处理器。</li></ul><h1><span id="案例分析群聊系统">案例分析（群聊系统）：</span></h1><h2><span id="服务器">服务器：</span></h2><h4><span id="chatserverclass">ChatServer.class</span></h4><p>服务器启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.netty.chat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelOption;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LogLevel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.logging.LoggingHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatServer</span><span class="params">(<span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 1.创建主从线程组</span></span><br><span class="line">        <span class="comment">// 1.1 处理客户端连接</span></span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">bossGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="comment">// 1.2 处理事件</span></span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">workGroups</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2.创建服务器</span></span><br><span class="line">            <span class="comment">// 创建并配置Netty服务器</span></span><br><span class="line">            <span class="type">ServerBootstrap</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">            <span class="comment">// 设置服务器的BossGroup和WorkGroup</span></span><br><span class="line">            server.group(bossGroup, workGroups);</span><br><span class="line">            <span class="comment">// 指定服务器的通道类型</span></span><br><span class="line">            server.channel(NioServerSocketChannel.class);</span><br><span class="line">            <span class="comment">// 1. 主通道处理器（用于ServerSocketChannel，处理连接建立事件）</span></span><br><span class="line">            server.handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;NioServerSocketChannel&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(NioServerSocketChannel ch)</span> &#123;</span><br><span class="line">                    <span class="comment">// 配置主通道的处理器链（如日志记录、连接限制等）</span></span><br><span class="line">                    ch.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 2. 子通道处理器（用于SocketChannel，处理读写事件）</span></span><br><span class="line">            server.childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                    <span class="comment">// 配置SocketChannel的管道</span></span><br><span class="line">                    socketChannel.pipeline().addLast(</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">StringDecoder</span>(), <span class="comment">// 字符串解码器</span></span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">StringEncoder</span>(), <span class="comment">// 字符串编码器</span></span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">ChatServerHandler</span>(), <span class="comment">// 自定义处理器</span></span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">ChatConnectionServerHandler</span>() <span class="comment">// 监听客户端状态</span></span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 设置服务器的配置项</span></span><br><span class="line">            server.option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.绑定端口并启动服务</span></span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">serverChannel</span> <span class="operator">=</span> server.bind(port).sync();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.等待服务器关闭</span></span><br><span class="line">            serverChannel.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            workGroups.shutdownGracefully();</span><br><span class="line">            bossGroup.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ChatServer</span> <span class="variable">chatServer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatServer</span>(<span class="number">3333</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            chatServer.run();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="chatserverhandlerclass">ChatServerHandler.class</span></h4><p>处理客户端发来的信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.netty.chat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatServerHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务器接收的数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelHandlerContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> msg</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext channelHandlerContext, String msg)</span>&#123;</span><br><span class="line">        <span class="type">SocketAddress</span> <span class="variable">socketAddress</span> <span class="operator">=</span> channelHandlerContext.channel().remoteAddress();</span><br><span class="line">        <span class="keyword">for</span> (Channel channel : ChatConnectionServerHandler.onlineUsers) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!channel.remoteAddress().equals(socketAddress)) &#123;</span><br><span class="line">                channel.writeAndFlush(socketAddress + <span class="string">&quot;说: &quot;</span> + msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="chatconnectionserverhandlerclass">ChatConnectionServerHandler.class</span></h4><p>处理客户端连接和断开连接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.netty.chat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInboundHandlerAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatConnectionServerHandler</span> <span class="keyword">extends</span> <span class="title class_">ChannelInboundHandlerAdapter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HashSet&lt;Channel&gt; onlineUsers = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Channel&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 监听信道的活跃状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端：&quot;</span> + ctx.channel().remoteAddress() + <span class="string">&quot;上线了&quot;</span>);</span><br><span class="line">        onlineUsers.add(ctx.channel());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  监听信道断开连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端：&quot;</span> + ctx.channel().remoteAddress() + <span class="string">&quot;断开连接&quot;</span>);</span><br><span class="line">        onlineUsers.remove(ctx.channel());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="客户端">客户端：</span></h2><h4><span id="chatclientclass">ChatClient.class</span></h4><p>客户端启动类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.netty.chat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringDecoder;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.string.StringEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatClient</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatClient</span><span class="params">(String host, <span class="type">int</span> port)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.port = port;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">NioEventLoopGroup</span> <span class="variable">groups</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Bootstrap</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Bootstrap</span>();</span><br><span class="line">            client.group(groups);</span><br><span class="line">            client.channel(NioSocketChannel.class);</span><br><span class="line">            client.handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                    socketChannel.pipeline().addLast(</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">StringDecoder</span>(),</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">StringEncoder</span>(),</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">ChatClientHandler</span>()</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="comment">// 启动客户端</span></span><br><span class="line">            <span class="type">ChannelFuture</span> <span class="variable">clientChannel</span> <span class="operator">=</span> client.connect(host, port).sync();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//  读取控制台输入 发送给服务器</span></span><br><span class="line">            <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> scanner.nextLine();</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;exit&quot;</span>.equals(msg)) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                clientChannel.channel().writeAndFlush(msg);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 等待关闭</span></span><br><span class="line">            clientChannel.channel().closeFuture().sync();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            groups.shutdownGracefully();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ChatClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatClient</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">3333</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.run();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="chatclienthandlerclass">ChatClientHandler.class</span></h4><p>处理服务器发来的消息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.netty.chat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatClientHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext channelHandlerContext, String msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="运行结果">运行结果：</span></h2><p><img src="/./../images/image-20250516235353164.png" alt="image-20250516235353164"></p><h1><span id="netty源码剖析">Netty源码剖析</span></h1><h2><span id="eventloopgroup-和eventloop">EventLoopGroup 和EventLoop</span></h2><p>从EventLoopGroup接口的继承关系图可以从看出来这个接口继承了ExecutorService接口，说明是一个线程池</p><p><img src="/./../images/image-20250517104227454.png" alt="image-20250517104227454"></p><h3><span id><img src="/./../images/image-20250517104049002.png" alt="image-20250517104049002"></span></h3><p><img src="/./../images/image-20250517105748200.png" alt="image-20250517105748200"></p><h2><span id="nioeventloop">NioEventLoop</span></h2><ul><li><p>处理 I&#x2F;O 多路复用，监听 Channel 上的事件</p></li><li><p><code>NioEventLoop</code> 是 Netty 基于 Java NIO 机制构建的事件循环实现</p></li><li><p>NioEvent通过组合方式管理线程和任务。</p></li><li><p><code>NioEventLoop</code> → <code>SingleThreadEventLoop</code> → <code>SingleThreadEventExecutor</code> → <code>AbstractScheduledEventExecutor</code>。</p></li><li><p>Netty 采用 <strong>单线程模型</strong> 处理 Channel：</p><ul><li>每个 <code>EventLoop</code> 绑定一个 <strong>专属线程</strong>（<code>Thread</code>）。</li><li>该线程负责处理该 <code>EventLoop</code> 管理的 <strong>所有 Channel 的 IO 操作</strong>（如读、写、连接）。</li><li>所有 Channel 操作必须在其关联的 <code>EventLoop</code> 线程中执行，否则会导致线程安全问题。</li></ul></li></ul><p><img src="/./../images/image-20250517112950788.png" alt="image-20250517112950788"></p><h4><span id="重要字段">重要字段</span></h4><table><thead><tr><th>属性分类</th><th>关键属性</th><th>作用与优化点</th></tr></thead><tbody><tr><td>Selector 优化</td><td><code>selectedKeys</code></td><td>使用数组替代 <code>HashSet</code>，提升选择键处理性能</td></tr><tr><td>任务调度</td><td><code>taskQueue</code>、<code>scheduledTaskQueue</code></td><td>分离普通任务和定时任务，支持异步执行</td></tr><tr><td>线程控制</td><td><code>threadId</code>、<code>wakenUp</code></td><td>确保任务在正确线程执行，优化 <code>Selector.wakeup()</code> 调用</td></tr><tr><td>时间管理</td><td><code>ioRatio</code>、<code>lastExecutionTime</code></td><td>平衡 I&#x2F;O 操作和任务执行时间，避免任务饥饿</td></tr><tr><td>状态管理</td><td><code>state</code>、<code>needsToSelectAgain</code></td><td>控制事件循环状态，处理取消的 SelectionKey</td></tr></tbody></table><h5><span id="1selector相关字段">1.Selector相关字段</span></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java NIO Selector</span></span><br><span class="line"><span class="keyword">private</span> Selector selector;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SelectorProvider provider;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 优化后的 Selector（通过反射替换为数组实现）</span></span><br><span class="line"><span class="keyword">private</span> SelectedSelectionKeySet selectedKeys;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原生 Selector（未优化版本）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Selector unwrappedSelector;</span><br></pre></td></tr></table></figure><h5><span id="2任务队列相关字段">2.任务队列相关字段</span></h5><ul><li><code>taskQueue</code>：存储通过 <code>execute()</code> 提交的普通任务。</li><li><code>scheduledTaskQueue</code>：存储通过 <code>schedule()</code> 提交的定时任务。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通任务队列（无界队列）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;Runnable&gt; taskQueue;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定时任务队列（基于优先级堆）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> PriorityQueue&lt;ScheduledFutureTask&lt;?&gt;&gt; scheduledTaskQueue;</span><br></pre></td></tr></table></figure><p>实现：</p><ul><li><code>taskQueue</code> 默认使用 <code>MpscUnboundedArrayQueue</code>（多生产者单消费者队列）。</li><li><code>scheduledTaskQueue</code> 使用二叉堆实现，按执行时间排序。</li></ul><h5><span id="3父级eventloopgroup">3.父级EventLoopGroup</span></h5><p>表示当前EventLoop属于哪个EventLoopGroup</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父级 EventLoopGroup</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> NioEventLoopGroup parent;</span><br></pre></td></tr></table></figure><h5><span id="4线程相关">4.线程相关</span></h5><ul><li>确保任务在正确的线程中执行（通过 <code>inEventLoop()</code> 检查）。</li><li>控制 <code>Selector</code> 的唤醒机制（避免不必要的 <code>wakeup()</code> 调用）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 线程 ID（用于检查是否在 EventLoop 线程中执行）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> threadId;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线程唤醒标志</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicBoolean</span> <span class="variable">wakenUp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicBoolean</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 线程状态（-1: 未启动, 1: 已启动, 2: 关闭中）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> ST_NOT_STARTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最大待处理任务数（默认 Integer.MAX_VALUE）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxPendingTasks;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拒绝策略（当任务队列满时的处理方式）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RejectedExecutionHandler rejectedExecutionHandler;</span><br></pre></td></tr></table></figure><h5><span id="5事件相关">5.事件相关</span></h5><ul><li><code>selectStrategy</code>：决定何时调用 <code>select()</code>、<code>selectNow()</code> 或跳过选择。</li><li><code>needsToSelectAgain</code>：标记是否需要重新执行 <code>select()</code>。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 选择策略（控制 select() 行为）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SelectStrategy selectStrategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 待处理的取消键数量</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> cancelledKeys;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否需要重新选择</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> needsToSelectAgain;</span><br></pre></td></tr></table></figure><h5><span id="6-时间与执行控制属性"><strong>6. 时间与执行控制属性</strong></span></h5><ul><li><code>ioRatio</code>：控制 I&#x2F;O 操作与任务执行的时间分配。</li><li><code>lastExecutionTime</code>：用于计算任务执行超时和延迟调度。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// I/O 操作与任务执行的时间比例（默认 50%）</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> ioRatio;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后一次执行任务的时间戳</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> lastExecutionTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任务执行超时控制</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">SCHEDULE_PURGE_INTERVAL</span> <span class="operator">=</span> TimeUnit.SECONDS.toNanos(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h4><span id="线程管理">线程管理</span></h4><p><strong>每个 NioEventLoop 绑定一个独立线程</strong>：</p><ul><li>处理注册到<code>Selector</code>上的<strong>IO 事件</strong>（连接、读写等）。</li><li>执行用户提交的<strong>普通任务</strong>（通过<code>execute(task)</code>）和<strong>定时任务</strong>（通过<code>schedule(task, delay, unit)</code>）。</li><li>调度后续的任务执行（如定时任务）。</li></ul><p><code>NioEventLoop</code>内部没有线程池，它是一个<strong>单线程的事件循环</strong>，所有操作都在同一个线程中完成。</p><ul><li><code>NioEventLoop</code>会将耗时任务通过<code>NioEventLoopGroup</code>提交到外部的线程池中</li></ul><h4><span id="重要方法">重要方法</span></h4><h5><span id="run方法">run方法：</span></h5><p><img src="/./../images/image-20250517155039884.png" alt="image-20250517155039884"></p><p><strong>NioEventLoop</strong>通过内部线程执行 <code>run()</code> 方法，通过 <code>execute(Runnable)</code> 提交任务</p><ul><li><p>无限循环处理 I&#x2F;O 事件和任务队列。</p></li><li><p>通过 <code>processSelectedKeys()</code> 处理网络 I&#x2F;O。</p></li><li><p>通过 <code>runAllTasks()</code> 执行提交的 <code>Runnable</code> 任务。</p></li><li><p><code>calculateStrategy</code> 是 Netty 中用于决定 EventLoop 选择策略的核心方法，它平衡了 I&#x2F;O 事件处理与任务执行的优先级。该方法由 <code>SelectStrategy</code> 接口定义，默认实现为 <code>DefaultSelectStrategy</code></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * NIO事件循环的主处理方法，负责轮询IO事件和执行任务</span></span><br><span class="line"><span class="comment"> * 这个方法实现了一个无限循环，不断地选择就绪的通道并处理IO事件，同时兼顾任务执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 记录select操作的连续唤醒次数，用于检测异常唤醒情况</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">selectCnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主事件循环，持续运行直到线程关闭</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 计算选择策略：-3/-1表示需要阻塞select，-2表示退出循环，其他正数表示就绪通道数</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">strategy</span> <span class="operator">=</span> selectStrategy.calculateStrategy(selectNowSupplier, hasTasks());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">switch</span> (strategy) &#123;</span><br><span class="line">                <span class="comment">// 处理需要阻塞等待IO事件的情况</span></span><br><span class="line">                <span class="keyword">case</span> -<span class="number">3</span>:</span><br><span class="line">                <span class="keyword">case</span> -<span class="number">1</span>:</span><br><span class="line">                    <span class="comment">// 获取下一个定时任务的截止时间</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">curDeadlineNanos</span> <span class="operator">=</span> nextScheduledTaskDeadlineNanos();</span><br><span class="line">                    <span class="keyword">if</span> (curDeadlineNanos == -<span class="number">1L</span>) &#123;</span><br><span class="line">                        curDeadlineNanos = Long.MAX_VALUE;</span><br><span class="line">                    &#125;</span><br><span class="line">                    nextWakeupNanos.set(curDeadlineNanos);</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// 如果没有待处理任务，进行阻塞select操作</span></span><br><span class="line">                        <span class="keyword">if</span> (!hasTasks()) &#123;</span><br><span class="line">                            strategy = select(curDeadlineNanos);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        <span class="comment">// 重置唤醒时间，允许其他线程唤醒selector</span></span><br><span class="line">                        nextWakeupNanos.lazySet(-<span class="number">1L</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                    </span><br><span class="line">                <span class="comment">// 退出事件循环的策略</span></span><br><span class="line">                <span class="keyword">case</span> -<span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">break</span> outerLoop;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 增加select计数并重置状态</span></span><br><span class="line">            ++selectCnt;</span><br><span class="line">            cancelledKeys = <span class="number">0</span>;</span><br><span class="line">            needsToSelectAgain = <span class="literal">false</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 根据IO比例配置处理IO事件和任务执行的时间分配</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">ioRatio</span> <span class="operator">=</span> <span class="built_in">this</span>.ioRatio;</span><br><span class="line">            <span class="type">boolean</span> ranTasks;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 处理就绪的IO事件</span></span><br><span class="line">            <span class="keyword">if</span> (strategy &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                processSelectedKeys();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 根据IO比例执行任务</span></span><br><span class="line">            <span class="keyword">if</span> (ioRatio == <span class="number">100</span>) &#123;</span><br><span class="line">                ranTasks = runAllTasks();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">ioStartTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 处理IO事件</span></span><br><span class="line">                    <span class="keyword">if</span> (strategy &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        processSelectedKeys();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// 计算IO操作耗时，并按比例执行任务</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">ioTime</span> <span class="operator">=</span> System.nanoTime() - ioStartTime;</span><br><span class="line">                    ranTasks = runAllTasks(ioTime * (<span class="type">long</span>)(<span class="number">100</span> - ioRatio) / (<span class="type">long</span>)ioRatio);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果没有执行任务且select操作没有返回就绪通道，检查是否需要重置select计数</span></span><br><span class="line">            <span class="keyword">if</span> (!ranTasks &amp;&amp; strategy &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (unexpectedSelectorWakeup(selectCnt)) &#123;</span><br><span class="line">                    selectCnt = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 记录select操作连续过早返回的情况，可能是JDK选择器实现的问题</span></span><br><span class="line">            <span class="keyword">if</span> (selectCnt &gt; <span class="number">3</span> &amp;&amp; logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;Selector.select() returned prematurely &#123;&#125; times in a row for Selector &#123;&#125;.&quot;</span>, selectCnt - <span class="number">1</span>, selector);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 重置计数</span></span><br><span class="line">            selectCnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// 发生IO异常时重建选择器</span></span><br><span class="line">            rebuildSelector0();</span><br><span class="line">            selectCnt = <span class="number">0</span>;</span><br><span class="line">            handleLoopException(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CancelledKeyException e) &#123;</span><br><span class="line">            <span class="comment">// 处理已取消键的异常</span></span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;CancelledKeyException raised by a Selector &#123;&#125; - JDK bug?&quot;</span>, selector, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Error e) &#123;</span><br><span class="line">            <span class="comment">// 致命错误直接抛出</span></span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            <span class="comment">// 处理其他异常</span></span><br><span class="line">            handleLoopException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 检查是否正在关闭，如果是则关闭所有通道并确认关闭</span></span><br><span class="line">            <span class="keyword">if</span> (isShuttingDown()) &#123;</span><br><span class="line">                closeAll();</span><br><span class="line">                <span class="keyword">if</span> (confirmShutdown()) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6><span id="selectcurdeadlinenanos">**<code>select(curDeadlineNanos)</code>**：</span></h6><ul><li><code>deadlineNanos</code>:下一个定时任务的截止时间</li><li><code>Long.MAX_VALUE</code> 表示无定时任务，可永久阻塞</li><li><code>deadlineNanos + 995000L</code>：增加 <code>995000 纳秒</code>（约 1 毫秒）以<strong>避免浮点数精度误差</strong>。</li><li><code>deadlineToDelayNanos()</code>：计算当前时间到 <code>deadlineNanos</code> 的剩余时间（纳秒）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">(<span class="type">long</span> deadlineNanos)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 情况1：无截止时间（永久阻塞）</span></span><br><span class="line">    <span class="keyword">if</span> (deadlineNanos == Long.MAX_VALUE) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.selector.select(); <span class="comment">// 永久阻塞，直到有 I/O 事件就绪</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 情况2：有截止时间，计算超时时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">timeoutMillis</span> <span class="operator">=</span> deadlineToDelayNanos(deadlineNanos + <span class="number">995000L</span>) / <span class="number">1000000L</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 根据超时时间决定执行方式</span></span><br><span class="line">        <span class="keyword">return</span> timeoutMillis &lt;= <span class="number">0L</span> </span><br><span class="line">            ? <span class="built_in">this</span>.selector.selectNow()    <span class="comment">// 无超时（立即返回）</span></span><br><span class="line">            : <span class="built_in">this</span>.selector.select(timeoutMillis); <span class="comment">// 带超时的阻塞</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6><span id="processselectedkeys">**<code>processSelectedKeys</code>**：</span></h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processSelectedKeys</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.selectedKeys != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 使用优化的数组实现（默认策略）</span></span><br><span class="line">        <span class="built_in">this</span>.processSelectedKeysOptimized();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 回退到 JDK 原生的 HashSet 实现</span></span><br><span class="line">        <span class="built_in">this</span>.processSelectedKeysPlain(<span class="built_in">this</span>.selector.selectedKeys());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processSelectedKeysOptimized</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 遍历优化后的数组（替代原生 HashSet&lt;SelectionKey&gt;）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.selectedKeys.size; ++i) &#123;</span><br><span class="line">        <span class="type">SelectionKey</span> <span class="variable">k</span> <span class="operator">=</span> <span class="built_in">this</span>.selectedKeys.keys[i];</span><br><span class="line">        <span class="built_in">this</span>.selectedKeys.keys[i] = <span class="literal">null</span>; <span class="comment">// 清空引用，帮助 GC</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">Object</span> <span class="variable">a</span> <span class="operator">=</span> k.attachment();</span><br><span class="line">        <span class="keyword">if</span> (a <span class="keyword">instanceof</span> AbstractNioChannel) &#123;</span><br><span class="line">            <span class="comment">// 处理 Channel 相关事件</span></span><br><span class="line">            processSelectedKey(k, (AbstractNioChannel) a);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 处理特殊任务（如 NioTask）</span></span><br><span class="line">            NioTask&lt;SelectableChannel&gt; task = (NioTask) a;</span><br><span class="line">            processSelectedKey(k, task);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查是否需要重新选择（如发生 key 取消）</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.needsToSelectAgain) &#123;</span><br><span class="line">            <span class="built_in">this</span>.selectedKeys.reset(i + <span class="number">1</span>); <span class="comment">// 重置数组游标</span></span><br><span class="line">            <span class="built_in">this</span>.selectAgain(); <span class="comment">// 重新执行 select()</span></span><br><span class="line">            i = -<span class="number">1</span>; <span class="comment">// 重新从数组头部开始遍历</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processSelectedKeysPlain</span><span class="params">(Set&lt;SelectionKey&gt; selectedKeys)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!selectedKeys.isEmpty()) &#123;</span><br><span class="line">        Iterator&lt;SelectionKey&gt; i = selectedKeys.iterator();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">SelectionKey</span> <span class="variable">k</span> <span class="operator">=</span> i.next();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">a</span> <span class="operator">=</span> k.attachment();</span><br><span class="line">            i.remove(); <span class="comment">// 处理后立即从集合中移除，避免重复处理</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (a <span class="keyword">instanceof</span> AbstractNioChannel) &#123;</span><br><span class="line">                <span class="comment">// 处理 Channel 相关事件</span></span><br><span class="line">                processSelectedKey(k, (AbstractNioChannel) a);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 处理特殊任务（如 NioTask）</span></span><br><span class="line">                NioTask&lt;SelectableChannel&gt; task = (NioTask) a;</span><br><span class="line">                processSelectedKey(k, task);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 检查是否需要重新选择</span></span><br><span class="line">            <span class="keyword">if</span> (!i.hasNext()) &#123;</span><br><span class="line">                <span class="keyword">break</span>; <span class="comment">// 遍历完成，退出循环</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.needsToSelectAgain) &#123;</span><br><span class="line">                selectAgain(); <span class="comment">// 重新执行 select()</span></span><br><span class="line">                selectedKeys = <span class="built_in">this</span>.selector.selectedKeys(); <span class="comment">// 获取新的就绪 keys</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (selectedKeys.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">break</span>; <span class="comment">// 没有新的就绪事件，退出循环</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                i = selectedKeys.iterator(); <span class="comment">// 重置迭代器</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6><span id="runalltaskslong-timeoutnanos">**<code>runAllTasks(long timeoutNanos)</code>**：</span></h6><p>Netty 使用**优先级队列（PriorityQueue）**管理定时任务，队列中的任务按执行时间排序。当调用 <code>runAllTasks()</code> 时，会先将**已到期的任务**从定时队列提取到普通任务队列</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">runAllTasks</span><span class="params">(<span class="type">long</span> timeoutNanos)</span> &#123;</span><br><span class="line">    <span class="comment">// 步骤1：将定时任务队列中已到期的任务转移到普通任务队列</span></span><br><span class="line">    <span class="built_in">this</span>.fetchFromScheduledTaskQueue();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 步骤2：获取第一个任务</span></span><br><span class="line">    <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> <span class="built_in">this</span>.pollTask();</span><br><span class="line">    <span class="keyword">if</span> (task == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.afterRunningAllTasks(); <span class="comment">// 无任务时执行收尾工作</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 步骤3：计算任务执行的截止时间</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">deadline</span> <span class="operator">=</span> timeoutNanos &gt; <span class="number">0L</span> ? <span class="built_in">this</span>.getCurrentTimeNanos() + timeoutNanos : <span class="number">0L</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">runTasks</span> <span class="operator">=</span> <span class="number">0L</span>; <span class="comment">// 记录已执行的任务数</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 步骤4：循环执行任务，直到超时或队列为空</span></span><br><span class="line">    <span class="type">long</span> lastExecutionTime;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        safeExecute(task); <span class="comment">// 安全执行任务</span></span><br><span class="line">        ++runTasks;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 每执行64个任务检查一次超时（批量执行优化）</span></span><br><span class="line">        <span class="keyword">if</span> ((runTasks &amp; <span class="number">63L</span>) == <span class="number">0L</span>) &#123;</span><br><span class="line">            lastExecutionTime = <span class="built_in">this</span>.getCurrentTimeNanos();</span><br><span class="line">            <span class="keyword">if</span> (lastExecutionTime &gt;= deadline) &#123;</span><br><span class="line">                <span class="keyword">break</span>; <span class="comment">// 超时，退出循环</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取下一个任务</span></span><br><span class="line">        task = <span class="built_in">this</span>.pollTask();</span><br><span class="line">        <span class="keyword">if</span> (task == <span class="literal">null</span>) &#123;</span><br><span class="line">            lastExecutionTime = <span class="built_in">this</span>.getCurrentTimeNanos();</span><br><span class="line">            <span class="keyword">break</span>; <span class="comment">// 队列为空，退出循环</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 步骤5：执行收尾工作并记录执行时间</span></span><br><span class="line">    <span class="built_in">this</span>.afterRunningAllTasks();</span><br><span class="line">    <span class="built_in">this</span>.lastExecutionTime = lastExecutionTime;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="nioeventloopgroup">NioEventLoopGroup</span></h2><p>参考链接：<a href="https://www.cnblogs.com/ZhuChangwu/p/11192219.html">https://www.cnblogs.com/ZhuChangwu/p/11192219.html</a></p><p>NioEventLoopGroup 是 Netty 框架中处理网络 IO 操作的核心组件，它管理一组 NioEventLoop 实例，负责注册 Channel、处理 IO 事件和执行任务</p><p><img src="/./../images/image-20250518112706134.png" alt="image-20250518112706134"></p><h3><span id="重要字段">重要字段</span></h3><h4><span id="1-线程池相关字段">1. <strong>线程池相关字段</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> EventExecutor[] children;         <span class="comment">// 管理的 EventLoop 数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;EventExecutor&gt; readonlyChildren; <span class="comment">// 只读视图</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> EventExecutorChooserFactory.EventExecutorChooser chooser; <span class="comment">// 线程选择器</span></span><br></pre></td></tr></table></figure><ul><li><strong>children</strong>：存储所有 NioEventLoop 实例，负责实际的 IO 操作和任务执行。</li><li><strong>chooser</strong>：负责从 children 中选择一个 EventLoop，实现负载均衡。</li></ul><h4><span id="2-线程配置字段">2. <strong>线程配置字段</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> nThreads;                     <span class="comment">// 线程数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Executor executor;                <span class="comment">// 任务执行器</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> EventExecutorGroup parent;        <span class="comment">// 父级 EventLoopGroup</span></span><br></pre></td></tr></table></figure><ul><li><strong>nThreads</strong>：指定线程池大小，默认是 CPU 核心数的两倍（<code>Runtime.getRuntime().availableProcessors() * 2</code>）。</li><li><strong>executor</strong>：实际执行任务的线程池，默认使用 <code>ThreadPerTaskExecutor</code>。</li></ul><h4><span id="3-selector-配置字段">3. <strong>Selector 配置字段</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SelectorProvider provider;        <span class="comment">// JDK Selector 提供者</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> SelectStrategyFactory selectStrategyFactory; <span class="comment">// 选择策略工厂</span></span><br></pre></td></tr></table></figure><ul><li><strong>provider</strong>：创建 JDK NIO Selector 的工厂，默认使用系统默认实现。</li><li><strong>selectStrategyFactory</strong>：创建选择策略，控制 EventLoop 的 select 行为。</li></ul><h4><span id="4-拒绝策略和任务队列字段">4. <strong>拒绝策略和任务队列字段</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RejectedExecutionHandler rejectedExecutionHandler; <span class="comment">// 任务拒绝策略</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> EventLoopTaskQueueFactory taskQueueFactory;         <span class="comment">// 任务队列工厂</span></span><br></pre></td></tr></table></figure><ul><li><strong>rejectedExecutionHandler</strong>：当任务队列已满时的拒绝策略，默认使用 <code>AbortPolicy</code>。</li></ul><h3><span id="重要方法"><strong>重要方法</strong></span></h3><h4><span id="1-构造方法">1. <strong>构造方法</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">NioEventLoopGroup</span><span class="params">()</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">NioEventLoopGroup</span><span class="params">(<span class="type">int</span> nThreads)</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">NioEventLoopGroup</span><span class="params">(<span class="type">int</span> nThreads, Executor executor)</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">NioEventLoopGroup</span><span class="params">(<span class="type">int</span> nThreads, Executor executor, SelectorProvider provider)</span></span><br></pre></td></tr></table></figure><ul><li>初始化 EventLoopGroup，指定线程数、执行器和 Selector 提供者等参数。</li></ul><h4><span id="2-线程选择方法">2. <strong>线程选择方法</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> EventExecutor <span class="title function_">next</span><span class="params">()</span></span><br></pre></td></tr></table></figure><ul><li>从 children 数组中选择一个 EventLoop，通过 <code>chooser</code> 实现负载均衡。</li></ul><h4><span id="3-channel-注册方法">3. <strong>Channel 注册方法</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">register</span><span class="params">(Channel channel)</span></span><br></pre></td></tr></table></figure><ul><li>将 Channel 注册到一个 EventLoop 的 Selector 上，返回异步注册结果。</li></ul><h4><span id="4-优雅关闭方法">4. <strong>优雅关闭方法</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Future&lt;?&gt; shutdownGracefully()</span><br><span class="line"><span class="keyword">public</span> Future&lt;?&gt; shutdownGracefully(<span class="type">long</span> quietPeriod, <span class="type">long</span> timeout, TimeUnit unit)</span><br></pre></td></tr></table></figure><ul><li>优雅关闭线程池，允许在指定时间内完成未执行的任务。</li></ul><h4><span id="5-任务提交方法">5. <strong>任务提交方法</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Callable&lt;T&gt; task)</span></span><br><span class="line"><span class="keyword">public</span> Future&lt;?&gt; execute(Runnable task)</span><br></pre></td></tr></table></figure><ul><li>向 EventLoop 提交任务，由线程池异步执行。</li></ul><h4><span id="6-资源清理方法">6. <strong>资源清理方法</strong></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">cleanup</span><span class="params">()</span></span><br></pre></td></tr></table></figure><ul><li>清理资源，关闭所有 EventLoop 和 Selector。</li></ul><h3><span id="工作流程"><strong>工作流程</strong></span></h3><ol><li><strong>初始化阶段</strong>：<ul><li>创建并启动指定数量的 NioEventLoop 线程。</li><li>初始化线程选择器 <code>chooser</code>，用于负载均衡。</li></ul></li><li><strong>Channel 注册阶段</strong>：<ul><li>调用 <code>register(Channel)</code> 方法将 Channel 注册到一个 EventLoop。</li><li>EventLoop 将 Channel 注册到其管理的 Selector 上。</li></ul></li><li><strong>IO 事件处理阶段</strong>：<ul><li>EventLoop 不断循环调用 <code>Selector.select()</code> 方法检测就绪事件。</li><li>处理就绪的 IO 事件（读 &#x2F; 写），并执行相应的 ChannelHandler。</li></ul></li><li><strong>任务执行阶段</strong>：<ul><li>通过 <code>execute()</code> 或 <code>submit()</code> 方法提交的任务在 EventLoop 线程中执行。</li><li>定时任务由 ScheduledExecutorService 管理和执行。</li></ul></li><li><strong>关闭阶段</strong>：<ul><li>调用 <code>shutdownGracefully()</code> 方法优雅关闭线程池。</li><li>释放所有资源，包括 Selector 和线程。</li></ul></li></ol><h3><span id="初始化逻辑">初始化逻辑</span></h3><p><img src="/./../images/image-20250518120624540.png" alt="image-20250518120624540"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化多线程事件执行器组</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nThreads         线程数量，必须为正数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> executor         用于执行任务的基础线程池，若为null则创建默认实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> chooserFactory   执行器选择工厂，用于从多个执行器中选择一个处理任务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args             创建子执行器时传递的可选参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="title function_">MultithreadEventExecutorGroup</span><span class="params">(<span class="type">int</span> nThreads, Executor executor, EventExecutorChooserFactory chooserFactory, Object... args)</span> &#123;</span><br><span class="line">    <span class="comment">// 原子计数器，记录已终止的子执行器数量</span></span><br><span class="line">    <span class="built_in">this</span>.terminatedChildren = <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line">    <span class="comment">// 异步终止承诺，用于通知整个执行器组已完全终止</span></span><br><span class="line">    <span class="built_in">this</span>.terminationFuture = <span class="keyword">new</span> <span class="title class_">DefaultPromise</span>(GlobalEventExecutor.INSTANCE);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 校验线程数量为正数</span></span><br><span class="line">    ObjectUtil.checkPositive(nThreads, <span class="string">&quot;nThreads&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 若未提供基础线程池，则创建默认实现（为每个任务创建新线程）</span></span><br><span class="line">    <span class="keyword">if</span> (executor == <span class="literal">null</span>) &#123;</span><br><span class="line">        executor = <span class="keyword">new</span> <span class="title class_">ThreadPerTaskExecutor</span>(<span class="built_in">this</span>.newDefaultThreadFactory());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建指定数量的子执行器数组</span></span><br><span class="line">    <span class="built_in">this</span>.children = <span class="keyword">new</span> <span class="title class_">EventExecutor</span>[nThreads];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环创建并初始化所有子执行器</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nThreads; ++i) &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">inTryBlock</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            inTryBlock = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// 创建子执行器实例（由子类实现具体逻辑）</span></span><br><span class="line">            <span class="built_in">this</span>.children[i] = <span class="built_in">this</span>.newChild((Executor)executor, args);</span><br><span class="line">            success = <span class="literal">true</span>;</span><br><span class="line">            inTryBlock = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// 若创建失败，抛出异常并终止已创建的子执行器</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;failed to create a child event loop&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 若在try块中且创建失败，优雅关闭已创建的子执行器</span></span><br><span class="line">            <span class="keyword">if</span> (inTryBlock &amp;&amp; !success) &#123;</span><br><span class="line">                <span class="comment">// 发起优雅关闭请求</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.children[j].shutdownGracefully();</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 等待所有已创建的子执行器完全终止</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">                    <span class="type">EventExecutor</span> <span class="variable">e</span> <span class="operator">=</span> <span class="built_in">this</span>.children[j];</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="comment">// 等待终止（超时时间设为极大值，等效于无限等待）</span></span><br><span class="line">                        <span class="keyword">while</span>(!e.isTerminated()) &#123;</span><br><span class="line">                            e.awaitTermination(<span class="number">2147483647L</span>, TimeUnit.SECONDS);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                        <span class="comment">// 恢复中断状态并退出循环</span></span><br><span class="line">                        Thread.currentThread().interrupt();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 若创建失败（finally块外的双重检查），再次确保资源释放</span></span><br><span class="line">        <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">            <span class="comment">// 与finally块中的逻辑相同，确保资源释放</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">                <span class="built_in">this</span>.children[j].shutdownGracefully();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; i; ++j) &#123;</span><br><span class="line">                <span class="type">EventExecutor</span> <span class="variable">e</span> <span class="operator">=</span> <span class="built_in">this</span>.children[j];</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">while</span>(!e.isTerminated()) &#123;</span><br><span class="line">                        e.awaitTermination(<span class="number">2147483647L</span>, TimeUnit.SECONDS);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建执行器选择器，用于从多个子执行器中选择一个处理任务</span></span><br><span class="line">    <span class="built_in">this</span>.chooser = chooserFactory.newChooser(<span class="built_in">this</span>.children);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建终止监听器，当所有子执行器终止时触发</span></span><br><span class="line">    FutureListener&lt;Object&gt; terminationListener = <span class="keyword">new</span> <span class="title class_">FutureListener</span>&lt;Object&gt;() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operationComplete</span><span class="params">(Future&lt;Object&gt; future)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            <span class="comment">// 原子增加已终止子执行器计数，当所有子执行器终止时，标记整个组终止完成</span></span><br><span class="line">            <span class="keyword">if</span> (MultithreadEventExecutorGroup.<span class="built_in">this</span>.terminatedChildren.incrementAndGet() == MultithreadEventExecutorGroup.<span class="built_in">this</span>.children.length) &#123;</span><br><span class="line">                MultithreadEventExecutorGroup.<span class="built_in">this</span>.terminationFuture.setSuccess((Object)<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 为每个子执行器注册终止监听器</span></span><br><span class="line">    EventExecutor[] executors = <span class="built_in">this</span>.children;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; executors.length; ++i) &#123;</span><br><span class="line">        <span class="type">EventExecutor</span> <span class="variable">e</span> <span class="operator">=</span> executors[i];</span><br><span class="line">        e.terminationFuture().addListener(terminationListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子执行器的只读集合视图，防止外部修改</span></span><br><span class="line">    Set&lt;EventExecutor&gt; childrenSet = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(<span class="built_in">this</span>.children.length);</span><br><span class="line">    Collections.addAll(childrenSet, <span class="built_in">this</span>.children);</span><br><span class="line">    <span class="built_in">this</span>.readonlyChildren = Collections.unmodifiableSet(childrenSet);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法主要是：</p><h4><span id="1初始化eventloop数组">1.初始化EventLoop数组</span></h4><p>根据传递进来的线程数，创建<code>EventLoop</code>，将<code>EventLoop</code>存储在一个<code>EventExecutor[]</code>数组(即<code>children</code>)中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.children[i] = <span class="built_in">this</span>.newChild((Executor)executor, args);</span><br></pre></td></tr></table></figure><p>这个<code>newChild</code>方法调用的是<code>MultithreadEventExecutorGroup</code>里面的<code>newChild</code>方法返回的是一个<code>EventExecutor</code>，<code>EventLoop</code>接口继承了<code>EventExecutor</code>，所以这个<code>EventExecutor</code>其实是一个<code>EventLoop</code>对象</p><p><img src="/./../images/image-20250518122317471.png" alt="image-20250518122317471"></p><h4><span id="3初始化选择器chooser"><strong>3</strong>.<strong>初始化选择器chooser</strong>：</span></h4><p>这个<code>chooser</code>是一个<code>EventExecutorChooserFactory.EventExecutorChooser</code>对象，这个对象提供了一个<code>next</code>方法，返回的是<code>EventExecutor</code>对象，所以这个选择器用于从<code>EventLoopGroup</code>中选取一个<code>EventLoop</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.chooser = chooserFactory.newChooser(<span class="built_in">this</span>.children);</span><br></pre></td></tr></table></figure><h3><span id="核心逻辑">核心逻辑</span></h3><p>当<code>NioEventLoopGroup</code>接收客户端的连接时，会先分配一个<code>NioEventLoop</code>给当前的客户端，当前这个线程池会将客户端<code>channel</code>传递给<code>NioEventLoop</code>，这个<code>NioEventLoop</code>会将调用<code>SingleThreadEventLoop</code>的<code>register</code>方法将当前的客户端注册到当前的<code>NIOEventLoop</code>中</p><p><code>SingleThreadEventLoop.register</code>:</p><blockquote><ol><li><p><strong>参数检查</strong>：确保 <code>promise</code> 不为空。</p></li><li><p><strong>获取 Unsafe 对象</strong>: <code>promise.channel().unsafe()</code></p><p>获取 Channel 的内部 Unsafe 实现。</p><ul><li><strong>Unsafe</strong>：是 Netty 内部使用的接口，提供了底层操作的能力，如注册、绑定、读写等。</li></ul></li><li><p><strong>调用 Unsafe.register ()</strong></p><ul><li>将当前 <code>NioEventLoopGroup</code> 中的一个 EventLoop（通过 <code>next()</code> 方法选择）传递给 Unsafe。</li><li>Unsafe 实现会负责实际的注册操作。</li></ul></li><li><p><strong>返回 Promise</strong>：返回原始的 promise 对象，用于异步获取注册结果。</p></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ChannelPromise promise：一个异步操作的承诺对象，用于跟踪注册操作的完成状态和结果</span></span><br><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">register</span><span class="params">(ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查 promise 不为空</span></span><br><span class="line">    ObjectUtil.checkNotNull(promise, <span class="string">&quot;promise&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取 Channel 的 Unsafe 对象并调用其 register 方法</span></span><br><span class="line">    promise.channel().unsafe().register(<span class="built_in">this</span>, promise);</span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后这个方法最终会调用<code>AbstractChannel.AbstractUnsafe.register</code>（处理具体的注册逻辑）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 Channel 注册到指定的 EventLoop 上</span></span><br><span class="line"><span class="comment"> * 此方法是 Channel 注册流程的核心入口，负责初始化 Channel 与 EventLoop 的关联</span></span><br><span class="line"><span class="comment"> * 并确保注册操作在线程安全的环境中执行</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> eventLoop 目标 EventLoop，Channel 将注册到该 EventLoop 管理的 Selector 上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> promise 用于异步通知注册结果的 Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(EventLoop eventLoop, <span class="keyword">final</span> ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查参数有效性</span></span><br><span class="line">    ObjectUtil.checkNotNull(eventLoop, <span class="string">&quot;eventLoop&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 确保 Channel 尚未注册</span></span><br><span class="line">    <span class="keyword">if</span> (AbstractChannel.<span class="built_in">this</span>.isRegistered()) &#123;</span><br><span class="line">        promise.setFailure(<span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;registered to an event loop already&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证 EventLoop 类型兼容性（例如 NioEventLoop 只能处理 NIO 类型的 Channel）</span></span><br><span class="line">    <span class="keyword">if</span> (!AbstractChannel.<span class="built_in">this</span>.isCompatible(eventLoop)) &#123;</span><br><span class="line">        promise.setFailure(<span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">            <span class="string">&quot;incompatible event loop type: &quot;</span> + eventLoop.getClass().getName()));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将 Channel 与指定的 EventLoop 关联</span></span><br><span class="line">    <span class="comment">// 这一步确保后续所有操作都在同一个 EventLoop 线程中执行</span></span><br><span class="line">    AbstractChannel.<span class="built_in">this</span>.eventLoop = eventLoop;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查当前线程是否是目标 EventLoop 的线程</span></span><br><span class="line">    <span class="comment">// Netty 要求所有 Channel 操作必须在其关联的 EventLoop 线程中执行</span></span><br><span class="line">    <span class="keyword">if</span> (eventLoop.inEventLoop()) &#123;</span><br><span class="line">        <span class="comment">// 如果当前线程是 EventLoop 线程，直接执行注册逻辑</span></span><br><span class="line">        register0(promise);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 如果不是 EventLoop 线程，则将注册任务封装为 Runnable 提交到 EventLoop</span></span><br><span class="line">        <span class="comment">// 确保注册操作在 EventLoop 线程中执行，保证线程安全</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            eventLoop.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    register0(promise);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="comment">// 处理任务提交失败的情况（例如 EventLoop 已关闭）</span></span><br><span class="line">            logger.warn(<span class="string">&quot;Force-closing a channel whose registration task was not accepted by an event loop: &#123;&#125;&quot;</span>, </span><br><span class="line">                        AbstractChannel.<span class="built_in">this</span>, t);</span><br><span class="line">            <span class="comment">// 强制关闭 Channel</span></span><br><span class="line">            closeForcibly();</span><br><span class="line">            AbstractChannel.<span class="built_in">this</span>.closeFuture.setClosed();</span><br><span class="line">            <span class="comment">// 标记 Promise 为失败状态</span></span><br><span class="line">            safeSetFailure(promise, t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 执行实际的注册操作（由 register() 方法调用）</span></span><br><span class="line"><span class="comment"> * 此方法会完成 JDK NIO Channel 到 Selector 的注册</span></span><br><span class="line"><span class="comment"> * 并触发 ChannelPipeline 中的注册完成事件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">register0</span><span class="params">(ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 标记首次注册状态</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">firstRegistration</span> <span class="operator">=</span> neverRegistered;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行 JDK NIO 底层注册操作</span></span><br><span class="line">        <span class="comment">// 将 Channel 注册到 EventLoop 的 Selector 上，初始不监听任何事件（ops=0）</span></span><br><span class="line">        doRegister();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新注册状态</span></span><br><span class="line">        neverRegistered = <span class="literal">false</span>;</span><br><span class="line">        registered = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 触发 ChannelPipeline 中所有添加的 ChannelHandler 的初始化逻辑</span></span><br><span class="line">        <span class="comment">// 确保所有 handlerAdded() 方法被调用</span></span><br><span class="line">        pipeline.invokeHandlerAddedIfNeeded();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 安全地标记 Promise 为成功状态</span></span><br><span class="line">        safeSetSuccess(promise);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 触发 ChannelRegistered 事件，通知所有 Handler 通道已注册</span></span><br><span class="line">        pipeline.fireChannelRegistered();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果 Channel 已处于活跃状态（例如客户端 Channel 已连接）</span></span><br><span class="line">        <span class="comment">// 则触发 ChannelActive 事件</span></span><br><span class="line">        <span class="keyword">if</span> (isActive()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (firstRegistration) &#123;</span><br><span class="line">                <span class="comment">// 首次注册且已激活，触发 ChannelActive 事件</span></span><br><span class="line">                pipeline.fireChannelActive();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config().isAutoRead()) &#123;</span><br><span class="line">                <span class="comment">// 非首次注册但配置了自动读取，开始读取数据</span></span><br><span class="line">                beginRead();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="comment">// 处理注册过程中发生的异常</span></span><br><span class="line">        <span class="comment">// 包括 JDK NIO 注册失败、Handler 初始化异常等</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 强制关闭 Channel</span></span><br><span class="line">        closeForcibly();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 标记关闭状态</span></span><br><span class="line">        closeFuture.setClosed();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 安全地标记 Promise 为失败状态</span></span><br><span class="line">        safeSetFailure(promise, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>假设</strong>：</p><ul><li><code>EventLoop</code> 绑定的线程是 <code>Thread-1</code>。</li><li>主线程（<code>main</code>）调用 <code>channel.register()</code>。</li></ul><p><strong>执行流程</strong>：</p><ol><li>主线程进入 <code>register()</code> 方法。</li><li>检查当前线程（<code>main</code>）是否是 <code>EventLoop</code> 线程（<code>Thread-1</code>），发现不是。</li><li>将 <code>register0()</code> 封装成任务，提交到 <code>EventLoop</code> 的任务队列。</li><li><code>Thread-1</code> 从队列中取出任务并执行 <code>register0()</code>。</li></ol><p>注册完成后会触发pipeline.fireChannelActive();会调用AbstractChannelHandlerContext.invokeChannelActive</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 静态工具方法：确保在正确的事件循环中调用 ChannelActive 事件</span></span><br><span class="line"><span class="comment"> * 根据执行器所在线程决定是直接调用还是提交异步任务执行</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 执行策略：</span></span><br><span class="line"><span class="comment"> * - 如果当前线程是处理器的事件循环线程，则直接同步调用</span></span><br><span class="line"><span class="comment"> * - 否则将调用封装为任务提交到事件循环线程执行</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> next 要调用的下一个 ChannelHandlerContext</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> EventExecutor#inEventLoop()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">invokeChannelActive</span><span class="params">(<span class="keyword">final</span> AbstractChannelHandlerContext next)</span> &#123;</span><br><span class="line">    <span class="comment">// 获取处理器关联的事件执行器</span></span><br><span class="line">    <span class="type">EventExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> next.executor();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断当前线程是否为事件循环线程</span></span><br><span class="line">    <span class="keyword">if</span> (executor.inEventLoop()) &#123;</span><br><span class="line">        <span class="comment">// 直接在当前线程调用，避免线程切换开销</span></span><br><span class="line">        next.invokeChannelActive();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 提交到事件循环线程异步执行</span></span><br><span class="line">        executor.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                next.invokeChannelActive();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 触发当前处理器的 ChannelActive 事件处理逻辑</span></span><br><span class="line"><span class="comment"> * 根据处理器类型调用对应实现，并处理可能的异常</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 执行流程：</span></span><br><span class="line"><span class="comment"> * 1. 判断当前处理器是否应该处理该事件</span></span><br><span class="line"><span class="comment"> * 2. 根据处理器类型选择具体的调用方式：</span></span><br><span class="line"><span class="comment"> *    - 头部处理器：直接调用 HeadContext 的实现</span></span><br><span class="line"><span class="comment"> *    - 双向处理器：调用 ChannelDuplexHandler 的实现</span></span><br><span class="line"><span class="comment"> *    - 默认情况：调用 ChannelInboundHandler 的实现</span></span><br><span class="line"><span class="comment"> * 3. 捕获并处理所有异常，确保事件流不中断</span></span><br><span class="line"><span class="comment"> * 4. 若当前处理器不处理，则将事件传播到下一个处理器</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ChannelHandler#channelActive(ChannelHandlerContext)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">invokeChannelActive</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 判断是否应由当前处理器处理事件</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.invokeHandler()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取当前处理器实例</span></span><br><span class="line">            <span class="type">ChannelHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="built_in">this</span>.handler();</span><br><span class="line">            <span class="comment">// 获取pipeline头部处理器引用</span></span><br><span class="line">            DefaultChannelPipeline.<span class="type">HeadContext</span> <span class="variable">headContext</span> <span class="operator">=</span> <span class="built_in">this</span>.pipeline.head;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 根据处理器类型选择调用方式</span></span><br><span class="line">            <span class="keyword">if</span> (handler == headContext) &#123;</span><br><span class="line">                <span class="comment">// 头部处理器特殊处理（如网络IO操作）</span></span><br><span class="line">                headContext.channelActive(<span class="built_in">this</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> ChannelDuplexHandler) &#123;</span><br><span class="line">                <span class="comment">// 双向处理器支持完整的入站/出站操作</span></span><br><span class="line">                ((ChannelDuplexHandler)handler).channelActive(<span class="built_in">this</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 默认作为入站处理器处理</span></span><br><span class="line">                ((ChannelInboundHandler)handler).channelActive(<span class="built_in">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="comment">// 异常处理机制确保事件处理流程不中断</span></span><br><span class="line">            <span class="built_in">this</span>.invokeExceptionCaught(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 将事件传播到下一个处理器</span></span><br><span class="line">        <span class="built_in">this</span>.fireChannelActive();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>头部处理器：</p><p>是Netty 底层 I&#x2F;O 操作的入口和出口，负责处理与物理通道（如 TCP 连接）直接相关的操作，并衔接上层业务处理器、、</p><h2><span id="abstractchannel">AbstractChannel</span></h2><p><code>AbstractChannel</code> 是 Netty 框架中的一个抽象类，它在 Netty 的网络通信中扮演着非常重要的角色，是所有具体通道实现类的基类</p><p><code>AbstractChannel</code> 类是 Netty 框架中实现网络通信的基础，它提供了通道的基本抽象和功能，为上层应用提供了一个统一的、高效的网络编程接口。通过继承 <code>AbstractChannel</code>，Netty 实现了多种不同类型的通道（如 <code>NioServerSocketChannel</code>、<code>NioSocketChannel</code> 等</p><h3><span id="属性字段">属性字段</span></h3><table><thead><tr><th><strong>字段名称</strong></th><th><strong>类型</strong></th><th><strong>核心作用</strong></th><th><strong>设计要点 &#x2F; 场景</strong></th></tr></thead><tbody><tr><td><code>parent</code></td><td><code>Channel</code></td><td>父通道引用（如服务器通道对应的客户端通道）</td><td>用于层级管理，父通道关闭时可级联关闭子通道</td></tr><tr><td><code>id</code></td><td><code>ChannelId</code></td><td>通道全局唯一标识符</td><td>基于 UUID 生成，用于日志、监控标识特定连接</td></tr><tr><td><code>unsafe</code></td><td><code>Channel.Unsafe</code></td><td>底层传输操作接口（如 Java NIO 的 <code>Selector</code> 操作）</td><td>解耦 Netty 抽象层与具体 IO 模型（NIO&#x2F;Epoll），提供 <code>read()</code>、<code>write()</code> 等底层方法</td></tr><tr><td><code>pipeline</code></td><td><code>DefaultChannelPipeline</code></td><td>处理器链（<code>ChannelHandler</code> 链表）</td><td>处理入站 &#x2F; 出站事件，支持动态添加 &#x2F; 删除处理器，实现业务逻辑与 IO 的解耦</td></tr><tr><td><code>closeFuture</code></td><td><code>CloseFuture</code></td><td>通道关闭事件的异步通知机制</td><td>基于 <code>Future-Listener</code> 模式，支持非阻塞式关闭回调（如资源释放）</td></tr><tr><td><code>eventLoop</code></td><td><code>EventLoop</code></td><td>关联的事件循环线程（<code>NioEventLoop</code> 等）</td><td>通道的所有 IO 操作必须在此线程执行，确保线程安全</td></tr><tr><td><code>registered</code></td><td><code>boolean</code></td><td>标识通道是否已注册到 <code>Selector</code></td><td><code>true</code> 表示可开始监听 IO 事件（如 <code>OP_READ</code>），由 <code>register()</code> 方法更新</td></tr><tr><td><code>localAddress</code></td><td><code>SocketAddress</code></td><td>本地绑定地址（如服务器端口）</td><td>绑定端口后设置（如 <code>0.0.0.0:8080</code>）</td></tr><tr><td><code>remoteAddress</code></td><td><code>SocketAddress</code></td><td>远程连接地址（如客户端 IP + 端口）</td><td>客户端连接建立后设置（如 <code>192.168.1.1:50000</code>）</td></tr><tr><td><code>unsafeVoidPromise</code></td><td><code>VoidChannelPromise</code></td><td>空操作的 <code>ChannelPromise</code>（占位符）</td><td>用于不需要返回结果的操作（如内部清理），避免创建临时对象</td></tr><tr><td><code>closeInitiated</code></td><td><code>boolean</code></td><td>标识是否已发起关闭流程</td><td>防止重复关闭，确保关闭逻辑幂等性</td></tr><tr><td><code>initialCloseCause</code></td><td><code>Throwable</code></td><td>关闭原因（异常信息）</td><td></td></tr></tbody></table><h3><span id="方法">方法</span></h3><table><thead><tr><th><strong>方法名称</strong></th><th><strong>参数</strong></th><th><strong>返回值</strong></th><th><strong>核心功能</strong></th><th><strong>设计要点 &#x2F; 典型场景</strong></th></tr></thead><tbody><tr><td><code>register(EventLoop, Promise)</code></td><td><code>EventLoop</code>, <code>ChannelPromise</code></td><td><code>void</code></td><td>将通道注册到指定 <code>EventLoop</code> 的 <code>Selector</code> 上</td><td>线程安全设计：若当前线程不是 <code>EventLoop</code> 线程，通过 <code>execute()</code> 提交任务确保单线程执行</td></tr><tr><td><code>bind(SocketAddress, Promise)</code></td><td><code>SocketAddress</code>, <code>ChannelPromise</code></td><td><code>ChannelFuture</code></td><td>绑定本地地址（如服务器端口）</td><td>异步操作：返回 <code>ChannelFuture</code> 监听绑定结果，内部调用 <code>doBind()</code> 实现具体逻辑</td></tr><tr><td><code>connect(SocketAddress, Promise)</code></td><td><code>SocketAddress</code>, <code>ChannelPromise</code></td><td><code>ChannelFuture</code></td><td>连接远程地址（客户端模式）</td><td>异步操作：支持超时设置，内部调用 <code>doConnect()</code> 实现具体连接逻辑</td></tr><tr><td><code>disconnect(Promise)</code></td><td><code>ChannelPromise</code></td><td><code>ChannelFuture</code></td><td>断开连接（客户端模式）</td><td>通常用于主动关闭连接，释放资源，内部调用 <code>doDisconnect()</code></td></tr><tr><td><code>close(Promise)</code></td><td><code>ChannelPromise</code></td><td><code>ChannelFuture</code></td><td>关闭通道（优雅关闭）</td><td>触发 <code>pipeline</code> 的 <code>channelInactive()</code> 事件，确保所有处理器有机会执行清理逻辑</td></tr><tr><td><code>write(Object, Promise)</code></td><td><code>Object</code>（消息）, <code>ChannelPromise</code></td><td><code>ChannelFuture</code></td><td>将消息写入通道（异步操作）</td><td>消息从 <code>pipeline</code> 的尾部开始流动，最终调用 <code>unsafe.write()</code> 执行底层写操作</td></tr><tr><td><code>flush()</code></td><td><code>void</code></td><td><code>Channel</code></td><td>强制刷新缓冲区，将数据发送到网络</td><td>通常与 <code>write()</code> 配合使用（如 <code>writeAndFlush()</code>），触发 <code>pipeline</code> 的 <code>flush()</code> 事件</td></tr><tr><td><code>read()</code></td><td><code>void</code></td><td><code>Channel</code></td><td>触发通道读取数据（从网络接收数据）</td><td>调用 <code>pipeline</code> 的 <code>read()</code> 事件，最终调用 <code>unsafe.beginRead()</code> 注册 <code>OP_READ</code> 事件</td></tr><tr><td><code>pipeline()</code></td><td><code>void</code></td><td><code>ChannelPipeline</code></td><td>获取通道的 <code>ChannelPipeline</code>（处理器链）</td><td>线程安全：每个通道有独立的 <code>pipeline</code>，支持动态添加 &#x2F; 删除处理器</td></tr><tr><td><code>config()</code></td><td><code>void</code></td><td><code>ChannelConfig</code></td><td>获取通道配置（如 <code>TCP_NODELAY</code>、<code>SO_KEEPALIVE</code> 等）</td><td>配置参数通过 <code>ChannelOption</code> 设置，影响底层 <code>Socket</code> 行为</td></tr><tr><td><code>localAddress()</code></td><td><code>void</code></td><td><code>SocketAddress</code></td><td>获取本地绑定地址</td><td>绑定后返回 <code>localAddress</code> 字段值，否则返回 <code>null</code></td></tr><tr><td><code>remoteAddress()</code></td><td><code>void</code></td><td><code>SocketAddress</code></td><td>获取远程连接地址</td><td>连接建立后返回 <code>remoteAddress</code> 字段值，否则返回 <code>null</code></td></tr><tr><td><code>isActive()</code></td><td><code>void</code></td><td><code>boolean</code></td><td>判断通道是否处于活跃状态（已连接或已绑定）</td><td>通常用于检查通道是否可进行读写操作</td></tr></tbody></table><h2><span id="netty服务器启动源码剖析">Netty服务器启动源码剖析</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建并配置Netty服务器</span></span><br><span class="line"><span class="type">ServerBootstrap</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line"><span class="comment">// 设置服务器的BossGroup和WorkGroup</span></span><br><span class="line">server.group(bossGroup, workGroups);</span><br><span class="line"><span class="comment">// 指定服务器的通道类型</span></span><br><span class="line">server.channel(NioServerSocketChannel.class);</span><br><span class="line"><span class="comment">// 2.配置服务器的处理器</span></span><br><span class="line"><span class="comment">// 2.1. 主通道处理器（用于ServerSocketChannel，处理连接建立事件）</span></span><br><span class="line">server.handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;NioServerSocketChannel&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(NioServerSocketChannel ch)</span> &#123;</span><br><span class="line">        <span class="comment">// 配置主通道的处理器链（如日志记录、连接限制等）</span></span><br><span class="line">        ch.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2.2. 子通道处理器（用于SocketChannel，处理读写事件）</span></span><br><span class="line">ChannelInitializer&lt;SocketChannel&gt; childHandlers = <span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 配置SocketChannel的管道</span></span><br><span class="line">        socketChannel.pipeline().addLast(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StringDecoder</span>(), <span class="comment">// 字符串解码器</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StringEncoder</span>(), <span class="comment">// 字符串编码器</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ChatServerHandler</span>(), <span class="comment">// 自定义处理器</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ChatConnectionServerHandler</span>() <span class="comment">// 监听客户端状态</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">server.childHandler(childHandlers);</span><br><span class="line"><span class="comment">// 设置服务器的配置项</span></span><br><span class="line">server.option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">        .childOption(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.绑定端口并启动服务</span></span><br><span class="line"><span class="type">ChannelFuture</span> <span class="variable">serverChannel</span> <span class="operator">=</span> server.bind(port).sync();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.等待服务器关闭</span></span><br><span class="line">serverChannel.channel().closeFuture().sync();</span><br></pre></td></tr></table></figure><ol><li>**创建并初始化 <code>ServerSocketChannel</code>**：<ul><li><code>ServerBootstrap</code> 根据配置创建一个 <code>ServerSocketChannel</code>，用于监听客户端连接。</li><li>配置 <code>ServerSocketChannel</code> 的一些参数，如 <code>SO_BACKLOG</code>（连接队列长度）等。</li></ul></li><li>**将 <code>ServerSocketChannel</code> 注册到 <code>EventLoop</code>**：<ul><li><code>ServerSocketChannel</code> 会被注册到 <code>EventLoop</code> 的 <code>Selector</code> 上，以便监听连接事件。</li><li>注册过程是异步的，通过 <code>ChannelFuture</code> 来通知注册结果。</li></ul></li><li><strong>绑定端口</strong>：<ul><li>调用 <code>ServerSocketChannel</code> 的 <code>bind</code> 方法，将其绑定到指定的端口。</li><li>底层会调用操作系统的 <code>bind</code> 系统调用，将套接字绑定到指定的 IP 地址和端口。</li></ul></li><li><strong>启动监听</strong>：<ul><li>绑定成功后，<code>ServerSocketChannel</code> 开始监听客户端连接。</li><li>此时，<code>ServerSocketChannel</code> 处于 <code>OP_ACCEPT</code> 状态，等待客户端连接。</li></ul></li><li><strong>阻塞等待绑定完成</strong>：<ul><li><code>sync()</code> 方法会阻塞当前线程，直到绑定操作完成。</li><li>如果绑定成功，<code>ChannelFuture</code> 的 <code>isSuccess()</code> 方法返回 <code>true</code>；如果绑定失败，<code>ChannelFuture</code> 的 <code>isSuccess()</code> 方法返回 <code>false</code>，并且可以通过 <code>cause()</code> 方法获取失败原因。</li></ul></li><li><strong>触发 <code>ChannelActive</code> 事件</strong>：<ul><li>如果 <code>Channel</code> 在绑定后变为活跃状态（之前不活跃），会异步触发 <code>ChannelActive</code> 事件。</li><li><code>ChannelActive</code> 事件会被传播到 <code>ChannelPipeline</code> 中的所有 <code>ChannelHandler</code>，以便它们可以执行相应的初始化或处理逻辑。</li></ul></li></ol><p><img src="/./../images/image-20250518125459436.png" alt="image-20250518125459436"></p><h3><span id="1初始化eventloopgroup">1.初始化EventLoopGroup</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.group(bossGroup, workerGroups);</span><br></pre></td></tr></table></figure><p>调用<code>ServerBootStrap</code>的<code>group</code>方法指定<code>bossGroup</code>和<code>workerGroup</code></p><ul><li><code>workerGroup</code>会传递给<code>ServerBootStrap</code>类，指定<code>childGroup</code>为<code>workerGroup</code></li><li><code>bossGroup</code>会传递给<code>AbstractBootstrap</code>这个类，指定这个类的<code>group</code>属性为传递的<code>bossGroup</code></li></ul><p>（<code>ServerBootStrap</code>类继承了<code>AbstractBootstrap</code>类）</p><p><strong>一般情况下：</strong></p><p><code>bossGroup</code>可以认为是主<code>Reactor</code>线程池，主要负责处理客户端的<strong>连接请求</strong>（<code>accept</code>事件），建立与客户端的连接</p><p><code>workerGroup</code>可以认为是从<code>Reactor</code>线程池。主要负责处理<strong>已建立连接的 <code>Channel</code> 的读写事件</strong>（<code>read/write</code>事件），包括数据的接收、处理和发送</p><h3><span id="2初始化channel">2.初始化channel</span></h3><p>主要是设置<code>AbstractBootstrap</code>里面的<code>channelFactory</code>属性设置为对应通道类型的工厂类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.channel(NioServerSocketChannel.class);</span><br></pre></td></tr></table></figure><p>调用的是父类<code>AbstractBootstrap</code>的<code>channel</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> B <span class="title function_">channel</span><span class="params">(Class&lt;? extends C&gt; channelClass)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.channelFactory((io.netty.channel.ChannelFactory)(<span class="keyword">new</span> <span class="title class_">ReflectiveChannelFactory</span>((Class)ObjectUtil.checkNotNull(channelClass, <span class="string">&quot;channelClass&quot;</span>))));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> B <span class="title function_">channelFactory</span><span class="params">(io.netty.channel.ChannelFactory&lt;? extends C&gt; channelFactory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.channelFactory((ChannelFactory)channelFactory);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> B <span class="title function_">channelFactory</span><span class="params">(ChannelFactory&lt;? extends C&gt; channelFactory)</span> &#123;</span><br><span class="line">    ObjectUtil.checkNotNull(channelFactory, <span class="string">&quot;channelFactory&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.channelFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;channelFactory set already&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.channelFactory = channelFactory;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.self();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ReflectiveChannelFactory</code> 是 Netty 中用于<strong>通过反射创建 Channel 实例</strong>的工厂类</p><p><code>ReflectiveChannelFactory</code>通过<code>channelClass</code>（当前通道的类型）通过反射拿到对应类（当前通道）的无参构造器</p><p><code>ReflectiveChannelFactory</code>实现了<code>ChannelFactory</code>接口，所以它是<code>ChannelFactory</code>的子类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ReflectiveChannelFactory</span><span class="params">(Class&lt;? extends T&gt; clazz)</span> &#123;</span><br><span class="line">    ObjectUtil.checkNotNull(clazz, <span class="string">&quot;clazz&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.constructor = clazz.getConstructor();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException var3) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Class &quot;</span> + StringUtil.simpleClassName(clazz) + <span class="string">&quot; does not have a public non-arg constructor&quot;</span>, var3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过<code>channelFactory</code>方法将当前类的<code>channelFactory</code>属性初始化为<code>ReflectiveChannelFactory</code>对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> B <span class="title function_">channelFactory</span><span class="params">(ChannelFactory&lt;? extends C&gt; channelFactory)</span> &#123;</span><br><span class="line">    ObjectUtil.checkNotNull(channelFactory, <span class="string">&quot;channelFactory&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.channelFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;channelFactory set already&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.channelFactory = channelFactory;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.self();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ChannelFactory</code>接口提供了一个<code>newChannel</code>方法，这个方法对应的实现类是<code>ReflectiveChannelFactory</code>，这个方法返回通过反射拿到的构造器创建对应通道类型的实例（即NioServerSocketChannel实例）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">newChannel</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (Channel)<span class="built_in">this</span>.constructor.newInstance();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var2) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ChannelException</span>(<span class="string">&quot;Unable to create Channel from class &quot;</span> + <span class="built_in">this</span>.constructor.getDeclaringClass(), var2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="3初始化处理器">3.初始化处理器</span></h3><p>在 Netty 中，**<code>ChannelInitializer</code>** 是一个核心组件，用于<strong>动态初始化 Channel 的处理器链（<code>ChannelPipeline</code>）</strong></p><p>会在 Channel 注册到<code>EventLoop</code>后、真正开始处理数据前，动态添加处理器</p><p>当 Channel 注册到<code>EventLoop</code>时，<code>ChannelInitializer</code>的<code>initChannel()</code>方法会被触发，会调用<code>AbstractChannel</code>类的<code>pipeline</code>方法给当前Channel的<code>ChannelPipeline</code>对象（即<code>pipeline</code>）添加处理器链</p><p><img src="/./../images/image-20250518135552301.png" alt="image-20250518135552301"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 配置SocketChannel的管道</span></span><br><span class="line">    socketChannel.pipeline().addLast(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">StringDecoder</span>(), <span class="comment">// 字符串解码器</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">StringEncoder</span>(), <span class="comment">// 字符串编码器</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ChatServerHandler</span>(), <span class="comment">// 自定义处理器</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ChatConnectionServerHandler</span>() <span class="comment">// 监听客户端状态</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ChannelPipeline <span class="title function_">addLast</span><span class="params">(EventExecutorGroup executor, ChannelHandler... handlers)</span> &#123;</span><br><span class="line">    ObjectUtil.checkNotNull(handlers, <span class="string">&quot;handlers&quot;</span>);</span><br><span class="line">    ChannelHandler[] var3 = handlers;</span><br><span class="line">    <span class="type">int</span> <span class="variable">var4</span> <span class="operator">=</span> handlers.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var5</span> <span class="operator">=</span> <span class="number">0</span>; var5 &lt; var4; ++var5) &#123;</span><br><span class="line">        <span class="type">ChannelHandler</span> <span class="variable">h</span> <span class="operator">=</span> var3[var5];</span><br><span class="line">        <span class="keyword">if</span> (h == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.addLast(executor, (String)<span class="literal">null</span>, h);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5><span id="初始化主通道处理器handler">初始化主通道处理器(handler())</span></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 主通道处理器（用于ServerSocketChannel，处理连接建立事件）</span></span><br><span class="line">server.handler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;NioServerSocketChannel&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(NioServerSocketChannel ch)</span> &#123;</span><br><span class="line">        <span class="comment">// 配置主通道的处理器链（如日志记录、连接限制等）</span></span><br><span class="line">        ch.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>调用入口是<code>AbstractBootstrap类</code>的<code>handler</code>方法，将<code>AbstractBootstrap类</code>的<code>handler属性</code>设置为传入的处理器，主要用于处理<code>bossGroup</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> B <span class="title function_">handler</span><span class="params">(ChannelHandler handler)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.handler = (ChannelHandler)ObjectUtil.checkNotNull(handler, <span class="string">&quot;handler&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.self();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5><span id="初始化子通道处理器childhandler">初始化子通道处理器(childHandler())</span></h5><p>客户端连接服务器时，为客户端通道添加处理器链</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 子通道处理器（用于SocketChannel，处理读写事件）</span></span><br><span class="line">ChannelInitializer&lt;SocketChannel&gt; childHandlers = <span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 配置SocketChannel的管道</span></span><br><span class="line">        socketChannel.pipeline().addLast(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StringDecoder</span>(), <span class="comment">// 字符串解码器</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">StringEncoder</span>(), <span class="comment">// 字符串编码器</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ChatServerHandler</span>(), <span class="comment">// 自定义处理器</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ChatConnectionServerHandler</span>() <span class="comment">// 监听客户端状态</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">server.childHandler(childHandlers);</span><br></pre></td></tr></table></figure><p>调用的入口是<code>ServerBootStrap</code>的<code>childHandler</code>方法，主要是将<code>ServerBootStrap</code>的子处理器<code>childHandler</code>设置为传入的处理器</p><p>这个子处理器其实就是用于处理<code>workerGroup</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ServerBootstrap <span class="title function_">childHandler</span><span class="params">(ChannelHandler childHandler)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.childHandler = (ChannelHandler)ObjectUtil.checkNotNull(childHandler, <span class="string">&quot;childHandler&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="4绑定端口并启动服务">4.绑定端口并启动服务</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定端口并启动服务</span></span><br><span class="line"><span class="type">ChannelFuture</span> <span class="variable">serverChannel</span> <span class="operator">=</span> server.bind(port).sync();</span><br></pre></td></tr></table></figure><p>调用关系图：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 核心调用链路（简化版）</span></span><br><span class="line"><span class="number">1.</span> ServerBootstrap.bind(port)                <span class="comment">// 用户调用入口</span></span><br><span class="line"><span class="number">2.</span>  -&gt; AbstractBootstrap.doBind(localAddress) <span class="comment">// 启动器内部逻辑</span></span><br><span class="line"><span class="number">3.</span>     -&gt; Channel.bind(localAddress)          <span class="comment">// 通道绑定操作</span></span><br><span class="line"><span class="number">4.</span>       -&gt; ChannelPipeline.bind()            <span class="comment">// 触发 Pipeline 事件</span></span><br><span class="line"><span class="number">5.</span>         -&gt; HeadContext.bind()              <span class="comment">// Pipeline 头部处理器</span></span><br><span class="line"><span class="number">6.</span>           -&gt; NioMessageUnsafe.bind()       <span class="comment">// 底层 unsafe 操作</span></span><br><span class="line"><span class="number">7.</span>             -&gt; ServerSocketChannel.bind()  <span class="comment">// 调用 Java NIO 原生方法</span></span><br><span class="line"><span class="number">8.</span>               -&gt; OS socket.bind()          <span class="comment">// 操作系统系统调用</span></span><br><span class="line"><span class="number">9.</span>               -&gt; OS socket.listen()        <span class="comment">// 操作系统系统调用</span></span><br><span class="line"><span class="number">10.</span> serverChannel.sync()                     <span class="comment">// 阻塞等待绑定完成</span></span><br></pre></td></tr></table></figure><p>入口函数：调用AbstractBootstrap的bind方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">bind</span><span class="params">(<span class="type">int</span> inetPort)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(inetPort));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">bind</span><span class="params">(SocketAddress localAddress)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.validate();</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.doBind((SocketAddress)ObjectUtil.checkNotNull(localAddress, <span class="string">&quot;localAddress&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> ChannelFuture <span class="title function_">doBind</span><span class="params">(<span class="keyword">final</span> SocketAddress localAddress)</span> &#123;</span><br><span class="line">    <span class="comment">// 步骤1：初始化Channel并注册到EventLoop</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ChannelFuture</span> <span class="variable">regFuture</span> <span class="operator">=</span> <span class="built_in">this</span>.initAndRegister();</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> regFuture.channel();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 步骤2：根据注册结果处理绑定</span></span><br><span class="line">    <span class="keyword">if</span> (regFuture.cause() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> regFuture; <span class="comment">// 注册失败，直接返回失败结果</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (regFuture.isDone()) &#123;</span><br><span class="line">        <span class="comment">// 注册已完成，立即执行绑定</span></span><br><span class="line">        <span class="type">ChannelPromise</span> <span class="variable">promise</span> <span class="operator">=</span> channel.newPromise();</span><br><span class="line">        doBind0(regFuture, channel, localAddress, promise);</span><br><span class="line">        <span class="keyword">return</span> promise;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 注册未完成（异步），添加监听器，注册完成后再执行绑定</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">PendingRegistrationPromise</span> <span class="variable">promise</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PendingRegistrationPromise</span>(channel);</span><br><span class="line">        regFuture.addListener(<span class="keyword">new</span> <span class="title class_">ChannelFutureListener</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operationComplete</span><span class="params">(ChannelFuture future)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="type">Throwable</span> <span class="variable">cause</span> <span class="operator">=</span> future.cause();</span><br><span class="line">                <span class="keyword">if</span> (cause != <span class="literal">null</span>) &#123;</span><br><span class="line">                    promise.setFailure(cause); <span class="comment">// 注册失败，传播异常</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    promise.registered();</span><br><span class="line">                    AbstractBootstrap.doBind0(regFuture, channel, localAddress, promise); <span class="comment">// 注册成功，执行绑定</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> promise;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="41初始化并注册channel">4.1.初始化并注册Channel</span></h4><p><strong>调用AbstractBootstrap的initAndRegister方法</strong></p><p>1.通过channelFactory工厂类，创建通道实例channel</p><p>2.通过this.init(channel)初始化当前通道，负责初始化服务器 Channel 的各项参数和处理器链。</p><p>3.将 Channel 注册到 EventLoopGroup 中的某个 EventLoop</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化 Channel 并将其注册到 EventLoopGroup，为后续的网络通信做准备。</span></span><br><span class="line"><span class="comment"> * 这是服务器启动流程中的核心步骤，完成后 Channel 开始监听网络事件。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 表示注册操作的异步结果。成功时可通过 Channel 绑定端口，失败时包含具体异常。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">final</span> ChannelFuture <span class="title function_">initAndRegister</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 通过反射创建 Channel 实例（如 NioServerSocketChannel）</span></span><br><span class="line">        <span class="comment">//    - 此步骤会初始化底层 Java NIO Channel（如 ServerSocketChannel）</span></span><br><span class="line">        <span class="comment">//    - 设置为非阻塞模式并创建对应的 Pipeline</span></span><br><span class="line">        channel = <span class="built_in">this</span>.channelFactory.newChannel();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 初始化 Channel 配置：</span></span><br><span class="line">        <span class="comment">//    - 设置 TCP 参数（如 SO_BACKLOG、SO_REUSEADDR）</span></span><br><span class="line">        <span class="comment">//    - 添加用户通过 handler() 设置的处理器（如 LoggingHandler）</span></span><br><span class="line">        <span class="comment">//    - 对于 ServerBootstrap，会添加 ServerBootstrapAcceptor 用于处理新连接</span></span><br><span class="line">        <span class="built_in">this</span>.init(channel);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="comment">// 初始化失败时，强制关闭 Channel 并返回失败的 ChannelPromise</span></span><br><span class="line">        <span class="comment">// 确保资源正确释放，避免内存泄漏</span></span><br><span class="line">        <span class="keyword">if</span> (channel != <span class="literal">null</span>) &#123;</span><br><span class="line">            channel.unsafe().closeForcibly();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultChannelPromise</span>(channel, GlobalEventExecutor.INSTANCE).setFailure(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 若 Channel 创建失败，返回特殊的 FailedChannel 实例</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultChannelPromise</span>(<span class="keyword">new</span> <span class="title class_">FailedChannel</span>(), GlobalEventExecutor.INSTANCE).setFailure(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 将 Channel 注册到 EventLoopGroup 中的某个 EventLoop：</span></span><br><span class="line">    <span class="comment">//    - 对于 ServerBootstrap，config().group() 返回 bossGroup（处理连接接受的线程池）</span></span><br><span class="line">    <span class="comment">//    - 注册后，EventLoop 开始监听 OP_ACCEPT 事件（对于服务器 Channel）</span></span><br><span class="line">    <span class="comment">//    - 注册是异步操作，通过 ChannelFuture 通知结果</span></span><br><span class="line">    <span class="type">ChannelFuture</span> <span class="variable">regFuture</span> <span class="operator">=</span> <span class="built_in">this</span>.config().group().register(channel);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 注册失败处理：</span></span><br><span class="line">    <span class="comment">//    - 若注册过程中立即发现异常（如 Selector 打开失败）</span></span><br><span class="line">    <span class="comment">//    - 根据 Channel 状态选择优雅关闭或强制关闭</span></span><br><span class="line">    <span class="keyword">if</span> (regFuture.cause() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (channel.isRegistered()) &#123;</span><br><span class="line">            channel.close(); <span class="comment">// 已注册但失败，执行优雅关闭</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            channel.unsafe().closeForcibly(); <span class="comment">// 未注册成功，强制关闭</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> regFuture;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1.通过channelFactory属性创建对应通道类型的实例（channelFactory这个工厂类是在初始化的时候创建的）</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">channel = <span class="built_in">this</span>.channelFactory.newChannel();</span><br></pre></td></tr></table></figure><p><strong>2.通过调用ServerBootstrap类的init方法初始化当前通道</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.init(channel);</span><br></pre></td></tr></table></figure><p>2.1.<strong>配置服务器 Channel</strong>：设置选项（如 <code>SO_BACKLOG</code>）和属性。</p><p>2.2.<strong>构建 Pipeline</strong>：添加主处理器（如 <code>LoggingHandler</code>）和 <code>ServerBootstrapAcceptor</code>。</p><p>2.3.<strong>处理新连接</strong>：</p><ul><li><code>ServerBootstrapAcceptor</code> 负责创建子 Channel（<code>SocketChannel</code>）。</li><li>为子 Channel 配置处理器链（如 <code>HttpServerCodec</code>）。</li><li>将子 Channel 注册到 <code>childGroup</code> 的 <code>EventLoop</code>。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">init</span><span class="params">(Channel channel)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 设置 Channel 选项（如 TCP 参数）</span></span><br><span class="line">    setChannelOptions(channel, <span class="built_in">this</span>.newOptionsArray(), logger);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置 Channel 属性（自定义键值对）</span></span><br><span class="line">    setAttributes(channel, <span class="built_in">this</span>.newAttributesArray());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 获取 Channel 的 Pipeline（处理器链）</span></span><br><span class="line">    <span class="type">ChannelPipeline</span> <span class="variable">p</span> <span class="operator">=</span> channel.pipeline();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 保存 childGroup 和 childHandler 的引用（用于处理客户端连接）</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">EventLoopGroup</span> <span class="variable">currentChildGroup</span> <span class="operator">=</span> <span class="built_in">this</span>.childGroup;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ChannelHandler</span> <span class="variable">currentChildHandler</span> <span class="operator">=</span> <span class="built_in">this</span>.childHandler;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 添加一个特殊的 ChannelInitializer 到 Pipeline</span></span><br><span class="line">    p.addLast(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;Channel&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(<span class="keyword">final</span> Channel ch)</span> &#123;</span><br><span class="line">            <span class="comment">// 5.1 添加用户配置的主处理器（如 LoggingHandler）</span></span><br><span class="line">            <span class="type">ChannelHandler</span> <span class="variable">handler</span> <span class="operator">=</span> ServerBootstrap.<span class="built_in">this</span>.config.handler();</span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                pipeline.addLast(handler);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5.2 添加 ServerBootstrapAcceptor 到 Pipeline（关键组件）</span></span><br><span class="line">            ch.eventLoop().execute(() -&gt; &#123;</span><br><span class="line">                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">ServerBootstrapAcceptor</span>(</span><br><span class="line">                    ch, currentChildGroup, currentChildHandler, </span><br><span class="line">                    currentChildOptions, currentChildAttrs, extensions</span><br><span class="line">                ));</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 调用扩展点（如果有）</span></span><br><span class="line">    <span class="keyword">if</span> (!extensions.isEmpty() &amp;&amp; channel <span class="keyword">instanceof</span> ServerChannel) &#123;</span><br><span class="line">        <span class="comment">// 执行扩展逻辑...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ServerBootstrapAcceptor</code> 是一个特殊的 <code>ChannelInboundHandler</code>，它作为<strong>连接管理器</strong>存在于 <code>NioServerSocketChannel</code> 的 Pipeline 中，主要负责：</p><ul><li><strong>接收新连接</strong>：当主 Reactor（<code>bossGroup</code>）检测到客户端连接请求时，创建对应的 <code>NioSocketChannel</code>。</li><li><strong>分配 EventLoop</strong>：从从 Reactor（<code>childGroup</code>）中选择一个 <code>EventLoop</code> 分配给新连接。</li><li><strong>初始化子 Channel</strong>：为新连接的 <code>NioSocketChannel</code> 配置处理器链（<code>Pipeline</code>）和选项。</li><li><strong>注册到 Selector</strong>：将新连接注册到分配的 <code>EventLoop</code> 的 <code>Selector</code> 上，开始监听读写事件。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.2 添加 ServerBootstrapAcceptor 到 Pipeline（关键组件）</span></span><br><span class="line">ch.eventLoop().execute(() -&gt; &#123;</span><br><span class="line">    pipeline.addLast(<span class="keyword">new</span> <span class="title class_">ServerBootstrapAcceptor</span>(</span><br><span class="line">        ch, currentChildGroup, currentChildHandler, </span><br><span class="line">        currentChildOptions, currentChildAttrs, extensions</span><br><span class="line">    ));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>当有新客户端连接时，<code>ServerBootstrapAcceptor</code> 的 <code>channelRead()</code> 方法会被触发</strong></p><p>核心功能：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理新连接的核心方法。当主 Reactor（bossGroup）接收到客户端连接时，此方法会被触发，</span></span><br><span class="line"><span class="comment"> * 负责将新连接配置并注册到从 Reactor（workerGroup）。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ctx 上下文对象，用于与 Pipeline 交互</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> msg 新连接的 Channel 对象（如 NioSocketChannel）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 获取新连接的 Channel 对象（代表客户端连接）</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Channel</span> <span class="variable">child</span> <span class="operator">=</span> (Channel) msg;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 配置子 Channel 的 Pipeline：</span></span><br><span class="line">    <span class="comment">//    - 添加用户通过 childHandler() 设置的处理器链（如 HttpServerCodec、业务处理器）</span></span><br><span class="line">    <span class="comment">//    - 每个新连接都会创建独立的 Pipeline 实例，确保线程安全</span></span><br><span class="line">    child.pipeline().addLast(<span class="keyword">new</span> <span class="title class_">ChannelHandler</span>[]&#123;<span class="built_in">this</span>.childHandler&#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 设置子 Channel 的 TCP 选项：</span></span><br><span class="line">    <span class="comment">//    - 常见选项：TCP_NODELAY（禁用 Nagle 算法）、SO_KEEPALIVE（启用保活机制）</span></span><br><span class="line">    <span class="comment">//    - 这些选项会影响底层 Socket 的行为</span></span><br><span class="line">    AbstractBootstrap.setChannelOptions(child, <span class="built_in">this</span>.childOptions, ServerBootstrap.logger);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 设置子 Channel 的自定义属性：</span></span><br><span class="line">    <span class="comment">//    - 存储与连接相关的元数据（如认证信息、会话ID）</span></span><br><span class="line">    <span class="comment">//    - 示例：channel.attr(AttributeKey.valueOf(&quot;sessionId&quot;)).set(&quot;12345&quot;);</span></span><br><span class="line">    AbstractBootstrap.setAttributes(child, <span class="built_in">this</span>.childAttrs);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. 执行扩展逻辑（如果有）：</span></span><br><span class="line">    <span class="comment">//    - 允许用户在 Channel 初始化后执行自定义逻辑</span></span><br><span class="line">    <span class="comment">//    - 例如：添加额外的处理器、修改 Channel 配置</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.extensions.isEmpty()) &#123;</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="built_in">this</span>.extensions.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">            <span class="type">ChannelInitializerExtension</span> <span class="variable">extension</span> <span class="operator">=</span> (ChannelInitializerExtension)var4.next();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                extension.postInitializeServerChildChannel(child);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var8) &#123;</span><br><span class="line">                ServerBootstrap.logger.warn(<span class="string">&quot;Exception thrown from postInitializeServerChildChannel&quot;</span>, var8);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 将子 Channel 注册到 workerGroup 的某个 EventLoop：</span></span><br><span class="line">    <span class="comment">//    - 从 workerGroup 中选择一个 EventLoop（线程）</span></span><br><span class="line">    <span class="comment">//    - 注册后，该 EventLoop 将负责处理此连接的所有 IO 操作（读写、编解码等）</span></span><br><span class="line">    <span class="comment">//    - 注册是异步操作，通过 ChannelFuture 监听结果</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.childGroup.register(child).addListener(<span class="keyword">new</span> <span class="title class_">ChannelFutureListener</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operationComplete</span><span class="params">(ChannelFuture future)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="keyword">if</span> (!future.isSuccess()) &#123;</span><br><span class="line">                    <span class="comment">// 注册失败时，强制关闭连接并记录异常</span></span><br><span class="line">                    ServerBootstrap.ServerBootstrapAcceptor.forceClose(child, future.cause());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var7) &#123;</span><br><span class="line">        <span class="comment">// 注册过程中发生异常，立即关闭连接</span></span><br><span class="line">        forceClose(child, var7);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   <strong>3. 将 Channel 注册到 EventLoopGroup 中的某个 EventLoop</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ChannelFuture</span> <span class="variable">regFuture</span> <span class="operator">=</span> <span class="built_in">this</span>.config().group().register(channel);</span><br></pre></td></tr></table></figure><p>是 Netty 服务器启动流程中的核心操作，负责将 <strong>Channel 注册到 EventLoop 的 Selector</strong>，从而建立事件循环机制。这个操作标志着 Channel 开始真正参与网络 IO 处理。</p><p><code>ChannelFuture</code>封装<strong>异步操作结果</strong>：</p><ul><li><strong>立即返回</strong>：调用 <code>register(channel)</code> 后，方法会立即返回一个 <code>ChannelFuture</code>，此时注册操作可能尚未完成。</li><li><strong>异步完成</strong>：Netty 会在后台完成实际的注册操作，完成后通过 <code>ChannelFuture</code> 通知结果。</li></ul><p> <strong><code>config().group()</code></strong></p><ul><li>**<code>config()</code>**：返回 <code>AbstractBootstrapConfig</code>，包含启动配置信息。</li><li>**<code>group()</code>**：返回EventLoopGroup（线程池）：<ul><li>**对于 <code>ServerBootstrap</code>**：<br><code>config().group()</code> 返回 **<code>bossGroup</code>**，负责接受客户端连接。<br>示例：<code>ServerBootstrap.group(bossGroup, workerGroup)</code>。</li><li><strong>对于 <code>Bootstrap</code>（客户端）</strong>：<br><code>config().group()</code> 返回唯一的 <code>EventLoopGroup</code>，负责处理所有连接的 IO。</li></ul></li></ul><p>这个<code>register</code>方法最终会调用<code>AbstractChannel</code>类的register方法（AbstractChannel类是所有具体通道实现类的基类,定义了通道的一些通用属性和方法），返回一个ChannelFuture对象，</p><p>SingleThreadEventLoop.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">register</span><span class="params">(Channel channel)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.register((ChannelPromise)(<span class="keyword">new</span> <span class="title class_">DefaultChannelPromise</span>(channel, <span class="built_in">this</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">register</span><span class="params">(ChannelPromise promise)</span> &#123;</span><br><span class="line">    ObjectUtil.checkNotNull(promise, <span class="string">&quot;promise&quot;</span>);</span><br><span class="line">    promise.channel().unsafe().register(<span class="built_in">this</span>, promise);</span><br><span class="line">    <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AbstractChannel.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 Channel 注册到指定的 EventLoop，建立事件循环机制。</span></span><br><span class="line"><span class="comment"> * 此方法是线程安全的，确保注册操作在 EventLoop 线程中执行。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> eventLoop 目标 EventLoop，负责处理 Channel 的所有 IO 操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> promise 用于异步通知注册结果的 Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(EventLoop eventLoop, <span class="keyword">final</span> ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="comment">// 校验参数：确保 EventLoop 不为空</span></span><br><span class="line">    ObjectUtil.checkNotNull(eventLoop, <span class="string">&quot;eventLoop&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 状态检查：防止重复注册</span></span><br><span class="line">    <span class="keyword">if</span> (AbstractChannel.<span class="built_in">this</span>.isRegistered()) &#123;</span><br><span class="line">        promise.setFailure(<span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Channel 已注册到 EventLoop&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 兼容性检查：确保 EventLoop 类型与 Channel 兼容（如 NioEventLoop 与 NioChannel）</span></span><br><span class="line">    <span class="keyword">if</span> (!AbstractChannel.<span class="built_in">this</span>.isCompatible(eventLoop)) &#123;</span><br><span class="line">        promise.setFailure(<span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">            <span class="string">&quot;不兼容的 EventLoop 类型: &quot;</span> + eventLoop.getClass().getName()));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 绑定 EventLoop：将 Channel 与指定的 EventLoop 永久关联</span></span><br><span class="line">    AbstractChannel.<span class="built_in">this</span>.eventLoop = eventLoop;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 确保注册操作在 EventLoop 线程中执行（关键！）</span></span><br><span class="line">    <span class="keyword">if</span> (eventLoop.inEventLoop()) &#123;</span><br><span class="line">        <span class="comment">// 当前线程已是 EventLoop 线程，直接执行注册</span></span><br><span class="line">        register0(promise);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 当前线程不是 EventLoop 线程，提交任务到 EventLoop 的任务队列</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            eventLoop.execute(() -&gt; register0(promise));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="comment">// 任务提交失败处理</span></span><br><span class="line">            logger.warn(<span class="string">&quot;注册任务被 EventLoop 拒绝，强制关闭 Channel: &#123;&#125;&quot;</span>, </span><br><span class="line">                AbstractChannel.<span class="built_in">this</span>, t);</span><br><span class="line">            closeForcibly();</span><br><span class="line">            AbstractChannel.<span class="built_in">this</span>.closeFuture.setClosed();</span><br><span class="line">            safeSetFailure(promise, t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实际执行 Channel 注册到 Selector 的核心方法。</span></span><br><span class="line"><span class="comment"> * 必须在 EventLoop 线程中调用，确保线程安全。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> promise 用于异步通知注册结果的 Promise 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">register0</span><span class="params">(ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 标记 Promise 为不可取消，并检查 Channel 是否处于打开状态</span></span><br><span class="line">        <span class="keyword">if</span> (!promise.setUncancellable() || !ensureOpen(promise)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 记录是否为首次注册</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">firstRegistration</span> <span class="operator">=</span> neverRegistered;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 执行底层注册操作（如调用 Java NIO 的 SelectableChannel.register()）</span></span><br><span class="line">        AbstractChannel.<span class="built_in">this</span>.doRegister();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. 更新注册状态</span></span><br><span class="line">        neverRegistered = <span class="literal">false</span>;</span><br><span class="line">        registered = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 触发 HandlerAdded 回调（如果有）</span></span><br><span class="line">        <span class="comment">//    确保所有添加到 Pipeline 的 Handler 有机会执行初始化逻辑</span></span><br><span class="line">        pipeline.invokeHandlerAddedIfNeeded();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 6. 标记注册成功</span></span><br><span class="line">        safeSetSuccess(promise);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 7. 触发 ChannelRegistered 事件，通知 Pipeline 中的所有 Handler</span></span><br><span class="line">        pipeline.fireChannelRegistered();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 8. 如果 Channel 已处于活跃状态（如客户端已连接），触发相应事件</span></span><br><span class="line">        <span class="keyword">if</span> (isActive()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (firstRegistration) &#123;</span><br><span class="line">                <span class="comment">// 首次注册且已活跃，触发 ChannelActive 事件</span></span><br><span class="line">                pipeline.fireChannelActive();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (config().isAutoRead()) &#123;</span><br><span class="line">                <span class="comment">// 非首次注册但配置了自动读取，开始读取数据</span></span><br><span class="line">                beginRead();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="comment">// 注册过程中发生异常，强制关闭 Channel</span></span><br><span class="line">        closeForcibly();</span><br><span class="line">        closeFuture.setClosed();</span><br><span class="line">        safeSetFailure(promise, t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="42-根据注册结果处理绑定">4.2 根据注册结果处理绑定</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ChannelPromise</span> <span class="variable">promise</span> <span class="operator">=</span> channel.newPromise();</span><br><span class="line">doBind0(regFuture, channel, localAddress, promise);</span><br><span class="line"><span class="keyword">return</span> promise;</span><br></pre></td></tr></table></figure><p>调用AbstractBootstrap类的doBind0()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 执行 Channel 绑定操作的核心逻辑。</span></span><br><span class="line"><span class="comment"> * 确保在 Channel 注册到 EventLoop 成功后，再异步执行绑定操作。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> regFuture 注册操作的 Future 对象，用于判断注册是否成功</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> channel 待绑定的 Channel</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> localAddress 要绑定的本地地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> promise 绑定操作的 Promise，用于异步通知结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doBind0</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="keyword">final</span> ChannelFuture regFuture,</span></span><br><span class="line"><span class="params">    <span class="keyword">final</span> Channel channel,</span></span><br><span class="line"><span class="params">    <span class="keyword">final</span> SocketAddress localAddress,</span></span><br><span class="line"><span class="params">    <span class="keyword">final</span> ChannelPromise promise)</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在 Channel 关联的 EventLoop 线程中执行绑定操作</span></span><br><span class="line">    channel.eventLoop().execute(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (regFuture.isSuccess()) &#123;</span><br><span class="line">            <span class="comment">// 注册成功，执行绑定操作，并添加失败自动关闭监听器</span></span><br><span class="line">            channel.bind(localAddress, promise).addListener(ChannelFutureListener.CLOSE_ON_FAILURE);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 注册失败，将注册失败原因传递给绑定 Promise</span></span><br><span class="line">            promise.setFailure(regFuture.cause());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>channel.bind会去调用AbstractChannel的pipeline对象，并执行对应的bind方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.pipeline.bind(localAddress, promise);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行DefaultChannelPipeline类的bind方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ChannelFuture <span class="title function_">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.tail.bind(localAddress, promise);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> ChannelFuture <span class="title function_">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.tail.bind(localAddress, promise);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>tail是<code>AbstractChannelHandlerContext</code>对象，会调用<code>AbstractChannelHandlerContext</code>类的<code>bind方法</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 异步绑定 Channel 到指定的本地地址。</span></span><br><span class="line"><span class="comment"> * 通过 ChannelPipeline 触发出站事件，最终由底层传输层执行实际绑定操作。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> localAddress 要绑定的本地地址（如 InetSocketAddress）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> promise 用于异步通知绑定结果的 Promise</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回传入的 promise 对象，支持链式调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> ChannelFuture <span class="title function_">bind</span><span class="params">(<span class="keyword">final</span> SocketAddress localAddress, <span class="keyword">final</span> ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="comment">// 校验参数：确保地址不为空</span></span><br><span class="line">    ObjectUtil.checkNotNull(localAddress, <span class="string">&quot;localAddress&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 验证 Promise 有效性（如未取消、与当前 Channel 关联）</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isNotValidPromise(promise, <span class="literal">false</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> promise; <span class="comment">// 无效 Promise，直接返回</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 查找 Pipeline 中下一个支持 bind 操作的出站处理器上下文</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">AbstractChannelHandlerContext</span> <span class="variable">next</span> <span class="operator">=</span> <span class="built_in">this</span>.findContextOutbound(<span class="number">512</span>); <span class="comment">// 512 = BIND 操作掩码</span></span><br><span class="line">    <span class="type">EventExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> next.executor();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 确保在 EventLoop 线程中执行绑定操作（关键！）</span></span><br><span class="line">    <span class="keyword">if</span> (executor.inEventLoop()) &#123;</span><br><span class="line">        <span class="comment">// 当前线程已是 EventLoop 线程，直接调用</span></span><br><span class="line">        next.invokeBind(localAddress, promise);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 当前线程不是 EventLoop 线程，提交任务到 EventLoop 线程池</span></span><br><span class="line">        safeExecute(executor, () -&gt; next.invokeBind(localAddress, promise), promise, <span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> promise; <span class="comment">// 返回 Promise 供调用者监听结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在当前 HandlerContext 中触发 bind 事件，调用对应处理器的 bind 方法。</span></span><br><span class="line"><span class="comment"> * 此方法会根据处理器类型进行不同的调用逻辑。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> localAddress 要绑定的本地地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> promise 用于异步通知绑定结果的 Promise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">invokeBind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查处理器是否启用（isRemoved() 为 false）</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.invokeHandler()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ChannelHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="built_in">this</span>.handler();</span><br><span class="line">            DefaultChannelPipeline.<span class="type">HeadContext</span> <span class="variable">headContext</span> <span class="operator">=</span> <span class="built_in">this</span>.pipeline.head;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 根据处理器类型选择调用方式</span></span><br><span class="line">            <span class="keyword">if</span> (handler == headContext) &#123;</span><br><span class="line">                <span class="comment">// 头部处理器：直接调用 HeadContext 的 bind 方法（最终触发底层网络绑定）</span></span><br><span class="line">                headContext.bind(<span class="built_in">this</span>, localAddress, promise);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> ChannelDuplexHandler) &#123;</span><br><span class="line">                <span class="comment">// 双向处理器：调用其 bind 方法</span></span><br><span class="line">                ((ChannelDuplexHandler)handler).bind(<span class="built_in">this</span>, localAddress, promise);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> ChannelOutboundHandlerAdapter) &#123;</span><br><span class="line">                <span class="comment">// 出站处理器适配器：调用其 bind 方法（默认实现会传递给下一个处理器）</span></span><br><span class="line">                ((ChannelOutboundHandlerAdapter)handler).bind(<span class="built_in">this</span>, localAddress, promise);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 其他类型的出站处理器：强制转换并调用 bind 方法</span></span><br><span class="line">                ((ChannelOutboundHandler)handler).bind(<span class="built_in">this</span>, localAddress, promise);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="comment">// 处理异常：通知出站处理器链发生异常</span></span><br><span class="line">            notifyOutboundHandlerException(t, promise);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 处理器已移除，将事件传递给下一个处理器</span></span><br><span class="line">        <span class="built_in">this</span>.bind(localAddress, promise);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据handler的类型调用不同的bind方法</p><p><strong>以headContext为例：</strong></p><p>headContext这个bind方法会调用AbstractChannel的bind方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 执行 Channel 到指定本地地址的底层绑定操作。</span></span><br><span class="line"><span class="comment"> * 此方法由 Channel 的 unsafe 接口实现，必须在 EventLoop 线程中调用。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> localAddress 要绑定的本地地址（如 InetSocketAddress）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> promise 用于异步通知绑定结果的 Promise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span> &#123;</span><br><span class="line">    <span class="comment">// 断言当前线程是 Channel 关联的 EventLoop 线程（确保线程安全）</span></span><br><span class="line">    <span class="built_in">this</span>.assertEventLoop();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 标记 Promise 为不可取消，并检查 Channel 是否处于打开状态</span></span><br><span class="line">    <span class="keyword">if</span> (promise.setUncancellable() &amp;&amp; <span class="built_in">this</span>.ensureOpen(promise)) &#123;</span><br><span class="line">        <span class="comment">// 处理广播地址警告（非 root 用户绑定非通配地址可能无法接收广播包）</span></span><br><span class="line">        <span class="keyword">if</span> (Boolean.TRUE.equals(AbstractChannel.<span class="built_in">this</span>.config().getOption(ChannelOption.SO_BROADCAST)) </span><br><span class="line">            &amp;&amp; localAddress <span class="keyword">instanceof</span> InetSocketAddress </span><br><span class="line">            &amp;&amp; !((InetSocketAddress)localAddress).getAddress().isAnyLocalAddress() </span><br><span class="line">            &amp;&amp; !PlatformDependent.isWindows() </span><br><span class="line">            &amp;&amp; !PlatformDependent.maybeSuperUser()) &#123;</span><br><span class="line">            logger.warn(<span class="string">&quot;非 root 用户绑定非通配地址(&#123;&#125;)可能无法接收广播包，但仍按请求继续绑定&quot;</span>, localAddress);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 记录绑定前的 Channel 活跃状态</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">wasActive</span> <span class="operator">=</span> AbstractChannel.<span class="built_in">this</span>.isActive();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 执行实际的底层绑定操作（由子类实现，如 Java NIO 的 ServerSocketChannel.bind()）</span></span><br><span class="line">            AbstractChannel.<span class="built_in">this</span>.doBind(localAddress);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            <span class="comment">// 绑定失败处理：标记 Promise 为失败，并在 Channel 已关闭时执行清理</span></span><br><span class="line">            <span class="built_in">this</span>.safeSetFailure(promise, t);</span><br><span class="line">            <span class="built_in">this</span>.closeIfClosed();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 若绑定后 Channel 变为活跃状态（之前不活跃），触发 ChannelActive 事件</span></span><br><span class="line">        <span class="keyword">if</span> (!wasActive &amp;&amp; AbstractChannel.<span class="built_in">this</span>.isActive()) &#123;</span><br><span class="line">            <span class="comment">// 异步触发事件，避免在关键路径中执行用户代码</span></span><br><span class="line">            <span class="built_in">this</span>.invokeLater(() -&gt; AbstractChannel.<span class="built_in">this</span>.pipeline.fireChannelActive());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 标记 Promise 为成功</span></span><br><span class="line">        <span class="built_in">this</span>.safeSetSuccess(promise);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doBind</span><span class="params">(SocketAddress var1)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure><p>调用<code>ServerSocketChannel</code>的<code>doBind</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressJava6Requirement(</span></span><br><span class="line"><span class="meta">    reason = &quot;Usage guarded by java version check&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doBind</span><span class="params">(SocketAddress localAddress)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (PlatformDependent.javaVersion() &gt;= <span class="number">7</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.javaChannel().bind(localAddress, <span class="built_in">this</span>.config.getBacklog());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.javaChannel().socket().bind(localAddress, <span class="built_in">this</span>.config.getBacklog());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> ServerSocketChannel <span class="title function_">bind</span><span class="params">(SocketAddress local, <span class="type">int</span> backlog)</span></span><br><span class="line">    <span class="keyword">throws</span> IOException;</span><br></pre></td></tr></table></figure><p>上面的<code>bind</code>方法会调用ServerSocketChannelImpl的具体实现方法<code>bind</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 ServerSocketChannel 绑定到指定的本地地址，并设置最大连接队列长度。</span></span><br><span class="line"><span class="comment"> * 此方法是 Java NIO 底层网络操作的核心实现，用于创建 TCP 服务器。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> local 要绑定的本地地址（如 InetSocketAddress），若为 null 则绑定到通配地址（0.0.0.0）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> backlog 最大连接队列长度（等待 accept 的连接数），若小于 1 则使用默认值 50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 绑定后的 ServerSocketChannel 自身，支持链式调用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException 若发生 I/O 错误（如端口已被占用）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ClosedChannelException 若 Channel 已关闭</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> AlreadyBoundException 若 Channel 已绑定</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> ServerSocketChannel <span class="title function_">bind</span><span class="params">(SocketAddress local, <span class="type">int</span> backlog)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 使用内部锁确保操作的线程安全性（同一时间只能有一个线程执行绑定）</span></span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>.lock) &#123;</span><br><span class="line">        <span class="comment">// 校验 Channel 状态：必须处于打开且未绑定状态</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.isOpen()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClosedChannelException</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.isBound()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AlreadyBoundException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理地址参数：若为 null 则绑定到通配地址（0.0.0.0）并随机分配端口</span></span><br><span class="line">        <span class="type">InetSocketAddress</span> <span class="variable">addr</span> <span class="operator">=</span> local == <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">0</span>) : Net.checkAddress(local);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 安全检查：验证当前线程是否有监听指定端口的权限</span></span><br><span class="line">        <span class="comment">// （例如：非 root 用户尝试监听 1-1023 之间的特权端口会被拒绝）</span></span><br><span class="line">        <span class="type">SecurityManager</span> <span class="variable">sm</span> <span class="operator">=</span> System.getSecurityManager();</span><br><span class="line">        <span class="keyword">if</span> (sm != <span class="literal">null</span>) &#123;</span><br><span class="line">            sm.checkListen(addr.getPort());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 平台相关的 TCP 绑定前准备（如设置 TCP 参数、权限检查等）</span></span><br><span class="line">        NetHooks.beforeTcpBind(<span class="built_in">this</span>.fd, addr.getAddress(), addr.getPort());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 执行底层 bind 操作（通过 JNI 调用操作系统的 socket.bind()）</span></span><br><span class="line">            <span class="comment">//    将套接字与指定 IP 地址和端口号关联</span></span><br><span class="line">            Net.bind(<span class="built_in">this</span>.fd, addr.getAddress(), addr.getPort());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 执行底层 listen 操作（通过 JNI 调用操作系统的 socket.listen()）</span></span><br><span class="line">            <span class="comment">//    将套接字转换为监听状态，开始接受客户端连接</span></span><br><span class="line">            <span class="comment">//    backlog 参数指定等待 accept 的最大连接数（TCP 半连接队列长度）</span></span><br><span class="line">            Net.listen(<span class="built_in">this</span>.fd, backlog &lt; <span class="number">1</span> ? <span class="number">50</span> : backlog);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// 绑定失败时尝试关闭文件描述符，避免资源泄漏</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.fd.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException suppressed) &#123;</span><br><span class="line">                e.addSuppressed(suppressed);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新本地地址信息（绑定成功后才能获取实际绑定的地址和端口）</span></span><br><span class="line">        <span class="comment">// 例如：若绑定到 0.0.0.0:0，这里会获取系统分配的实际端口号</span></span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>.stateLock) &#123;</span><br><span class="line">            <span class="built_in">this</span>.localAddress = Net.localAddress(<span class="built_in">this</span>.fd);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2025/04/29/Vue3/"/>
      <url>/2025/04/29/Vue3/</url>
      
        <content type="html"><![CDATA[<h1><span id="vue3未完待续">Vue3（未完待续）</span></h1><h2><span id="vue3项目结构vite-构建工具">vue3项目结构(Vite 构建工具)</span></h2><p><img src="D:/Users/blog/source/images/image-20250429173750357.png" alt="image-20250429173750357"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">my-vue3-project/</span><br><span class="line">├── index.html                 # 入口 HTML 文件（必须位于根目录）</span><br><span class="line">├── package.json               # 项目依赖和脚本配置</span><br><span class="line">├── vite.config.js             # Vite 构建配置</span><br><span class="line">├── tsconfig.json              # TypeScript 配置（可选）</span><br><span class="line">├── .gitignore                 # Git 忽略规则</span><br><span class="line">├── public/                    # 静态资源（不会被构建工具处理）</span><br><span class="line">│   └── favicon.ico            # 网站图标</span><br><span class="line">└── src/                       # 源代码目录</span><br><span class="line">    ├── main.js/ts             # 项目入口文件</span><br><span class="line">    ├── App.vue                # 根组件</span><br><span class="line">    ├── assets/                # 图片、字体等静态资源</span><br><span class="line">    ├── components/            # 可复用的 Vue 组件</span><br><span class="line">    ├── views/                 # 页面级组件（与路由对应）</span><br><span class="line">    ├── router/                # Vue Router 配置</span><br><span class="line">    ├── store/                 # Pinia/Vuex 状态管理</span><br><span class="line">    ├── api/                   # API 请求封装</span><br><span class="line">    ├── utils/                 # 工具函数</span><br><span class="line">    ├── styles/                # 全局样式文件</span><br><span class="line">    └── env.d.ts               # TypeScript 环境声明</span><br></pre></td></tr></table></figure><h2><span id="路由配置">路由配置</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router@4</span><br></pre></td></tr></table></figure><p>src&#x2F;router&#x2F;index.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&quot;@/pages/Home.vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">About</span> <span class="keyword">from</span> <span class="string">&quot;@/pages/About.vue&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">News</span> <span class="keyword">from</span> <span class="string">&quot;@/pages/News.vue&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;</span><br><span class="line">    <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(),</span><br><span class="line">    <span class="attr">routes</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">Home</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">About</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&quot;/news&quot;</span>,</span><br><span class="line">            <span class="attr">component</span>: <span class="title class_">News</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p>src&#x2F;main.ts</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createApp&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>)</span><br><span class="line">app.<span class="title function_">use</span>(router)</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>src&#x2F;App.vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">      &lt;h2 class=&quot;title&quot;&gt;Welcome to Vue 3&lt;/h2&gt;</span><br><span class="line">      </span><br><span class="line">      &lt;nav class=&quot;nav-bar&quot;&gt;</span><br><span class="line">        &lt;RouterLink </span><br><span class="line">          to=&quot;/home&quot; </span><br><span class="line">          class=&quot;nav-link&quot;</span><br><span class="line">          active-class=&quot;active&quot;&gt;</span><br><span class="line">          首页</span><br><span class="line">        &lt;/RouterLink&gt;</span><br><span class="line">        &lt;RouterLink </span><br><span class="line">          to=&quot;/about&quot;</span><br><span class="line">          class=&quot;nav-link&quot;</span><br><span class="line">          active-class=&quot;active&quot;&gt;</span><br><span class="line">          关于</span><br><span class="line">        &lt;/RouterLink&gt;</span><br><span class="line">        &lt;RouterLink </span><br><span class="line">          to=&quot;/news&quot; </span><br><span class="line">          class=&quot;nav-link&quot;</span><br><span class="line">          active-class=&quot;active&quot;&gt;</span><br><span class="line">          新闻</span><br><span class="line">        &lt;/RouterLink&gt;</span><br><span class="line">      &lt;/nav&gt;</span><br><span class="line">  </span><br><span class="line">      &lt;main class=&quot;content-container&quot;&gt;</span><br><span class="line">        &lt;router-view&gt;&lt;/router-view&gt;</span><br><span class="line">      &lt;/main&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;style scoped&gt;</span><br><span class="line">  .app-container &#123;</span><br><span class="line">    max-width: 1200px;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">    padding: 2rem;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .title &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">    font-size: 2.5rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    margin-bottom: 2rem;</span><br><span class="line">    font-family: &#x27;Arial Rounded MT Bold&#x27;, sans-serif;</span><br><span class="line">    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .nav-bar &#123;</span><br><span class="line">    background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);</span><br><span class="line">    padding: 1.2rem 2rem;</span><br><span class="line">    border-radius: 12px;</span><br><span class="line">    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);</span><br><span class="line">    margin-bottom: 2rem;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    gap: 2rem;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .nav-link &#123;</span><br><span class="line">    color: white;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    padding: 0.8rem 1.5rem;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    position: relative;</span><br><span class="line">    font-weight: 500;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .nav-link:hover &#123;</span><br><span class="line">    background: rgba(255, 255, 255, 0.15);</span><br><span class="line">    transform: translateY(-2px);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .nav-link.active &#123;</span><br><span class="line">    background: white;</span><br><span class="line">    color: #6366f1;</span><br><span class="line">    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .nav-link.active::after &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    bottom: -8px;</span><br><span class="line">    left: 50%;</span><br><span class="line">    transform: translateX(-50%);</span><br><span class="line">    width: 60%;</span><br><span class="line">    height: 3px;</span><br><span class="line">    background: #6366f1;</span><br><span class="line">    border-radius: 2px;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  .content-container &#123;</span><br><span class="line">    background: white;</span><br><span class="line">    border-radius: 12px;</span><br><span class="line">    padding: 2rem;</span><br><span class="line">    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);</span><br><span class="line">    min-height: 500px;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  /* 响应式设计 */</span><br><span class="line">  @media (max-width: 768px) &#123;</span><br><span class="line">    .nav-bar &#123;</span><br><span class="line">      flex-direction: column;</span><br><span class="line">      align-items: center;</span><br><span class="line">      gap: 1rem;</span><br><span class="line">      padding: 1rem;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .nav-link &#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">      justify-content: center;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .title &#123;</span><br><span class="line">      font-size: 2rem;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &lt;/style&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript</title>
      <link href="/2025/04/27/JavaScript/"/>
      <url>/2025/04/27/JavaScript/</url>
      
        <content type="html"><![CDATA[<h1><span id="javascript">JavaScript</span></h1><h2><span id="javascript是什么">JavaScript是什么?</span></h2><ul><li><p>JavaScript 是脚本语言</p></li><li><p>JavaScript 是一种轻量级的编程语言。</p></li><li><p>JavaScript 是可插入 HTML 页面的编程代码。</p></li><li><p>JavaScript 插入 HTML 页面后，可由所有的现代浏览器执行。</p></li></ul><h2><span id="怎么定义">怎么定义？</span></h2><p>HTML 中的 Javascript 脚本代码必须位于 <script> 与 </script> 标签之间。</p><p>Javascript 脚本代码可被放置在 HTML 页面的 <body> 和 <head> 部分中。</head></body></p><h2><span id="js显示数据">JS显示数据</span></h2><ul><li>使用 window.alert() 弹出警告框。</li><li>使用 document.write() 方法将内容写到 HTML 文档中。</li><li>使用 innerHTML 写入到 HTML 元素。</li><li>使用 console.log() 写入到浏览器的控制台。</li></ul><h2><span id="js数据格式">JS数据格式</span></h2><p><strong>数字（Number）字面量</strong> 可以是整数或者是小数，或者是科学计数(e)。</p><p><strong>字符串（String）字面量</strong> 可以使用单引号或双引号:</p><p><strong>表达式字面量</strong> 用于计算：5 + 6 5 * 6</p><p><strong>数组（Array）字面量</strong> [40, 100, 1, 5, 25, 10]</p><p><strong>对象（Object）字面量</strong> 定义一个对象：</p><p>{firstName:”John”, lastName:”Doe”, age:50, eyeColor:”blue”}</p><p><strong>函数（Function）字面量</strong> 定义一个函数：</p><p>function myFunction(a, b) { return a * b;}</p><h2><span id="变量声明">变量声明</span></h2><p>在 JavaScript 中，可以使用 var、let 和 const 关键字来声明变量。</p><ul><li><code>var</code>：ES5 引入的变量声明方式，具有函数作用域。</li></ul><blockquote><p>变量可以重复声明（覆盖原变量）。<br>变量未赋值时，默认值为 undefined。<br>var 声明的变量会提升（Hoisting），但不会初始化。</p></blockquote><ul><li><code>let</code>：ES6 引入的变量声明方式，具有块级作用域。</li><li><code>const</code>：ES6 引入的常量声明方式，具有块级作用域，且值不可变。</li></ul><blockquote><p>变量必须以字母开头<br>变量也能以 $ 和 _ 符号开头（不过我们不推荐这么做）<br>变量名称对大小写敏感（y 和 Y 是不同的变量）</p></blockquote><ul><li><p>当您向变量分配文本值时，应该用双引号或单引号包围这个值。</p></li><li><p>当您向变量赋的值是数值时，不要使用引号。如果您用引号包围数值，该值会被作为文本来处理。</p></li></ul><h2><span id="数据类型">数据类型</span></h2><ul><li>**值类型(基本类型)**：字符串（String）、数字(Number)、布尔(Boolean)、空（Null）、未定义（Undefined）、Symbol。</li><li><strong>引用数据类型（对象类型）</strong>：对象(Object)、数组(Array)、函数(Function)，还有两个特殊的对象：正则（RegExp）和日期（Date）</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC</title>
      <link href="/2025/04/26/Spring%20MVC/"/>
      <url>/2025/04/26/Spring%20MVC/</url>
      
        <content type="html"><![CDATA[<h1><span id="spring-mvc">Spring MVC</span></h1><h2><span id="什么是spring-mvc">什么是Spring MVC？</span></h2><p>是Spring框架的一部分，是一个基于Java的Web开发框架，遵循经典的<strong>MVC设计模式</strong>。它通过分离应用程序的输入逻辑、业务逻辑和显示逻辑，帮助开发者构建灵活、可扩展且易于维护的Web应用程序。</p><h3><span id="mvc模式"><strong>MVC模式：</strong></span></h3><blockquote><ul><li><strong>Model（模型）</strong>：负责处理数据和业务逻辑，通常由JavaBean或POJO（Plain Old Java Object）组成，可能涉及服务层（Service）和数据访问层（DAO）。</li><li><strong>View（视图）</strong>：负责展示数据，支持多种视图技术（如JSP、Thymeleaf、FreeMarker等），通过逻辑视图名称与具体模板关联。</li><li><strong>Controller（控制器）</strong>：处理用户请求，协调模型和视图。通过注解（如@Controller）标识，并使用@RequestMapping等注解映射HTTP请求到具体方法。</li></ul></blockquote><h3><span id="核心组件"><strong>核心组件：</strong></span></h3><ul><li><strong>DispatcherServlet：</strong>前端控制器，接收所有请求并分发给对应的处理器（Handler），是Spring MVC的入口。</li><li><strong>HandlerMapping：</strong>根据请求URL找到对应的Controller方法（处理器）。</li><li><strong>HandlerAdapter：</strong>调用处理器方法，并将结果封装为ModelAndView对象（模型数据+视图名称）。</li><li><strong>ViewResolver：</strong>解析逻辑视图名称为具体的视图对象（如JSP页面），并渲染模型数据。</li></ul><p><img src="/../images/image-20250425171953991.png" alt="image-20250425171953991"></p><h3><span id="webxml">web.xml:</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.注册DispatcherServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--关联一个springmvc的配置文件:【servlet-name】-servlet.xml--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--启动级别-1--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--/ 匹配所有的请求；（不包括.jsp）--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--/* 匹配所有的请求；（包括.jsp）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/WEB-INF/jsp/welcome.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 对请求进行过滤，防止乱码   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="springmvc-servletxml">springmvc-servlet.xml:</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 处理器映射器   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理器适配器   --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;bean class=&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 替换原来的处理器适配器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 启用组件扫描（扫描Service、DAO等包） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itcast.controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 启用注解驱动（支持@RestController、@RequestBody等） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置静态资源处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/resources/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/resources/&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--视图解析器:DispatcherServlet给他的ModelAndView--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--前缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--后缀--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2><span id="使用spring-mvc框架的流程">使用Spring MVC框架的流程：</span></h2><h4><span id="1用户发送http请求到dispatcherservlet">1.用户发送HTTP请求到DispatcherServlet。</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.注册DispatcherServlet--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--关联一个springmvc的配置文件:【servlet-name】-servlet.xml--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-servlet.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--启动级别-1--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--/ 匹配所有的请求；（不包括.jsp）--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--/* 匹配所有的请求；（包括.jsp）--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="2dispatcherservlet通过handlermapping找到对应的controller方法处理器">2.DispatcherServlet通过HandlerMapping找到对应的Controller方法（处理器）。</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 处理器映射器   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据bean名称确定处理器的URL路径列表。</span></span><br><span class="line"><span class="comment"> * 该方法主要用于将bean名称映射到一个或多个URL路径，从而实现请求到正确处理器的路由功能。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> beanName bean的名称，可能是以&quot;/&quot;开头的路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 包含所有对应处理器URL路径的字符串数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> String[] determineUrlsForHandler(String beanName) &#123;</span><br><span class="line">    <span class="comment">// 初始化用于存储URL路径的集合</span></span><br><span class="line">    List&lt;String&gt; urls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果bean名称以&quot;/&quot;开头，则直接将其作为URL路径添加</span></span><br><span class="line">    <span class="keyword">if</span> (beanName.startsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">        urls.add(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取bean名称的所有别名，这些别名也可能表示额外的URL路径</span></span><br><span class="line">    String[] aliases = obtainApplicationContext().getAliases(beanName);</span><br><span class="line">    <span class="keyword">for</span> (String alias : aliases) &#123;</span><br><span class="line">        <span class="comment">// 如果别名以&quot;/&quot;开头，则将其作为URL路径添加</span></span><br><span class="line">        <span class="keyword">if</span> (alias.startsWith(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">            urls.add(alias);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将URL路径集合转换为数组并返回</span></span><br><span class="line">    <span class="keyword">return</span> StringUtils.toStringArray(urls);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="3handleradapter调用处理器方法处理业务逻辑并返回modelandview">3.HandlerAdapter调用处理器方法，处理业务逻辑并返回ModelAndView。</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 处理器适配器   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单的控制器处理器适配器类，实现了HandlerAdapter接口</span></span><br><span class="line"><span class="comment"> * 该适配器用于处理符合Controller接口的处理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleControllerHandlerAdapter</span> <span class="keyword">implements</span> <span class="title class_">HandlerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查当前适配器是否支持给定的处理器</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler 需要检查的处理器对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果处理器是Controller的实例，则返回true，否则返回false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (handler <span class="keyword">instanceof</span> Controller);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理HTTP请求，并返回ModelAndView对象</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request HTTP请求对象，包含请求数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response HTTP响应对象，用于生成响应</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler 处理请求的控制器对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ModelAndView对象，包含模型数据和视图信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 如果处理请求时发生错误，则抛出异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class="line">            <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 调用Controller类型处理器的handleRequest方法处理请求,返回ModelAndView</span></span><br><span class="line">        <span class="keyword">return</span> ((Controller) handler).handleRequest(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取处理器的最后修改时间</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request HTTP请求对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler 处理请求的处理器对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果处理器实现了LastModified接口，则返回最后修改时间，否则返回-1L</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getLastModified</span><span class="params">(HttpServletRequest request, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">// 检查处理器是否实现了LastModified接口</span></span><br><span class="line">        <span class="keyword">if</span> (handler <span class="keyword">instanceof</span> LastModified) &#123;</span><br><span class="line">            <span class="comment">// 调用处理器的getLastModified方法获取最后修改时间</span></span><br><span class="line">            <span class="keyword">return</span> ((LastModified) handler).getLastModified(request);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果处理器未实现LastModified接口，则返回-1L</span></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4><span id="4viewresolver根据视图名称解析具体的视图资源如jsp页面">4.ViewResolver根据视图名称解析具体的视图资源（如JSP页面）。</span></h4><h4><span id="5视图渲染模型数据生成html等响应内容返回给用户">5.视图渲染模型数据，生成HTML等响应内容返回给用户。</span></h4><h2><span id="ssm整合登录案例">SSM整合(登录案例)</span></h2><h3><span id="项目结构">项目结构</span></h3><p><img src="/./../images/image-20250426124437784.png" alt="image-20250426124437784"></p><h3><span id="1配置文件">1.配置文件</span></h3><p><img src="/./../images/image-20250426125442865.png" alt="image-20250426125442865"></p><h4><span id="11-pomxml">1.1 pom.xml:</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>ssm<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>5.9.2<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Junit--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 根据实际需求选择版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 基础依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 根据需要选择版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Servlet - JSP --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Spring--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="12-webxml">1.2 web.xml:</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--DispatcherServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--encodingFilter--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span></span><br><span class="line">            org.springframework.web.filter.CharacterEncodingFilter</span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Session过期时间--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>15<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/WEB-INF/jsp/login.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="13-applicationcontextxml总配置">1.3 applicationContext.xml(总配置):</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-dao.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-bean.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-mvc.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="14-spring-daoxmlspring和mybatis整合">1.4 spring-dao.xml(Spring和MyBatis整合):</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置整合mybatis --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.关联数据库文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:database.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 2.数据库连接池 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库连接池  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxWait&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6000&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeBetweenEvictionRunsMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6000&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3.配置SqlSessionFactory对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入数据库连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置MyBaties全局配置文件:mybatis-config.xml --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 4.配置扫描Dao接口包，动态实现Dao接口注入到spring容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入sqlSessionFactory --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 给出需要扫描Dao接口包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.itcast.dao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>mybatis-config.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.itcast.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/itcast/dao/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>database.properties:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure><h4><span id="15-spring-mvcxmlspring和springmvc整合">1.5 spring-mvc.xml(Spring和SpringMVC整合):</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">    https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.开启SpringMVC注解驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 2.静态资源默认servlet配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 3.配置jsp 显示ViewResolver视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment">&lt;!-- 4.扫描web相关的bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itcast.controller&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="16-spring-beanxmlspring配置bean">1.6 spring-bean.xml(Spring配置bean)</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 扫描service相关的bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.itcast.service&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--UserServiceImpl注入到IOC容器中--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;UserServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itcast.service.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 注入数据库连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="17-user表">1.7 user表：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    id       <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span></span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    username <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">null</span>,</span><br><span class="line">    password <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3><span id="2编写pojo实体类层">2.编写pojo实体类层：</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="3编写dao层">3.编写Dao层</span></h3><p>数据库交互层</p><p>UserMapper.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itcast.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    User <span class="title function_">getUserByName</span><span class="params">(String name)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line">    User <span class="title function_">login</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserMapper.xml:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itcast.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itcast.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itcast.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where username = #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itcast.pojo.User&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itcast.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where username = #&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.itcast.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        insert into user values (#&#123;id&#125;,#&#123;username&#125;,#&#123;password&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3><span id="4编写service层">4.编写Service层：</span></h3><p>UserService.interface</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itcast.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(Integer id)</span>;</span><br><span class="line">    User <span class="title function_">getUserByName</span><span class="params">(String name)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line">    String <span class="title function_">login</span><span class="params">(Model model, User user)</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">register</span><span class="params">(Model model, String username, String password, String confirm)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceImpl.class:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itcast.dao.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.itcast.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserMapper</span><span class="params">(UserMapper userMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(Model model, User user)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> userMapper.login(user);</span><br><span class="line">        <span class="keyword">if</span> (user1 != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> confirm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">(Model model, String username, String password, String confirm)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (password.equals(confirm))&#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getUserByName(username);</span><br><span class="line">            <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">User</span> <span class="variable">register</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(username, password);</span><br><span class="line">                <span class="type">UUID</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID();</span><br><span class="line">                register.setId(uuid.toString());</span><br><span class="line">                userMapper.addUser(register);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;该用户已经注册&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;两次密码不一致&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="6编写controller层">6.编写Controller层：</span></h3><p>UserController.class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itcast.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.itcast.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(Model model, String username, String password)</span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;username&quot;</span>,username);</span><br><span class="line">        <span class="keyword">return</span> userService.login(model, <span class="keyword">new</span> <span class="title class_">User</span>(username,password));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">(Model model, String username, String password, String confirm)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.register(model, username, password, confirm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/register_forward&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">forwardRegisterPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;register&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="7web层界面">7.Web层界面</span></h3><p>login.jsp:</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            font-family: Arial, sans-serif;</span><br><span class="line">            background-color: #f4f4f9;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            height: 100vh;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        form &#123;</span><br><span class="line">            background-color: #fff;</span><br><span class="line">            padding: 20px;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">            box-shadow: <span class="number">0</span> <span class="number">0</span> 10px <span class="title function_">rgba</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;text&quot;</span>], input[type=<span class="string">&quot;password&quot;</span>] &#123;</span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">            padding: 10px;</span><br><span class="line">            margin: 10px <span class="number">0</span>;</span><br><span class="line">            border: 1px solid #ccc;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>] &#123;</span><br><span class="line">            background-color: #007bff;</span><br><span class="line">            color: white;</span><br><span class="line">            padding: 10px 15px;</span><br><span class="line">            border: none;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>]:hover &#123;</span><br><span class="line">            background-color: #0056b3;</span><br><span class="line">        &#125;</span><br><span class="line">        a &#123;</span><br><span class="line">            display: block;</span><br><span class="line">            text-align: center;</span><br><span class="line">            margin-top: 10px;</span><br><span class="line">            color: #007bff;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">        &#125;</span><br><span class="line">        a:hover &#123;</span><br><span class="line">            text-decoration: underline;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;username&quot;</span>&gt;用户名：&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> required&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;password&quot;</span>&gt;密码：&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;password&quot;</span> id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> required&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>&gt;</span><br><span class="line">    &lt;button onclick=<span class="string">&quot;window.location.href=&#x27;/register_forward&#x27;&quot;</span>&gt;注册&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="/./../images/image-20250426124507092.png" alt="image-20250426124507092"></p><p>register.jsp:</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            font-family: Arial, sans-serif;</span><br><span class="line">            background-color: #f4f4f9;</span><br><span class="line">            display: flex;</span><br><span class="line">            justify-content: center;</span><br><span class="line">            align-items: center;</span><br><span class="line">            height: 100vh;</span><br><span class="line">            margin: <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        form &#123;</span><br><span class="line">            background-color: #fff;</span><br><span class="line">            padding: 20px;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">            box-shadow: <span class="number">0</span> <span class="number">0</span> 10px <span class="title function_">rgba</span><span class="params">(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>)</span>;</span><br><span class="line">            width: 300px;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;text&quot;</span>], input[type=<span class="string">&quot;email&quot;</span>], input[type=<span class="string">&quot;password&quot;</span>], input[type=<span class="string">&quot;confirm&quot;</span>] &#123;</span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">            padding: 10px;</span><br><span class="line">            margin: 10px <span class="number">0</span>;</span><br><span class="line">            border: 1px solid #ccc;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>] &#123;</span><br><span class="line">            background-color: #28a745;</span><br><span class="line">            color: white;</span><br><span class="line">            padding: 10px 15px;</span><br><span class="line">            border: none;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">            cursor: pointer;</span><br><span class="line">            width: <span class="number">100</span>%;</span><br><span class="line">        &#125;</span><br><span class="line">        input[type=<span class="string">&quot;submit&quot;</span>]:hover &#123;</span><br><span class="line">            background-color: #<span class="number">218838</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        label &#123;</span><br><span class="line">            display: block;</span><br><span class="line">            margin-bottom: 5px;</span><br><span class="line">            font-weight: bold;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/register&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;username&quot;</span>&gt;用户名：&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> id=<span class="string">&quot;username&quot;</span> name=<span class="string">&quot;username&quot;</span> required&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;password&quot;</span>&gt;密码：&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;password&quot;</span> id=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span> required&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;label <span class="keyword">for</span>=<span class="string">&quot;confirm&quot;</span>&gt;确认密码：&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;confirm&quot;</span> id=<span class="string">&quot;confirm&quot;</span> name=<span class="string">&quot;confirm&quot;</span> required&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;注册&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="/./../images/image-20250426124521462.png" alt="image-20250426124521462"></p><p>fail.jsp:</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Error&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">   $&#123;msg&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>success.jsp:</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Success&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    登录成功，$&#123;username&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h2><span id="ajax">Ajax</span></h2>]]></content>
      
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2025/04/24/WebSocket/"/>
      <url>/2025/04/24/WebSocket/</url>
      
        <content type="html"><![CDATA[<h2><span id="websocketing">WebSocket（ing）</span></h2><h2><span id="websocket协议">WebSocket协议</span></h2><blockquote><p><strong>WebSocket</strong> （握手+ 数据传输）是一种网络通信协议，是HTML5 开始提供的一种在单个TCP连接上进行<strong>全双工通讯</strong>的协议。</p></blockquote><h2><span id="http协议">Http协议</span></h2><blockquote><ul><li>HTTP 协议是一种无状态的、无连接的、单向的应用层协议。它采用请求&#x2F;响应模型。通信请求只能由客户端发起，服务端对请求做出应答处理。</li><li>HTTP协议<strong>无法实现服务器主动向客户端发起消息</strong>。</li></ul></blockquote><p><img src="D:/Users/blog/source/images/e9d04aff4ce28cff02cc86bb76e48271-1745495848665-1.png" alt="img"></p><p>图源：<a href="https://i-blog.csdnimg.cn/blog_migrate/e9d04aff4ce28cff02cc86bb76e48271.png">https://i-blog.csdnimg.cn/blog_migrate/e9d04aff4ce28cff02cc86bb76e48271.png</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Servlet小结</title>
      <link href="/2025/04/24/Servlet%E5%B0%8F%E7%BB%93/"/>
      <url>/2025/04/24/Servlet%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1><span id="servlet小结">Servlet小结</span></h1><p>视频链接：<a href="https://www.bilibili.com/video/BV1CM411a7s1/?p=31&spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=e34fd69a904ae2667b5c5e7a85ba95c9">黑马servlet视频全套视频教程，快速入门servlet原理+servlet实战</a></p><h2><span id="什么是servlet">什么是Servlet？</span></h2><blockquote><p>菜鸟教程：<a href="https://www.runoob.com/servlet/servlet-intro.html">Java Servlet</a></p><p>servlet： server applet</p><p><strong>Servlet</strong>是一个运行在Web服务器（如Tomcat、Jetty）或应用服务器（如WebLogic、WildFly）中的<strong>Java类</strong>，用于扩展服务器功能，通过请求-响应模型与客户端交互（如浏览器）。</p><ul><li>它实现了javax.servlet.Servlet接口或继承HttpServlet类，处理HTTP请求（GET、POST等）并生成动态响应（HTML、JSON、图片等）。</li><li>与JSP（JavaServer Pages）结合使用时，Servlet负责业务逻辑处理，JSP负责页面渲染。</li></ul></blockquote><p>Servlet其实就是一个接口，它定义了Java类被浏览器访问到（tomcat识别到）的规则，只要实现了这个接口的Java类就是一个Servlet</p><h2><span id="快速入门">快速入门</span></h2><h3><span id="1创建项目">1.创建项目</span></h3><p><img src="/../images/image-20250424201132171.png" alt="image-20250424201132171"></p><h3><span id="2编写servlet类">2.编写Servlet类</span></h3><h4><span id="21-实现servlet接口">2.1 实现Servlet接口</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo1</span> <span class="keyword">implements</span> <span class="title class_">Servlet</span></span><br></pre></td></tr></table></figure><h4><span id="22-继承httpservlet类">2.2 继承HttpServlet类</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletDemo2</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> </span><br></pre></td></tr></table></figure><p>其实这个底层也是实现Servlet接口</p><p><img src="/../images/image-20250424202329959-1745497525660-3.png" alt="image-20250424202329959"></p><h3><span id="3实现servlet或重写httpservlet里面的方法">3.实现Servlet或重写HttpServlet里面的方法</span></h3><p>servlet里面最重要的方法：service方法</p><p>HttpServlet里面最重要的方法: doGet doPost</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Servlet</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(ServletConfig var1)</span> <span class="keyword">throws</span> ServletException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得配置</span></span><br><span class="line">    ServletConfig <span class="title function_">getServletConfig</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提供服务</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest var1, ServletResponse var2)</span> <span class="keyword">throws</span> ServletException, IOException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得信息</span></span><br><span class="line">    String <span class="title function_">getServletInfo</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 销毁前执行</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250424203430895.png" alt="image-20250424203430895"></p><h3><span id="4配置servlet">4.配置Servlet</span></h3><h4><span id="41-基于webxml配置">4.1 基于web.xml配置</span></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet的名字<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet的全类名<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet的名字<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>servlet的请求路径<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>eg：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;https://jakarta.ee/xml/ns/jakartaee https://jakarta.ee/xml/ns/jakartaee/web-app_5_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;5.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置ServletDemo1   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.itcast.servlet.ServletDemo1<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置ServletDemo2   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.itcast.servlet.ServletDemo2<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet2<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet2<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h4><span id="42-基于webservlet注解配置">4.2 基于@WebServlet注解配置</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/servlet1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Servlet1</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;servlet1 doGet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;servlet1 doPost&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@WebServlet</code>注解会自动把当前类注册为Servlet并且请求路径为<code>/servlet1</code> 相当于</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置ServletDemo1   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.itcast.servlet.ServletDemo1<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>servlet1<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet1<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2><span id="执行流程">执行流程</span></h2><h4><span id="1客户端请求">1.客户端请求</span></h4><p>​浏览器输入URL <a href="http://localhost:8080/servlet1%EF%BC%8C%E5%8F%91%E9%80%81HTTP%E8%AF%B7%E6%B1%82%E3%80%82">http://localhost:8080/servlet1，发送HTTP请求。</a></p><h4><span id="2tomcat接收请求">2.Tomcat接收请求</span></h4><p>​Connector组件（如 Coyote）监听端口 8080，接收请求。<br>​解析请求：提取URL路径 &#x2F;servlet1，并封装为HttpServletRequest对象。</p><h4><span id="3url到servlet的映射">3.URL到Servlet的映射</span></h4><p>​Tomcat在启动时已加载所有Servlet配置（包括web.xml和@WebServlet注解），<strong>建立URL到Servlet类的映射表</strong>。<br>​<strong>匹配路径</strong>：Tomcat检查请求的URL <code>/servlet1</code>是否与已注册的Servlet路径匹配。<br>​如果匹配，找到对应的Servlet类（如 ServletDemo1）。</p><h4><span id="4servlet类加载与实例化单次行为">4.Servlet类加载与实例化（单次行为）</span></h4><p>​<strong>4.1 类加载：</strong><br>​Tomcat使用Web应用类加载器加载Servlet类的字节码（如 ServletDemo1.class）。<br>​类路径通常为 WEB-INF&#x2F;classes 或 WEB-INF&#x2F;lib 中的JAR包。<br>​<strong>4.2 实例化：</strong><br>​Tomcat通过反射机制创建Servlet类的实例（ServletDemo1 instance &#x3D; new ServletDemo1()）。<br>​<strong>4.3 初始化：</strong><br>​调用Servlet的init()方法，完成初始化（如加载配置、数据库连接等）。</p><h4><span id="5处理请求">5.处理请求</span></h4><p>​调用service()方法：<br>​Tomcat根据请求方法（如GET&#x2F;POST），调用Servlet的service()方法。<br>​service()方法会进一步分发到doGet()或doPost()等具体方法。</p><h4><span id="6响应客户端">6.响应客户端</span></h4><p>​构建响应：Servlet通过HttpServletResponse对象生成响应内容（如HTML、JSON等）。<br>​返回结果：Tomcat通过Connector将响应结果返回给浏览器。</p><h2><span id="http协议">Http协议</span></h2><h3><span id="特点">特点</span></h3><blockquote><ol><li><strong>无状态（Stateless）</strong><br>定义：协议本身不保存请求与响应之间的通信状态，每次请求都是独立的。<br>意义：简化了服务器的实现，提高了可扩展性，但需要客户端在每次请求中携带必要的状态信息（如通过Cookie、Session等）。</li><li><strong>无连接（Connectionless）</strong><br>定义：客户端与服务器在每次请求完成后断开连接（HTTP&#x2F;1.0默认），但HTTP&#x2F;1.1引入了持久连接（Keep-Alive）。<br>早期版本：HTTP&#x2F;0.9和HTTP&#x2F;1.0每次请求均建立新连接，效率低；HTTP&#x2F;1.1通过持久连接复用TCP连接，减少开销。</li><li><strong>面向对象（Object-Oriented）</strong><br>定义：通过统一资源标识符（URI）定位互联网上的资源（如HTML、图片、视频等），支持对资源的增删改查操作。<br>方法：GET（获取资源）、POST（提交数据）、PUT（更新资源）、DELETE（删除资源）等。</li><li><strong>短连接（Short-lived）</strong><br>早期行为：HTTP&#x2F;0.9和1.0采用短连接，请求完成后立即断开，导致频繁的TCP握手开销。<br>改进：HTTP&#x2F;1.1引入持久连接（Keep-Alive），允许复用TCP连接，提升性能。</li><li><strong>可缓存（Cachable）</strong><br>机制：通过Cache-Control、ETag、Last-Modified等头部字段，客户端或代理服务器可缓存响应内容，减少重复请求。<br>优势：降低服务器负载，加快响应速度。</li><li><strong>灵活扩展</strong><br>头部信息：通过请求头和响应头（如Content-Type、User-Agent）传递元数据，支持功能扩展。<br>方法扩展：HTTP&#x2F;1.1新增PUT、DELETE等方法，HTTP&#x2F;2支持服务器推送（Server Push）。</li></ol></blockquote><h3><span id="请求消息">请求消息</span></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /login HTTP/1.1</span><br><span class="line">Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br, zstd</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 27</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Cookie: JSESSIONID=ED583FB162E9D2E951D951B649C4DEBA</span><br><span class="line">Host: localhost:8080</span><br><span class="line">Origin: http://localhost:8080</span><br><span class="line">Referer: http://localhost:8080/</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br><span class="line">sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;135&quot;, &quot;Not-A.Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;135&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line"></span><br><span class="line">username=admin&amp;password=123</span><br></pre></td></tr></table></figure><h4><span id="1请求行">1.请求行</span></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /login HTTP/<span class="number">1.1</span></span><br></pre></td></tr></table></figure><ul><li>方法（Method）：POST（向服务器提交数据，通常用于表单提交）。</li><li>路径（URI）：<code>/login</code>（请求的目标资源路径）。</li><li>协议版本（Protocol）：HTTP&#x2F;1.1（使用的HTTP协议版本）。</li></ul><h4><span id="2请求头">2.请求头</span></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Accept<span class="punctuation">:</span> text/html<span class="punctuation">,</span>application/xhtml+xml<span class="punctuation">,</span>application/xml;q=<span class="number">0.9</span><span class="punctuation">,</span>image/avif<span class="punctuation">,</span>image/webp<span class="punctuation">,</span>image/apng<span class="punctuation">,</span>*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate, br, zstd</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="comment">Cache-Control: max-age=0</span></span><br><span class="line"><span class="comment">Connection: keep-alive</span></span><br><span class="line"><span class="comment">Content-Length: 27</span></span><br><span class="line"><span class="comment">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment">Cookie: JSESSIONID=ED583FB162E9D2E951D951B649C4DEBA</span></span><br><span class="line"><span class="comment">Host: localhost:8080</span></span><br><span class="line"><span class="comment">Origin: http://localhost:8080</span></span><br><span class="line"><span class="comment">Referer: http://localhost:8080/</span></span><br><span class="line"><span class="comment">Sec-Fetch-Dest: document</span></span><br><span class="line"><span class="comment">Sec-Fetch-Mode: navigate</span></span><br><span class="line"><span class="comment">Sec-Fetch-Site: same-origin</span></span><br><span class="line"><span class="comment">Sec-Fetch-User: ?1</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="comment">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span></span><br><span class="line"><span class="comment">sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;135&quot;, &quot;Not-A.Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;135&quot;</span></span><br><span class="line"><span class="comment">sec-ch-ua-mobile: ?0</span></span><br><span class="line"><span class="comment">sec-ch-ua-platform: &quot;Windows&quot;</span></span><br></pre></td></tr></table></figure><p><strong>1.User-Agent: 浏览器的版本信息</strong></p><p><code>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</code> </p><p><strong>2.Refer: 告诉服务器，请求来源页面</strong></p><p><code>Referer: http://localhost:8080/</code></p><p><strong>3.Cookie：客户端携带的Cookie</strong></p><p><code>Cookie: JSESSIONID=ED583FB162E9D2E951D951B649C4DEBA</code></p><p><strong>4.Origin：请求的来源域</strong></p><p><code>Origin: http://localhost:8080</code></p><p><strong>5.Accept：浏览器可接受的响应内容</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept<span class="punctuation">:</span> text/html<span class="punctuation">,</span>application/xhtml+xml<span class="punctuation">,</span>application/xml;q=<span class="number">0.9</span><span class="punctuation">,</span>image/avif<span class="punctuation">,</span>image/webp<span class="punctuation">,</span>image/apng<span class="punctuation">,</span>*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span></span><br></pre></td></tr></table></figure><h4><span id="3请求空行">3.请求空行</span></h4><p>请求头结束后必须有一个空行（即两个换行符 \r\n\r\n），表示请求头结束，请求体开始。</p><h4><span id="4请求体">4.请求体</span></h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admin&amp;password=<span class="number">123</span></span><br></pre></td></tr></table></figure><h3><span id="servletrequest-接口">ServletRequest 接口</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ServletRequest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取请求中指定名称的属性值。</span></span><br><span class="line">    Object <span class="title function_">getAttribute</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回请求中所有属性名称的枚举</span></span><br><span class="line">    Enumeration&lt;String&gt; <span class="title function_">getAttributeNames</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取请求的字符编码</span></span><br><span class="line">    String <span class="title function_">getCharacterEncoding</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置请求的字符编码（需确保编码有效，否则抛出异常）。</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCharacterEncoding</span><span class="params">(String var1)</span> <span class="keyword">throws</span> UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取请求体的长度（字节），若未知返回 -1</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getContentLength</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 以 long 类型返回请求体长度，避免 int 溢出</span></span><br><span class="line">    <span class="type">long</span> <span class="title function_">getContentLengthLong</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取请求体的 MIME 类型</span></span><br><span class="line">    String <span class="title function_">getContentType</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取请求体的二进制输入流（用于读取二进制数据）。</span></span><br><span class="line">    ServletInputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取指定名称的请求参数的第一个值（若参数有多个值）</span></span><br><span class="line">    String <span class="title function_">getParameter</span><span class="params">(String var1)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 返回所有请求参数名称的枚举</span></span><br><span class="line">    Enumeration&lt;String&gt; <span class="title function_">getParameterNames</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取指定名称的请求参数的所有值（如多选框）</span></span><br><span class="line">    String[] getParameterValues(String var1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回所有请求参数的映射(键为参数名，值为参数值数组）</span></span><br><span class="line">    Map&lt;String, String[]&gt; getParameterMap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取请求使用的协议及版本（如 HTTP/1.1）</span></span><br><span class="line">    String <span class="title function_">getProtocol</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取请求的协议名称（如 http、https）</span></span><br><span class="line">    String <span class="title function_">getScheme</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取服务器的主机名(如 localhost)</span></span><br><span class="line">    String <span class="title function_">getServerName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取服务器的端口号（如 8080）</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getServerPort</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取请求体的字符流（用于文本数据，如表单提交）。</span></span><br><span class="line">    BufferedReader <span class="title function_">getReader</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取客户端的IP地址。</span></span><br><span class="line">    String <span class="title function_">getRemoteAddr</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取客户端的端口号（如浏览器使用的临时端口）。</span></span><br><span class="line">    String <span class="title function_">getRemoteHost</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置请求属性，名称为 name，值为 value。</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setAttribute</span><span class="params">(String var1, Object var2)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除指定名称的请求属性。</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeAttribute</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取客户端支持的所有语言环境。</span></span><br><span class="line">    Locale <span class="title function_">getLocale</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取客户端支持的所有语言环境。</span></span><br><span class="line">    Enumeration&lt;Locale&gt; <span class="title function_">getLocales</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断请求是否通过安全通道（HTTPS）传输。</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isSecure</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 获取用于请求转发或包含的 RequestDispatcher 对象。</span></span><br><span class="line">    RequestDispatcher <span class="title function_">getRequestDispatcher</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="servletresponse-接口">ServletResponse 接口</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ServletResponse</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取响应的字符编码（如 UTF-8）</span></span><br><span class="line">    String <span class="title function_">getCharacterEncoding</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取响应的 MIME 类型（如 text/html）</span></span><br><span class="line">    String <span class="title function_">getContentType</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取二进制输出流（用于发送二进制数据，如图片）</span></span><br><span class="line">    ServletOutputStream <span class="title function_">getOutputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字符输出流（用于发送文本数据，如 HTML）</span></span><br><span class="line">    PrintWriter <span class="title function_">getWriter</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置响应的字符编码（如 UTF-8）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setCharacterEncoding</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置响应体的长度（字节，使用 int 类型）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setContentLength</span><span class="params">(<span class="type">int</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置响应体的长度（字节，使用 long 类型，避免溢出）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setContentLengthLong</span><span class="params">(<span class="type">long</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置响应的 MIME 类型（如 text/html）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setContentType</span><span class="params">(String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置响应缓冲区的大小（单位：字节）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBufferSize</span><span class="params">(<span class="type">int</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前缓冲区的大小（单位：字节）</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getBufferSize</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 强制刷新缓冲区，将数据立即发送到客户端</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">flushBuffer</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重置缓冲区内容，但保留已提交的响应状态</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">resetBuffer</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断响应是否已提交（即已发送到客户端）</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isCommitted</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重置响应，清除缓冲区内容和状态（仅在未提交时有效）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reset</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置响应的区域设置（如 Locale.CHINA）</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setLocale</span><span class="params">(Locale var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前响应的区域设置</span></span><br><span class="line">    Locale <span class="title function_">getLocale</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3><span id="httprequest-的核心方法">HttpRequest 的核心方法</span></h3><h4><span id="1-请求参数获取"><strong>1. 请求参数获取</strong></span></h4><ul><li><p><strong><code>getParameter(String name)</code></strong><br>获取指定名称的请求参数的<strong>第一个值</strong>（如表单提交或 URL 参数）。<br><strong>示例</strong>：<code>String username = request.getParameter(&quot;username&quot;);</code></p></li><li><p><strong><code>getParameterValues(String name)</code></strong><br>获取指定名称的请求参数的<strong>所有值</strong>（如多选框的多个值）。<br><strong>示例</strong>：<code>String[] hobbies = request.getParameterValues(&quot;hobby&quot;);</code></p></li><li><p><strong><code>getParameterMap()</code></strong><br>返回所有请求参数的 <code>Map</code>（键为参数名，值为参数值数组）。<br><strong>示例</strong>：<code>Map&lt;String, String[]&gt; paramMap = request.getParameterMap();</code></p></li></ul><h4><span id="2-请求头与元数据"><strong>2. 请求头与元数据</strong></span></h4><ul><li><p><strong><code>getMethod()</code></strong><br>获取请求方法（如 <code>GET</code>、<code>POST</code>）。<br><strong>示例</strong>：<code>String method = request.getMethod();</code></p></li><li><p><strong><code>getHeader(String name)</code></strong><br>获取指定名称的请求头值（如 <code>User-Agent</code>、<code>Content-Type</code>）。<br><strong>示例</strong>：<code>String userAgent = request.getHeader(&quot;User-Agent&quot;);</code></p></li><li><p><strong><code>getHeaders(String name)</code></strong><br>获取指定名称的所有请求头值（若存在多个值）。<br><strong>示例</strong>：<code>Enumeration&lt;String&gt; acceptTypes = request.getHeaders(&quot;Accept&quot;);</code></p></li></ul><h4><span id="3-请求路径与来源"><strong>3. 请求路径与来源</strong></span></h4><ul><li><p><strong><code>getRequestURI()</code></strong><br>获取请求的资源路径（不包含主机名和端口）。<br><strong>示例</strong>：<code>/api/user</code>（返回路径部分）。</p></li><li><p><strong><code>getRequestURL()</code></strong><br>获取完整的请求 URL（包含协议、主机和端口）。<br><strong>示例</strong>：<code>http://localhost:8080/api/user</code>。</p></li><li><p><strong><code>getRemoteAddr()</code></strong><br>获取客户端的 IP 地址。<br><strong>示例</strong>：<code>String clientIP = request.getRemoteAddr();</code></p></li></ul><h4><span id="4-会话与-cookie"><strong>4. 会话与 Cookie</strong></span></h4><ul><li><p><strong><code>getSession()</code></strong><br>获取与当前请求关联的 <code>HttpSession</code> 对象（若不存在则新建）。<br><strong>示例</strong>：<code>HttpSession session = request.getSession();</code></p></li><li><p><strong><code>getCookies()</code></strong><br>获取客户端发送的 Cookie 集合。<br><strong>示例</strong>：<code>Cookie[] cookies = request.getCookies();</code></p></li></ul><h4><span id="5-其他重要方法"><strong>5. 其他重要方法</strong></span></h4><ul><li><p><strong><code>getInputStream()</code></strong><br>获取请求体的二进制输入流（用于文件上传或二进制数据）。<br><strong>示例</strong>：<code>ServletInputStream inputStream = request.getInputStream();</code></p></li><li><p><strong><code>getPart(String name)</code></strong><br>获取上传的文件或表单字段（用于处理多部分表单数据）。<br><strong>示例</strong>：<code>Part filePart = request.getPart(&quot;file&quot;);</code></p></li></ul><hr><h3><span id="httpresponse-的核心方法">HttpResponse 的核心方法</span></h3><h4><span id="1-响应头与状态码设置"><strong>1. 响应头与状态码设置</strong></span></h4><ul><li><p><strong><code>setStatus(int sc)</code></strong> 或 <strong><code>sendError(int sc)</code></strong><br>设置 HTTP 状态码（如 <code>200</code> 成功、<code>404</code> 未找到、<code>500</code> 服务器错误）。<br><strong>示例</strong>：<code>response.setStatus(HttpServletResponse.SC_OK);</code></p></li><li><p><strong><code>setHeader(String name, String value)</code></strong><br>设置指定名称的响应头（如 <code>Content-Type</code>、<code>Cache-Control</code>）。<br><strong>示例</strong>：<code>response.setHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);</code></p></li></ul><h4><span id="2-响应内容输出"><strong>2. 响应内容输出</strong></span></h4><ul><li><p><strong><code>getOutputStream()</code></strong><br>获取二进制输出流（用于发送文件或二进制数据）。<br><strong>示例</strong>：<code>ServletOutputStream os = response.getOutputStream();</code></p></li><li><p><strong><code>getWriter()</code></strong><br>获取字符输出流（用于发送文本内容，如 JSON、HTML）。<br><strong>示例</strong>：<code>PrintWriter writer = response.getWriter();</code></p></li></ul><h4><span id="3-重定向与会话管理"><strong>3. 重定向与会话管理</strong></span></h4><ul><li><p><strong><code>sendRedirect(String location)</code></strong><br>发送重定向响应（客户端会发起新请求到指定 URL）。<br><strong>示例</strong>：<code>response.sendRedirect(&quot;/login.html&quot;);</code></p></li><li><p><strong><code>addCookie(Cookie cookie)</code></strong><br>添加一个 Cookie 到响应中（用于客户端存储数据）。<br><strong>示例</strong>：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Cookie</span> <span class="variable">sessionCookie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;session&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">response.addCookie(sessionCookie);</span><br></pre></td></tr></table></figure></li></ul><h4><span id="4-缓冲区与提交控制"><strong>4. 缓冲区与提交控制</strong></span></h4><ul><li><p><strong><code>flushBuffer()</code></strong><br>强制刷新缓冲区，立即发送响应内容到客户端。<br><strong>示例</strong>：<code>response.flushBuffer();</code></p></li><li><p><strong><code>reset()</code></strong><br>重置响应（清除缓冲区和状态，需在响应提交前调用）。<br><strong>示例</strong>：<code>response.reset();</code></p></li></ul><h4><span id="5-其他重要方法"><strong>5. 其他重要方法</strong></span></h4><ul><li><p><strong><code>setContentType(String type)</code></strong><br>设置响应的 MIME 类型（如 <code>text/html</code>、<code>application/json</code>）。<br><strong>示例</strong>：<code>response.setContentType(&quot;application/json&quot;);</code></p></li><li><p><strong><code>setCharacterEncoding(String charset)</code></strong><br>设置响应的字符编码（如 <code>UTF-8</code>）。<br><strong>示例</strong>：<code>response.setCharacterEncoding(&quot;UTF-8&quot;);</code></p></li></ul><hr><h3><span id="关键注意事项"><strong>关键注意事项</strong></span></h3><ol><li><p><strong><code>getInputStream()</code> 和 <code>getWriter()</code> 的冲突</strong>  </p><ul><li>在 <code>HttpServletRequest</code> 中，二者<strong>不能同时使用</strong>，否则抛出 <code>IllegalStateException</code>。</li></ul></li><li><p><strong>响应提交后的限制</strong>  </p><ul><li>一旦响应提交（通过 <code>flushBuffer()</code> 或客户端接收），无法修改响应头或状态码。</li></ul></li><li><p><strong>字符编码设置时机</strong>  </p><ul><li>应在调用 <code>getWriter()</code> 或 <code>getOutputStream()</code> <strong>之前</strong>设置字符编码。</li></ul></li><li><p><strong>会话与 Cookie 的安全性</strong>  </p><ul><li>敏感数据（如密码）应避免通过 Cookie 传输，需使用 <code>HttpOnly</code> 和 <code>Secure</code> 标志。</li></ul></li></ol><h2><span id="登录案例">登录案例</span></h2><p>项目结构：</p><p><img src="/../images/image-20250424230022466.png" alt="image-20250424230022466"></p><p>index.jsp:</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%--</span><br><span class="line">  Created by IntelliJ IDEA.</span><br><span class="line">  User: xuan</span><br><span class="line">  Date: <span class="number">2025</span>/<span class="number">4</span>/<span class="number">24</span></span><br><span class="line">  Time: <span class="number">20</span>:<span class="number">05</span></span><br><span class="line">  To change <span class="built_in">this</span> template use File | Settings | File Templates.</span><br><span class="line">--%&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">  用户名：&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  密码：&lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;登录&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>pom.xml文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>login-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>login-test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span>5.9.2<span class="tag">&lt;/<span class="name">junit.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;junit.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Druid 连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- MySQL 8.0 驱动 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-beanutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-beanutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20250424230752713.png" alt="image-20250424230752713"></p><h3><span id="1创建数据库创建user表">1.创建数据库，创建user表</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">    id       <span class="type">int</span> auto_increment</span><br><span class="line">        <span class="keyword">primary key</span>,</span><br><span class="line">    username <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">    password <span class="type">varchar</span>(<span class="number">12</span>) <span class="keyword">not null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3><span id="2编写数据库配置文件">2.编写数据库配置文件</span></h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driverClassName</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/servlet</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">maxActive</span>=<span class="string">20</span></span><br><span class="line"><span class="attr">maxWait</span>=<span class="string">60000</span></span><br></pre></td></tr></table></figure><h3><span id="3编写数据库工具类">3.编写数据库工具类</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSourceFactory;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">resource</span> <span class="operator">=</span> JDBCUtils.class.getClassLoader().getResourceAsStream(<span class="string">&quot;druid.properties&quot;</span>);</span><br><span class="line">            properties.load(resource);</span><br><span class="line">            dataSource = DruidDataSourceFactory.createDataSource(properties);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.err.println(<span class="string">&quot;数据库加载出错&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DataSource <span class="title function_">getDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="keyword">return</span> dataSource.getConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="4编写user实体类封装用户数据">4.编写User实体类，封装用户数据</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="5编写logindaoclass">5.编写LoginDao.class</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itcast.dao.User;</span><br><span class="line"><span class="keyword">import</span> com.itcast.utils.JDBCUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>(JDBCUtils.getDataSource());</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginUser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(User loginUser)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where username = ? and password = ?&quot;</span>;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(User.class),</span><br><span class="line">                    loginUser.getUsername(), loginUser.getPassword());</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DataAccessException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;用户&quot;</span>+loginUser.getUsername()+<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="6编写servlet">6.编写servlet</span></h3><h4><span id="loginservletclass">LoginServlet.class:</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itcast.dao.User;</span><br><span class="line"><span class="keyword">import</span> com.itcast.domain.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        req.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">        <span class="type">User</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BeanUtils.populate(userDTO, map);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;复制失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDao</span>();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.login(userDTO);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 登录失败</span></span><br><span class="line">            req.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/fail&quot;</span>).forward(req, resp);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            req.getRequestDispatcher(<span class="string">&quot;/success&quot;</span>).forward(req, resp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="failservletclass">FailServlet.class:</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/fail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FailServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="successservletclass">SuccessServlet.class:</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itcast.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/success&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuccessServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="built_in">this</span>.doPost(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        resp.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        resp.getWriter().write(username + <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Servlet </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>若依项目部署小结</title>
      <link href="/2025/04/23/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%B0%8F%E7%BB%93/"/>
      <url>/2025/04/23/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h2><span id="环境搭建">环境搭建</span></h2><p>虚拟机环境：jdk1.8 + tomcat9 + nginx</p><blockquote><p>A ：虚拟机A运行前端项目 A </p><p>B：虚拟机B运行war包 B </p><p>C：虚拟机C运行jar包 C </p><p>mysql和redis连的是C主机</p></blockquote><p><img src="/./../images/image-20250423122832269.png" alt="image-20250423122832269"></p><p><img src="/./../images/image-20250423123133199.png" alt="image-20250423123133199"></p><h2><span id="前端项目部署">前端项目部署</span></h2><p>必备：nginx环境 + 打包好的dist文件夹</p><p>1.前端打包命令：</p><p>在当前前端项目的根目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i # 下载依赖</span><br><span class="line">npm run build # 打包 结束会生成一个dist文件夹</span><br></pre></td></tr></table></figure><p>2.nginx部署</p><p>修改conf文件夹下的nginx.conf文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 8080;</span><br><span class="line">        server_name localhost;</span><br><span class="line"></span><br><span class="line">        # 前端静态文件配置 : dist目录</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /usr/local/program/ruoyi-ui/dist;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # 反向代理 API 请求到后端服务</span><br><span class="line">        location /prod-api/ &#123;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://backend/; # 修改为自己的后端项目地址</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>3.运行nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nginx</span><br></pre></td></tr></table></figure><p>4.在浏览器测试一下</p><p>在虚拟机中输入 <a href="http://localhost:8080/">http://localhost:8080</a> 测试一下能不能访问静态资源</p><h2><span id="后端打包部署">后端打包+部署</span></h2><p>打包</p><p>idea将项目打包war包+jar包</p><p>1.修改pom.xml中的打包方式 war or jar</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.打包</p><p>命令行输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package</span><br></pre></td></tr></table></figure><p>或直接运用idea里面的工具</p><p><img src="/./../images/image-20250423115555891.png" alt="image-20250423115555891"></p><p>3.打包好的项目会放在target目录下, jar包也是一样的</p><p><img src="/./../images/image-20250423115750254.png" alt="image-20250423115750254"></p><h3><span id="war包部署">war包部署</span></h3><p>war包部署在B虚拟机上，连的是C虚拟机的mysql和redis</p><p>1.将war包放到webapps目录下，tomcat运行时会自动生成一个和war包同名的文件夹</p><p>2.修改conf目录下的server.xml文件，修改当前项目为根目录</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">&quot;8005&quot;</span> <span class="attr">shutdown</span>=<span class="string">&quot;SHUTDOWN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.startup.VersionLoggerListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.core.AprLifecycleListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.core.JreMemoryLeakPreventionListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.core.ThreadLocalLeakPreventionListener&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">&quot;UserDatabase&quot;</span> <span class="attr">auth</span>=<span class="string">&quot;Container&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">type</span>=<span class="string">&quot;org.apache.catalina.UserDatabase&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">description</span>=<span class="string">&quot;User database that can be updated and saved&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">factory</span>=<span class="string">&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">pathname</span>=<span class="string">&quot;conf/tomcat-users.xml&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">&quot;Catalina&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">maxParameterCount</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">               /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Engine</span> <span class="attr">name</span>=<span class="string">&quot;Catalina&quot;</span> <span class="attr">defaultHost</span>=<span class="string">&quot;localhost&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.realm.LockOutRealm&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.realm.UserDatabaseRealm&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">resourceName</span>=<span class="string">&quot;UserDatabase&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Realm</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">&quot;localhost&quot;</span>  <span class="attr">appBase</span>=<span class="string">&quot;webapps&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">unpackWARs</span>=<span class="string">&quot;true&quot;</span> <span class="attr">autoDeploy</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--修改成tomcat服务器根地址--&gt;</span>     </span><br><span class="line">        <span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">docBase</span>=<span class="string">&quot;ruoyi-admin&quot;</span> <span class="attr">reloadable</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> <span class="attr">directory</span>=<span class="string">&quot;logs&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">prefix</span>=<span class="string">&quot;localhost_access_log&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;.txt&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">pattern</span>=<span class="string">&quot;%h %l %u %t <span class="symbol">&amp;quot;</span>%r<span class="symbol">&amp;quot;</span> %s %b&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3.运行tomcat</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start tomcat</span><br></pre></td></tr></table></figure><p>4.查看日志输出</p><p><img src="/./../images/image-20250423115031053.png" alt="image-20250423115031053"></p><p><strong>tomcat运行失败，如何发现问题？</strong></p><p>1.查看日志，可能是某些版本冲突或过旧问题</p><p>2.可能是redis或者mysql连接失败造成的问题，连一下特定主机的特定端口号</p><blockquote><p>curl host_ip:port</p></blockquote><p>可能出现的问题：</p><p><strong>B主机连不上C主机的mysql</strong></p><p>解决：</p><p>1.可能是防火墙的原因：C主机防火墙开放特定端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --add-port=3306/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>2.可能是mysql拒绝访问，那就是B主机没有权限访问C的mysql（进入mysql，创建用户，赋予权限）</p><p>eg（这个是允许同一子网下连接）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 创建用户，允许子网内的所有 IP 访问（例如子网 192.168.1.0/24）</span><br><span class="line">CREATE USER &#x27;subnet_user&#x27;@&#x27;192.168.1.%&#x27; IDENTIFIED BY &#x27;StrongPassword123!&#x27;;</span><br><span class="line"></span><br><span class="line">-- 授予该用户对特定数据库的权限（如允许所有数据库和所有权限）：</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#x27;subnet_user&#x27;@&#x27;192.168.1.%&#x27; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">-- 刷新权限使更改生效</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><p><strong>B主机连不上C主机的redis</strong></p><p>1.防火墙的原因</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --add-port=3306/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>2.redis拒绝访问</p><p>修改redis.conf</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br></pre></td></tr></table></figure><h3><span id="jar包部署">jar包部署</span></h3><p>将jar包上传到虚拟机C</p><p>1.直接运行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ***.jar </span><br></pre></td></tr></table></figure><p>2.观察日志输出</p>]]></content>
      
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS 7环境搭建</title>
      <link href="/2025/04/21/CentOS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2025/04/21/CentOS%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1><span id="centos-7环境搭建">CentOS 7环境搭建</span></h1><p>我的基础环境：</p><blockquote><p>CentOS版本：CentOS Linux release 7.7.1908 (Core)</p><p>Vmware版本：VMware® Workstation 17 Pro 17.5.0 build-22583795</p></blockquote><blockquote><p>注意：</p><ol><li>所有有关防火墙的操作都可以不开端口，但是我为了测试方便我就开了端口号，便于后续本地测试，这个自行选择。</li><li>我所有的安装指令都是在root用户权限下执行的。</li><li>参考：<a href="https://www.bilibili.com/video/BV1oK4y147Qu/?spm_id_from=333.1387.search.video_card.click&vd_source=e34fd69a904ae2667b5c5e7a85ba95c9">软件安装 | CodeSheep</a></li><li>如有错误，欢迎指正！</li></ol></blockquote><h2><span id="1验证网络连通性">1.验证网络连通性</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping 8.8.8.8</span><br><span class="line">ping www.baidu.com</span><br></pre></td></tr></table></figure><p><img src="/./../images/image-20250421095237831.png" alt="image-20250421095237831"></p><p>连不通的，去修改一下&#x2F;etc&#x2F;resolv.conf下的dns配置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># /etc/resolv.conf</span><br><span class="line">nameserver 223.5.5.5      # 阿里云主DNS</span><br><span class="line">nameserver 223.6.6.6      # 阿里云备DNS</span><br><span class="line">nameserver 114.114.114.114 # 114公共DNS（备用）</span><br><span class="line">nameserver 8.8.8.8        # Google DNS（最后备用）</span><br></pre></td></tr></table></figure><p>再重启一下网络服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart NetworkManager</span><br></pre></td></tr></table></figure><h2><span id="2yum命令修复">2.yum命令修复</span></h2><p>我的yum损坏了，我重新下载了一下（排查步骤：1.防火墙 2.仓库 3.yum损坏）：</p><p>1.备份仓库配置文件，避免误删</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/yum.repos.d/backup_$(date +%Y%m%d)</span><br><span class="line">sudo mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup_$(date +%Y%m%d)/</span><br></pre></td></tr></table></figure><p>2.临时关闭防火墙</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop firewalld  # 临时关闭防火墙</span><br></pre></td></tr></table></figure><p>3.重新下载新的仓库文件（从阿里云下载的）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>4.重新下载正确的yum包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">替换为阿里云的正确路径（注意版本号可能不同）</span></span><br><span class="line">sudo wget https://mirrors.aliyun.com/centos/7.9.2009/os/x86_64/Packages/yum-3.4.3-168.el7.centos.noarch.rpm</span><br></pre></td></tr></table></figure><p>5.验证修复</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum --version </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">应输出类似：3.4.3</span></span><br></pre></td></tr></table></figure><p>常用工具和仓库下载：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install wget</span><br><span class="line">sudo yum install curl</span><br><span class="line">sudo yum install epel-release</span><br></pre></td></tr></table></figure><h2><span id="2安装git工具">2.安装Git工具</span></h2><p>2.1用yum命令安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y git</span><br></pre></td></tr></table></figure><p>2.2 验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git --version</span><br></pre></td></tr></table></figure><h2><span id="3jdk安装">3.JDK安装</span></h2><p>3.1 查看已有jdk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看</span></span><br><span class="line">rpm -qa | grep java</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 输出 (打注释的都是要删的)：</span></span></span><br><span class="line">[root@localhost git-2.45.0]# rpm -qa | grep java</span><br><span class="line">python-javapackages-3.4.1-11.el7.noarch</span><br><span class="line">javapackages-tools-3.4.1-11.el7.noarch</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">java-1.8.0-openjdk-headless-1.8.0.222.b03-1.el7.x86_64</span></span><br><span class="line">tzdata-java-2019b-1.el7.noarch</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">java-1.7.0-openjdk-headless-1.7.0.221-2.6.18.1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">java-1.8.0-openjdk-1.8.0.222.b03-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">java-1.7.0-openjdk-1.7.0.221-2.6.18.1.el7.x86_64</span></span><br></pre></td></tr></table></figure><p>3.2 删除jdk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove java-1.7.0-openjdk-headless-1.7.0.221-2.6.18.1.el7.x86_64</span><br><span class="line">yum -y remove java-1.8.0-openjdk-headless-1.8.0.222.b03-1.el7.x86_64</span><br><span class="line">yum -y remove java-1.8.0-openjdk-1.8.0.222.b03-1.el7.x86_64</span><br><span class="line">yum -y remove java-1.7.0-openjdk-1.7.0.221-2.6.18.1.el7.x86_64</span><br></pre></td></tr></table></figure><p>3.3 yum安装jdk1.8</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install java-1.8.0-openjdk</span><br><span class="line">sudo yum install java-1.8.0-openjdk-devel</span><br></pre></td></tr></table></figure><p>3.4 检查是否安装成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">openjdk version <span class="string">&quot;1.8.0_412&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OpenJDK Runtime Environment (build 1.8.0_412-b08)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OpenJDK 64-Bit Server VM (build 25.412-b08, mixed mode)</span></span><br><span class="line"></span><br><span class="line">javac -version</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">javac 1.8.0_412</span></span><br></pre></td></tr></table></figure><p>3.5 添加环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bin目录路径添加到 PATH</span></span><br><span class="line">vim  ~/.bashrc # 打开环境变量配置文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加如下环境变量，替换成自己的bin目录路径</span></span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.412.b08-1.el7_9.x86_64</span><br><span class="line">export PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line">source ~/.bashrc  # 使配置立即生效</span><br></pre></td></tr></table></figure><h2><span id="4nodejs环境配置">4.NodeJS环境配置</span></h2><p>我的安装位置：&#x2F;usr&#x2F;local&#x2F;node</p><p>容易出问题的点： 配置环境变量时，路径错误</p><p>4.1 下载压缩包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v14.15.1/node-v14.15.1-linux-x64.tar.xz</span><br></pre></td></tr></table></figure><p>4.2 解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xvf node-v14.15.1-linux-x64.tar.xz</span><br></pre></td></tr></table></figure><p>4.3 检查文件权限</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l /usr/local/node/node-v14.15.1-linux-x64/bin/ # 检查node和npm是否有可执行权限</span><br><span class="line">sudo chmod +x /usr/local/node/node-v14.15.1-linux-x64/bin/node # 给node加可执行权限</span><br><span class="line">sudo chmod +x /usr/local/node/node-v14.15.1-linux-x64/bin/npm # 给npm加可执行权限</span><br></pre></td></tr></table></figure><p>4.3 配置环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 Node.js 的 bin 目录路径添加到 PATH</span></span><br><span class="line">vim  ~/.bashrc # 打开环境变量配置文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加如下环境变量，替换成自己的bin目录路径</span></span><br><span class="line">export PATH=$PATH:/usr/local/node/node-v14.15.1-linux-x64/bin</span><br><span class="line">source ~/.bashrc  # 使配置立即生效</span><br></pre></td></tr></table></figure><p>4.3 验证安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">which node  # 应输出 `/usr/local/node/node-v14.15.1-linux-x64/bin/node`</span><br><span class="line">which npm   # 应输出 `/usr/local/node/node-v14.15.1-linux-x64/bin/npm`</span><br><span class="line">node -v     # 显示 Node.js 版本（如 v14.15.1）</span><br><span class="line">npm -v      # 显示 npm 版本</span><br></pre></td></tr></table></figure><h2><span id="5python3-环境安装">5.Python3 环境安装</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum update</span><br><span class="line">sudo yum install python3 python3-pip</span><br><span class="line">python3 --version</span><br></pre></td></tr></table></figure><h2><span id="6maven环境安装">6.Maven环境安装</span></h2><p>6.1 下载maven压缩包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dlcdn.apache.org/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz</span><br></pre></td></tr></table></figure><p>6.2 解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xzvf apache-maven-3.9.6-bin.tar.gz</span><br></pre></td></tr></table></figure><p>6.3 添加到环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bin 目录路径添加到 PATH</span></span><br><span class="line">vim  ~/.bashrc # 打开环境变量配置文件</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加如下环境变量，替换成自己的bin目录路径</span></span><br><span class="line">export MAVEN_HOME=/usr/local/maven/apache-maven-3.9.6</span><br><span class="line">export PATH=$MAVEN_HOME/bin:$PATH</span><br><span class="line">source ~/.bashrc  # 使配置立即生效</span><br></pre></td></tr></table></figure><p>6.4 验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -version</span><br></pre></td></tr></table></figure><h2><span id="7mysql-57环境安装">7.Mysql 5.7环境安装</span></h2><p>7.1 删除mysql</p><p>参考：<a href="https://blog.csdn.net/weixin_45031801/article/details/139429231?ops_request_misc=%257B%2522request%255Fid%2522%253A%25226acdc1a65971f52fc8dc58bafe36ebc7%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=6acdc1a65971f52fc8dc58bafe36ebc7&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-139429231-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=centos7%E5%AE%89%E8%A3%85mysql&spm=1018.2226.3001.4187">mysql安装教程-CSDN</a></p><p>7.2 删除mariadb(可能会与mysql冲突)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mariadb</span><br></pre></td></tr></table></figure><p>7.3 下载mysql5.7压缩包（最好是下载跟自己linux版本相符合的版本）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure><p>7.4 解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf mysql-8.0.35-linux-glibc2.12-x86_64.tar.xz -C /usr/local/mysql</span><br></pre></td></tr></table></figure><p>7.5 创建一个mysql用户来管理数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br><span class="line">chown -R mysql:mysql /usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64/</span><br></pre></td></tr></table></figure><p>7.6 配置my.cnf配置文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通常将配置文件放在 `/etc/` 目录下</span></span><br><span class="line">sudo vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">配置文件内容如下（可根据需求改）:</span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">基础配置</span></span><br><span class="line">basedir = /usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64</span><br><span class="line">datadir = /usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64/data</span><br><span class="line">port = 3306</span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line">max_connections = 200</span><br><span class="line">lower_case_table_names = 1  # 解决表名大小写敏感问题</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">日志配置（参考知识库[1][3]）</span></span><br><span class="line">log-error = /usr/local/mysql/log/error.log</span><br><span class="line">general-log = 1</span><br><span class="line">general_log_file = /usr/local/mysql/log/logger.log</span><br><span class="line">slow-query-log = 1</span><br><span class="line">slow_query_log_file = /usr/local/mysql/log/logger-slow.log</span><br><span class="line">long_query_time = 10</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">InnoDB 配置</span></span><br><span class="line">innodb_buffer_pool_size = 128M</span><br><span class="line">innodb_log_file_size = 128M</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安全配置</span></span><br><span class="line">default_authentication_plugin = mysql_native_password</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set = utf8mb4</span><br></pre></td></tr></table></figure><p>7.6 创建log路径并授权</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /usr/local/mysql/log</span><br><span class="line">sudo chown -R mysql:mysql /usr/local/mysql/log</span><br></pre></td></tr></table></figure><p>7.6 进入mysql安装目录创建data目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建数据目录并设置权限</span></span><br><span class="line">sudo mkdir data</span><br><span class="line">sudo chown -R mysql:mysql data</span><br><span class="line">sudo chmod 750 data</span><br></pre></td></tr></table></figure><p>7.7 将mysql添加到环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bin 目录路径添加到 PATH</span></span><br><span class="line">vim  ~/.bashrc # 打开环境变量配置文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加如下环境变量，替换成自己的bin目录路径</span></span><br><span class="line">export PATH=$PATH:/usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64/bin</span><br><span class="line"></span><br><span class="line">source ~/.bashrc  # 使配置立即生效</span><br></pre></td></tr></table></figure><p>7.8 初始化</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64 --datadir=/usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64/data</span><br></pre></td></tr></table></figure><p>7.9 使用systemd服务（推荐）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/systemd/system/mysqld.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文件内容如下：</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line">ExecStart=/usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64/bin/mysqld --defaults-file=/etc/my.cnf</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">ExecStop=/bin/kill -SIGTERM $MAINPID</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>7.10 重新加载systemd且启动服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl enable mysqld</span><br></pre></td></tr></table></figure><p>7.11 使用systemd启动、查看、停止mysql服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 systemd 启动mysql服务</span></span><br><span class="line">sudo systemctl start mysqld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 systemd 查看 mysql服务</span></span><br><span class="line">sudo systemctl status mysqld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用 systemd 停止 mysql服务</span></span><br><span class="line">sudo systemctl stop mysqld </span><br></pre></td></tr></table></figure><p>7.12 查看临时密码并登录mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看临时密码</span></span><br><span class="line">sudo grep &#x27;temporary password&#x27; /usr/local/mysql/log/error.log </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用临时密码登录（从 error.log 中获取）</span></span><br><span class="line">mysql -u root -p # 会提示让你输入密码，隐式密码</span><br></pre></td></tr></table></figure><p>7.13 修改密码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;你的密码&#x27;;</span><br></pre></td></tr></table></figure><p>7.14 运行安全配置（可选）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql_secure_installation</span><br></pre></td></tr></table></figure><p>接下来是本地（windows主机）连接虚拟机mysql的步骤（如果有需要可以继续）：</p><p>1.防火墙开放指定端口3306</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent --add-port=3306/tcp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>2.在my.cnf中的[mysqld]下添加：</p><p>如果配置文件中没有指定<code>bind-address</code>，MySQL服务器通常会监听所有可用的网络接口（等同于<code>bind-address = 0.0.0.0</code>）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind-address = 192.168.***.***</span><br></pre></td></tr></table></figure><p>3.测试（本地连接）：</p><p><img src="/./../images/image-20250421205327935.png" alt="image-20250421205327935"></p><h2><span id="8redis环境安装">8.Redis环境安装</span></h2><p>8.1 下载安装并启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install redis -y # 安装redis</span><br><span class="line">sudo systemctl start redis # 启动redis</span><br><span class="line">sudo systemctl enable redis # 设置开机自启动</span><br><span class="line">sudo systemctl status redis # 检查redis状态</span><br></pre></td></tr></table></figure><p>8.2 修改配置文件</p><p>不需要本地连接虚拟机上的数据库的走到这一步就可以了。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- 8.2.1 打开配置文件</span><br><span class="line">vim /etc/redis.conf</span><br><span class="line"></span><br><span class="line">- 8.2.2 在配置文件中修改 /etc/redis.conf:</span><br><span class="line">requirepass 你的密码 #设置访问密码</span><br><span class="line">bind 192.168.***.*** # 允许远程访问（将 bind 127.0.0.1 改为 bind 0.0.0.0 或指定 IP）</span><br><span class="line">protected-mode no # 关闭保护模式（仅测试环境使用，生产环境不建议）</span><br><span class="line"></span><br><span class="line">- 8.2.3 重启redis</span><br><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><p>8.3 防火墙开放6379端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --add-port=6379/tcp --permanent</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>8.4 本地测试连接</p><p><img src="/./../images/image-20250422185141407.png" alt="image-20250422185141407"></p><h2><span id="9rabbitmq环境安装">9.RabbitMQ环境安装</span></h2><p>参考：<a href="https://blog.csdn.net/weixin_45886609/article/details/124047540?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522f0d5119194da219ad2f20f290458d9e3%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=f0d5119194da219ad2f20f290458d9e3&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-124047540-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=centos7%E5%AE%89%E8%A3%85rabbitmq&spm=1018.2226.3001.4187">CentOS7安装RabbitMQ简单实用教程 |huang_sj502 </a></p><p>如果有问题的话，基本就是github连不上的问题，用加速器就好了</p><h2><span id="10tomcat环境安装">10.Tomcat环境安装</span></h2><p>1.下载压缩包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.104/bin/apache-tomcat-9.0.104.tar.gz</span><br></pre></td></tr></table></figure><p>2.解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxvf apache-tomcat-9.0.104.tar.gz</span><br></pre></td></tr></table></figure><p>3.把项目迁移到tomcat9这个目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/local/tomcat/apache-tomcat-9.0.104/* /usr/local/tomcat/tomcat9/</span><br><span class="line">rm -rf /usr/local/tomcat/apache-tomcat-9.0.104</span><br></pre></td></tr></table></figure><p>4.添加环境变量</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bin 目录路径添加到 PATH</span></span><br><span class="line">vim  ~/.bashrc # 打开环境变量配置文件</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加如下环境变量，替换成自己的bin目录路径</span></span><br><span class="line">export PATH=$PATH:/usr/local/mysql/mysql-5.7.38-linux-glibc2.12-x86_64/bin</span><br><span class="line"></span><br><span class="line">source ~/.bashrc  # 使配置立即生效</span><br></pre></td></tr></table></figure><p>5.将tomcat添加systemd服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/tomcat.service # 创建服务</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 文件内容填入：</span></span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Apache Tomcat Web Application Container</span><br><span class="line">After=syslog.target network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line"></span><br><span class="line">Environment=JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.412.b08-1.el7_9.x86_64</span><br><span class="line">Environment=CATALINA_PID=/usr/local/tomcat/tomcat9/temp/tomcat.pid</span><br><span class="line">Environment=CATALINA_HOME=/usr/local/tomcat/tomcat9</span><br><span class="line">Environment=CATALINA_BASE=/usr/local/tomcat/tomcat9</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Environment=<span class="string">&#x27;CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Environment=<span class="string">&#x27;JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom&#x27;</span></span></span><br><span class="line"></span><br><span class="line">ExecStart=/usr/local/tomcat/tomcat9/bin/startup.sh</span><br><span class="line">ExecStop=/usr/local/tomcat/tomcat9/bin/shutdown.sh</span><br><span class="line"></span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">UMask=0007</span><br><span class="line"></span><br><span class="line">RestartSec=10</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload # 重新加载systemd</span><br></pre></td></tr></table></figure><p>5.验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start tomcat</span><br><span class="line">sudo systemctl stop tomcat</span><br><span class="line">sudo systemctl status tomcat</span><br></pre></td></tr></table></figure><p>6.防火墙开放8080端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>7.虚拟机访问</p><p><img src="/./../images/image-20250422093636988.png" alt="image-20250422093636988"></p><p>本地访问：</p><p><img src="/./../images/image-20250422093719045.png" alt="image-20250422093719045"></p><h2><span id="11nginx环境安装">11.Nginx环境安装</span></h2><p>1.下载压缩包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.27.5.tar.gz</span><br></pre></td></tr></table></figure><p>2.解压</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/nginx</span><br><span class="line">cd  /usr/local/nginx</span><br><span class="line">tar -zxvf nginx-1.27.5.tar.gz</span><br></pre></td></tr></table></figure><p>3.安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure><p>4.配置编译参数并编译安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir usr/local/nginx/nginx # 安装目录</span><br><span class="line">cd usr/local/nginx/nginx-1.27.5 # 存放源码</span><br><span class="line">./configure --prefix=/usr/local/nginx/nginx --with-http_ssl_module --with-http_v2_module</span><br><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure><p>5.添加到环境变量</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># bin 目录路径添加到 PATH</span><br><span class="line">vim  ~/.bashrc # 打开环境变量配置文件</span><br><span class="line"></span><br><span class="line"># 添加如下环境变量，替换成自己的bin目录路径</span><br><span class="line">export PATH=$PATH:/usr/local/nginx/nginx/sbin</span><br><span class="line"></span><br><span class="line">source ~/.bashrc  # 使配置立即生效</span><br></pre></td></tr></table></figure><p>6.验证</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -version</span><br></pre></td></tr></table></figure><p>7.修改nginx配置文件（centos默认80端口已经被占了，我换了个端口号）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/nginx/conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改server下的端口号和其他配置</span></span><br><span class="line">listen       8080;</span><br><span class="line">server_name  localhost;</span><br><span class="line">root /usr/local/nginx/nginx/html;</span><br><span class="line">index index.html;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查语法</span></span><br><span class="line">sudo /usr/local/nginx/nginx/sbin/nginx -t -c /usr/local/nginx/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>8.启用systemd服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/nginx.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx.service 配置文件内容如下（记得替换成自己的路径）：</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=The NGINX HTTP and reverse proxy server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/nginx/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重新加载服务</span></span><br><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nginx</span><br><span class="line">sudo systemctl status nginx</span><br><span class="line">sudo systemctl restart nginx</span><br><span class="line">sudo systemctl stop nginx</span><br></pre></td></tr></table></figure><p>9.防火墙开放8080端口号（可选）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --add-port=8080/tcp</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><h2><span id="12-docker安装环境">12 docker安装环境</span></h2><p>参考CSDN保姆级教程：</p><p><a href="https://blog.csdn.net/heima005/article/details/127053152?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522f82027233a110b1bda827e3daba146d6%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=f82027233a110b1bda827e3daba146d6&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-127053152-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=centos7%E5%AE%89%E8%A3%85docker&spm=1018.2226.3001.4187">centos7安装Docker详细步骤（无坑版教程）| 江東-H</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最短路问题</title>
      <link href="/2025/04/20/%E6%9C%80%E7%9F%AD%E8%B7%AF%E9%97%AE%E9%A2%98/"/>
      <url>/2025/04/20/%E6%9C%80%E7%9F%AD%E8%B7%AF%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2><span id="学习思路yxc总结">学习思路（yxc总结）：</span></h2><h3><span id><img src="/./../images/d398ac4944413a559c3cdb1b29e61a8d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><hr><h2><span id="一-朴素dijkstra算法-稠密图lt邻接矩阵gt"><strong>一. 朴素Dijkstra算法 (稠密图)****&lt;邻接矩阵&gt;</strong></span></h2><h3><span id="算法思路"><strong>算法思路：</strong></span></h3><h3><span id="更新过程"><img src="/./../images/a59879a74c105b4b38009250c23496ec.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> <strong>更新过程：</strong></span></h3><h3><span id><img src="/./../images/0a062b186f826b7ede4c961681ae887b.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><h3><span id="acwing849-dijkstra求最短路-i"><strong>acwing849. Dijkstra求最短路 I</strong></span></h3><p><img src="/./../images/f9068377679ced20473850bcd05b20f3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="此题思路分解版">此题思路（分解版）：</span></h3><p> <strong>1.读入的同时需要更新边权</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g[a][b] = <span class="built_in">min</span>(g[a][b], c);<span class="comment">//g[][]存放的为最小边权</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>2.Dijkstra算法 (核心步骤)，循环思路对应朴素Dijkstra算法的第二步</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )<span class="comment">//循环每一个点</span></span><br><span class="line">&#123;</span><br><span class="line">       <span class="type">int</span> t = <span class="number">-1</span>;<span class="comment">//初始化</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j ++ )</span><br><span class="line">           <span class="keyword">if</span> (!st[j] &amp;&amp; (t == <span class="number">-1</span> || d[t] &gt; d[j]))<span class="comment">//没有确定最短距离的点 + 没有更新过t/距离更近的点</span></span><br><span class="line">               t = j;</span><br><span class="line">               </span><br><span class="line">       st[t] = <span class="literal">true</span>;<span class="comment">//标记t这个点已确定最短距离</span></span><br><span class="line">       </span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j ++ )<span class="comment">//用t来更新其他点的距离</span></span><br><span class="line">           d[j] = <span class="built_in">min</span>(d[j], d[t] + g[t][j]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="全部代码实现注释">全部代码实现+注释：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> d[N];<span class="comment">//某点到起点的最短距离</span></span><br><span class="line"><span class="type">int</span> g[N][N];<span class="comment">//邻接矩阵存边权</span></span><br><span class="line"><span class="type">bool</span> st[N];<span class="comment">//当前已确定最短距离的点标记为true</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dijkstra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);<span class="comment">//初始化所有点到起点的距离为无穷大</span></span><br><span class="line">    d[<span class="number">1</span>] = <span class="number">0</span>;<span class="comment">//从第一个点开始</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )<span class="comment">//循环每一个点</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = <span class="number">-1</span>;<span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j ++ )</span><br><span class="line">            <span class="keyword">if</span> (!st[j] &amp;&amp; (t == <span class="number">-1</span> || d[t] &gt; d[j]))<span class="comment">//没有确定最短距离的点 + 没有更新过t/距离更近的点</span></span><br><span class="line">                t = j;</span><br><span class="line">                </span><br><span class="line">        st[t] = <span class="literal">true</span>;<span class="comment">//标记t这个点已确定最短距离</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j ++ )<span class="comment">//用t来更新其他点的距离</span></span><br><span class="line">            d[j] = <span class="built_in">min</span>(d[j], d[t] + g[t][j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (d[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> d[n];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(g, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> g);</span><br><span class="line">    <span class="keyword">while</span> (m --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;c);</span><br><span class="line">        g[a][b] = <span class="built_in">min</span>(g[a][b], c);<span class="comment">//g[][]存放的为最小边权</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">dijkstra</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h2><span id="二-堆优化版dijkstra算法稀疏图lt邻接表gt">二. 堆优化版Dijkstra算法(稀疏图)&lt;邻接表&gt;</span></h2><h3><span id="算法思路"><strong>算法思路：</strong></span></h3><p><strong>利用邻接表，优先队列<br> 在priority_queue[HTML_REMOVED], greater[HTML_REMOVED] &gt; heap;中将返回堆顶<br> 利用堆顶来更新其他点，并加入堆中类似宽搜</strong> </p><h3><span id="更新过程"><strong>更新过程：</strong></span></h3><p><img src="/./../images/55e3c6e76f104b318826b5cf4e99a475.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/97f091e3f1e7ca3fd6606f8245e9b4fa.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/d31c5bd21cf00d7ed02fca69f2cf8996.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="acwing-850-dijkstra求最短路-ii"><strong>acwing 850. Dijkstra求最短路 II</strong></span></h3><p><img src="/./../images/cef92a6d9ea44f987266088b338b5e63.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], e[N], ne[N], w[N], idx;</span><br><span class="line">priority_queue&lt;PII, vector&lt;PII&gt;, greater&lt;PII&gt;&gt; heap;<span class="comment">//小根堆</span></span><br><span class="line"><span class="type">int</span> d[N];<span class="comment">//节点到起点的最短距离</span></span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b;</span><br><span class="line">    ne[idx] = h[a];</span><br><span class="line">    w[idx] = c;</span><br><span class="line">    h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Dijkstra</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line">    d[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    heap.<span class="built_in">push</span>(&#123;<span class="number">0</span>, <span class="number">1</span>&#125;);<span class="comment">//距离 + 节点</span></span><br><span class="line">    <span class="keyword">while</span> (heap.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> t = heap.<span class="built_in">top</span>();<span class="comment">//堆顶取出</span></span><br><span class="line">        heap.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="type">int</span> ver = t.second;<span class="comment">//节点编号</span></span><br><span class="line">        <span class="type">int</span> distance = t.first;<span class="comment">//记录距离</span></span><br><span class="line">        <span class="keyword">if</span> (st[ver]) <span class="keyword">continue</span>;<span class="comment">//如果说当前节点已经确定，就跳过以下语句</span></span><br><span class="line">        st[ver] = <span class="literal">true</span>;<span class="comment">//要进行以下语句就给当前节点打上标记</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[ver]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];<span class="comment">//节点编号</span></span><br><span class="line">            <span class="keyword">if</span> (d[j] &gt; distance + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                d[j] = distance + w[i];<span class="comment">//更新节点距离</span></span><br><span class="line">                heap.<span class="built_in">push</span>(&#123;d[j], j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (d[n] == <span class="number">0x3f3f3f3f</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> d[n];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">Dijkstra</span>();</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h2><span id="三-bellman_ford算法结构体存储边及边权lt结构体gt">三. Bellman_Ford算法(结构体存储边及边权)&lt;结构体&gt;</span></h2><h3><span id="定义"><strong>定义：</strong></span></h3><p><strong>连续进行松弛，在每次松弛时把每条边都更新一下，若在 n-1 次松弛后还能更新，则说明图中有负环，因此无法得出结果，否则就完成。</strong></p><p> <strong>假设 1 号点到 n 号点是可达的，每一个点同时向指向的方向出发，更新相邻的点的最短距离，通过循环 n-1 次操作，若图中不存在负环，则 1 号点一定会到达 n 号点，若图中存在负环，则在 n-1 次松弛后一定还会更新</strong></p><h3><span id="算法思路">算法思路：</span></h3><p><img src="/./../images/d520573773e069aea966ccae6a12ad8f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="更新过程"><strong>更新过程：</strong></span></h3><p><img src="/./../images/04648cbc1c8922a9954d6e84a4dd2641.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/73e89808aadfe7ac0c0393759224096e.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/8a422104d167b002e4a0f64571d242fc.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/541db0e1327048bb564f5761749be7ee.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="853-有边数限制的最短路"><strong>853. 有边数限制的最短路</strong></span></h3><p><img src="/./../images/a76c716c9360202731fc15ecedc3b7b9.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>, M = <span class="number">10010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Edge</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a, b, w;</span><br><span class="line">&#125;edges[M];</span><br><span class="line"><span class="type">int</span> n, m, k;</span><br><span class="line"><span class="type">int</span> d[N], backup[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bellman_ford</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line">    d[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(backup, d, <span class="keyword">sizeof</span> d);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> a = edges[j].a, b = edges[j].b, w = edges[j].w;</span><br><span class="line">            d[b] = <span class="built_in">min</span>(d[b], backup[a] + w);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[n];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b, w;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; w;</span><br><span class="line">        edges[i] = &#123;a, b, w&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">bellman_ford</span>();</span><br><span class="line">    <span class="keyword">if</span> (ans &gt;= <span class="number">0x3f3f3f3f</span> / <span class="number">2</span>) <span class="built_in">puts</span>(<span class="string">&quot;impossible&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h2><span id="四-spfa算法lt邻接表gt">四. Spfa算法&lt;邻接表&gt;</span></h2><h3><span id="算法思路"><strong>算法思路：</strong></span></h3><p><img src="/./../images/e411e7232990f4ed010e37284d19e69a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="更新过程">更新过程：</span></h3><p><img src="/./../images/543ede1444e9b5bdfd5e948ca6f4864a.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> <img src="/./../images/c77fa0352596c0fdd83e8d4b719b4cf3.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  <img src="/./../images/cd60ebde9638b6c398ff9bd7da1ae88f.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="851-spfa求最短路"><strong>851. spfa求最短路</strong></span></h3><p><img src="/./../images/b77839cd79d7250af2f8bad0bc430c5b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spfa</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], e[N], ne[N], w[N], idx;<span class="comment">//邻接表</span></span><br><span class="line"><span class="type">int</span> d[N];</span><br><span class="line"><span class="type">bool</span> st[N];<span class="comment">//用于判断队列中是否有重复的点</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b;</span><br><span class="line">    ne[idx] = h[a];</span><br><span class="line">    w[idx] = c;</span><br><span class="line">    h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(d, <span class="number">0x3f</span>, <span class="keyword">sizeof</span> d);</span><br><span class="line">    d[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    st[<span class="number">1</span>] = <span class="literal">true</span>;<span class="comment">//在队列之中</span></span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        st[t] = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (d[j] &gt; d[t] + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                d[j] = d[t] + w[i];</span><br><span class="line">               </span><br><span class="line">                <span class="keyword">if</span> (!st[j])</span><br><span class="line">                &#123;</span><br><span class="line">                     q.<span class="built_in">push</span>(j);</span><br><span class="line">                     st[j] = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d[n];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        cin &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> ans = <span class="built_in">spfa</span>();</span><br><span class="line">    <span class="keyword">if</span> (ans &gt;= <span class="number">0x3f3f3f3f</span>) <span class="built_in">printf</span>(<span class="string">&quot;impossible\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="852-spfa判断负环">852. spfa判断负环</span></h3><p><img src="/./../images/cba7a8fd573a2bd872d3bc3a91f40854.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="注意">注意：</span></h4><p>​    <strong>判断负环时，起点不止一个，所以要将所有的点都插入队列当中去</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">10010</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> h[N], e[N], ne[N], w[N], idx;</span><br><span class="line"><span class="type">int</span> d[N], cnt[N];<span class="comment">//cnt用来存储边数</span></span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    e[idx] = b;</span><br><span class="line">    ne[idx] = h[a];</span><br><span class="line">    w[idx] = c;</span><br><span class="line">    h[a] = idx ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        st[i] = <span class="literal">true</span>;</span><br><span class="line">        q.<span class="built_in">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> t = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        </span><br><span class="line">        st[t] = <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = h[t]; i != <span class="number">-1</span>; i = ne[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> j = e[i];</span><br><span class="line">            <span class="keyword">if</span> (d[j] &gt; d[t] + w[i])</span><br><span class="line">            &#123;</span><br><span class="line">                d[j] = d[t] + w[i];</span><br><span class="line">                cnt[j] = cnt[t] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (cnt[j] &gt;= n) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">if</span> (!st[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    st[j] = <span class="literal">true</span>;</span><br><span class="line">                    q.<span class="built_in">push</span>(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(h, <span class="number">-1</span>, <span class="keyword">sizeof</span> h);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;c);</span><br><span class="line">        <span class="built_in">add</span>(a, b, c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">spfa</span>()) <span class="built_in">puts</span>(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="四-floyd算法多源汇最短路多个起点lt邻接矩阵gt">四. Floyd算法(多源汇最短路，多个起点)&lt;邻接矩阵&gt;</span></h2><h3><span id="闫氏dp分析法">闫氏Dp分析法：</span></h3><p><img src="/./../images/e644fb61719275033097397519a8f998.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="状态转移方程">状态转移方程：</span></h3><p><img src="/./../images/9edc403b8cb8e534abb43bd40a95751c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="算法思路">算法思路：</span></h3><p><img src="/./../images/23b9271221ad9dac4d7db786bdbb5c6e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="854-floyd求最短路"><strong>854. Floyd求最短路</strong></span></h3><p><img src="/./../images/9f8a6c863cba8aa4015f745b35f43b52.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">210</span>, INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="type">int</span> m, n, Q;</span><br><span class="line"><span class="type">int</span> d[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Floyd</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= n; k ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j ++ )</span><br><span class="line">            &#123;</span><br><span class="line">                d[i][j] = <span class="built_in">min</span>(d[i][j], d[i][k] + d[k][j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;n,&amp;m,&amp;Q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == j) d[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> d[i][j] = INF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;c);</span><br><span class="line">        d[a][b] = <span class="built_in">min</span>(d[a][b], c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Floyd</span>();</span><br><span class="line">    <span class="keyword">while</span> (Q --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;a,&amp;b);</span><br><span class="line">        <span class="keyword">if</span> (d[a][b] &gt;= INF / <span class="number">2</span>) <span class="built_in">printf</span>(<span class="string">&quot;impossible\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,d[a][b]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="pintia-7-17-城市间紧急救援"><strong>pintia 7-17 城市间紧急救援</strong></span></h2><p><img src="/./../images/294f02074a6ac324623c67bb64f20535.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="此题思路">此题思路：</span></h3><p><strong>大体上是朴素dijkstra算法</strong> </p><p> <strong>参考了别人的代码，自己小改了一下：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">510</span>, INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="type">int</span> n, m, s, d;</span><br><span class="line"><span class="comment">//城市个数,m个操作,起点,终点</span></span><br><span class="line"><span class="type">int</span> g[N][N];<span class="comment">//存储边权</span></span><br><span class="line"><span class="type">int</span> cnt[N];<span class="comment">//最短路径的条数</span></span><br><span class="line"><span class="type">int</span> save[N];<span class="comment">//各个城市的救援队数量</span></span><br><span class="line"><span class="type">int</span> sum_save[N];<span class="comment">//到达该城市的所有救援队</span></span><br><span class="line"><span class="type">int</span> e[N];<span class="comment">//到达目标城市前经过的城市编号</span></span><br><span class="line"><span class="type">int</span> path[N], q;<span class="comment">//路径</span></span><br><span class="line"><span class="type">bool</span> st[N];<span class="comment">//判断城市是否经过</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dijkstra</span><span class="params">()</span><span class="comment">//朴素dijkstra算法</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cnt[s] = <span class="number">1</span>, st[s] = <span class="literal">true</span>;<span class="comment">//标记起点经过</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> min = INF;</span><br><span class="line">        <span class="type">int</span> t = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j ++ )</span><br><span class="line">            <span class="keyword">if</span> (!st[j] &amp;&amp; g[s][j] &lt; min) min = g[s][j], t = j;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (t == <span class="number">-1</span>) <span class="keyword">break</span>;<span class="comment">//找不到连通的点</span></span><br><span class="line">        st[t] = <span class="literal">true</span>;<span class="comment">//找到标记该点经过</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!st[j] &amp;&amp; g[s][j] &gt; g[s][t] + g[t][j])<span class="comment">//找到一个最短路径</span></span><br><span class="line">            &#123;</span><br><span class="line">                g[s][j] = g[s][t] + g[t][j];</span><br><span class="line">                e[j] = t;<span class="comment">//t为经过的点</span></span><br><span class="line">                cnt[j] = cnt[t];</span><br><span class="line">                sum_save[j] = sum_save[t] + save[j];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(!st[j] &amp;&amp; g[s][j] == g[s][t] + g[t][j])<span class="comment">//找到相同的最短路径</span></span><br><span class="line">            &#123;</span><br><span class="line">                cnt[j] = cnt[j] + cnt[t];<span class="comment">//更新最短路径条数</span></span><br><span class="line">                <span class="keyword">if</span> (sum_save[j] &lt; sum_save[t] + save[j])</span><br><span class="line">                &#123;</span><br><span class="line">                    sum_save[j] = sum_save[t] + save[j];<span class="comment">//更新最大救援队数量</span></span><br><span class="line">                    e[j] = t;</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; d;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) </span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;save[i]), sum_save[i] = save[i], cnt[i] = <span class="number">1</span>;<span class="comment">//读入各个城市的救援队数量并且对sum_save进行初始化</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (j == i) g[i][j] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> g[i][j] = INF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ )<span class="comment">//m个操作</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a, b, w;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;a,&amp;b,&amp;w);<span class="comment">//无向图</span></span><br><span class="line">        g[a][b] = w;</span><br><span class="line">        g[b][a] = w;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dijkstra</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,cnt[d], sum_save[d] + save[s]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = e[d]; i != <span class="number">0</span>; i = e[i]) path[q ++] = i;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, s);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = q - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,path[i]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, d);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java虚拟机</title>
      <link href="/2025/04/20/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/"/>
      <url>/2025/04/20/Java%E8%99%9A%E6%8B%9F%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<h1><span id="jvm的概念">JVM的概念</span></h1><p>百度百科：<a href="https://baike.baidu.com/item/java%E8%99%9A%E6%8B%9F%E6%9C%BA/6810577">java虚拟机</a></p><h3><span id="什么是虚拟机">什么是虚拟机？</span></h3><p>虚拟机是一种抽象化的计算机，通过在实际的计算机上<strong>仿真模拟各种计算机</strong>功能来实现的。</p><h3><span id="为什么要有jvm">为什么要有JVM？</span></h3><blockquote><ul><li>Java设计的初衷是使要建的<strong>能在任何平台上运行的程序</strong>不需要再在每个单独的平台上由程序员进行重写或重编译。</li><li>Java虚拟机使这个愿望变为可能，因为它<strong>能知道每条指令的长度和平台的其他特性</strong>。</li><li>JVM的设计目标是提供一个基于抽象规格描述的计算机模型，为解释程序开发人员提供的任何系统上运行。</li></ul></blockquote><h3><span id="什么是java虚拟机">什么是java虚拟机?</span></h3><p>JVM全称Java Virtual Machine</p><blockquote><ul><li><strong>Java虚拟机有自己完善的硬体架构</strong>，如处理器、堆栈、寄存器等，还具有相应的指令系统。</li><li>运行所有Java程序的<strong>抽象计算机</strong>，是Java语言的运行环境</li><li>Java虚拟机包括一套字节码指令集、一组寄存器、一个栈、一个垃圾回收堆和一个存储方法域。</li><li>一旦一个Java虚拟机在给定的平台上运行，任何Java程序（编译之后的程序，称作字节码）都能在这个平台上运行。<strong>“一次编写，到处运行”</strong></li><li>Java虚拟机（JVM）可以以一次一条指令的方式来解释字节码（把它映射到实际的处理器指令），或者字节码也可以由实际处理器中称作just-in-time的编译器进行进一步的编译</li></ul></blockquote><p> 白话文理解一下：</p><blockquote><p>​      想象一下，您写了一篇非常特别的文章（Java程序），但是这篇文章需要用一种特殊的“万能语言”（字节码）来书写，这样它才能在任何地方被理解。然而，要读懂这种“万能语言”，人们需要一个特殊的翻译机（JVM）。</p><p>​    这个翻译机不仅能够读懂您的文章，还能把它转换成当地语言（机器指令），以便任何人（任何操作系统和硬件）都能理解。</p><p>​    现在，如果每次有人想读您的文章，都需要自己造一台这样的翻译机，那将是非常麻烦且耗时的。这就是为什么我们需要JVM——一个通用的翻译机，它可以安装在各种不同的设备上。一旦设备上有了这个翻译机，无论何时何地，只要把您的文章放进去，它就能立刻翻译并让大家读懂。</p><p>​    所以，别人想要运行您写的Java程序时，并不需要重新制造一台新的翻译机，只需要确保他们的设备上已经安装了合适的翻译机（即对应版本的JVM）。这样一来，他们就可以轻松运行您的程序，而无需担心底层的细节问题。</p><p>​    总结来说，JVM就像是一个专为Java程序设计的“虚拟计算机”。它允许您编写的程序在任何安装了适当版本JVM的设备上运行，极大地简化了跨平台应用的开发和部署过程。通过这种方式，Java实现了“编写一次，到处运行”的理念。</p></blockquote><h1><span id="jvm的组成">JVM的组成</span></h1><p><img src="/./../images/5614b03a0be04d9183a4087a87bf8a6b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="类加载器classloader">类加载器（ClassLoader）：</span></h3><p>负责加载.class文件中的字节码到内存中，并将这些字节码转换为可以由JVM执行的形式。</p><p>类加载器有三个主要类型：</p><ul><li><strong>启动类加载器（Bootstrap ClassLoader）</strong></li><li><strong>扩展类加载器（Extension ClassLoader）</strong></li><li><strong>应用类加载器（Application ClassLoader）</strong></li></ul><h3><span id="运行时数据区runtime-data-area">运行时数据区（Runtime Data Area）：</span></h3><p>这部分包括了多个关键的数据区域，用于存储程序运行期间需要的数据：</p><ul><li><strong>方法区（Method Area）</strong>：存储已被虚拟机加载的类信息、常量、静态变量等。</li><li><strong>堆（Heap）</strong>：存放对象实例以及数组，是垃圾回收的主要区域。</li><li><strong>虚拟机栈（VM Stack）</strong>：每个线程在创建时都会创建一个私有的栈，用来存储栈帧，栈帧中包含了局部变量表、操作数栈、动态链接等信息。</li><li><strong>本地方法栈（Native Method Stack）</strong>：与虚拟机栈类似，但主要是为执行本地方法服务的。</li><li><strong>程序计数器（Program Counter Register</strong>）：每个线程都有自己的程序计数器，指向当前线程正在执行的字节码指令地址。</li></ul><h3><span id="执行引擎execution-engine">执行引擎（Execution Engine）：</span></h3><p>执行引擎负责解释或编译字节码并执行它。主要包括以下几部分：</p><ul><li><strong>解释器（Interpreter）</strong>：直接解释字节码并执行，虽然速度较慢但能快速启动。</li><li><strong>即时编译器（Just-In-Time Compiler, JIT）</strong>：将经常执行的字节码编译成本地机器代码以提高执行效率。</li><li><strong>垃圾收集器（Garbage Collector, GC）</strong>：自动管理内存，回收不再使用的对象所占用的内存空间。</li></ul><h3><span id="本地接口库native-interface-library">本地接口库（Native Interface Library）：</span></h3><p>提供了一种机制，<strong>允许Java代码调用C&#x2F;C++等其他语言编写的本地库函数</strong>，这通过JNI（Java Native Interface）实现。</p><h3><span id="本地方法库native-method-library">本地方法库（Native Method Library）：</span></h3><p>包含了由本地代码（如C&#x2F;C++）实现的方法库，这些方法可以通过JNI被Java程序调用。</p><hr><h1><span id="运行时数据区">运行时数据区</span></h1><p>JVM再执行Java程序的过程中会把它所管理的内存划分为若干个不同的数据区域。</p><h2><span id="分类">分类：</span></h2><h3><span id="程序计数器program-counter-register">程序计数器（Program Counter Register）：</span></h3><ul><li>每个线程都有一个独立的程序计数器。</li><li><strong>存储当前线程正在执行的字节码指令的地址</strong>。如果线程正在执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址；如果正在执行的是本地方法（Native Method），则计数器的值为空（Undefined）。</li></ul><h3><span id="虚拟机栈java-virtual-machine-stacks">虚拟机栈（Java Virtual Machine Stacks）：</span></h3><p><strong>存储方法调用过程中的局部变量、操作数栈、动态链接和方法出口信息。</strong></p><h3><span id><img src="/./../images/5e0f60d1c2ba4cea951af5d057fef3a3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><p>每个线程在创建时都会创建一个私有的栈。<br> 栈由多个栈帧（Frame）组成，每个栈帧对应一个方法调用。</p><ul><li><strong>局部变量表（Local Variable Table）：</strong>存储方法参数和方法内部定义的局部变量。包括各种基本数据类型、对象引用和返回地址类型。</li><li><strong>操作数栈（Operand Stack）：</strong>用于存储计算过程中需要的操作数和结果。Java虚拟机的指令集大多通过操作数栈来进行计算。</li><li><strong>动态链接（Dynamic Linking）：</strong>指向运行时常量池中的符号引用，这些引用在类加载阶段解析为直接引用后，可以通过这些引用访问类或接口的方法和字段。</li><li><strong>方法出口信息（Return Address）：</strong>存储方法返回地址，即方法退出后应该返回到的位置。</li></ul><h3><span id="堆heap">堆（Heap）：</span></h3><h3><span id><img src="/./../images/49ccf263893f4ffa97c82a2eafa1403c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><ul><li>堆是所有线程共享的一块内存区域，主要用于<strong>存储对象实例和数组</strong>。</li><li>堆被划分为<strong>新生代（Young Generation）、老年代（Old Generation）</strong>等不同区域，以实现高效的垃圾回收机制。</li><li><strong>新生代通常进一步分为Eden区和两个Survivor区（From和To）</strong>，用于管理新创建的对象。</li></ul><p><strong>注意:</strong></p><p>在早期的Java虚拟机（JVM）实现中，存在一个被称为“永久代”（Permanent Generation，简称PermGen）的区域，它用于存储类的元数据。然而，从Java 8开始，JVM的设计发生了变化，永久代被移除，并引入了一个新的区域叫做“元空间”（Metaspace）</p><p><strong>永久代是堆的一部分，与永久代不同，元空间并不属于堆内存，而是直接分配在本地内存（Native Memory）中。</strong></p><h3><span id="方法区method-area">方法区（Method Area）：</span></h3><p>方法区也是所有线程共享的一块内存区域，用于<strong>存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码缓存等</strong>。</p><ul><li><strong>类信息：</strong>包括类的名称、父类名称、实现的接口列表、字段描述符、方法描述符等。</li><li><strong>常量池</strong>（Constant Pool）：存储了类或接口中定义的常量，如字符串常量、整型常量等。</li><li><strong>静态变量</strong>（Static Variables）：存储类级别的变量，这些变量属于整个类而非某个实例。</li><li><strong>即时编译器编译后的代码缓存</strong>：存储由JIT编译器生成的机器码。</li></ul><h3><span id="本地方法栈native-method-stack">本地方法栈（Native Method Stack）：</span></h3><ul><li>与虚拟机栈类似，但专门为执行本地方法（Native Method）服务。</li><li>存储本地方法调用时的相关信息，具体结构和功能依赖于本地方法的具体实现。</li></ul><hr><h1><span id="类加载器">类加载器</span></h1><p><img src="/./../images/fbd33249a10a4833911eb24d9cebafc7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="类加载机制">类加载机制</span></h2><p>​    虚拟机把描述类的数据从Class文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型。</p><p>​     Java中天生可以动态扩展的语言特性就是依赖运行期动态加载和动态连接这个特点实现的。</p><h3><span id="类的生命周期">类的生命周期：</span></h3><p>类的生命周期是指从类被加载到JVM中开始，直到最终被卸载的过程。这个过程可以分为几个主要阶段：<strong>加载（Loading）、链接（Linking）、初始化（Initialization）、使用（Using）和卸载（Unloading）。</strong></p><p>类的加载阶段必须按顺序执行，而解析阶段不一定。</p><p><strong>有四种情况必须立即对类进行“初始化”：</strong></p><blockquote><ol><li>使用 new 关键字实例化对象</li></ol><p> 当你使用 new 关键字创建一个类的实例时，如果该类尚未被初始化，则会触发类的初始化。</p><ol start="2"><li>调用类的静态方法</li></ol><p> 当你调用一个类的静态方法时，如果该类尚未被初始化，则会触发类的初始化。</p><ol start="3"><li>访问或设置类的静态字段（非final）</li></ol><p> 当你访问或设置一个类的静态字段（且该字段不是 final 的）时，如果该类尚未被初始化，则会触发类的初始化。</p><ol start="4"><li>使用反射机制</li></ol><p> 当你通过反射机制来操作类时，某些操作会触发类的初始化。例如，使用 Class.forName(String name) 方法加载类时，如果该类尚未被初始化，则会触发其初始化过程。 </p></blockquote><p><img src="/./../images/c01191e6335e486fbb8eeaa32e528f7b.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="1-加载loading">1. 加载（Loading）</span></h4><p>目标：<strong>找到类的字节码文件，并将其加载到内存中。</strong></p><ul><li>通过一个类的全限定名来获取定义此类的二进制字节流。</li><li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。</li><li>创建类对象，在Java堆中生成一个代表这个类的java.lang.Class对象（实例化），作为方法区这些数据的访问入口。</li></ul><h4><span id="2-链接linking">2. 链接（Linking）</span></h4><p>链接阶段又可以细分为三个子阶段：<strong>验证（Verification）、准备（Preparation）和解析（Resolution）。</strong></p><h5><span id="21-验证verification">2.1 验证（Verification）</span></h5><p>目标：<strong>确保类的字节码是正确且安全的。</strong></p><ul><li>文件格式验证：验证字节码是否符合Java虚拟机规范的文件格式要求。</li><li>元数据验证：确保类的结构是正确的，例如方法是否有返回值、继承关系是否合法等。</li><li>字节码验证：防止恶意代码对系统的攻击，确保字节码在运行时是安全的。</li><li>.符号引用验证：确保符号引用能够正确解析为直接引用。（解析阶段发生）</li></ul><h5><span id="22-准备preparation">2.2 准备（Preparation）</span></h5><p>目标：<strong>为类的静态变量分配内存，并设置默认初始值。</strong></p><ul><li>静态变量初始化：在这个阶段，所有静态变量都会被分配内存空间，并赋予默认值（例如 int 类型的默认值为 0，Object 类型的默认值为 null）。</li></ul><h5><span id="23-解析resolution">2.3 解析（Resolution）</span></h5><p>目标：<strong>将类、接口、字段和方法的符号引用转换为直接引用。</strong></p><ul><li>符号引用：在编译时生成的对其他类、接口、字段或方法的引用。</li><li>直接引用：在运行时解析这些符号引用，找到它们实际的内存地址。</li></ul><h4><span id="3-初始化initialization">3. 初始化（Initialization）</span></h4><p>目标：<strong>执行类的静态初始化块和静态变量的赋值操作。</strong></p><ul><li>静态初始化块：如果类中有静态初始化块（static {}），这些块会在初始化阶段被执行。</li><li>静态变量赋值：静态变量会被赋予程序员指定的初始值（而不是默认值）。</li></ul><h4><span id="4-使用using">4. 使用（Using）</span></h4><p>目标：<strong>当类被加载、链接和初始化后，就可以在程序中使用了。</strong></p><ul><li>实例化对象：通过 new 关键字创建类的实例。</li><li>调用方法：可以调用类的方法或访问类的字段。</li></ul><h4><span id="5-卸载unloading">5. 卸载（Unloading）</span></h4><p>目标：<strong>当类不再被使用时，JVM会进行垃圾回收，释放相关的资源。</strong></p><ul><li>类卸载条件：只有当类加载器本身也被垃圾回收时，类才会被卸载。具体来说，当没有任何对象引用类加载器时，类加载器及其加载的所有类都可以被垃圾回收。</li></ul><h3><span id="类生命周期的详细步骤">类生命周期的详细步骤</span></h3><blockquote><p><strong>1.加载（Loading）：</strong></p><ul><li>查找并读取 .class 文件。</li><li>创建 java.lang.Class 对象表示该类。</li></ul><p><strong>2.链接（Linking）：</strong></p><ul><li>验证（Verification）：检查字节码的正确性和安全性。</li><li>准备（Preparation）：为静态变量分配内存并赋予默认值。</li><li>解析（Resolution）：将符号引用解析为直接引用。</li></ul><p><strong>3.初始化（Initialization）：</strong></p><ul><li>执行静态初始化块和静态变量的赋值操作。</li></ul><p><strong>4.使用（Using）：</strong></p><ul><li>实例化对象并调用类的方法。</li></ul><p><strong>5.卸载（Unloading）：</strong></p><ul><li>当类加载器不再被引用时，JVM可能会卸载类及其相关资源。</li></ul></blockquote><h2><span id="类加载器的层次">类加载器的层次：</span></h2><p>​    比较两个类是否“相等”，只有在这两个类是由同一个类加载器加载的前提之下才有意义，否则，即时这两个类来源于同一个Class文件，只要加载它们的类加载器不同，那这两个类就必定不相等。</p><h3><span id="启动类加载器bootstrap-classloader">启动类加载器（Bootstrap ClassLoader）</span></h3><ul><li>这是最顶层的类加载器，由本地代码实现（通常是C&#x2F;C++），不属于Java类层次结构的一部分。</li><li>负责加载核心Java库中的类，例如 rt.jar 中的类，这些类位于 $JAVA_HOME&#x2F;jre&#x2F;lib 目录下。</li><li>由于它是由本地代码实现的，因此无法通过Java代码直接访问或扩展。</li></ul><h3><span id="扩展类加载器extension-classloader">扩展类加载器（Extension ClassLoader）</span></h3><ul><li>继承自 java.net.URLClassLoader，是 sun.misc.Launcher$ExtClassLoader 的实例。</li><li>负责加载位于 $JAVA_HOME&#x2F;jre&#x2F;lib&#x2F;ext 目录下的扩展类库，以及任何配置在 java.ext.dirs 系统属性中的路径中的类库。</li></ul><h3><span id="应用类加载器application-classloader">应用类加载器（Application ClassLoader）</span></h3><ul><li>继承自 java.net.URLClassLoader，是 sun.misc.Launcher$AppClassLoader 的实例。</li><li>负责加载应用程序类路径上的类，即 -classpath 或 CLASSPATH 环境变量指定的路径中的类。</li></ul><h3><span id="自定义类加载器custom-classloader">自定义类加载器（Custom ClassLoader）</span></h3><ul><li>用户可以继承 java.lang.ClassLoader 来创建自定义类加载器，以满足特定需求，如从数据库、网络或其他非标准位置加载类。</li></ul><h2><span id="双亲委派模型">双亲委派模型</span></h2><p><img src="/./../images/3c487179cf174c33a5f6c3de84af739e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>类加载器使用双亲委派模型（Parent Delegation Model），其工作原理如下：</p><ol><li>当一个类加载器收到加载某个类的请求时，首先不会自己去尝试加载这个类。</li><li>它会将该请求<strong>委派给它的父类加载器，直到启动类加载器</strong>。</li><li>如果<strong>父类加载器无法找到或加载该类，则子类加载器才会尝试自己加载该类</strong>。</li><li>如果所有父类加载器都无法加载该类，则最终会抛出 ClassNotFoundException 异常。</li></ol><hr><h1><span id="垃圾收集器">垃圾收集器</span></h1><h2><span id="垃圾收集是什么">垃圾收集是什么？</span></h2><blockquote><p>​    是Java虚拟机（JVM）自动管理内存的一种机制，目的是自动释放不再使用的对象所占用的内存资源。</p></blockquote><h2><span id="为什么要垃圾收集">为什么要垃圾收集？</span></h2><blockquote><p><strong>1.防止内存泄漏：</strong></p><ul><li>如果程序中存在不再使用的对象但仍然持有对这些对象的引用，那么这些对象将无法被释放，导致内存泄漏。内存泄漏会逐渐耗尽可用内存，最终导致应用程序崩溃或性能下降。</li></ul><p><strong>2.简化内存管理：</strong></p><ul><li>在没有垃圾回收的语言中，开发者需要手动管理内存分配和释放。这不仅增加了开发复杂度，还容易出错。通过垃圾回收，开发者可以专注于业务逻辑，而无需担心内存管理问题。</li></ul><p><strong>3.提高系统稳定性：</strong></p><ul><li>自动化的垃圾回收可以确保在适当的时候释放内存，从而减少因内存不足导致的应用崩溃或性能问题。</li></ul><p><strong>4.优化内存使用：</strong></p><ul><li>垃圾回收器可以通过压缩等方式重新组织堆内存，减少内存碎片化，提高内存利用率。</li></ul></blockquote><h2><span id="垃圾收集发生在哪里">垃圾收集发生在哪里？</span></h2><p><img src="/./../images/49ccf263893f4ffa97c82a2eafa1403c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p>垃圾回收<strong>主要发生在堆内存</strong>（Heap Memory） 中，因为堆是存储对象实例的地方。具体来说：</p><ul><li><strong>年轻代（Young Generation）：</strong>新创建的对象首先被分配到年轻代中的Eden区。<strong>当Eden区满时，会触发一次Minor GC（轻量级垃圾回收）</strong>，清理掉不再使用的对象，并将存活的对象移动到Survivor区。</li><li><strong>老年代（Old Generation）：</strong>经过多次Minor GC后仍存活的对象会被晋升到老年代。老年代的空间较大，通常用于存储生命周期较长的对象。<strong>当老年代空间不足时，会触发Major GC或Full GC（全量垃圾回收）</strong>。</li><li><strong>永久代&#x2F;元空间（Permanent Generation&#x2F;Metaspace）：</strong>从Java 8开始，永久代被元空间取代。元空间用于存储类的元数据、方法信息等。虽然这部分不属于堆内存，但它也是垃圾回收的一部分，尤其是类卸载时。（逻辑上存在于堆，物理上不存在）</li></ul></blockquote><h2><span id="垃圾收集的流程">垃圾收集的流程</span></h2><p> 堆中几乎存放着Java世界中所有的对象实例，垃圾收集器在对堆进行回收前，第一件事就是要<strong>确定哪些对象还“存活”着，哪些已经“死去”</strong>(即不可能再被任何途径使用的对象)。</p><h3><span id="1判断对象是否存活"><strong>1.判断对象是否存活</strong></span></h3><h4><span id="1引用计数算法">（1）引用计数算法</span></h4><blockquote><p>​    给对象中添加一个引用计数。每当有一个地方引用它，计数器就加1；当引用失效，计数器值就减1。<strong>任何时候，计数器值为0的对象就是不可能被使用的。</strong></p></blockquote><p><strong>注意：</strong>Java语言中没有选用引用计数算法来管理内存，其中最主要的原因是它<strong>很难解决对象之间的相互循环引用的问题</strong>。</p><h4><span id="2根搜索算法">（2）根搜索算法</span></h4><p>​    在主流的商用程序语言中（Java 和 C#， 甚至包括古老的Lisp），都是采用根搜索算法（GC Roots Tracing）判定对象是否存活。</p><blockquote><p>​    通过一系列的名为“GC Roots”的对象作为起始点，从这些节点开始向下搜索，搜索所走过的路径被称为<strong>引用链</strong>，当一个对象到GC Roots没有任何的引用链相连（用图论的话来说就是从GC Roots到这个对象不可达），则证明此对象是不可用的。</p></blockquote><p><img src="/./../images/37d6f7b6357441c18cb7092ebd7a2733.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p> 无论是引用计数算法还是根搜索算法都离不开<strong>“引用”</strong>：</p><ul><li>强引用：常规引用，对象不会被回收。</li><li>软引用：内存不足时可能被回收，用于缓存。</li><li>弱引用：对象无强引用时立即被回收，用于生命周期较短的对象。</li><li>虚引用：跟踪对象回收状态，用于清理操作。</li></ul></blockquote><h3><span id="2垃圾收集算法">2.垃圾收集算法</span></h3><h4><span id="1标记-清除算法">（1）标记-清除算法</span></h4><p><img src="/./../images/63cedbf72c824b7098e5df51ca566c77.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>原理</strong></p><ul><li>标记阶段：从根对象开始，递归地遍历所有可达的对象，并将这些对象标记为存活。</li><li>清除阶段：扫描整个堆内存，清理未被标记的对象，释放其占用的内存。</li></ul><p><strong>优点</strong></p><ul><li>实现简单，不需要额外的空间。</li></ul><p><strong>缺点</strong></p><ul><li>容易产生内存碎片，影响后续的大对象分配。</li><li>需要暂停应用程序（Stop-the-world），影响系统的响应时间。</li></ul><p><strong>适用场景</strong></p><ul><li>适用于对停顿时间要求不高、内存碎片化问题不严重的场景。</li></ul></blockquote><h4><span id="2复制算法">（2）复制算法</span></h4><p><img src="/./../images/09173714d72c442c8b794b2191dc6f7f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>原理</strong></p><ul><li>将堆内存分为两个区域（Eden区和Survivor区），每次只使用其中一个区域。</li><li>当一个区域满时，触发GC，将存活的对象复制到另一个区域，然后清空当前区域。</li></ul><p><strong>优点</strong></p><ul><li>不会产生内存碎片，适合处理短期存在的对象。</li><li>清理过程高效，只需移动存活对象。</li></ul><p><strong>缺点</strong></p><ul><li>需要额外的空间来存储存活的对象，内存利用率较低。</li><li>每次GC都需要复制对象，增加了开销。</li></ul></blockquote><h4><span id="3标记-整理算法">（3）标记-整理算法</span></h4><p><img src="/./../images/c6d4e8f834224968bed0d522a4c5974d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>原理</strong></p><ul><li>类似于标记-清除算法，但在清除阶段会将存活的对象向一端移动，从而避免内存碎片。</li></ul><p><strong>优点</strong></p><ul><li>解决了内存碎片问题，适合处理长期存在的对象。</li><li>内存利用率较高。</li></ul><p><strong>缺点</strong></p><ul><li>移动对象的过程较为耗时，可能导致暂停时间较长。</li></ul><p><strong>适用场景</strong></p><ul><li>适用于老年代（Old Generation）的垃圾回收，特别是当内存碎片化成为问题时。</li></ul></blockquote><h4><span id="4分代收集算法">（4）分代收集算法</span></h4><blockquote><p><strong>原理</strong></p><ul><li>根据对象的生命周期将其分为年轻代和老年代。</li><li><strong>年轻代采用复制算法，老年代采用标记-清除或标记-整理算法。</strong></li><li>通过这种分代策略，可以更高效地管理不同生命周期的对象。</li></ul><p><strong>优点</strong></p><ul><li>提高了垃圾回收的效率，减少了不必要的扫描。</li><li>针对不同生命周期的对象采用了不同的回收策略。</li></ul><p><strong>缺点</strong></p><ul><li>实现复杂，需要维护多个区域的状态。</li></ul><p><strong>适用场景</strong></p><ul><li>适用于大多数现代JVM，默认配置通常使用分代收集算法。</li></ul></blockquote><hr><h2><span id="内存分配与回收策略">内存分配与回收策略</span></h2><h3><span id="内存分配">内存分配</span></h3><h4><span id="1-堆内存划分">1. 堆内存划分</span></h4><p>JVM的堆内存通常被划分为以下几个区域：</p><blockquote><p><strong>年轻代（Young Generation）：</strong>新创建的对象首先被分配到年轻代。</p><ul><li>Eden区：新对象通常首先被分配到这里。</li><li>Survivor区（S0 和 S1）：用于存放从Eden区存活下来的对象。</li></ul><p><strong>老年代（Old Generation）：</strong></p><ul><li>经过多次Minor GC后仍存活的对象会被晋升到老年代。</li></ul><p><strong>永久代&#x2F;元空间（Permanent Generation&#x2F;Metaspace）：</strong></p><ul><li>存储类的元数据、方法信息等（从Java 8开始，永久代被元空间取代）。</li></ul></blockquote><h4><span id="2-对象分配">2. 对象分配</span></h4><blockquote><p><strong>年轻代分配：</strong></p><ul><li>新对象通常首先被分配到Eden区。</li><li>如果Eden区空间不足，会触发一次Minor GC，清理掉不再使用的对象，并将存活的对象移动到Survivor区。</li></ul><p><strong>老年代分配：</strong></p><ul><li><strong>经过多次Minor GC后仍存活的对象会被晋升到老年代。</strong></li><li>对于<strong>大对象（超过一定阈值）</strong>，可以直接分配到老年代（通过-XX:PretenureSizeThreshold参数设置阈值）。</li></ul></blockquote><h4><span id="3-tlabthread-local-allocation-buffer">3. TLAB（Thread Local Allocation Buffer）</span></h4><blockquote><p>​    为了提高多线程环境下的对象分配效率，JVM为每个线程分配了一个本地缓冲区（TLAB）。当线程需要分配对象时，优先从TLAB中分配内存，减少了线程间的竞争。</p></blockquote><h3><span id="回收策略">回收策略</span></h3><h4><span id="1-minor-gc轻量级垃圾回收">1. Minor GC（轻量级垃圾回收）</span></h4><blockquote><p><strong>触发条件：****Eden区满时触发。</strong><br> <strong>过程：</strong></p><ul><li>标记Eden区和Survivor区中的存活对象。</li><li>将存活对象复制到另一个Survivor区（例如从S0复制到S1）。</li><li>清理Eden区和原来的Survivor区。</li><li>如果某个对象经过多次Minor GC仍然存活，则将其晋升到老年代。</li></ul></blockquote><h4><span id="2-major-gc重量级垃圾回收">2. Major GC（重量级垃圾回收）</span></h4><blockquote><p><strong>触发条件：****老年代空间不足时触发。</strong><br> <strong>过程：</strong></p><ul><li>标记老年代中的存活对象。</li><li>清理未被标记的对象，释放其占用的内存。</li><li>可能会进行内存整理，减少碎片化。</li></ul></blockquote><h4><span id="3-full-gc全量垃圾回收">3. Full GC（全量垃圾回收）</span></h4><blockquote><p><strong>触发条件：****整个堆内存</strong>（包括年轻代和老年代）<strong>空间不足时触发。</strong><br> <strong>过程：</strong></p><ul><li>标记并清理年轻代和老年代中的所有对象。</li><li>清理元空间中的无效类信息（如果使用了G1或ZGC等收集器）。</li></ul></blockquote><hr><h1><span id="执行引擎">执行引擎</span></h1><p> JVM（Java虚拟机）的执行引擎是<strong>负责执行字节码</strong>的核心组件。它将编译器生成的Java字节码转换为具体平台上的机器码，并在运行时管理这些代码的执行。执行引擎的主要职责包括解释字节码、即时编译（JIT）、垃圾回收等。以下是JVM执行引擎的关键组成部分和工作机制。</p><h2><span id="基本组成">基本组成</span></h2><h3><span id="解释器interpreter">解释器（Interpreter）</span></h3><blockquote><p><strong>功能</strong>：逐条读取并解释执行Java字节码。<br> <strong>优点：</strong></p><ul><li>启动速度快，因为不需要预编译。</li><li>适合短生命周期的应用程序。</li></ul><p><strong>缺点：</strong></p><ul><li>执行效率较低，因为每次都需要重新解释字节码。</li></ul></blockquote><h3><span id="即时编译器just-in-time-compiler-jit">即时编译器（Just-In-Time Compiler, JIT）</span></h3><blockquote><p><strong>功能：</strong>将频繁执行的字节码片段编译成本地机器码，以提高执行效率。<br> <strong>工作原理：</strong></p><ul><li>在程序运行过程中，JIT会识别出“热点”方法（即经常被调用的方法），并将它们编译成本地机器码。</li><li>编译后的机器码可以直接由CPU执行，减少了解释执行的开销。</li></ul><p><strong>优点：</strong></p><ul><li>提高了频繁执行代码段的性能。</li><li>动态优化，适应不同的运行环境。</li></ul><p><strong>缺点：</strong></p><ul><li>初始启动时间较长，因为需要进行编译。</li><li>需要占用额外的内存来存储编译后的机器码。</li></ul></blockquote><h3><span id="垃圾回收器garbage-collector-gc">垃圾回收器（Garbage Collector, GC）</span></h3><blockquote><p><strong>功能：</strong>自动管理内存，回收不再使用的对象，释放内存资源。<br> <strong>常见GC算法：</strong></p><ul><li>Serial收集器：单线程执行，适用于单核CPU和对响应时间要求不高的应用。</li><li>Parallel收集器：多线程并行执行，适用于吞吐量优先的应用。</li><li>CMS（Concurrent Mark-Sweep）收集器：并发执行，减少停顿时间，适用于对响应时间要求较高的应用。</li><li>G1收集器：面向服务端应用，可设置停顿时间目标，适合需要低延迟的应用。</li><li>ZGC收集器：极低的暂停时间，适合大规模应用和大堆内存。</li></ul></blockquote><h2><span id="工作流程">工作流程</span></h2><h3><span id="1加载字节码">1.加载字节码：</span></h3><ul><li>类加载器（ClassLoader）将 .class 文件加载到JVM中，并将其转换为方法区中的类数据结构。</li></ul><h3><span id="2-链接linking">2. 链接（Linking）：</span></h3><ul><li>验证（Verification）：确保加载的字节码符合JVM规范，防止恶意代码或错误代码的执行。</li><li>准备（Preparation）：为类的静态变量分配内存，并设置默认初始值。</li><li>解析（Resolution）：将类、接口、字段和方法的符号引用转换为直接引用。</li></ul><h3><span id="3初始化initialization">3.初始化（Initialization）：</span></h3><ul><li>执行类构造器 <clinit> 方法，为静态变量赋初始值，并执行静态初始化块中的代码。</clinit></li></ul><h3><span id="4执行字节码">4.执行字节码：</span></h3><ul><li>解释器逐条解释执行字节码指令。</li><li>对于频繁执行的代码段，JIT编译器将其编译成本地机器码，以提高执行效率。</li></ul><h3><span id="5垃圾回收">5.垃圾回收：</span></h3><ul><li>当堆内存不足时，垃圾回收器会触发垃圾回收，清理不再使用的对象，释放内存资源。</li></ul><h2><span id="优化技术">优化技术</span></h2><p>VM执行引擎的优化技术旨在提升Java应用程序的执行效率和性能。这些技术包括但不限于：</p><ul><li>分层编译：结合解释器和JIT的优势，提供渐进式的编译优化。</li><li>内联：将方法调用替换为方法体本身，减少方法调用的开销。</li><li>逃逸分析：分析对象的作用域，决定是否栈上分配以减少垃圾回收开销。</li><li>锁优化：减少锁竞争，提高并发性能。</li><li>分支预测：提高条件语句的执行效率。</li><li>方法内联缓存：提高动态方法调用的效率。</li><li>常量折叠：在编译期间计算常量表达式的结果。</li><li>死代码消除：移除不会被执行的代码段。</li><li>循环展开：通过增加每次迭代处理的数据量，减少循环控制的开销。</li></ul><hr><h1><span id="补充">补充 ：</span></h1><p>JVM调优：<a href="https://blog.csdn.net/qq_40991313/article/details/132382094?ops_request_misc=%7B%22request_id%22:%22c7f9ea2322a06ee2ecc7b1b9b7bc46bc%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=c7f9ea2322a06ee2ecc7b1b9b7bc46bc&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-132382094-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=jvm%E8%B0%83%E4%BC%98&spm=1018.2226.3001.4187">JVM调优</a></p><p>JMM（内存模型）：<a href="https://blog.csdn.net/qq_25409421/article/details/131273163?ops_request_misc=%7B%22request_id%22:%22ec0000f3394d64b433b8213f739b94ae%22,%22scm%22:%2220140713.130102334..%22%7D&request_id=ec0000f3394d64b433b8213f739b94ae&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-2-131273163-null-null.142%5Ev102%5Epc_search_result_base7&utm_term=JMM&spm=1018.2226.3001.4187">Java内存模型JMM</a></p><hr><p> <strong>注意：</strong></p><p><strong>1.本篇文章中的图片来源于百度（侵删）</strong></p><p><strong>2.如有错误，欢迎指正。</strong></p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基础算法</title>
      <link href="/2025/04/20/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/"/>
      <url>/2025/04/20/%E5%9F%BA%E7%A1%80%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1><span id="快速排序">快速排序</span></h1><h2><span id="图解分析">图解分析：</span></h2><p><img src="/./../images/ef9263c3c1a20cf10aa5d1ed82b18646.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="模板">模板：</span></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//核心思想：分而治之</span></span><br><span class="line"><span class="comment">//函数参数：(需要处理的数组， 数组的左边界， 数组的右边界)</span></span><br><span class="line"><span class="comment">//函数：使得左边小于x, 右边大于x</span></span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//运用双指针，左指针指向的数小于x, 右指针指向的数大于x</span></span><br><span class="line">    <span class="type">int</span> x = (q[l] + q[r]) / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> i = l - <span class="number">1</span>, j = r + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span> i ++; <span class="keyword">while</span>(q[i] &lt; x);</span><br><span class="line">        <span class="keyword">do</span> j --; <span class="keyword">while</span>(q[j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) <span class="built_in">swap</span>(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//递归处理左右子区间</span></span><br><span class="line">    <span class="built_in">quick_sort</span>(q, l, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(q, j + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="大概思路">大概思路：</span></h2><p>​    1.<strong>分成子问题</strong>：将数组分为左边小于x， 右边大于x<br>​     2.<strong>递归处理子问题</strong>：递归处理左右子区间<br>​     3.<strong>子问题合并</strong></p><h2><span id="快速排序例题c版">快速排序例题（C++版）：</span></h2><h3><span id="acwing785快速排序">Acwing785.快速排序</span></h3><p><img src="/./../images/24255ed6c9d99433c2d8ded32cda269b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> x = (q[l] + q[r]) / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> i = l - <span class="number">1</span>, j = r + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span> i ++; <span class="keyword">while</span>(q[i] &lt; x);</span><br><span class="line">        <span class="keyword">do</span> j --; <span class="keyword">while</span>(q[j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) <span class="built_in">swap</span>(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">quick_sort</span>(q, l, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(q, j + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> q[N];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">quick_sort</span>(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, q[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="acwing786第k个数">Acwing786.第k个数<img src="/./../images/0b7b3d64c48142e6a57042b705bafa87.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">quick_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> ;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> x = (q[l] + q[r]) / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> i = l - <span class="number">1</span>, j = r + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">do</span> i ++; <span class="keyword">while</span>(q[i] &lt; x);</span><br><span class="line">        <span class="keyword">do</span> j --; <span class="keyword">while</span>(q[j] &gt; x);</span><br><span class="line">        <span class="keyword">if</span> (i &lt; j) <span class="built_in">swap</span>(q[i], q[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">quick_sort</span>(q, l, j);</span><br><span class="line">    <span class="built_in">quick_sort</span>(q, j + <span class="number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> q[N];</span><br><span class="line">    <span class="type">int</span> n, k;</span><br><span class="line">    <span class="built_in">scanf</span> (<span class="string">&quot;%d %d&quot;</span>, &amp;n, &amp;k);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">quick_sort</span>(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, q[k - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="归并排序">归并排序</span></h1><h2><span id="图解分析">图解分析：</span></h2><p><img src="/./../images/b98329e0d74852f966070388918916e4.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="模板">模板：</span></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//核心思想：分而治之</span></span><br><span class="line"><span class="comment">//函数参数:(需要处理的数组， 数组左边界， 数组右边界)</span></span><br><span class="line"><span class="comment">//函数:使得以mid下标两侧的区间有序</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="comment">//分成左右子区间:使得左右两个区间有序</span></span><br><span class="line">    <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">merge_sort</span>(q, l, mid);</span><br><span class="line">    <span class="built_in">merge_sort</span>(q, mid + <span class="number">1</span>, r);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//合并左右子区间</span></span><br><span class="line">    <span class="type">int</span> i = l;</span><br><span class="line">    <span class="type">int</span> j = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (q[i] &lt;= q[j]) tmp[k ++] = q[i ++];</span><br><span class="line">        <span class="keyword">else</span>  tmp[k ++] = q[j ++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) tmp[k ++] = q[i ++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= r) tmp[k ++] = q[j ++];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = l; i &lt; k; i ++, j ++) q[j] = tmp[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="大概思路">大概思路：</span></h2><p>​    1.<strong>分成子问题：</strong>以mid为分界线的左右区间有序<br>​     2.<strong>递归处理子问题</strong>：递归处理左右子区间<br>​     3.<strong>子问题合并：</strong>将左右区间有序数组合并</p><h2><span id="归并排序例题c版">归并排序例题（C++版）：</span></h2><h3><span id="acwing787归并排序">Acwing787.归并排序</span></h3><p><img src="/./../images/3bf91622a6effd24bea817df45a4bdec.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> tmp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> ;</span><br><span class="line">    <span class="comment">//分成子问题</span></span><br><span class="line">    <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">merge_sort</span>(q, l, mid);</span><br><span class="line">    <span class="built_in">merge_sort</span>(q, mid + <span class="number">1</span>, r);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//合并</span></span><br><span class="line">    <span class="type">int</span> i = l;</span><br><span class="line">    <span class="type">int</span> j = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (q[i] &lt;= q[j]) tmp[k ++] = q[i ++];</span><br><span class="line">        <span class="keyword">else</span>  tmp[k ++] = q[j ++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) tmp[k ++] = q[i ++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= r) tmp[k ++] = q[j ++];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = l; i &lt; k; i ++, j ++) q[j] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> q[N];</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">merge_sort</span>(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, q[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="acwing788逆序对的数量">Acwing788.逆序对的数量<img src="/./../images/4bcc3e137cfd5e3f83ae21caaa80f000.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><p><strong>解析：</strong></p><p> <img src="/./../images/2d03d22da4ea86bb49e3b6710881ef1d.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"><span class="type">int</span> q[N], tmp[N];</span><br><span class="line">LL len;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(<span class="type">int</span> q[], <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> ;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">merge_sort</span> (q, l, mid);</span><br><span class="line">    <span class="built_in">merge_sort</span> (q, mid + <span class="number">1</span>, r);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> i = l;</span><br><span class="line">    <span class="type">int</span> j = mid + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> k = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (q[i] &lt;= q[j]) tmp[k ++] = q[i ++];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            tmp[k ++] = q[j ++];</span><br><span class="line">            len += mid - i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= mid) tmp[k ++] = q[i ++];</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= r) tmp[k ++] = q[j ++];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>, j = l; i &lt; k; i ++, j ++ ) q[j] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q[i]);</span><br><span class="line">    <span class="built_in">merge_sort</span>(q, <span class="number">0</span>, n - <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="二分查找">二分查找</span></h1><h2><span id="图解分析">图解分析：</span></h2><p><img src="/./../images/84c779ffb1e256a063157504c21f802f.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="模板">模板：</span></h2><h3><span id="从左边开始找">从左边开始找：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> l = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> r = n - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (l &lt; r)</span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">     <span class="keyword">if</span> (a[mid] &gt;= x) r = mid;</span><br><span class="line">     <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="从右边开始找">从右边开始找：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">l = <span class="number">0</span>;</span><br><span class="line">r = n - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(l &lt; r)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> mid = (l + r + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (a[mid] &lt;= x) l = mid;</span><br><span class="line">    <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="大概思路">大概思路：</span></h2><p>​    <strong>根据a[mid]与x的大小关系，不断更新左右区间</strong></p><p><strong>当从右边开始找时，对于mid&#x3D;(l+r+1)的说明：</strong></p><blockquote><p>​        当 l 和 r 相邻时（即 r &#x3D; l + 1），使用 (l + r) &#x2F; 2 计算得到的 mid 会等于 l（因为整数除法向下取整）。如果条件判断使得 l 更新为 mid，那么实际上 l 没有发生变化，导致 l 和 r 始终保持相邻状态，形成死循环。通过将 mid 的计算公式改为 (l + r + 1) &#x2F; 2，可以确保 mid 等于 r，从而在下一次迭代中可以正确地更新 l 或 r，避免死循环。</p></blockquote><h2><span id="二分法例题c版"><strong>二分法例题（C++版）：</strong></span></h2><h3><span id="acing789数的范围"><strong>Acing789.数的范围</strong></span></h3><p><img src="/./../images/5c2f48c3bc18310873385db25fbe66fa.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;q);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> a[N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="keyword">while</span> (q --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> l = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> r = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (a[mid] &gt;= x) r = mid;</span><br><span class="line">            <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (a[l] != x) <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>, <span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, l);</span><br><span class="line">            </span><br><span class="line">        l = <span class="number">0</span>;</span><br><span class="line">        r = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(l &lt; r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> mid = (l + r + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (a[mid] &lt;= x) l = mid;</span><br><span class="line">            <span class="keyword">else</span> r = mid - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="acwing790数的三次方根">Acwing790.数的三次方根</span></h3><h3><span id><img src="/./../images/ba5ad954e3727ec46ea98737f174b62c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> x;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;x);</span><br><span class="line">    </span><br><span class="line">    <span class="type">double</span> l = <span class="number">-10000</span>;</span><br><span class="line">    <span class="type">double</span> r = <span class="number">10000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (r - l &gt;= <span class="number">1e-8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (mid * mid * mid  &gt;= x) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.6lf\n&quot;</span>, l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="高精度运算">高精度运算</span></h1><h2><span id="加法">加法：</span></h2><h3><span id="核心思想">核心思想：</span></h3><p>​    <strong>1.将数字当成字符串读入</strong></p><p>​    <strong>2.字符串转换成数组(从低位向高位)</strong></p><p>​    <strong>3.数组每个数字相加(注意有进位)</strong></p><h3><span id="模板"><strong>模板：</strong></span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">add</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, vector&lt;<span class="type">int</span>&gt; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res; <span class="comment">//存储加法结果</span></span><br><span class="line">    <span class="keyword">if</span> (x.<span class="built_in">size</span>() &lt; y.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="built_in">add</span>(y, x);</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t += x[i];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; y.<span class="built_in">size</span>()) t += y[i];</span><br><span class="line">        res.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t) res.<span class="built_in">push_back</span>(t);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="高精度加法例题">高精度加法例题：</span></h3><h4><span id="acwing791高精度加法">Acwing791.高精度加法</span></h4><p><img src="/./../images/832db261659d988ca49778da741a0204.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>C++:</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">add</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, vector&lt;<span class="type">int</span>&gt; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res; <span class="comment">//存储加法结果</span></span><br><span class="line">    <span class="keyword">if</span> (x.<span class="built_in">size</span>() &lt; y.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="built_in">add</span>(y, x);</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t += x[i];</span><br><span class="line">        <span class="keyword">if</span> (i &lt; y.<span class="built_in">size</span>()) t += y[i];</span><br><span class="line">        res.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (t) res.<span class="built_in">push_back</span>(t);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; x, y;</span><br><span class="line">    string a, b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) x.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = b.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) y.<span class="built_in">push_back</span>(b[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res = <span class="built_in">add</span>(x, y);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = res.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) cout &lt;&lt; res[i];</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>C:</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100010</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> a[N], b[N];</span><br><span class="line"><span class="type">int</span> x[N], y[N];</span><br><span class="line"><span class="type">int</span> la, lb;</span><br><span class="line"><span class="type">int</span> ans[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> y[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>; <span class="comment">// 表示进位</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; la || i &lt; lb; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> sum = x[i] + y[i] + t; <span class="comment">// 当前加数之和</span></span><br><span class="line">        ans[i] = sum % <span class="number">10</span>;</span><br><span class="line">        t = sum / <span class="number">10</span>; <span class="comment">// 进位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, a, b);</span><br><span class="line">    </span><br><span class="line">    la = <span class="built_in">strlen</span>(a);</span><br><span class="line">    lb = <span class="built_in">strlen</span>(b);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = la - <span class="number">1</span>, t = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i --, t ++) x[t] = a[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = lb - <span class="number">1</span>, t = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i --, t ++) y[t] = b[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">add</span>(x, y); <span class="comment">// x + y</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (t) <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, t);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> len = la &gt; lb ? la : lb;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --) <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans[i]);</span><br><span class="line">        </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="减法">减法：</span></h2><h3><span id="核心思想">核心思想：</span></h3><p>​    <strong>1.将数字按照字符串读入</strong></p><p>​    <strong>2.字符串转化为数组</strong></p><p>​    <strong>3.比较两个数字大小</strong></p><p>​    <strong>4.两个数字相减，大数减小数</strong></p><p>​    <strong>5.去掉前导0</strong></p><h3><span id="模板">模板：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//比较x与y的大小</span></span><br><span class="line"><span class="comment">// x &gt;= y 返回true</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, vector&lt;<span class="type">int</span>&gt; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x.<span class="built_in">size</span>() != y.<span class="built_in">size</span>()) <span class="keyword">return</span> x.<span class="built_in">size</span>() &gt; y.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = x.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- )</span><br><span class="line">        <span class="keyword">if</span> (x[i] != y[i]) <span class="keyword">return</span> x[i] &gt; y[i];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sub</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, vector&lt;<span class="type">int</span>&gt; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t = x[i] - t;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; y.<span class="built_in">size</span>()) t -= y[i];</span><br><span class="line">        res.<span class="built_in">push_back</span>((t + <span class="number">10</span>) % <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (t &lt; <span class="number">0</span>) t = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> t = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前缀0去掉</span></span><br><span class="line">    <span class="keyword">while</span> (res.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; res.<span class="built_in">back</span>() == <span class="number">0</span>) res.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="高精度减法例题">高精度减法例题：</span></h3><h4><span id="acwing792高精度减法">Acwing792.高精度减法</span></h4><p><img src="/./../images/b409e9a2a4b97a329ab56d2142143a12.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>C++代码：</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//比较x与y的大小</span></span><br><span class="line"><span class="comment">// x &gt;= y 返回true</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, vector&lt;<span class="type">int</span>&gt; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x.<span class="built_in">size</span>() != y.<span class="built_in">size</span>()) <span class="keyword">return</span> x.<span class="built_in">size</span>() &gt; y.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = x.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- )</span><br><span class="line">        <span class="keyword">if</span> (x[i] != y[i]) <span class="keyword">return</span> x[i] &gt; y[i];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sub</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, vector&lt;<span class="type">int</span>&gt; y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t = x[i] - t;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; y.<span class="built_in">size</span>()) t -= y[i];</span><br><span class="line">        res.<span class="built_in">push_back</span>((t + <span class="number">10</span>) % <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (t &lt; <span class="number">0</span>) t = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> t = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//前缀0去掉</span></span><br><span class="line">    <span class="keyword">while</span> (res.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; res.<span class="built_in">back</span>() == <span class="number">0</span>) res.<span class="built_in">pop_back</span>();</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string a, b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">    </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; x, y;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) x.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = b.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) y.<span class="built_in">push_back</span>(b[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">cmp</span>(x, y)) res = <span class="built_in">sub</span>(x, y);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">        res = <span class="built_in">sub</span>(y, x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = res.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- )</span><br><span class="line">        cout &lt;&lt; res[i];</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>C语言代码：</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100010</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> a[N], b[N];</span><br><span class="line"><span class="type">int</span> x[N], y[N];</span><br><span class="line"><span class="type">int</span> la, lb;</span><br><span class="line"><span class="type">int</span> ans[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> y[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (la &gt; lb) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (lb &gt; la) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = la - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (x[i] &gt; y[i]) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (y[i] &gt; x[i]) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">remov</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> y[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>; <span class="comment">// 表示借位</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; la || i &lt; lb; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        x[i] -= t;</span><br><span class="line">        <span class="keyword">if</span> (x[i] &lt; y[i]) t = <span class="number">1</span>; <span class="comment">// 借一位</span></span><br><span class="line">        <span class="keyword">else</span> t = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sum = x[i] - y[i] + t * <span class="number">10</span>;</span><br><span class="line">        ans[i] = sum % <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>, a, b);</span><br><span class="line">    </span><br><span class="line">    la = <span class="built_in">strlen</span>(a);</span><br><span class="line">    lb = <span class="built_in">strlen</span>(b);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = la - <span class="number">1</span>, t = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i --, t ++) x[t] = a[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = lb - <span class="number">1</span>, t = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i --, t ++) y[t] = b[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">cmp</span>(x, y);</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span> (<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (t == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">remov</span>(x, y);</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = la - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ans[i] != <span class="number">0</span>) flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (flag) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">remov</span>(y, x);</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = lb - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ans[i] != <span class="number">0</span>) flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (flag) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="乘法">乘法：</span></h2><h3><span id="核心思想">核心思想：</span></h3><p>​    <strong>1.规模大的数字按照字符串读入</strong></p><p>​    <strong>2.将字符串转化为数组</strong></p><p>​    <strong>3.将数组中的每一个数与数字相乘</strong></p><h3><span id="模版">模版：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">mul</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, <span class="type">int</span> y)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t += x[i] * y;</span><br><span class="line">        res.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (t)</span><br><span class="line">    &#123;</span><br><span class="line">        res.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="高精度乘法例题">高精度乘法例题：</span></h3><h4><span id="acwing793高精度乘法">Acwing793.高精度乘法</span></h4><p><img src="/./../images/c943def1fbdc0a3993cf30280e7ed662.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>C++代码：</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">mul</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, <span class="type">int</span> y)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t += x[i] * y;</span><br><span class="line">        res.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (t)</span><br><span class="line">    &#123;</span><br><span class="line">        res.<span class="built_in">push_back</span>(t % <span class="number">10</span>);</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) x.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res = <span class="built_in">mul</span>(x, b);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = res.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) cout &lt;&lt; res[i];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>C语言：</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100010</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> a[N];</span><br><span class="line"><span class="type">int</span> x[N], b;</span><br><span class="line"><span class="type">int</span> l;</span><br><span class="line"><span class="type">int</span> ans[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fuc</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>; <span class="comment">//进位</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; l; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> sum =  x[i] * b + t;</span><br><span class="line">        ans[i] = sum % <span class="number">10</span>;</span><br><span class="line">        t = sum / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, a, &amp;b);</span><br><span class="line">    </span><br><span class="line">    l = <span class="built_in">strlen</span>(a);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l - <span class="number">1</span>, t = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i --) x[t ++] = a[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span> || (l == <span class="number">1</span> &amp;&amp; x[<span class="number">0</span>] == <span class="number">0</span>)) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">fuc</span>(x, b);</span><br><span class="line">    <span class="keyword">if</span> (t) <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = l - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans[i]);</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="除法">除法：</span></h2><h3><span id="核心思想">核心思想：</span></h3><p>​     <strong>1.规模大的数字按照字符串读入</strong></p><p>​     <strong>2.将字符串转化为数组</strong></p><p>​     <strong>3.将数组中的每一个数与数字相除</strong></p><p>​    <strong>4.去除前导0</strong></p><h3><span id="模板">模板：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> t;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">divide</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t = t * <span class="number">10</span> + x[i];</span><br><span class="line">        res.<span class="built_in">push_back</span>(t / b);</span><br><span class="line">        t = t % b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(), res.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (res.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; res.<span class="built_in">back</span>() == <span class="number">0</span>) res.<span class="built_in">pop_back</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="高精度除法例题">高精度除法例题：</span></h3><h4><span id="acwing794高精度除法">Acwing794.高精度除法</span></h4><p><img src="/./../images/92ec94f959e4fdb7720e4e523f92693e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>C++：</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> t;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">divide</span><span class="params">(vector&lt;<span class="type">int</span>&gt; x, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; x.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        t = t * <span class="number">10</span> + x[i];</span><br><span class="line">        res.<span class="built_in">push_back</span>(t / b);</span><br><span class="line">        t = t % b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">reverse</span>(res.<span class="built_in">begin</span>(), res.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (res.<span class="built_in">size</span>() &gt; <span class="number">1</span> &amp;&amp; res.<span class="built_in">back</span>() == <span class="number">0</span>) res.<span class="built_in">pop_back</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">    </span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; x;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = a.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) x.<span class="built_in">push_back</span>(a[i] - <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="built_in">reverse</span>(x.<span class="built_in">begin</span>(), x.<span class="built_in">end</span>());</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; res = <span class="built_in">divide</span>(x, b);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = res.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i -- ) cout &lt;&lt; res[i];</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>C语言：</strong> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 100010</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> a[N];</span><br><span class="line"><span class="type">int</span> x[N], b;</span><br><span class="line"><span class="type">int</span> l;</span><br><span class="line"><span class="type">int</span> ans[N];</span><br><span class="line"><span class="type">int</span> tmp[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> t = b;</span><br><span class="line">    <span class="keyword">while</span> (t)</span><br><span class="line">    &#123;</span><br><span class="line">        tmp[cnt ++] = t % <span class="number">10</span>;</span><br><span class="line">        t /= <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (cnt &gt; l) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (cnt &lt; l) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = cnt - <span class="number">1</span>, j = <span class="number">0</span>; i &gt;= <span class="number">0</span>; i --, j ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (tmp[i] &gt; x[j]) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">fuc</span><span class="params">(<span class="type">int</span> x[], <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; l; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> sum = x[i] + t * <span class="number">10</span>;</span><br><span class="line">        ans[i] = sum / b;</span><br><span class="line">        t = sum % b;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%d&quot;</span>, a, &amp;b);</span><br><span class="line">    </span><br><span class="line">    l = <span class="built_in">strlen</span>(a);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; l; i ++) x[i] = a[i] - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">    <span class="type">int</span> t = <span class="built_in">fuc</span>(x, b);</span><br><span class="line">    <span class="comment">// b &gt; a</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">cmp</span>(x, b)) <span class="built_in">printf</span>(<span class="string">&quot;0\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; l; i ++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ans[i] != <span class="number">0</span>) flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (flag) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, ans[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, t);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="前缀和与差分">前缀和与差分</span></h1><h2><span id="一维前缀和">一维前缀和：</span></h2><h3><span id="图解分析">图解分析：</span></h3><p><img src="/./../images/a68776a65ef2519a118353f2881d078e.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="模板">模板：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prefix_and</span><span class="params">(<span class="type">int</span> a[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )  sum[i] = sum[i - <span class="number">1</span>] + a[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sum[r] - sum[l - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="一维前缀和例题c版">一维前缀和例题（C++版）：</span></h3><h4><span id="acwing795前缀和">Acwing795.前缀和</span></h4><p><img src="/./../images/9c2732e368e2595792c595b97de4e44e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> sum[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prefix_and</span><span class="params">(<span class="type">int</span> a[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )  sum[i] = sum[i - <span class="number">1</span>] + a[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sum[r] - sum[l - <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">   </span><br><span class="line">    <span class="type">int</span> a[N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="built_in">Prefix_and</span>(a);</span><br><span class="line">    <span class="keyword">while</span> (m --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">Sum</span>(l, r) &lt;&lt; endl;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="二维前缀和">二维前缀和：</span></h2><h3><span id="图解分析">图解分析：</span></h3><p><img src="/./../images/c040869bc0139f21e5b5a09d252206eb.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="模板">模板：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> sum[N][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prefix_and</span><span class="params">(<span class="type">int</span> a[N][N])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">            sum[i][j] = sum[i - <span class="number">1</span>][j] + sum[i][j - <span class="number">1</span>] - sum[i - <span class="number">1</span>][j - <span class="number">1</span>] + a[i][j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res = sum[x2][y2] - sum[x2][y1 - <span class="number">1</span>] - sum[x1 - <span class="number">1</span>][y2] + sum[x1 - <span class="number">1</span>][y1 - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="二维前缀和例题c版">二维前缀和例题（C++版）：</span></h3><h4><span id="acwing796子矩阵的和">Acwing796.子矩阵的和</span></h4><p><img src="/./../images/f5de50d061b13456ca16084627868f67.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> sum[N][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Prefix_and</span><span class="params">(<span class="type">int</span> a[N][N])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">            sum[i][j] = sum[i - <span class="number">1</span>][j] + sum[i][j - <span class="number">1</span>] - sum[i - <span class="number">1</span>][j - <span class="number">1</span>] + a[i][j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Sum</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> res = sum[x2][y2] - sum[x2][y1 - <span class="number">1</span>] - sum[x1 - <span class="number">1</span>][y2] + sum[x1 - <span class="number">1</span>][y1 - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> q;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; q;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> a[N][N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">            cin &gt;&gt; a[i][j];</span><br><span class="line">    <span class="built_in">Prefix_and</span>(a);</span><br><span class="line">    <span class="keyword">while</span> (q --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x1, y1, x2, y2;</span><br><span class="line">        cin &gt;&gt; x1 &gt;&gt; y1 &gt;&gt; x2 &gt;&gt; y2;</span><br><span class="line">        </span><br><span class="line">        cout &lt;&lt; <span class="built_in">Sum</span>(x1, y1, x2, y2) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="一维差分">一维差分：</span></h2><h3><span id="图解分析">图解分析：</span></h3><p><strong>对于差分数组b，可以看作b求前缀和就等于a</strong></p><p><strong>对于给定区间[l, r]， 每一个数都加上c：</strong></p><p>​    <strong>b[l] + c 可以使得 a[l ~ n]的每一个数都加上c</strong></p><p>​    <strong>b[r + 1] - c 可以使得 a[r + 1 ~ n] 的每一个数都减上c</strong></p><p><img src="/./../images/af32cd6bcd979a88df2d14b2ffb46e52.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="模板">模板：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    b[l] += c;</span><br><span class="line">    b[r + <span class="number">1</span>] -= c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="一维差分例题c版">一维差分例题（C++版）：</span></h3><p><img src="/./../images/aee30a1cabca7d52fb481b7b024d9c00.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100010</span>;</span><br><span class="line"><span class="type">int</span> a[N], b[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    b[l] += c;</span><br><span class="line">    b[r + <span class="number">1</span>] -= c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) cin &gt;&gt; a[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ ) <span class="built_in">insert</span>(i, i, a[i]);</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">while</span> (m --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r, c;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r &gt;&gt; c;</span><br><span class="line">        <span class="built_in">insert</span>(l, r, c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span> ; i &lt;= n; i ++ ) </span><br><span class="line">    &#123;</span><br><span class="line">        b[i] += b[i - <span class="number">1</span>];</span><br><span class="line">        cout &lt;&lt; b[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="二维差分">二维差分：</span></h2><h3><span id="图解分析">图解分析：</span></h3><p><img src="/./../images/34d721857a49f666824471558a713319.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="模板">模板：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[N][N], b[N][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    b[x1][y1] += c;</span><br><span class="line">    b[x1][y2 + <span class="number">1</span>] -= c;</span><br><span class="line">    b[x2 + <span class="number">1</span>][y1] -= c;</span><br><span class="line">    b[x2 + <span class="number">1</span>][y2 + <span class="number">1</span>] += c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="二维差分例题c版">二维差分例题（C++版）：</span></h3><h4><span id="acwing798差分矩阵">Acwing798.差分矩阵</span></h4><p><img src="/./../images/73509df855f4b51037b7a3a2a32d0ef6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1010</span>;</span><br><span class="line"><span class="type">int</span> a[N][N], b[N][N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> x1, <span class="type">int</span> y1, <span class="type">int</span> x2, <span class="type">int</span> y2, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    b[x1][y1] += c;</span><br><span class="line">    b[x1][y2 + <span class="number">1</span>] -= c;</span><br><span class="line">    b[x2 + <span class="number">1</span>][y1] -= c;</span><br><span class="line">    b[x2 + <span class="number">1</span>][y2 + <span class="number">1</span>] += c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m, q;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;n, &amp;m, &amp;q);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i][j]);</span><br><span class="line">            <span class="built_in">insert</span>(i, j, i, j, a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">while</span> (q --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x1, y1, x2, y2, c;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d%d&quot;</span>, &amp;x1, &amp;y1, &amp;x2, &amp;y2, &amp;c);</span><br><span class="line">        <span class="built_in">insert</span>(x1, y1, x2, y2, c);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">            b[i][j] = b[i - <span class="number">1</span>][j] + b[i][j - <span class="number">1</span>] - b[i - <span class="number">1</span>][j - <span class="number">1</span>] + b[i][j];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= m; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, b[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="双指针算法">双指针算法</span></h1><h2><span id="核心思想">核心思想：</span></h2><p><img src="/./../images/8284cd3aa7697e71f81451f2d7af6d31.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="模板"><strong>模板：</strong></span></h2><p>​        <strong>双指针是一种思想，没有具体模板</strong></p><h2><span id="双指针算法例题c版">双指针算法例题（C++版）：</span></h2><h3><span id="acwing799最长连续不重复子序列">Acwing799.最长连续不重复子序列</span></h3><p><img src="/./../images/349bf0a127595358f5046b6a3d6acd72.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="分析">分析：</span></h4><p><img src="/./../images/18d317868b782cf36204cc14f5574953.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="代码">代码：</span></h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> s[N];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> a[N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        s[a[i]] ++;</span><br><span class="line">        <span class="keyword">while</span> (s[a[i]] &gt; <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            s[a[j]] --;</span><br><span class="line">            j ++;</span><br><span class="line">        &#125;    </span><br><span class="line">        res = <span class="built_in">max</span>(res, i - j + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; res &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="acwing800数组元素的目标和">Acwing800.数组元素的目标和</span></h3><h3><span id><img src="/./../images/acb566d469d031e49af1a7a8e746c509.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m, x;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; x;</span><br><span class="line">    </span><br><span class="line">    LL a[N], b[N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) cin &gt;&gt; a[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ ) cin &gt;&gt; b[i];</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> j = m - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (j &gt;= <span class="number">0</span> &amp;&amp; a[i] + b[j] &gt; x) j --;</span><br><span class="line">        <span class="keyword">if</span> (a[i] + b[j] == x) cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; j &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="acwing2816判断子序列">Acwing2816.判断子序列</span></h3><p><img src="/./../images/88981faada3cd9aed4c3e0da47170a72.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> a[N], b[N];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ ) cin &gt;&gt; a[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++ ) cin &gt;&gt; b[i];</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; n &amp;&amp; j &lt; m)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] == b[j]) i ++;</span><br><span class="line">        j ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == n) <span class="built_in">puts</span>(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="位运算">位运算</span></h1><h2><span id="位运算的基本知识">位运算的基本知识：</span></h2><p><img src="/./../images/f21502f290fc7ab5b7946949a0917510.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="位运算常用操作">位运算常用操作：</span></h2><h3><span id="1求x的第k位数字">1.求x的第k位数字：</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x &gt;&gt; k &amp; <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="2返回x的最后一位1">2.返回x的最后一位1:</span></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lowbit</span>(x) = x &amp; -x;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="位运算例题c版">位运算例题（C++版）：</span></h2><h3><span id="acwing801二进制中1的个数">Acwing801.二进制中1的个数</span></h3><p><img src="/./../images/07e9c3f02fc4b6061e51b279dba579d3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x &amp; -x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (n --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin &gt;&gt; x;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (x)</span><br><span class="line">        &#123;</span><br><span class="line">            x -= <span class="built_in">lowbit</span>(x);</span><br><span class="line">            cnt ++;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; cnt &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="离散化">离散化</span></h1><h2><span id="运用离散化的题目特点">运用离散化的题目特点：</span></h2><p>​    <strong>值域大，个数少。</strong></p><h2><span id="核心思路">核心思路：</span></h2><p>​    <strong>1.用可变数组存储所有的下标，按大小排序后去重</strong></p><p>​    <strong>2.用二分查找的方法，查找出离散后的坐标，构造离散化以后的数组</strong></p><h2><span id="去重模板c">去重模板（C++）：</span></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sort</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>());</span><br><span class="line">alls.<span class="built_in">erase</span>(<span class="built_in">unique</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>()), alls.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="二分查找模板">二分查找模板：</span></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;<span class="type">int</span>&gt; alls;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = alls.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (alls[mid] &gt;= x) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> l + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="离散化例题c版">离散化例题（C++版）：</span></h2><h3><span id="acwing802区间和">Acwing802.区间和</span></h3><p><img src="/./../images/900db8ecdcb9809377dc638aa40ab455.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">300010</span>;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> a[N], s[N];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; alls;</span><br><span class="line">vector&lt;PII&gt; add, query;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = alls.<span class="built_in">size</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (l &lt; r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (alls[mid] &gt;= x) r = mid;</span><br><span class="line">        <span class="keyword">else</span> l = mid + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> l + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">while</span> (n --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x, c;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; c;</span><br><span class="line">        alls.<span class="built_in">push_back</span>(x);</span><br><span class="line">        </span><br><span class="line">        add.<span class="built_in">push_back</span>(&#123;x, c&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (m --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        alls.<span class="built_in">push_back</span>(l);</span><br><span class="line">        alls.<span class="built_in">push_back</span>(r);</span><br><span class="line">        </span><br><span class="line">        query.<span class="built_in">push_back</span>(&#123;l, r&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//去重</span></span><br><span class="line">    <span class="built_in">sort</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>());</span><br><span class="line">    alls.<span class="built_in">erase</span>(<span class="built_in">unique</span>(alls.<span class="built_in">begin</span>(), alls.<span class="built_in">end</span>()), alls.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> item: add)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> k = <span class="built_in">find</span>(item.first);</span><br><span class="line">        a[k] = item.second;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= alls.<span class="built_in">size</span>(); i ++ ) s[i] = s[i - <span class="number">1</span>] + a[i];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> item: query)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l = <span class="built_in">find</span>(item.first), r = <span class="built_in">find</span>(item.second);</span><br><span class="line">        </span><br><span class="line">        cout &lt;&lt; s[r] - s[l - <span class="number">1</span>] &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="区间合并">区间合并</span></h1><h2><span id="图解分析">图解分析：</span></h2><p><img src="/./../images/3b55a6166912d7d4c8ef29977add38cf.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="模板c">模板（C++）：</span></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;PII&gt; segs, res;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(vector&lt;PII&gt; segs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(segs.<span class="built_in">begin</span>(), segs.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> st = <span class="number">-2e9</span>, ed = <span class="number">-2e9</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> item : segs)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ed &lt; item.first)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ed != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">            st = item.first;</span><br><span class="line">            ed = item.second;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ed = <span class="built_in">max</span>(ed, item.second);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (st != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="区间合并例题c版">区间合并例题（C++版）：</span></h2><h3><span id="acwing803区间合并">Acwing803.区间合并</span></h3><p><img src="/./../images/11fe057bdeff2944878f79ccbd8ec64f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; PII;</span><br><span class="line"></span><br><span class="line">vector&lt;PII&gt; segs, res;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(vector&lt;PII&gt; segs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(segs.<span class="built_in">begin</span>(), segs.<span class="built_in">end</span>());</span><br><span class="line">    <span class="type">int</span> st = <span class="number">-2e9</span>, ed = <span class="number">-2e9</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> item : segs)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ed &lt; item.first)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ed != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">            st = item.first;</span><br><span class="line">            ed = item.second;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ed = <span class="built_in">max</span>(ed, item.second);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (st != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (n --)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">        segs.<span class="built_in">push_back</span>(&#123;l, r&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">merge</span>(segs);</span><br><span class="line">    cout &lt;&lt; res.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><p><strong>如有错误，欢迎指正！！！</strong> </p><p><a href="https://blog.csdn.net/m0_73569492/article/details/139204460?spm=1001.2014.3001.5501">所有笔记总结目录-CSDN博客</a></p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java并发编程4（JUC篇）</title>
      <link href="/2025/04/20/JUC4/"/>
      <url>/2025/04/20/JUC4/</url>
      
        <content type="html"><![CDATA[<p>本篇文章重点介绍JUC（java.util.concurrent）</p><blockquote><p>JUC是”java.util.concurrent”包的简称，它是Java提供的一个并发工具包，旨在简化多线程编程，提供了丰富的类和接口来帮助开发者更高效、更安全地编写并发程序。JUC包增强了Java对并发的支持，解决了传统多线程编程中的一些难题，如死锁、竞争条件和资源管理等。</p></blockquote><p><img src="/./../images/724cf2c283f5497fa5c3ea2f214defce.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h1><span id="原子变量">原子变量</span></h1><h2><span id="基本类型原子变量"><img src="/./../images/0bd58f04fc6144f484a107320868af9a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  基本类型原子变量</span></h2><blockquote><p>AtomicInteger</p><ul><li>提供对整型值的原子操作，如加法、减法等。</li><li>方法示例：incrementAndGet(), decrementAndGet(), addAndGet(int delta), compareAndSet(int expect, int update)。</li></ul><p>AtomicLong</p><ul><li>类似于AtomicInteger，但是针对长整型（long）值。</li><li>方法与AtomicInteger相似，适用于需要处理较大数值的情况。</li></ul><p>AtomicBoolean</p><ul><li>支持布尔类型的原子操作。</li><li>方法示例：get(), set(boolean newValue), compareAndSet(boolean expect, boolean update)。</li></ul></blockquote><h2><span id="对象引用原子变量">对象引用原子变量</span></h2><blockquote><p>AtomicReference<v></v></p><ul><li>用于对象引用的原子更新。</li><li>方法示例：get(), set(V newValue), compareAndSet(V expect, V update)。</li></ul><p>AtomicStampedReference<v></v></p><ul><li>带版本号的对象引用原子变量，解决ABA问题。</li><li>方法示例：get(), set(V newValue, int newStamp), compareAndSet(V expectedReference, V newReference, int expectedStamp, int newStamp)。</li></ul><p>AtomicMarkableReference<v></v></p><ul><li>带标记位的对象引用原子变量，适用于需要记录是否发生过变化的情况。</li><li>方法示例：getReference(), isMarked(), compareAndSet(V expectedReference, V newReference, boolean expectedMark, boolean newMark)。</li></ul></blockquote><h2><span id="数组类型的原子变量">数组类型的原子变量</span></h2><blockquote><p>AtomicIntegerArray</p><ul><li>提供对整型数组元素的原子操作。</li><li>方法示例：get(int i), set(int i, int newValue), incrementAndGet(int i), compareAndSet(int i, int expect, int update)。</li></ul><p>AtomicLongArray</p><ul><li>类似于AtomicIntegerArray，但针对长整型数组。</li><li>方法与AtomicIntegerArray相似。</li></ul><p>AtomicReferenceArray<v></v></p><ul><li>提供对对象引用数组元素的原子操作。</li><li>方法示例：get(int i), set(int i, V newValue), compareAndSet(int i, V expect, V update)。</li></ul></blockquote><h2><span id="字段更新器">字段更新器</span></h2><blockquote><p>AtomicIntegerFieldUpdater<t></t></p><ul><li>提供对现有对象字段进行原子更新的能力，无需直接使用原子变量。</li><li>使用时需注意字段必须是volatile类型，并且不能是private。</li></ul><p>AtomicLongFieldUpdater<t></t></p><ul><li>类似于AtomicIntegerFieldUpdater，但适用于长整型字段。</li></ul><p>AtomicReferenceFieldUpdater&lt;T, V&gt;</p><ul><li>提供对对象引用字段的原子更新能力。</li></ul></blockquote><h2><span id="atomicstampedreference">AtomicStampedReference<v></v></span></h2><h3><span id="介绍">介绍：</span></h3><p>解决了ABA问题的一种原子引用实现，通过引入版本号（称为“邮票”）来区分即使是相同的对象引用也可能是不同的状态。</p><p>典型应用场景：解决复杂的并发控制问题，特别是在可能出现ABA问题的场合。<br> 常用方法：getReference() 和 getStamp() 获取引用及其版本号；compareAndSet(V expectedReference, V newReference, int expectedStamp, int newStamp) 进行带有版本检查的更新。</p><h3><span id="aba问题的描述">ABA问题的描述</span></h3><p>假设有一个共享变量A，其初始值为A。现在有两个线程Thread 1和Thread 2同时操作这个变量：</p><ul><li>Thread 1读取变量的值A。</li><li>在Thread 1执行其他操作期间，Thread 2首先将变量的值从A改为B，然后又改回A。</li><li>当Thread 1尝试使用类似compareAndSet(A, newValue)的操作来更新变量时，它会发现当前变量的值仍然是A，因此认为在这段时间内没有其他线程修改过该变量，并继续执行更新操作。</li><li>但实际上，在这段时间里，变量已经经历了从A到B再到A的变化过程，这可能导致程序逻辑上的错误或数据不一致的情况。</li></ul><h3><span id="aba问题的具体场景">ABA问题的具体场景</span></h3><p>设想有三个线程：Thread 1、Thread 2 和 Thread 3，以及初始栈结构如下：</p><p>栈顶 -&gt; A(10) -&gt; B(20) -&gt; null</p><p>现在考虑以下执行顺序：</p><p><strong>1.Thread 1 开始执行pop()操作：</strong></p><ul><li>它读取到当前栈顶为A(10)。</li><li>在获取A.next之前被抢占。</li></ul><p><strong>2.Thread 2 执行两次pop()操作</strong></p><ul><li>弹出了A(10)和B(20)，然后又压入了C(30)和A(10)，使得栈变为：栈顶 -&gt; A(10) -&gt; C(30) -&gt; null</li></ul><p><strong>3.Thread 1 恢复执行：</strong></p><ul><li>它继续执行，发现A.next指向的是B(20)（这是它最初看到的状态），但实际上现在的A.next指向的是C(30)。</li><li>当它尝试使用CAS将栈顶从A(10)改为B(20)时，由于此时栈顶确实是A(10)，CAS操作成功。</li><li>结果是，栈变成了B(20) -&gt; C(30) -&gt; null，而实际上应该保持为A(10) -&gt; C(30) -&gt; null。</li></ul><h3><span id="源码分析">源码分析</span></h3><h4><span id="构造方法">构造方法</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化一个带有时间戳的原子引用对象</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialRef 初始引用对象，表示要被引用的对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialStamp 初始时间戳，用于检测和防止虚假冲突</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 使用Pair.of方法来创建并初始化一个Pair对象，该Pair对象包含了引用对象和时间戳</span></span><br><span class="line"><span class="comment"> * 这个构造方法允许用户在创建AtomicStampedReference对象时指定初始的引用对象和时间戳</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicStampedReference</span><span class="params">(V initialRef, <span class="type">int</span> initialStamp)</span> &#123;</span><br><span class="line">    pair = Pair.of(initialRef, initialStamp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>这个pair通过volitaile修饰的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个泛型类，用于存储一个引用及其关联的版本戳。</span></span><br><span class="line"><span class="comment"> * 主要用途是封装对实际对象的引用和一个表示版本的整数，</span></span><br><span class="line"><span class="comment"> * 允许程序通过比较版本戳来确定引用是否被修改。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; 引用的类型，表示该类可以用于任何对象类型。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Pair</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">final</span> T reference; <span class="comment">// 存储的引用对象</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> stamp;   <span class="comment">// 关联的版本戳</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数，用于创建 Pair 对象。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> reference 要存储的对象引用。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stamp 关联的版本戳，用于表示对象的状态或版本。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Pair</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.reference = reference;</span><br><span class="line">        <span class="built_in">this</span>.stamp = stamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态工厂方法，用于创建 Pair 对象。</span></span><br><span class="line"><span class="comment">     * 该方法提供了一种更灵活的方式来创建 Pair 对象，简化了实例化过程。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> reference 要存储的对象引用。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stamp 关联的版本戳。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个包含给定引用和版本戳的 Pair 对象。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; Pair&lt;T&gt; <span class="title function_">of</span><span class="params">(T reference, <span class="type">int</span> stamp)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pair</span>&lt;T&gt;(reference, stamp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 一个 volatile 的 Pair 对象，用于存储对象引用及其对应的版本戳。</span></span><br><span class="line"><span class="comment"> * 声明为 volatile 以确保多个线程可以安全地访问这个 Pair 对象，</span></span><br><span class="line"><span class="comment"> * 维护对该变量的写操作的可见性和顺序性。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> Pair&lt;V&gt; pair;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="compareandset">compareAndSet</span></h4><blockquote><p>&#x2F;**<br> * 使用原子方式比较并设置引用和戳<br> * 此方法用于在当前引用和戳与预期值匹配时，将引用和戳更新为新值<br> * 它是实现非阻塞算法的关键，特别是在并发控制中<br> *<br> * @param expectedReference 预期的引用值<br> * @param newReference 新的引用值<br> * @param expectedStamp 预期的戳值<br> * @param newStamp 新的戳值<br> * @return 如果更新成功则返回true，否则返回false<br> *&#x2F;<br> public boolean compareAndSet(V  expectedReference,<br>                V  newReference,<br>                int expectedStamp,<br>                int newStamp) {<br>     &#x2F;&#x2F; 获取当前的引用和戳对<br>     Pair<v> current &#x3D; pair;<br>     &#x2F;&#x2F; 检查当前的引用和戳是否与预期值匹配<br>     &#x2F;&#x2F; 如果匹配，则进一步检查新值是否与当前值相同，或尝试使用CAS操作更新值<br>     return<br>       expectedReference &#x3D;&#x3D; current.reference &amp;&amp;<br>       expectedStamp &#x3D;&#x3D; current.stamp &amp;&amp;<br>       ((newReference &#x3D;&#x3D; current.reference &amp;&amp;<br>        newStamp &#x3D;&#x3D; current.stamp) ||<br>        casPair(current, Pair.of(newReference, newStamp)));<br>   }</v></p></blockquote><h4><span id="weakcompareandset">weakCompareAndSet</span></h4><blockquote><p> &#x2F;**<br> * 使用弱一致性比较并设置引用和戳<br> * 此方法与compareAndSet方法类似，但它使用弱一致性，这意味着在某些情况下，<br> * 它可能返回false，即使比较成功，这通常是为了提高性能<br> *<br> * @param expectedReference 预期的引用值<br> * @param newReference    新的引用值，如果预期引用匹配则设置此值<br> * @param expectedStamp   预期的戳值<br> * @param newStamp      新的戳值，如果预期戳匹配则设置此值<br> * @return 如果设置操作成功则返回true，否则返回false<br> *&#x2F;<br> public boolean weakCompareAndSet(V  expectedReference,<br>                  V  newReference,<br>                  int expectedStamp,<br>                  int newStamp) {<br>   return compareAndSet(expectedReference, newReference,<br>              expectedStamp, newStamp);<br> }</p></blockquote><h4><span id="attemptstamp">attemptStamp</span></h4><blockquote><p> &#x2F;**<br> * 尝试更新引用对象的版本号<br> * 此方法旨在更新引用对象的版本号（stamp），以实现更复杂的同步或版本控制逻辑<br> * 它首先检查当前引用对象是否与预期的引用对象匹配，然后尝试更新版本号如果版本号不匹配，<br> * 它会尝试使用CAS（Compare-And-Swap）操作来更新引用对象和版本号<br> *<br> * @param expectedReference 预期的引用对象，即我们期望当前引用对象所指向的对象<br> * @param newStamp 新的版本号，我们尝试更新引用对象到这个版本号<br> * @return 如果成功更新引用对象的版本号，则返回true；否则返回false<br> *&#x2F;<br> public boolean attemptStamp(V expectedReference, int newStamp) {<br>   &#x2F;&#x2F; 获取当前的引用对象和版本号对<br>   Pair<v> current &#x3D; pair;<br>   &#x2F;&#x2F; 检查预期的引用对象是否与当前引用对象匹配，并尝试更新版本号<br>   return<br>     expectedReference &#x3D;&#x3D; current.reference &amp;&amp;<br>     (newStamp &#x3D;&#x3D; current.stamp ||<br>      casPair(current, Pair.of(expectedReference, newStamp)));<br> }</v></p></blockquote><h4><span id="unsafe机制">Unsafe机制</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Unsafe 机制</span></span><br><span class="line"><span class="comment">// 使用 sun.misc.Unsafe 进行低级别的操作，绕过 Java 语言的安全检查。</span></span><br><span class="line"><span class="comment">// 注意：sun.misc.Unsafe 的使用通常不被推荐，因为它可能导致稳定性与安全性问题，并且它不属于标准 Java API。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> sun.misc.<span class="type">Unsafe</span> <span class="variable">UNSAFE</span> <span class="operator">=</span> sun.misc.Unsafe.getUnsafe();</span><br><span class="line"><span class="comment">// 获取 AtomicStampedReference 中 &quot;pair&quot; 字段的内存偏移量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">pairOffset</span> <span class="operator">=</span></span><br><span class="line">    objectFieldOffset(UNSAFE, <span class="string">&quot;pair&quot;</span>, AtomicStampedReference.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 尝试原子地更新当前实例的 pair 字段。</span></span><br><span class="line"><span class="comment"> * 该方法使用 Unsafe 执行比较并交换（CAS）操作，这是实现无锁算法的关键部分。</span></span><br><span class="line"><span class="comment"> * 它通过确保更新是原子的来保证线程安全：仅当当前值与预期值相同时，更新才会成功。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> cmp 预期的旧值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> val 要设置的新值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果更新成功则返回 true，否则返回 false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">casPair</span><span class="params">(Pair&lt;V&gt; cmp, Pair&lt;V&gt; val)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> UNSAFE.compareAndSwapObject(<span class="built_in">this</span>, pairOffset, cmp, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取指定类中指定字段的内存偏移量。</span></span><br><span class="line"><span class="comment"> * 该方法通过查找字段的确切位置，为低级别操作做准备。</span></span><br><span class="line"><span class="comment"> * 它是一个辅助函数，简化了获取字段偏移量的过程。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> UNSAFE 用于低级别操作的 Unsafe 实例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> field 目标字段的名称</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> klazz 包含目标字段的类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 字段的内存偏移量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchFieldError 如果找不到指定字段，则抛出此错误</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">long</span> <span class="title function_">objectFieldOffset</span><span class="params">(sun.misc.Unsafe UNSAFE,</span></span><br><span class="line"><span class="params">                              String field, Class&lt;?&gt; klazz)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> UNSAFE.objectFieldOffset(klazz.getDeclaredField(field));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">        <span class="comment">// 将异常转换为对应的错误</span></span><br><span class="line">        <span class="type">NoSuchFieldError</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NoSuchFieldError</span>(field);</span><br><span class="line">        error.initCause(e);</span><br><span class="line">        <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h1><span id="并发集合">并发集合</span></h1><h2><span id="集合">集合</span></h2><blockquote><p><strong>ConcurrentHashMap</strong></p><ul><li>线程安全的哈希表实现，支持高并发读写操作。</li></ul><p><strong>CopyOnWriteArrayList</strong></p><ul><li>线程安全的列表，适用于读多写少的场景，写操作时创建底层数组的新副本。</li></ul><p><strong>CopyOnWriteArraySet</strong></p><ul><li>基于CopyOnWriteArrayList实现的线程安全集合，保证元素唯一性。</li></ul><p><strong>ConcurrentLinkedQueue</strong></p><ul><li>无界线程安全队列，基于链表结构，支持高效的插入和移除操作。</li></ul><p><strong>ConcurrentLinkedDeque</strong></p><ul><li>类似于ConcurrentLinkedQueue，但支持双端队列操作。</li></ul><p><strong>BlockingQueue接口及其实现类</strong></p><ul><li>ArrayBlockingQueue：有界的阻塞队列。</li><li>LinkedBlockingQueue：可选容量限制的阻塞队列。</li><li>PriorityBlockingQueue：支持优先级排序的无界阻塞队列。</li><li>DelayQueue：元素只有在延迟期满后才能从队列中取出。</li><li>SynchronousQueue：不存储元素的阻塞队列，每个插入操作必须等待相应的删除操作，反之亦然。</li><li>LinkedTransferQueue：实现了TransferQueue接口的无界阻塞队列。</li></ul><p><strong>ConcurrentSkipListMap</strong></p><ul><li>线程安全的可排序映射，基于跳表数据结构，允许范围查询。</li></ul><p><strong>ConcurrentSkipListSet</strong></p><ul><li>基于ConcurrentSkipListMap实现的线程安全集合，支持排序。</li></ul><p><strong>ConcurrentHashMap.KeySetView</strong></p><ul><li>ConcurrentHashMap的键视图，提供了一种方式来使用ConcurrentHashMap作为集合。</li></ul></blockquote><h2><span id="concurrenthashmap">ConcurrentHashMap</span></h2><blockquote><p>ConcurrentHashMap 是 Java 中 java.util.concurrent 包提供的一个高效且线程安全的哈希表实现。它在多线程环境下提供了比传统的同步集合（如 Collections.synchronizedMap() 或者 Hashtable）更好的并发性能，同时避免了传统锁机制带来的瓶颈问题</p></blockquote><h3><span id="特点">特点</span></h3><blockquote><p><strong>1.分段锁机制（Segment Locking）</strong></p><ul><li>在早期版本（Java 7及之前），ConcurrentHashMap 使用了一种称为“分段锁”的技术来减少锁竞争。整个哈希表被划分为多个段（segments），每个段实际上是一个小的哈希表，拥有自己的锁。这样，在理想情况下，不同的线程可以同时访问不同段的数据而不会发生冲突。</li><li>从Java 8开始，这种设计被替换为更细粒度的锁机制——CAS（Compare-And-Swap）操作结合同步标记（synchronized blocks），这使得大部分读写操作可以在不加锁的情况下完成，进一步提高了并发性能。</li></ul><p><strong>2.无阻塞读取</strong></p><ul><li>ConcurrentHashMap 支持完全并发的读操作，即使有其他线程正在进行写操作或结构化修改（如增加&#x2F;删除节点）。这是因为它的内部结构允许在不锁定整个表的情况下进行读取。</li><li>高效的扩容机制</li><li>当哈希表需要扩容时，ConcurrentHashMap 并不是一次性锁定整个表来进行复制和迁移工作，而是将这个过程分散到多次增量更新中完成，从而减少了对系统性能的影响。</li></ul><p><strong>3.弱一致性迭代器</strong></p><ul><li>迭代器不会抛出 ConcurrentModificationException，并且它们是弱一致性的：它们反映的是某个时间点上的快照，并可能包含已删除的元素，但绝不会返回从未添加过的元素。</li></ul><p><strong>4.支持原子操作的方法</strong></p><ul><li>提供了一系列支持原子操作的方法，如 putIfAbsent, remove(Object key, Object value), replace(K key, V oldValue, V newValue) 等，这些方法可以帮助开发者编写更加简洁和高效的代码。</li></ul></blockquote><h3><span id="扩容机制">扩容机制</span></h3><h4><span id="触发条件">触发条件：</span></h4><p>扩容通常发生在插入新键值对时，如果当前哈希表的负载因子（即元素数量与桶数组长度的比例）超过了预定阈值。具体来说，当ConcurrentHashMap中的元素数量超过了容量乘以负载因子(loadFactor)时，就会触发扩容操作。默认情况下，负载因子设置为0.75。</p><h4><span id="扩容过程">扩容过程</span></h4><blockquote><p><strong>1.创建新数组：</strong></p><ul><li>首先确定需要扩容后的新容量（通常是原容量的两倍），然后创建一个新的桶数组。</li></ul><p><strong>2.迁移数据：</strong></p><ul><li>对于旧数组中的每个非空桶（包括链表或红黑树结构），需要将其重新分配到新数组中。由于新数组的大小是原来的两倍，所以每个桶的数据可能被分配到新数组中的两个位置之一。</li><li>具体来说，对于一个位于索引i的桶，在新数组中它可能会被放置在i或i + oldCapacity的位置上（其中oldCapacity是旧数组的容量）。</li></ul><p><strong>3.并行迁移：</strong></p><ul><li>不同于一次性完成所有数据的迁移，ConcurrentHashMap采用了一种增量迁移的方式。这意味着不是由单个线程负责整个迁移过程，而是任何访问到未迁移桶的线程都可以帮助完成这部分桶的迁移工作。</li><li>这种设计允许多个线程同时参与扩容过程，从而加速了迁移速度，并减少了对系统性能的影响。</li></ul><p><strong>4.完成扩容：</strong></p><ul><li>当所有的桶都成功迁移到新的数组中后，旧的数组将被废弃，新的数组成为ConcurrentHashMap的实际存储结构。</li><li>在此过程中，ConcurrentHashMap仍然能够处理查询、插入等操作，保证了系统的高可用性。</li></ul></blockquote><h1><span id="executor框架">Executor框架</span></h1><h2><span id="executor框架主要组成">Executor框架主要组成</span></h2><blockquote><p><strong>Executor接口：</strong></p><ul><li>这是最基础的接口，只有一个方法void execute(Runnable command);。它代表一个对象，其职责是执行提交给它的Runnable任务。</li></ul><p><strong>ExecutorService接口：</strong></p><ul><li>继承自Executor接口，增加了管理服务的功能，如终止现有任务、等待所有已提交任务完成等。提供了更丰富的控制能力，比如提交带返回值的任务(Callable)、批量提交任务等。</li></ul><p><strong>AbstractExecutorService类：</strong></p><ul><li>为ExecutorService接口提供了一个默认的实现模板，方便开发者创建自定义的执行服务。</li></ul><p><strong>ScheduledExecutorService接口：</strong></p><ul><li>继承自ExecutorService接口，支持延迟和周期性任务的执行。</li></ul><p><strong>Executors工厂类：</strong>提供了静态方法用于创建不同类型的线程池，包括但不限于：</p><ul><li>newFixedThreadPool(int nThreads)：创建一个固定大小的线程池。</li><li>newCachedThreadPool()：创建一个可根据需要创建新线程的线程池。</li><li>newSingleThreadExecutor()：创建一个单线程的线程池。</li><li>newScheduledThreadPool(int corePoolSize)：创建一个支持定时及周期性任务执行的线程池。</li></ul></blockquote><h2><span id="线程池">线程池</span></h2><h3><span id="概念">概念</span></h3><p>线程池是一种用于管理和复用一组线程的技术，它避免了频繁创建和销毁线程所带来的开销。通过预先创建一定数量的线程并将其保持在一个池中，可以显著提升应用程序的性能。</p><h3><span id="线程池的创建">线程池的创建</span></h3><p>在JUC中，可以通过多种方式创建线程池，最常用的方式是使用Executors工厂类提供的静态方法，如：</p><ul><li>newFixedThreadPool(int nThreads)：创建一个固定大小的线程池。</li><li>newCachedThreadPool()：创建一个根据需要创建新线程的线程池，但在以前构造的线程可用时将重用它们。</li><li>newSingleThreadExecutor()：创建一个单线程的线程池。</li><li>newScheduledThreadPool(int corePoolSize)：创建一个支持定时及周期性任务执行的线程池。</li></ul><p>当然，也可以直接使用ThreadPoolExecutor或ScheduledThreadPoolExecutor来更灵活地配置线程池参数。</p><h3><span id="线程池工作流程">线程池工作流程</span></h3><blockquote><p><strong>1.任务提交：</strong></p><ul><li>当你向线程池提交一个新的任务（通过调用execute(Runnable command)方法），该任务会被放入队列等待执行。</li></ul><p><strong>2.任务分配：</strong></p><ul><li>如果当前运行的线程少于核心线程数（corePoolSize），则创建新的线程来处理任务。</li><li>如果当前运行的线程数等于或大于核心线程数，则将任务加入到任务队列等待空闲线程处理。</li><li>如果任务队列已满，并且当前运行的线程数小于最大线程数（maximumPoolSize），则会创建新的线程来处理任务。</li><li>如果线程数已经达到了最大线程数并且任务队列也满了，则根据拒绝策略处理无法执行的任务。</li></ul><p><strong>3.任务执行：</strong>线程从任务队列中取出任务并执行。<br> <strong>4.线程回收：</strong></p><ul><li>当线程完成任务后，如果此时线程池中的线程数超过了核心线程数，并且这些多余的线程在一段时间内（keepAliveTime）没有新的任务可执行，则这些线程将会被终止以节省资源。</li></ul><p><strong>5.拒绝策略：</strong></p><p>当线程池无法接受新的任务时，会按照预设的拒绝策略进行处理。JUC提供了几种默认的拒绝策略，如：</p><ul><li>AbortPolicy：抛出RejectedExecutionException异常。</li><li>CallerRunsPolicy：由提交任务的线程自己运行该任务。</li><li>DiscardPolicy：直接丢弃任务，不抛出异常。</li><li>DiscardOldestPolicy：丢弃队列中最老的任务，然后尝试重新提交此任务。</li></ul></blockquote><h2><span id></span></h2><h1><span id="threadpoolexecutor">ThreadPoolExecutor</span></h1><h2><span id="案例引入">案例引入：</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个ThreadPoolExecutor线程池</span></span><br><span class="line"> <span class="comment">// 核心线程数为2，最大线程数为5</span></span><br><span class="line"> <span class="comment">// 空闲线程存活时间为1秒</span></span><br><span class="line"> <span class="comment">// 使用ArrayBlockingQueue作为任务队列，容量为3</span></span><br><span class="line"> <span class="comment">// 当任务队列已满且线程数达到最大时，使用丢弃策略处理无法执行的任务</span></span><br><span class="line"> <span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">         <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>),</span><br><span class="line">         <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardPolicy()</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"> <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i ++) &#123;</span><br><span class="line">     <span class="type">int</span> <span class="variable">finalI</span> <span class="operator">=</span> i;</span><br><span class="line">     <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">             log.debug(<span class="string">&quot;running... task&#123;&#125;&quot;</span>, finalI);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br><span class="line">     executor.submit(task);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> System.out.println(executor.getTaskCount());</span><br><span class="line"> executor.shutdown();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/9d6be143bc374fcd8dba9afa3027a5ff.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="参数说明">参数说明：</span></h2><p><img src="/./../images/9c838558c936494280009beafa6e5878.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>1. corePoolSize（核心线程数）</strong></p><ul><li>表示线程池中保持的最小线程数量。</li><li>即使这些线程处于空闲状态，也不会被销毁（除非设置了 allowCoreThreadTimeOut(true)）。</li><li>当提交任务时，如果当前运行的线程数小于 corePoolSize，即使有空闲线程，也会创建新线程来执行任务。</li></ul><p><strong>2. maximumPoolSize（最大线程数）</strong></p><ul><li>线程池中允许的最大线程数量。</li><li>当任务队列已满，并且当前运行的线程数小于 maximumPoolSize 时，线程池会创建新的线程来处理任务，直到达到 maximumPoolSize。</li><li>如果线程数已经达到 maximumPoolSize，并且任务队列也满了，则根据拒绝策略处理无法执行的任务。</li></ul><p><strong>3. keepAliveTime（空闲线程存活时间）</strong></p><ul><li>表示当线程池中的线程数超过 corePoolSize 时，多余空闲线程在终止前等待新任务的最长时间。</li><li>时间单位由 unit 参数指定。</li><li>默认情况下，keepAliveTime 只会影响超出核心线程数的线程；但可以通过调用 allowCoreThreadTimeOut(true) 方法，使得核心线程也遵循这个规则。</li></ul><p><strong>4. unit（时间单位）</strong><br> keepAliveTime 的时间单位。<br> 常见的时间单位包括：</p><ul><li>TimeUnit.NANOSECONDS：纳秒</li><li>TimeUnit.MICROSECONDS：微秒</li><li>TimeUnit.MILLISECONDS：毫秒</li><li>TimeUnit.SECONDS：秒</li><li>TimeUnit.MINUTES：分钟</li><li>TimeUnit.HOURS：小时</li><li>TimeUnit.DAYS：天</li></ul><p><strong>5. workQueue（任务队列）</strong><br> 用于保存等待执行的任务的阻塞队列。<br> 常见的任务队列类型：</p><ul><li>ArrayBlockingQueue：基于数组的有界阻塞队列。</li><li>LinkedBlockingQueue：基于链表的无界阻塞队列（默认容量为 Integer.MAX_VALUE）。</li><li>SynchronousQueue：不存储元素的队列，每个插入操作必须等待另一个线程的对应移除操作。</li><li>PriorityBlockingQueue：支持优先级排序的无界阻塞队列。</li></ul><p>队列的选择直接影响线程池的工作机制，例如任务排队和线程创建的策略。<br> <strong>6. threadFactory（线程工厂）</strong></p><ul><li>用于创建新线程的工厂。</li><li>默认使用 Executors.defaultThreadFactory()，它创建的线程具有相同的优先级（NORM_PRIORITY）并设置为非守护线程。</li><li>自定义线程工厂可以用来设置线程的名称、优先级、是否为守护线程等。</li></ul><p><strong>7. handler（拒绝策略）</strong><br> 当线程池和任务队列都满了时使用的处理策略。<br> 常见的拒绝策略：</p><ul><li>AbortPolicy：抛出 RejectedExecutionException 异常（默认策略）。</li><li>CallerRunsPolicy：由提交任务的线程自己执行该任务。</li><li>DiscardPolicy：直接丢弃任务，不做任何处理。</li><li>DiscardOldestPolicy：丢弃队列中最老的任务，然后尝试重新提交被拒绝的任务。</li></ul><p>也可以自定义拒绝策略，只需要实现 RejectedExecutionHandler 接口。</p></blockquote><h2><span id="1-提交任务">1. 提交任务</span></h2><ul><li><strong>execute(Runnable command)：</strong>用于执行不需要返回结果的任务（即实现了 Runnable 接口的任务）。该方法没有返回值。</li><li><strong>submit(Runnable task)：</strong>提交一个不需要返回结果的任务，并返回一个 Future 对象，可以通过这个对象来管理任务的状态或尝试取消任务。</li><li><strong>submit(Runnable task, T result)：</strong>类似于 submit(Runnable task)，但允许指定一个结果对象，在任务完成时可以获取到这个结果（虽然对于 Runnable 任务，这个结果通常是 null）。</li><li><strong>submit(Callable<t> task)：</t></strong>提交一个需要返回结果的任务（即实现了 Callable 接口的任务），并返回一个 Future 对象，通过这个对象可以获取任务执行的结果。</li></ul><h2><span id="2-线程池管理">2. 线程池管理</span></h2><ul><li><strong>shutdown()：</strong>启动一次顺序关闭，在这个方法调用之后，线程池不再接受新的任务，但是会继续执行已经在队列中的任务。</li><li><strong>shutdownNow()：</strong>试图停止所有正在执行的任务，并暂停处理等待中的任务，返回等待执行的任务列表。</li><li><strong>awaitTermination(long timeout, TimeUnit unit)：</strong>阻塞当前线程直到线程池中的所有任务都完成执行，或者超过了指定的时间限制。</li></ul><h2><span id="3-状态检查">3. 状态检查</span></h2><ul><li><strong>isShutdown()：</strong>判断线程池是否已经启动了关闭程序（调用了 shutdown() 或 shutdownNow() 方法）。</li><li><strong>isTerminated()：</strong>如果调用了 shutdown() 或 shutdownNow() 方法后，所有任务都已完成，则返回 true。</li></ul><h2><span id="4-其他实用方法">4. 其他实用方法</span></h2><ul><li><strong>getActiveCount()：</strong>返回线程池中正在积极执行任务的线程数量。</li><li><strong>getCompletedTaskCount()：</strong>返回已执行完毕的任务数。</li><li><strong>getPoolSize()：</strong>返回当前线程池中的线程数量，包括空闲线程。</li><li><strong>getLargestPoolSize()：</strong>返回线程池曾经创建的最大线程数量。</li><li><strong>getTaskCount()：</strong>估计已执行的任务总数加上仍在队列中等待执行的任务数。</li><li><strong>setThreadFactory(ThreadFactory threadFactory)：</strong>设置用于创建新线程的工厂。</li><li><strong>setRejectedExecutionHandler(RejectedExecutionHandler handler)：</strong>设置当任务无法被提交执行时使用的拒绝策略。</li></ul><h2><span id></span></h2><h1><span id="forkx2fjoin"><strong>Fork&#x2F;Join</strong></span></h1><blockquote><p>Fork&#x2F;Join 框架是 Java 7 引入的一个用于并行执行任务的框架，它特别适用于那些可以递归分解成更小任务的问题。这个框架旨在高效地利用多核处理器来加速计算密集型操作。以下是 Fork&#x2F;Join 框架的主要概念、工作原理以及如何使用它。</p></blockquote><h2><span id="主要概念">主要概念</span></h2><ul><li>Fork：将一个大任务拆分为多个子任务的过程。</li><li>Join：等待所有子任务完成并将它们的结果合并的过程。</li></ul><h2><span id="核心类">核心类</span></h2><ul><li>ForkJoinPool：执行 ForkJoinTask 的线程池。它管理着一组工作线程，并提供了一种机制来执行任务及其子任务。</li><li>ForkJoinTask：这是一个抽象类，代表可以在 ForkJoinPool 中执行的任务。通常情况下，你不需要直接继承这个类，而是使用它的两个具体实现之一：</li><li>RecursiveAction：用于没有返回结果的任务。</li><li>RecursiveTask<v>：用于有返回结果的任务（V 是返回值的类型）。</v></li></ul><h1><span id="aqs">AQS</span></h1><h2><span id="概念">概念</span></h2><p>全称AbstractQueuedSynchronizer（抽象队列同步器），是Java并发包（java.util.concurrent）中的一个核心组件。它提供了一个框架，用于实现依赖于先进先出（FIFO）等待队列的阻塞锁和相关的同步器（如信号量、事件等）。AQS的设计简化了开发高效且可靠的同步器的过程。</p><h1><span id="读写锁reentrantreadwritelock">读写锁（ReentrantReadWriteLock）</span></h1><h2><span id="基本操作">基本操作：</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"><span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">ReadLock</span> <span class="variable">r</span> <span class="operator">=</span> rw.readLock();</span><br><span class="line"><span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">WriteLock</span> <span class="variable">w</span> <span class="operator">=</span> rw.writeLock();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>ReentrantReadWriteLock.ReadLock r &#x3D; rw.readLock() ： 返回用于读操作的锁</p><p>ReentrantReadWriteLock.WriteLock w &#x3D; rw.writeLock() : 返回用于写操作的锁</p><h2><span id="基本方法">基本方法</span></h2><blockquote><p><strong>1. 获取读锁和写锁</strong></p><ul><li>readLock() ：返回一个用于读操作的锁（Lock 对象）。</li><li>writeLock()：返回一个用于写操作的锁（Lock 对象）。</li></ul><p><strong>2. 锁的基本操作</strong><br> <strong>读锁（Read Lock）方法</strong></p><ul><li>void lock() ：获取读锁。如果当前没有线程持有写锁，则可以成功获取；否则会阻塞，直到写锁被释放。</li><li>void unlock() ：释放读锁。必须在持有读锁的线程中调用，否则会抛出llegalMonitorStateException。</li><li>boolean tryLock() : 尝试非阻塞地获取读锁。如果当前没有线程持有写锁，则立即获取并返回 true，否则返回 false。</li><li>boolean tryLock(long timeout, TimeUnit unit):尝试在指定时间内获取读锁。如果成功获取则返回 true，超时或被中断则返回 false。</li></ul><p><strong>写锁（Write Lock）方法</strong></p><ul><li>void lock():获取写锁。如果当前没有其他线程持有读锁或写锁，则可以成功获取；否则会阻塞，直到锁可用。</li><li>void unlock():释放写锁。必须在持有写锁的线程中调用，否则会抛出 IllegalMonitorStateException。</li><li>boolean tryLock():尝试非阻塞地获取写锁。如果当前没有其他线程持有读锁或写锁，则立即获取并返回 true，否则返回 false。</li><li>boolean tryLock(long timeout, TimeUnit unit):尝试在指定时间内获取写锁。如果成功获取则返回 true，超时或被中断则返回 false。</li></ul><p><strong>3. 公平性相关方法</strong></p><ul><li>boolean isFair():判断锁是否是公平锁。如果是公平锁，等待时间最长的线程优先获得锁；否则是非公平锁，默认为非公平模式。</li><li>Thread getOwner():返回当前持有写锁的线程。如果没有线程持有写锁，则返回 null。</li><li>int getQueueLength():返回正在等待获取写锁的线程数量。</li><li>Collection<thread> getQueuedThreads():返回所有正在等待获取写锁的线程集合。</thread></li><li>int getReadLockCount():返回当前持有读锁的线程数（包括重入次数）。</li><li>boolean hasQueuedThreads():判断是否有线程正在等待获取写锁。</li></ul><p><strong>4. 状态检查方法</strong></p><ul><li>boolean isWriteLocked():判断写锁是否被任何线程持有。</li><li>boolean isWriteLockedByCurrentThread():判断当前线程是否持有写锁。</li><li>int getWriteHoldCount():返回当前线程持有写锁的重入次数。如果当前线程未持有写锁，则返回 0。</li><li>int getReadHoldCount()返回当前线程持有读锁的重入次数。如果当前线程未持有读锁，则返回 0。</li></ul><p><strong>5. 条件变量（Condition）支持</strong><br> 虽然 ReentrantReadWriteLock 支持条件变量，但需要注意：</p><ul><li>读锁不支持条件变量：尝试使用读锁创建条件变量会导致 UnsupportedOperationException。</li><li>写锁支持条件变量：可以使用写锁创建条件变量。</li></ul></blockquote><h2><span id="读读锁可以并发">读读锁可以并发</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"><span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">ReadLock</span> <span class="variable">r</span> <span class="operator">=</span> rw.readLock();</span><br><span class="line"><span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">WriteLock</span> <span class="variable">w</span> <span class="operator">=</span> rw.writeLock();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">    r.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;获取read锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;释放read锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        r.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">    w.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;获取write锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;释放write锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        w.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(Test5::read, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(Test5::read, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/b8212d2086344f0b9a130e52d2ed6b31.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  </p><h2><span id="读写锁互相阻塞">读写锁互相阻塞</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">   <span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">ReadLock</span> <span class="variable">r</span> <span class="operator">=</span> rw.readLock();</span><br><span class="line">   <span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">WriteLock</span> <span class="variable">w</span> <span class="operator">=</span> rw.writeLock();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">       r.lock();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           log.debug(<span class="string">&quot;获取read锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">           sleep(<span class="number">1000</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           log.debug(<span class="string">&quot;释放read锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">           r.unlock();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">       w.lock();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           log.debug(<span class="string">&quot;获取write锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">           sleep(<span class="number">1000</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           log.debug(<span class="string">&quot;释放write锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">           w.unlock();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(Test5::read, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">       <span class="keyword">new</span> <span class="title class_">Thread</span>(Test5::write, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <img src="/./../images/5370b820c3e94ab1a36b63396859080a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="写写锁互相阻塞">写写锁互相阻塞</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"> <span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">ReadLock</span> <span class="variable">r</span> <span class="operator">=</span> rw.readLock();</span><br><span class="line"> <span class="keyword">static</span> ReentrantReadWriteLock.<span class="type">WriteLock</span> <span class="variable">w</span> <span class="operator">=</span> rw.writeLock();</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">     r.lock();</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         log.debug(<span class="string">&quot;获取read锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">         sleep(<span class="number">1000</span>);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         log.debug(<span class="string">&quot;释放read锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">         r.unlock();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">     w.lock();</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         log.debug(<span class="string">&quot;获取write锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">         sleep(<span class="number">1000</span>);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         log.debug(<span class="string">&quot;释放write锁, &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">         w.unlock();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Thread</span>(Test5::write, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Thread</span>(Test5::write, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <img src="/./../images/9c688fcb36f640cfaa9a05156b968dd5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>写锁是独占的，读锁是共享的。</p><hr><p><strong>如有错误，欢迎指正！！！</strong></p><p>碎碎念：Java并发编程JUC篇，目前来说是个基础篇，更深入的都还没学，后续有时间会进一步完善qwq，juc内容很多，如果想要深入学习，还是要看一下源码深入理解一下底层原理。。。</p>]]></content>
      
      
      <categories>
          
          <category> Java并发编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java并发编程3(CAS)</title>
      <link href="/2025/04/20/JUC3/"/>
      <url>/2025/04/20/JUC3/</url>
      
        <content type="html"><![CDATA[<h1><span id="java内存模型jmm">Java内存模型(JMM)</span></h1><h2><span id="概念">概念</span></h2><p>百度百科：<a href="https://baike.baidu.com/item/java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/3399303">java内存模型_百度百科</a></p><blockquote><p>Java内存模型（Java Memory Model, JMM）是Java语言规范的一部分，它定义了程序中各个线程如何通过内存进行通信的规则。这个模型确保了在多线程环境下，不同线程对共享变量的操作具有一定的可见性和有序性，从而避免了一些潜在的问题，如竞态条件和内存一致性错误。</p></blockquote><h2><span id="jmm特性">JMM特性</span></h2><ol><li><strong>可见性：</strong>指的是一个线程对共享变量所做的修改需要对其他线程变得可见。如果没有适当的同步机制，一个线程所做的更改可能不会立即或根本不会对其他线程显现出来。JMM通过使用volatile关键字、synchronized块或方法等机制来确保可见性。</li><li><strong>有序性：</strong>Java允许编译器和处理器对指令进行重排序以优化性能，只要这种重排序不改变程序在单线程环境下的行为。然而，在多线程环境中，这可能导致意外的行为。JMM通过规定happens-before原则和其他同步手段来防止有害的重排序，确保程序的执行顺序符合开发者的预期。</li><li><strong>原子性：</strong>指的是操作不可分割，要么全部执行，要么完全不执行。对于基本数据类型的读取和写入（除long和double外），Java保证它们是原子性的。但对于复合操作（如i++），则不是原子性的，可能会导致竞态条件。为了实现原子性，可以使用synchronized、显式锁或者java.util.concurrent.atomic包中的类。</li></ol><h1><span id="可见性">可见性</span></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">run</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (run) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">        run = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="原因">原因</span></h2><ol><li><strong>处理器缓存（Cache）：</strong>为了减少访问主内存的延迟，每个处理器核心通常有自己的缓存（L1, L2, 甚至L3）。当一个线程在一个核心上修改了共享变量，这个更新首先发生在该核心的缓存中，并不会立刻写回到主内存。因此，运行在其他核心上的线程可能暂时看不到这个更新，因为它们可能会从自己的缓存中读取旧值。</li><li><strong>乱序执行（Out-of-order Execution）：</strong>为了优化性能，现代处理器可能会改变指令的实际执行顺序，只要这种重排序不影响单个线程内的程序结果。然而，在多线程环境中，这样的重排序可能导致一个线程所见的执行顺序不同于另一个线程，从而影响共享数据的一致性。</li><li><strong>编译器优化：</strong>编译器在编译程序时也会进行各种优化，包括指令重排、消除看似冗余的读写操作等。虽然这些优化在单线程环境下是安全的，但在多线程环境下可能会导致一个线程看不到另一个线程对共享变量所做的最新修改。</li><li><strong>存储一致性模型（Memory Consistency Models）：</strong>不同的硬件架构和编程语言实现有着不同的存储一致性模型。例如，x86架构提供相对较强的一致性保证，而ARM和PowerPC则允许更宽松的内存模型，这可能导致不同线程间观察到的程序行为有所不同。</li></ol><h2><span id="解决方式">解决方式</span></h2><ol><li><strong>使用同步机制</strong>：如互斥锁（mutex）、信号量（semaphore）等来保护共享资源，确保同一时间只有一个线程能够访问该资源。</li><li><strong>使用volatile关键字</strong>：在Java等语言中，声明一个变量为volatile可以保证对该变量的读写操作不会被编译器或处理器重排序，同时每次读取都会从主内存获取最新值，而不是使用本地缓存中的值。</li><li><strong>使用原子变量</strong>：原子变量提供了不依赖于锁机制的线程安全操作，适用于某些特定场景下的高效并发控制。</li><li><strong>使用高级同步结构</strong>：例如读写锁、条件变量、栅栏(barrier)等，可以根据具体情况提供更细粒度或更适合场景的同步方案。</li><li><strong>使用内存屏障（Memory Barrier）&#x2F; 内存栅栏（Memory Fence）</strong>：这是一种硬件级别的机制，可以防止编译器和CPU对指令进行跨屏障的重排序，确保某些操作的顺序性。</li></ol><h1><span id="有序性">有序性</span></h1><h2><span id="指令重排序引起的问题"><strong>指令重排序引起的问题：</strong></span></h2><p>​    为了提高执行效率，编译器和处理器可能对指令顺序进行调整，只要这种重排序不影响单个线程内的程序结果。但在多线程环境中，如果一个线程依赖另一个线程的操作结果，这种重排序可能导致未预期的行为。</p><h2><span id="解决方案">解决方案</span></h2><ol><li><strong>使用synchronized关键字</strong>：synchronized块或方法不仅能保证原子性，还能保证有序性和可见性。进入synchronized块时会插入内存屏障，确保所有之前的操作都已完成且对其他线程可见；退出时也会插入内存屏障，确保所有后续操作都不会被提前执行。</li><li><strong>使用volatile关键字</strong>：声明一个变量为volatile可以防止对其读写操作被重排序，并确保每次读取都会从主内存获取最新值，而不是从本地缓存中。这对于状态标志等简单的同步需求非常有用。</li><li><strong>使用java.util.concurrent包下的高级并发工具</strong>：如ReentrantLock, CountDownLatch, CyclicBarrier, Semaphore等，这些工具提供了比synchronized更丰富的功能，并且在很多情况下拥有更好的性能。</li><li><strong>使用原子变量类</strong>：如AtomicInteger, AtomicLong, AtomicReference等，它们提供了一种无锁的方式来处理共享数据，基于现代CPU的CAS（Compare-And-Swap）特性实现，既保证了原子性也保证了有序性和可见性。</li><li><strong>使用final关键字</strong>：对于对象引用和不可变对象，使用final字段可以在对象构造期间保护其初始化的安全性，确保对象一旦构造完成，其状态就不会再受到重排序的影响。</li></ol><h1><span id="volatile关键字"><strong>volatile关键字</strong></span></h1><p> volatile关键字在Java中用于确保变量的可见性和禁止某些类型的指令重排序，它主要用于解决多线程环境下的可见性问题。</p><h2><span id="可见性">可见性</span></h2><ul><li>当一个线程对volatile变量进行写操作时，这个<strong>写操作会立即被刷新到主内存</strong>中，而不是停留在处理器缓存中。</li><li>当另一个线程随后读取同一个volatile变量时，<strong>它会从主内存中获取最新的值</strong>，而不是使用处理器缓存中的副本。</li></ul><p>这意味着，通过使用volatile关键字声明的变量可以保证一个线程对变量所做的修改能够立即对其他线程可见，解决了由于缓存导致的可见性问题。</p><h2><span id="禁止指令重排序">禁止指令重排序</span></h2><ul><li>volatile还提供了一种“happens-before”的关系，确保了对该变量的操作不会被编译器或处理器重排序到不恰当的位置。</li></ul><p>更具体地说，<strong>对volatile变量的写入操作必须在任何后续对该变量的读取操作之前完成</strong>（根据程序顺序）。这有助于避免由于指令重排序导致的竞态条件或其他并发问题。</p><h1><span id="happens-before"><strong>happens-before</strong></span></h1><h2><span id="概念"><strong>概念</strong></span></h2><p> “Happens-before”是Java内存模型（JMM）中的一个概念，用于描述程序中操作之间的部分有序关系，确保多线程环境下的可见性和有序性。简单来说，“happens-before”规则定义了一个操作何时以及如何对另一个操作可见。如果操作A “happens-before” 操作B，则A所做的所有影响（包括变量的写入）都必须在B执行时可见。</p><h2><span id="规则">规则</span></h2><ol><li><strong>程序顺序规则：</strong>每个线程内部的操作按照程序代码的顺序执行，“happens-before”于该线程后续的操作。尽管编译器和处理器可以对指令进行重排序优化，但这些重排序不能改变单个线程内的程序顺序。</li><li><strong>监视器锁规则：</strong>对同一个锁的解锁操作“happens-before”随后对该锁的加锁操作。这意味着在一个线程释放锁之后对共享变量所做的任何修改，在其他线程获取到这个锁后都是可见的。</li><li><strong>volatile字段规则：</strong>对volatile变量的写入操作“happens-before”所有后续对该变量的读取操作。这保证了当一个线程写入一个volatile变量后，所有其它线程都能看到这个写入动作的效果。</li><li><strong>线程启动规则：</strong>Thread.start()方法调用“happens-before”由该线程执行的所有操作。这意味着主线程在调用新线程的start()方法之前所做的任何初始化工作对于新线程来说都是可见的。</li><li><strong>线程结束规则：</strong>由某个线程执行的所有操作“happens-before”其他线程通过Thread.join()成功返回。即，一个线程等待另一个线程结束，并且能够看到那个线程所有的操作结果。</li><li><strong>传递性：</strong>如果操作A “happens-before” 操作B，而操作B又 “happens-before” 操作C，那么操作A “happens-before” 操作C。</li></ol><h1><span id="并发设计模式">并发设计模式</span></h1><h2><span id="概念">概念</span></h2><p>​    并发设计模式是专门用来解决多线程编程和并发计算中遇到的问题的设计模式。它们帮助开发者更好地管理资源共享、任务分配以及线程间通信，从而提高程序的性能和可靠性 </p><h2><span id="分类">分类</span></h2><h3><span id="生产者-消费者模式producer-consumer-pattern"><strong>生产者-消费者模式（Producer-Consumer Pattern）：</strong></span></h3><ul><li>这是一种经典的并发模式，用于解耦数据生产者和消费者。它通过一个共享队列来实现，生产者将数据放入队列，而消费者从队列中取出数据进行处理。</li></ul><h3><span id="读者-写者问题readers-writers-problem"><strong>读者-写者问题（Readers-Writers Problem）：</strong></span></h3><ul><li>解决了当存在多个读取者和写入者同时访问共享资源时的问题。目标是在最大化读操作并发性的同时保证写操作的数据一致性。</li></ul><h3><span id="单例模式singleton-with-double-checked-locking"><strong>单例模式（Singleton with Double-Checked Locking）：</strong></span></h3><ul><li>虽然单例模式本身不是专门为并发环境设计的，但在多线程环境下使用双重检查锁定机制可以确保只有一个实例被创建，同时减少同步带来的开销。</li></ul><h3><span id="锁与条件变量locks-and-condition-variables"><strong>锁与条件变量（Locks and Condition Variables）：</strong></span></h3><ul><li>提供了一种机制让线程之间能够相互等待直到某个条件成立。这通常涉及到互斥锁（mutex）和条件变量的使用。</li></ul><h3><span id="信号量semaphore"><strong>信号量（Semaphore）：</strong></span></h3><ul><li>用于控制对有限资源的访问，如限制数据库连接池中的最大连接数等。二元信号量（binary semaphore）特别类似于互斥锁。</li></ul><h3><span id="屏障barrier"><strong>屏障（Barrier）：</strong></span></h3><ul><li>允许一组线程全部到达某一点后继续执行。这对于需要所有线程完成当前阶段才能开始下一阶段的任务非常有用。</li></ul><h3><span id="future模式"><strong>Future模式：</strong></span></h3><ul><li>允许异步执行任务，并在将来某个时刻获取结果。Java中的Future接口和CompletableFuture类就是这种模式的实现。</li></ul><h3><span id="工作窃取work-stealing"><strong>工作窃取（Work Stealing）：</strong></span></h3><ul><li>在任务并行库（TPL）或类似框架中，工作窃取算法使得空闲线程可以从忙碌线程的工作队列末尾“偷取”任务来执行，以平衡负载。</li></ul><h3><span id="balking模式"><strong>Balking模式：</strong></span></h3><ul><li>当一个操作正在进行中时，阻止其他线程再次尝试执行相同的操作。例如，在自动保存场景下，如果用户已经手动保存，则自动保存过程会被取消。</li></ul><h3><span id="两阶段终止模式two-phase-termination-pattern"><strong>两阶段终止模式（Two-Phase Termination Pattern）：</strong></span></h3><ul><li>为了解决如何优雅地停止线程的问题，包括通知线程准备停止，并给线程机会清理资源。</li></ul><h2><span id></span></h2><h1><span id="无锁编程">无锁编程</span></h1><h2><span id="概念">概念</span></h2><p>无锁编程（Lock-Free Programming）是一种并发编程技术，旨在避免使用传统的锁机制来保护共享资源，从而减少死锁、优先级反转和性能瓶颈等问题。无锁算法通常依赖于原子操作（如比较并交换 Compare-And-Swap, CAS）来实现同步，确保即使在高并发条件下也能保证数据的一致性和正确性。 </p><h2><span id="主要技术">主要技术</span></h2><h3><span id="1-原子操作">1. 原子操作</span></h3><p>原子操作是无锁编程的基础，它保证了一系列操作要么全部执行完成，要么完全不执行，不会出现部分执行的情况。常见的原子操作包括：</p><ul><li><strong>Compare-And-Swap (CAS)：</strong>检查一个内存位置的值是否等于预期值，如果是，则用新值替换旧值。这是实现无锁算法最常用的原子操作。</li><li><strong>Fetch-And-Add：</strong>对指定内存位置的值进行原子加法操作，并返回该位置的原值。</li><li><strong>Load-Linked&#x2F;Store-Conditional (LL&#x2F;SC)：</strong>一种替代CAS的方法，首先通过Load-Linked读取一个值，然后尝试用Store-Conditional写入一个新值，只有在这两个操作之间没有其他线程修改过该位置时，写入才会成功。</li></ul><h3><span id="2-内存屏障x2f栅栏memory-barriersx2ffences">2. 内存屏障&#x2F;栅栏（Memory Barriers&#x2F;Fences）</span></h3><ul><li>内存屏障是一种同步指令，用于控制指令重排序和确保内存操作的顺序性。它们帮助程序员强制某些内存操作按照特定顺序执行，这对于维护多线程环境下的正确性至关重要。内存屏障分为几种类型，如加载屏障、存储屏障、全屏障等。</li></ul><h3><span id="3-aba问题解决方案">3. ABA问题解决方案</span></h3><p>ABA问题是无锁编程中的一个经典挑战，指的是某个变量先从A变为B再变回A，导致依赖于值比较的操作（如CAS）产生错误的行为。解决ABA问题的技术包括：</p><ul><li>版本号计数：为每个需要保护的数据项附加一个版本号或时间戳。每次更新数据项时也更新其版本号，这样即使值回到了原来的A，版本号也会不同，从而可以被检测到。</li><li>指针标记：在指针上添加额外的信息（例如低位作为标记），使得即使指针指向的对象地址相同，但标记位不同也能区分不同的状态。</li></ul><h3><span id="4-设计高效的无锁数据结构">4. 设计高效的无锁数据结构</span></h3><p>设计高效的无锁数据结构是无锁编程的核心任务之一。常见的无锁数据结构包括但不限于：</p><ul><li>无锁栈（Lock-Free Stack）：通过使用CAS操作来安全地推入和弹出元素。</li><li>无锁队列（Lock-Free Queue）：如Michael-Scott非阻塞队列算法，它允许多个线程同时进行入队和出队操作而不互相干扰。</li><li>无锁哈希表（Lock-Free Hash Table）：通过细粒度锁定或者基于CAS的操作来管理哈希冲突和扩容。</li></ul><h3><span id="5-非阻塞同步策略">5. 非阻塞同步策略</span></h3><p>除了上述具体的技术外，还有一些高层次的设计策略可以帮助构建无锁系统：</p><ul><li>乐观并发控制（Optimistic Concurrency Control, OCC）：假设冲突很少发生，在提交更改之前检查是否有冲突；如果发现冲突，则回滚并重试。</li><li>惰性同步（Lazy Synchronization）：推迟某些同步操作直到绝对必要时才执行，以减少同步开销。</li></ul><h2><span id="为什么无锁效率高"><strong>为什么无锁效率高</strong></span></h2><p><strong>1. 减少上下文切换</strong></p><p>在基于锁的并发控制中，如果一个线程持有锁而其他线程尝试获取相同的锁时，那些未能获得锁的线程会被阻塞，这意味着它们必须等待直到锁可用。这种等待会导致操作系统进行线程上下文切换，这是一项昂贵的操作，因为它涉及保存当前线程的状态并加载另一个线程的状态。</p><p>相比之下，无锁算法允许所有线程继续运行，即使某个操作失败了（例如 compareAndSet 返回 false），它也只是简单地重试，而不是被阻塞或暂停执行。这样可以显著减少不必要的上下文切换，从而提高系统整体性能。</p><p><strong>2. 避免死锁和优先级反转</strong></p><p>使用传统的锁机制时，可能会遇到复杂的问题如死锁（Deadlock）和优先级反转（Priority Inversion）。这些问题可能导致部分或全部线程永久挂起，严重影响系统的响应性和稳定性。无锁算法通过消除锁的使用自然避免了这些问题的发生。</p><p><strong>3. 更好的可伸缩性</strong></p><p>随着处理器核心数量的增加，能够有效利用多核架构变得至关重要。无锁算法由于不依赖于全局锁，因此可以在多个核心上同时执行不同的任务而不互相干扰，从而更好地利用硬件资源。相反，基于锁的设计可能会成为瓶颈，尤其是在高争用的情况下，因为所有的线程都试图访问同一个锁。</p><p><strong>4. 原子操作的高效性</strong></p><p>现代CPU提供了对原子操作的强大支持，比如 Compare-And-Swap (CAS) 操作。这些原子指令能够在硬件层面保证某些类型的同步操作是原子性的，无需额外的软件层同步开销。虽然单个 CAS 操作可能并不总是成功，但它的失败处理非常轻量级——通常是立即重试或者根据策略短暂等待后再重试，而不是像锁那样导致线程进入等待状态。</p><p><strong>5. 降低锁争用带来的开销</strong></p><p>在高度竞争的环境中，锁争用会导致严重的性能下降。每个试图获取已被占用的锁的尝试都会失败，并且线程不得不等待。而在无锁算法中，尽管也可能存在“竞争”——即多个线程同时尝试修改同一数据结构的情况，但是这种竞争是以非阻塞的方式处理的，允许失败的操作快速重试，而不是陷入长时间的等待。</p><h2><span id="cas是什么">CAS是什么</span></h2><p>CAS是一种硬件提供的原子操作，它接受三个参数：内存位置（V）、预期原值（A）和新值（B）。这个操作的功能是仅当内存位置V的当前值等于预期原值A时，才将V的值更新为新值B，并返回操作是否成功的布尔值。如果在此期间另一个线程改变了V的值，使得其不再等于A，则该操作失败，通常会重试。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> expectedValue, <span class="type">int</span> newValue)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> V.compareAndSet(expectedValue, newValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="账户余额管理功能案例分析">账户余额管理功能案例分析</span></h2><h3><span id="账户接口">账户接口</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="comment">// 获取余额</span></span><br><span class="line">    Integer <span class="title function_">getBalance</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 取款</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法内会启动 1000 个线程，每个线程做 -10 元 的操作</span></span><br><span class="line"><span class="comment">     * 如果初始余额为 10000 那么正确的结果应当是 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">(Account account)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个线程列表，用于存储即将创建的1000个线程</span></span><br><span class="line">        List&lt;Thread&gt; ts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 记录操作开始的时间，用于计算操作耗时</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环创建1000个线程，每个线程执行的操作是：从账户中取款10元</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            ts.add(<span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                account.withdraw(<span class="number">10</span>);</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动所有线程，让它们开始执行取款操作</span></span><br><span class="line">        ts.forEach(Thread::start);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待所有线程完成取款操作，确保主线程在所有取款线程完成后才继续执行</span></span><br><span class="line">        ts.forEach(t -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                t.join();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记录操作结束的时间，用于计算操作耗时</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印账户余额和操作耗时</span></span><br><span class="line">        System.out.println(account.getBalance()</span><br><span class="line">                + <span class="string">&quot; cost: &quot;</span> + (end - start) / <span class="number">1000_000</span> + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="线程不安全的情况">线程不安全的情况</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.cas;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountUnsafeImpl</span> <span class="keyword">implements</span> <span class="title class_">Account</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountUnsafeImpl</span><span class="params">(Integer balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">        balance -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="通过锁实现线程安全">通过锁实现线程安全</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountSafeImplSychronized</span> <span class="keyword">implements</span> <span class="title class_">Account</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountSafeImplSychronized</span><span class="params">(Integer balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">        balance -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="无锁实现线程安全">无锁实现线程安全</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountSafeImpl</span> <span class="keyword">implements</span> <span class="title class_">Account</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicInteger balance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountSafeImpl</span><span class="params">(Integer balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance = <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 无限循环，尝试更新余额，直到成功</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 获取当前余额</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">prev</span> <span class="operator">=</span> balance.get();</span><br><span class="line">            <span class="comment">// 计算消费后的余额</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> prev - amount;</span><br><span class="line">            <span class="comment">// 尝试更新余额，如果成功则退出循环</span></span><br><span class="line">            <span class="keyword">if</span> (balance.compareAndSet(prev, next)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="测试">测试：</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建账户</span></span><br><span class="line">log.debug(<span class="string">&quot;线程不安全的情况：&quot;</span>);</span><br><span class="line">Account.demo(<span class="keyword">new</span> <span class="title class_">AccountUnsafeImpl</span>(<span class="number">10000</span>));</span><br><span class="line">log.debug(<span class="string">&quot;线程安全(锁)的情况：&quot;</span>);</span><br><span class="line">Account.demo(<span class="keyword">new</span> <span class="title class_">AccountSafeImplSychronized</span>(<span class="number">10000</span>));</span><br><span class="line">log.debug(<span class="string">&quot;线程安全(无锁)的情况：&quot;</span>);</span><br><span class="line">Account.demo(<span class="keyword">new</span> <span class="title class_">AccountSafeImpl</span>(<span class="number">10000</span>));</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/368c13318e6b4b8b98960b5f976765a7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="分析无锁实现线程安全">分析无锁实现线程安全：</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">    <span class="comment">// 无限循环，尝试更新余额，直到成功</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取当前余额</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">prev</span> <span class="operator">=</span> balance.get();</span><br><span class="line">        <span class="comment">// 计算消费后的余额</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> prev - amount;</span><br><span class="line">        <span class="comment">// 尝试更新余额，如果成功则退出循环</span></span><br><span class="line">        <span class="keyword">if</span> (balance.compareAndSet(prev, next)) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><blockquote><ul><li>使用 while(true) 循环不断尝试更新余额，直到成功为止。</li><li>compareAndSet(prev, next) 方法用于比较当前余额是否为预期值 (prev)，如果是，则将余额设置为新值 (next)。如果不是，则说明在此期间有其他线程修改了余额，因此当前线程会再次尝试。</li><li>这种方式确保了即使在并发环境中，余额的更新也能正确完成，不会出现数据竞争或其他一致性问题。</li></ul></blockquote><h4><span id="源码分析">源码分析：</span></h4><p>看一下AtomicInteger底层实现：</p><p>可以发现通过AtomicInteger包裹整型，底层使用volatile关键字，保证了可见性和禁止指令重排序。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Creates a new AtomicInteger with the given initial value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> initialValue the initial value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">AtomicInteger</span><span class="params">(<span class="type">int</span> initialValue)</span> &#123;</span><br><span class="line">    value = initialValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> compareAndSet方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="built_in">this</span>, valueOffset, expect, update);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><blockquote><p>该代码实现了原子级别的比较并设置操作：</p><ul><li>如果当前值等于期望值，则将值更新为新值，并返回true。</li><li>如果当前值不等于期望值，则不进行更新，返回false。</li><li>使用Unsafe类的compareAndSwapInt方法实现底层的CAS（Compare-And-Swap）操作。</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapInt</span><span class="params">(Object var1, <span class="type">long</span> var2, <span class="type">int</span> var4, <span class="type">int</span> var5)</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><p><strong>如有错误，欢迎指正！！！</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java并发编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java并发编程2(锁-Sychronized)</title>
      <link href="/2025/04/20/JUC2/"/>
      <url>/2025/04/20/JUC2/</url>
      
        <content type="html"><![CDATA[<h1><span id="认识java对象头">认识Java对象头</span></h1><p><img src="/./../images/62007980c9464950aa873bb9b92923c2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>32位虚拟机对象头：</p><p><img src="/./../images/015d875a32564d24bc821129428b6259.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>64位虚拟机对象头： </p><p><img src="/./../images/caa69615a9754ef68b053d75b2ab6cc4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>1.Mark Word（标记字）:</strong></p><ul><li>Mark Word是对象头的一部分，用于存储对象自身的哈希码、GC分代年龄、锁状态标志、线程持有的锁、偏向线程ID（或偏向时间戳）、偏向模式以及锁的状态等信息。</li><li>标记字的大小和具体内容可能因JVM实现的不同而有所变化。例如，在64位JVM上，默认情况下Mark Word占用64位（8字节），而在32位JVM上则是32位（4字节）。</li></ul><p><strong>2.Class Pointer（类指针）:</strong></p><ul><li>这是指向该对象对应类（Class）的指针，通过这个指针可以访问到对象所属类的元数据（如方法表、字段描述等）。类指针的大小依赖于JVM的具体实现及其是否开启了压缩指针（Compressed Oop）选项。</li><li>在某些情况下，比如当使用了-XX:+UseCompressedClassPointers选项时，类指针会被压缩以节省内存。</li></ul><p><strong>3.Array Length（数组长度，仅适用于数组对象）:</strong></p><ul><li>如果对象是一个数组，则对象头还需要额外的空间来存储数组的长度。这是因为非数组对象不需要知道其“长度”，但数组需要这个信息以便进行边界检查等操作。</li></ul></blockquote><hr><h1><span id="sychronized锁原理">sychronized锁原理</span></h1><p><img src="/./../images/d51144c25ee94925aefe66676e1fb4ea.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="基本概念">基本概念</span></h2><ul><li><strong>对象头（Object Header）：</strong>每个Java对象都有一个对象头，其中包含了一些元数据信息。对于普通对象来说，这部分包括Mark Word和Class Pointer。Mark Word存储了对象的哈希码、GC分代年龄、锁状态标志等信息。</li><li><strong>Monitor（监视器&#x2F;管程）：</strong>这是JVM内部的一种同步机制。每个对象都关联有一个监视器锁。当一个线程获取到这个锁时，它可以进入临界区；其他试图进入同一临界区的线程必须等待，直到第一个线程释放锁。</li></ul><h2><span id="工作原理">工作原理</span></h2><h3><span id="1作用在方法上">1.作用在方法上</span></h3><ul><li>使用synchronized修饰一个实例方法时，该方法被调用时会自动获取当前实例（即this）的monitor锁。</li><li>如果是静态方法，则锁定的是该类的Class对象。</li></ul><h3><span id="2作用在代码块上">2.作用在代码块上</span></h3><ul><li>使用synchronized代码块可以更灵活地指定要锁定的对象，获取的是括号中的对象。</li></ul><h2><span id="工作机制">工作机制</span></h2><blockquote><p>字节码层面：使用synchronized关键字时，编译器会将同步块或方法转换为特定的字节码指令。对于同步方法，编译器会在方法信息中设置一个标志位（ACC_SYNCHRONIZED）。对于同步代码块，则会生成monitorenter和monitorexit指令。</p></blockquote><p><strong>monitorenter 和 monitorexit 指令：</strong></p><ul><li>monitorenter：每个对象都有一个与之关联的monitor（监视器锁）。当线程执行到monitorenter指令时，它尝试获取该对象的monitor。如果monitor未被其他线程持有，则当前线程成功获取monitor并继续执行；否则，线程将被阻塞直到获得monitor。</li><li>monitorexit：当线程执行完同步代码块后，会执行monitorexit指令以释放monitor，允许其他等待获取该monitor的线程继续执行。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">           cnt ++;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>上段代码main方法生成的字节码指令如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(java.lang.String[])</span>;</span><br><span class="line">  Code:</span><br><span class="line">     <span class="number">0</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field lock:Ljava/lang/Object;</span></span><br><span class="line">     <span class="number">3</span>: dup</span><br><span class="line">     <span class="number">4</span>: astore_1</span><br><span class="line">     <span class="number">5</span>: monitorenter                     <span class="comment">// 获取锁</span></span><br><span class="line">     <span class="number">6</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field cnt:I</span></span><br><span class="line">     <span class="number">9</span>: iconst_1</span><br><span class="line">    <span class="number">10</span>: iadd</span><br><span class="line">    <span class="number">11</span>: putstatic     #<span class="number">3</span>                  <span class="comment">// Field cnt:I</span></span><br><span class="line">    <span class="number">14</span>: aload_1</span><br><span class="line">    <span class="number">15</span>: monitorexit                      <span class="comment">// 释放锁</span></span><br><span class="line">    <span class="number">16</span>: <span class="keyword">goto</span>          <span class="number">24</span></span><br><span class="line">    <span class="number">19</span>: astore_2</span><br><span class="line">    <span class="number">20</span>: aload_1</span><br><span class="line">    <span class="number">21</span>: monitorexit                      <span class="comment">// 确保在异常情况下也释放锁</span></span><br><span class="line">    <span class="number">22</span>: aload_2</span><br><span class="line">    <span class="number">23</span>: athrow</span><br><span class="line">    <span class="number">24</span>: <span class="keyword">return</span></span><br><span class="line">  Exception table:</span><br><span class="line">     from    to  target type</span><br><span class="line">         <span class="number">6</span>    <span class="number">16</span>    <span class="number">19</span>   any</span><br><span class="line">        <span class="number">19</span>    <span class="number">22</span>    <span class="number">19</span>   any</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="jvm优化锁">JVM优化锁</span></h2><blockquote><p><strong>1.无锁状态：</strong></p><ul><li>这是对象的初始状态，没有任何线程持有该对象的Monitor锁。</li></ul><p><strong>2.偏向锁（Biased Locking）：</strong></p><ul><li>偏向锁是针对单线程访问场景的一种优化。它假设如果一个线程获得了某个对象的锁，那么接下来很可能还是这个线程继续访问该对象。</li><li>当一个线程第一次进入同步块时，会尝试获取偏向锁，并将线程ID记录在对象头中。如果之后还是同一个线程进入同步块，则不需要再次获取锁，减少了锁获取的开销。</li><li>如果有其他线程试图获取偏向锁，则需要撤销偏向锁并升级为轻量级锁。</li></ul><p><strong>3.轻量级锁（Lightweight Locking）：</strong></p><ul><li>当存在少量锁竞争时，使用轻量级锁来代替重量级锁，以提高性能。</li><li>轻量级锁通过CAS（Compare And Swap）操作尝试原子性地获得锁。如果成功，则线程可以进入临界区；如果失败，表示存在锁竞争，锁可能会升级为重量级锁。</li></ul><p><strong>4.重量级锁（Heavyweight Locking）：</strong></p><ul><li>当锁竞争加剧时，JVM会将锁升级为重量级锁。重量级锁涉及到操作系统层面的线程挂起和恢复操作，因此开销较大。</li><li>在这种状态下，所有竞争锁的线程都会被阻塞，直到当前持有锁的线程释放锁为止。</li></ul><p><strong>5.自旋锁（Spin Lock）：</strong></p><ul><li>自旋锁不是一种独立的锁类型，而是一种策略。当一个线程尝试获取锁时，它可以选择“自旋”一段时间，而不是立即进入阻塞状态。这样可以在等待锁释放的过程中减少上下文切换的开销。</li><li>Java中的自旋锁通常与轻量级锁结合使用，在某些情况下可以作为一种优化手段。</li></ul><p><strong>6.可重入锁（Reentrant Lock）：</strong></p><ul><li>synchronized机制本身就是可重入的，这意味着如果一个线程已经持有了某个对象的锁，它可以再次获取相同的锁而不会导致死锁。</li><li>每次重新获取锁时，计数器会增加；每次释放锁时，计数器会减少，直到计数器归零才真正释放锁。</li></ul></blockquote><p>在Java中默认第一次给对象加锁就是<strong>偏向锁</strong>（默认延迟加载），假如t1线程已经给obj加上锁（偏向锁）了，当有另外一个线程t2也试图获取同一把锁时，偏向锁升级为轻量级锁。</p><p><strong>轻量级锁</strong>通过使用CAS操作尝试将对象头中的Mark Word更新为指向当前线程的Lock Record的指针。如果成功，则线程获得了轻量级锁，并继续执行；如果失败（意味着存在锁竞争），则会尝试进行锁膨胀，轻量级锁尝试升级为重量级锁。</p><p><strong>重量级锁</strong>的核心是Monitor（监视器锁），如果Monitor已被其他线程持有，则试图获取锁的线程将被放入Entry Set中等待。此时，线程会进入阻塞状态，即线程会被挂起，不会占用CPU资源，直到Monitor锁被释放并且该线程有机会重新尝试获取锁，这允许Entry Set中的一个或多个线程重新竞争Monitor锁。如果有线程处于Wait Set中，那么根据调用的是notify()还是notifyAll()方法，相应的线程会被移动到Entry Set中，重新参与Monitor锁的竞争。</p><h2><span id="monitor锁">Monitor锁</span></h2><ul><li><strong>Owner（所有者）：</strong>指向当前持有Monitor的线程。</li><li><strong>Entry Set（入口集）：</strong>等待获取Monitor锁的线程队列。如果一个线程尝试进入一个已经被其他线程持有的同步块或方法，则该线程会被放入这个队列中，直到Monitor被释放并且该线程有机会重新尝试获取锁。</li><li><strong>Wait Set（等待集）：</strong>调用了wait()方法并正在等待某个条件满足的线程集合。这些线程暂时释放了Monitor，并且不会参与锁的竞争，直到另一个线程调用notify()或notifyAll()方法通知它们可以继续执行。</li></ul><hr><h2><span id="waitx2fnotify">wait&#x2F;notify</span></h2><blockquote><ul><li><strong>wait()：</strong>使当前线程等待，直到另一个线程调用同一个对象上的notify()或notifyAll()方法。调用wait()时，当前线程会释放它持有的对象锁，并进入该对象的“等待集”。只有当其他线程调用了相应的通知方法并且当前线程被选中（对于notify()）或所有等待的线程都被唤醒（对于notifyAll()），当前线程才能重新获取锁并继续执行。</li><li><strong>notify()：</strong>随机唤醒一个正在等待该对象监视器的单个线程。如果多个线程都在等待，则选择其中一个线程进行唤醒。被唤醒的线程并不能立即执行，而是要等到当前线程退出同步代码块并释放锁之后。</li><li><strong>notifyAll()：</strong>唤醒所有正在等待该对象监视器的线程。尽管所有线程都会被唤醒，但只有一个线程能够成功获得锁并继续执行；其余线程将再次进入等待状态或者竞争锁。</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;running &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;end... &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;running &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;end... &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;唤醒线程&quot;</span>);</span><br><span class="line">        <span class="comment">// lock.notify(); // 唤醒一个线程</span></span><br><span class="line">        lock.notifyAll(); <span class="comment">// 唤醒所有线程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/d6aa6da84d834c43a424844811bd47fe.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  调用wait就是当前线程得到了对象锁了，但是我不往下执行了，我把锁释放给其他线程先去执行，我自己到<strong>Wait Set（等待集）</strong>中去，有人（线程）叫我（notify）我再去排队进入<strong>Entry Set（入口集）</strong>，每有人叫我我就继续等着。（感觉很像坐高铁，我虽然进了高铁站，但是车次没有轮到我，那么我就继续等着，如果叫到我了我就去排队等待坐车）</p><h2><span id="parkx2funpark">park&#x2F;unpark</span></h2><p>它们是 LockSupport 类中的方法</p><blockquote><p>&#x2F;&#x2F; 暂停当前线程</p><p>LockSupport.park();</p><p>&#x2F;&#x2F; 恢复某个线程的运行</p><p>LockSupport.unpark(暂停线程对象)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.thread&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;t1 running &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            LockSupport.park();</span><br><span class="line">            log.debug(<span class="string">&quot;t1 end &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">        LockSupport.unpark(t1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 执行结果：</p><p>16:10:58 [t1] c.thread - t1 running 1742631058230<br> 16:10:59 [t1] c.thread - t1 end 1742631059240</p><h1><span id="线程状态转换案例">线程状态转换案例</span></h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.thread&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test5</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;running t1&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">1000</span>);</span><br><span class="line">                    obj.notify();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;running t2&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    obj.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;running t3&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    obj.wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">        log.debug(<span class="string">&quot;t1 &#123;&#125; t2 &#123;&#125; t3 &#123;&#125;&quot;</span>, t1.getState(), t2.getState(), t3.getState());</span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;t1 &#123;&#125; t2 &#123;&#125; t3 &#123;&#125;&quot;</span>, t1.getState(), t2.getState(), t3.getState());</span><br><span class="line">        sleep(<span class="number">2000</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;t1 &#123;&#125; t2 &#123;&#125; t3 &#123;&#125;&quot;</span>, t1.getState(), t2.getState(), t3.getState());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>运行结果：</p><p>21:08:27 [main] c.thread - t1 RUNNABLE t2 RUNNABLE t3 RUNNABLE<br> 21:08:27 [t2] c.thread - running t2<br> 21:08:27 [t2] c.thread - running t3<br> 21:08:27 [Thread-0] c.thread - running t1<br> 21:08:27 [main] c.thread - t1 TIMED_WAITING t2 WAITING t3 WAITING<br> 21:08:29 [main] c.thread - t1 TERMINATED t2 TERMINATED t3 WAITING </p><p>第一次打印分析：三个线程都启动了</p><p>第二次打印分析：此时t1在sleep，t2和t3都在wait</p><p>第三次打印分析：t1sleep完了，然后随机唤醒一个waiting的线程，所以t1和t2都执行完了，t3没有人唤醒它</p><h1><span id="死锁">死锁</span></h1><h2><span id="概念">概念</span></h2><blockquote><p>死锁（Deadlock）是指两个或更多线程在执行过程中，<strong>由于争夺资源而造成的一种互相等待的状态</strong>。在这种状态下，没有任何线程能够继续前进，整个系统或部分系统因此陷入停滞。死锁是并发编程中常见的问题之一，尤其是在多线程环境下对共享资源进行访问时。</p></blockquote><h2><span id="死锁发生的必要条件">死锁发生的必要条件</span></h2><ol><li><strong>互斥条件：</strong>至少有一个资源必须处于非共享模式，即只能被一个线程占用。例如，文件写入权限通常就是互斥的。</li><li><strong>占有并等待条件：</strong>一个线程已经占有了至少一个资源，并且正在等待其他线程占有的资源。也就是说，该线程不会释放自己已获得的资源直到它获得了所有需要的资源。</li><li><strong>不可剥夺条件：</strong>资源不能被强制从某个线程中抢走，只能由拥有它的线程主动释放。这意味着一旦一个线程获得了某个资源，它可以在不自愿的情况下保持对该资源的控制权，直到它完成任务并释放资源。</li><li><strong>循环等待条件：</strong>存在一组等待资源的线程链，其中每个线程都在等待下一个线程当前占有的资源。例如，线程A等待线程B持有的资源，而线程B又在等待线程C持有的资源，以此类推，直到某一线程又在等待线程A持有的资源，形成一个闭环。</li></ol><p>一个线程同时获取多把锁就容易导致死锁</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test6</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;lockA &#123;&#125;&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;lockB &#123;&#125;&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockB) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;lockB &#123;&#125;&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">synchronized</span> (lockA) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;lockA &#123;&#125;&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        log.debug(<span class="string">&quot;t1 &#123;&#125; t2 &#123;&#125;&quot;</span>, t1.getState(), t2.getState());</span><br><span class="line">        sleep(<span class="number">100</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;t1 &#123;&#125; t2 &#123;&#125;&quot;</span>, t1.getState(), t2.getState());</span><br><span class="line">        sleep(<span class="number">2000</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;t1 &#123;&#125; t2 &#123;&#125;&quot;</span>, t1.getState(), t2.getState());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/824b3abfa3a044f58184423af78b18c0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>分析：</p><p>t1获得lockA的锁，t2获得lockB的锁，t1、t2都上锁成功，然后t1想要获得lockB，但是lockB被t2占有，t2只有等到全部执行完才能释放锁，但是t2中又要获得lockA的锁，但是lockA的锁被t1占有，又回到t1，t1也只能是执行完才能释放锁，然后t1和t2就互相等待对方放锁，造成死锁。 </p><p> —-&gt; 定位死锁的工具：jconsole</p><h2><span id="哲学家问题">哲学家问题</span></h2><ul><li>有五位哲学家，围坐在圆桌旁。 </li><li>他们只做两件事，思考和吃饭，思考一会吃口饭，吃完饭后接着思考。 </li><li>吃饭时要用两根筷子吃，桌上共有 5 根筷子，每位哲学家左右手边各有一根筷子。 </li><li>如果筷子被身边的人拿着，自己就得等待</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.sychronized;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test7&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test7</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p1&quot;</span>, c1, c2);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p2&quot;</span>, c2, c3);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p3&quot;</span>, c3, c4);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p4&quot;</span>, c4, c5);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p5&quot;</span>, c5, c1);</span><br><span class="line"></span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        p4.start();</span><br><span class="line">        p5.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChopSticks</span> &#123;</span><br><span class="line">   String name;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">ChopSticks</span><span class="params">(String name)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;筷子 &#123; &quot;</span> + name + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Philosopher&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Philosopher</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ChopSticks left;</span><br><span class="line">    <span class="keyword">final</span> ChopSticks right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Philosopher</span><span class="params">(String name, ChopSticks left, ChopSticks right)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name); <span class="comment">// 线程名字</span></span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;&#123;&#125; eat&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (left) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (right) &#123;</span><br><span class="line">                    eat();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/a9288f2e51a34287858f1216a46b81b0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h1><span id="活锁">活锁</span></h1><blockquote><p>活锁（Livelock）是并发编程中的一种问题，类似于死锁，但它涉及的是线程虽然没有被阻塞，但却无法继续向前推进的情况。在活锁的情况下，线程不断地尝试执行某项操作但总是失败，并且不断地重复相同的操作，导致它们实际上没有取得任何进展。这种现象通常发生在试图避免死锁的过程中，特别是当多个线程相互改变状态以试图解决另一个线程的问题时。</p></blockquote><p>活锁出现在两个线程互相改变对方的结束条件，最后谁也无法结束。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test8</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">while</span> (cnt &gt; <span class="number">0</span>) &#123;</span><br><span class="line">               cnt --;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   sleep(<span class="number">100</span>);</span><br><span class="line">               &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">               log.debug(<span class="string">&quot;t1 : &#123;&#125;&quot;</span>, cnt);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">while</span> (cnt &lt; <span class="number">100</span>) &#123;</span><br><span class="line">               cnt ++;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   sleep(<span class="number">100</span>);</span><br><span class="line">               &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                   e.printStackTrace();</span><br><span class="line">               &#125;</span><br><span class="line">               log.debug(<span class="string">&quot;t2 : &#123;&#125;&quot;</span>, cnt);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/137f3cd4c53443548aeadd96a02d8527.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h1><span id="饥饿">饥饿</span></h1><h2><span id="概念">概念</span></h2><blockquote><p> “饥饿”（Starvation）是指一个线程由于无法获得所需的资源而无法继续执行的情况。尽管该线程没有被阻塞，但由于其他线程频繁地抢占资源，导致这个线程得不到足够的CPU时间或其他必要的资源来推进其任务</p></blockquote><h2><span id="饥饿的原因">饥饿的原因</span></h2><ol><li><strong>资源竞争：</strong>当多个线程竞争有限的资源时，如果没有公平的调度机制，某些线程可能会始终得不到资源，从而导致饥饿。例如，如果系统总是优先处理高优先级的任务，那么低优先级的任务可能永远得不到执行的机会。</li><li><strong>不恰当的锁机制：</strong>在使用锁进行同步控制时，如果某个线程长时间持有锁而不释放，其他等待该锁的线程就会被阻塞，可能导致这些线程出现饥饿现象。</li><li><strong>忙等待（Busy-waiting）：</strong>如果一个线程通过忙等待的方式来等待某个条件成立，而这个条件很少或几乎不会成立，那么这个线程就会一直消耗CPU资源，同时无法完成实际的工作。</li><li><strong>不公平的调度器：</strong>操作系统或运行时环境中的线程调度器如果没有实现公平调度算法，也可能导致某些线程长期得不到执行机会。</li></ol><h1><span id="reentrantlock"><strong>ReentrantLock</strong></span></h1><blockquote><p>ReentrantLock reentrantLock &#x3D; new ReentrantLock(true);</p><p>reentrantLock.lock();</p><p>try {</p><p>  &#x2F;&#x2F; 临界区代码</p><p>} finally {</p><p>  reentrantLock.unlock()</p><p>}</p></blockquote><blockquote><p>ReentrantLock(false) : 非公平锁</p><p>ReentrantLock(true) : 公平锁</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">reentrantLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            reentrantLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                    cnt++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                reentrantLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            reentrantLock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                    cnt--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                reentrantLock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t1.join();</span><br><span class="line">        t2.join();</span><br><span class="line">        log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>,cnt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="基本锁操作">基本锁操作</span></h2><blockquote><p><strong>lock()：</strong></p><ul><li>获取锁。</li><li>如果锁已经被其他线程持有，则当前线程将被阻塞，直到获取到锁为止。</li></ul><p><strong>lockInterruptibly() throws InterruptedException：</strong></p><ul><li>获取锁，但可以响应中断。</li><li>如果当前线程在等待获取锁的过程中被中断，则抛出 InterruptedException 异常并退出等待状态。</li></ul><p><strong>tryLock()：</strong></p><ul><li>尝试获取锁，如果锁未被其他线程持有，则立即返回 true；否则立即返回 false，不会阻塞当前线程。</li></ul><p><strong>tryLock(long timeout, TimeUnit unit) throws InterruptedException：</strong></p><ul><li>在给定的时间内尝试获取锁。</li><li>如果在指定时间内成功获取锁，则返回 true；如果超时或者当前线程被中断，则返回 false 或抛出 InterruptedException。</li></ul><p><strong>unlock()：</strong></p><ul><li>释放锁。</li><li>每次调用 lock() 方法获得一次锁后，必须对应地调用一次 unlock() 来释放锁。通常在 finally 块中调用以确保即使发生异常也能正确释放锁。</li></ul></blockquote><h2><span id="查看锁状态的方法">查看锁状态的方法</span></h2><blockquote><ul><li><strong>isHeldByCurrentThread()：</strong>判断当前线程是否持有该锁。</li><li><strong>getHoldCount()：</strong>返回当前线程获取这个锁的次数（重入计数）。每次调用 lock() 方法都会增加计数，每次调用 unlock() 方法都会减少计数。</li><li><strong>isLocked()：</strong>判断锁是否被任意一个线程持有。</li><li><strong>hasQueuedThreads()：</strong>查询是否有线程正在等待获取此锁。</li></ul></blockquote><h2><span id="条件变量相关的方法">条件变量相关的方法</span></h2><blockquote><p><strong>newCondition()：</strong></p><ul><li>创建一个新的 Condition 实例，与当前锁关联。</li><li>可以使用条件变量来实现类似于 Object.wait() 和 Object.notify() 的功能，但更加灵活和强大。</li></ul></blockquote><h2><span id="可重入锁">可重入锁</span></h2><p>这是指一个线程可以尝试多次获取同一个锁，并且不会发生死锁的情况。每次获取锁（调用lock()方法）都需要相应的释放锁（调用unlock()方法）。锁获取次数与锁释放次数需要匹配。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReentrantLock 可重入锁</span></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">reentrantLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;method1 running&quot;</span>);</span><br><span class="line">            method2();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            reentrantLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;method2 running&quot;</span>);</span><br><span class="line">            method3();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            reentrantLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;</span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;method3 running&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            reentrantLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        method1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>执行结果：</p><p>10:17:12 [main] c.Test2 - method1 running<br> 10:17:12 [main] c.Test2 - method2 running<br> 10:17:12 [main] c.Test2 - method3 running </p><h2><span id="可打断lockinterruptibly">可打断(lockInterruptibly)</span></h2><p>这个方法允许你以一种可以响应中断的方式获取锁。如果当前线程在调用lockInterruptibly()方法时没有被打断，并且能够获取到锁，则它将继续执行；但如果此时有另一个线程已经持有了这个锁，那么当前线程将被阻塞，直到锁可用或当前线程被中断。<br> <strong>如果在等待获取锁的过程中收到了中断请求</strong>（即另一个线程调用了当前线程的interrupt()方法），则会<strong>抛出InterruptedException异常</strong>，从而允许你捕获这个异常并进行相应的处理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可打断</span></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test3</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;t1 running&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.lockInterruptibly();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1:在等锁过程中被打断&quot;</span>);</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 获取锁 &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        lock.lock();</span><br><span class="line">        log.debug(<span class="string">&quot;主线程获得锁&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">1000</span>);</span><br><span class="line">            t1.interrupt(); <span class="comment">// 打断t1</span></span><br><span class="line">            log.debug(<span class="string">&quot;执行打断&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;主线程释放锁&quot;</span>);</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/c2ead97c3aab40918cd54e89b8562830.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="不可打断">不可打断</span></h2><p>在ReentrantLock中，默认的锁获取方法lock()是不可中断的。这意味着如果一个线程尝试获取一个已经被其他线程持有的锁，它将会一直阻塞直到成功获取到锁，<strong>即使这个线程在这期间被中断（即调用了该线程的interrupt()方法），也不会抛出InterruptedException，而是继续等待直至获得锁</strong>。这种行为可以被视为“不可打断”。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不可打断</span></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test4</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;t1 启动 &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 获得锁 &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 释放锁 &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        lock.lock();</span><br><span class="line">        log.debug(<span class="string">&quot;主线程获得锁 &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        t1.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;执行打断 &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            sleep(<span class="number">1000</span>);</span><br><span class="line">            t1.interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;主线程释放锁 &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>执行结果：</p><blockquote><p>10:18:41 [main] c.Test4 - 主线程获得锁 1742696321911<br> 10:18:41 [main] c.Test4 - 执行打断 1742696321917<br> 10:18:41 [t1] c.Test4 - t1 启动 1742696321917<br> 10:18:42 [main] c.Test4 - 主线程释放锁 1742696322931<br> 10:18:42 [t1] c.Test4 - t1 获得锁 1742696322931<br> 10:18:42 [t1] c.Test4 - t1 释放锁 1742696322931</p></blockquote><h2><span id="锁超时trylock">锁超时(tryLock)</span></h2><blockquote><ul><li><strong>tryLock()：</strong>尝试立即获取锁。如果锁当前没有被其他线程持有，则该方法会成功获取锁并返回true；如果锁已经被其他线程持有，则该方法不会阻塞，而是立刻返回false。</li><li><strong>tryLock(long timeout, TimeUnit unit)：</strong>尝试在指定的时间内获取锁。如果在这个时间段内成功获取到了锁，则返回true；如果在这个时间段内未能获取到锁（即锁一直被其他线程持有），则返回false。此外，如果在等待期间当前线程被中断，它将抛出InterruptedException。</li></ul></blockquote><h3><span id="立刻返回">立刻返回</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 锁超时 --- 立刻返回</span></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test5</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;t1 running&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (!lock.tryLock()) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 获取锁失败, 立刻返回&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 获得锁成功&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        lock.lock();</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id><img src="/./../images/1235f9da30244a859ad5c81b19c4eb8c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><h3><span id="超时释放">超时释放</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test6</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;t1 running&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 超时释放</span></span><br><span class="line">                <span class="keyword">if</span> (!lock.tryLock(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;t1 1s尝试获得锁失败&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 获得锁成功&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        lock.lock();</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">1500</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;主线程释放锁&quot;</span>);</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/1782ad0c5b2d4513a0916fd75b9fc1dc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  <strong>例子：哲学家问题</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test7&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test7</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">        <span class="type">ChopSticks</span> <span class="variable">c5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChopSticks</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p1&quot;</span>, c1, c2);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p2&quot;</span>, c2, c3);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p3&quot;</span>, c3, c4);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p4&quot;</span>, c4, c5);</span><br><span class="line">        <span class="type">Philosopher</span> <span class="variable">p5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Philosopher</span>(<span class="string">&quot;p5&quot;</span>, c5, c1);</span><br><span class="line"></span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        p4.start();</span><br><span class="line">        p5.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChopSticks</span> <span class="keyword">extends</span> <span class="title class_">ReentrantLock</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChopSticks</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;筷子&#123;&quot;</span> + name + <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Philosopher&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Philosopher</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    ChopSticks left;</span><br><span class="line">    ChopSticks right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Philosopher</span><span class="params">(String name, ChopSticks left, ChopSticks right)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;&#123;&#125; eating&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 尝试获得左边的筷子</span></span><br><span class="line">            <span class="keyword">if</span> (left.tryLock()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 尝试获得右边的筷子</span></span><br><span class="line">                    <span class="keyword">if</span> (right.tryLock()) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            eat();</span><br><span class="line">                        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                            right.unlock();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    left.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="公平锁x2f非公平锁">公平锁&#x2F;非公平锁</span></h2><h3><span id="非公平锁">非公平锁</span></h3><ul><li><strong>定义：</strong>在非公平锁机制下，锁不会保证按照请求的先后顺序来分配。当锁可用时，任何一个尝试获取锁的线程都有机会获得锁，包括那些刚刚释放了这个锁并且立刻再次尝试获取它的线程。</li><li><strong>默认行为：</strong>如果不特别指定，ReentrantLock默认采用的是非公平锁策略（即new ReentrantLock()等同于new ReentrantLock(false)）。</li><li><strong>性能：</strong>通常情况下，非公平锁可以获得更高的吞吐量，因为它减少了线程上下文切换的次数，并且允许线程在锁刚被释放时迅速重新获取锁，而不需要排队等待。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非公平锁</span></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test8</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500</span>; i ++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;&#123;&#125; 获得锁成功&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    lock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">&quot;t&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;start-----------------------&quot;</span>);</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;&#123;&#125; 获得锁成功 running&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;强行抢夺&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <img src="/./../images/a095c152aa774e01b24e9b73518d44de.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="公平锁">公平锁</span></h3><ul><li><strong>定义：</strong>当使用公平锁时，锁会按照线程请求的顺序来分配。也就是说，最早提出请求的线程将最先被授予锁。这有助于避免“饥饿”现象，即某些线程永远无法获得锁。</li><li><strong>实现：</strong>要创建一个公平锁的ReentrantLock实例，可以在构造函数中传入参数true，例如new ReentrantLock(true)。</li><li><strong>性能：</strong>由于需要维护线程请求锁的顺序，公平锁可能会导致较低的吞吐量。因为每当有线程释放锁后，系统必须检查等待队列中的下一个线程是否可以获取锁，而不是简单地允许当前正在尝试获取锁的线程直接获取它。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公平锁</span></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test8</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500</span>; i ++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;&#123;&#125; 获得锁成功&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    lock.unlock();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">&quot;t&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;start-----------------------&quot;</span>);</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;&#123;&#125; 获得锁成功 running&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;强行抢夺&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id><img src="/./../images/17bd9de5d9e94b609650f44fbf2baa93.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><h2><span id="awaitx2fcondition">await&#x2F;Condition</span></h2><h3><span id="等待条件await方法系列"><strong>等待条件（await方法系列）：</strong></span></h3><p>当一个线程需要等待某个特定条件发生时，可以调用Condition对象的await()方法进入等待状态。这会导致当前线程释放锁并等待，直到另一个线程调用了同一个Condition对象的signal()或signalAll()方法。常见的await方法包括：</p><ul><li>await()：使当前线程进入等待状态，直到被通知或中断。</li><li>awaitUninterruptibly()：类似于await()，但是不会响应中断。</li><li>awaitNanos(long nanosTimeout)：尝试等待指定的时间长度，如果超时则返回剩余时间。</li><li>awaitUntil(Date deadline)：等待直到指定的时间点，如果到达截止时间还未被通知，则继续执行。</li></ul><h3><span id="通知条件signal方法系列">通知条件（signal方法系列）：</span></h3><p>当一个线程修改了共享资源并且认为可能满足了一个或多个正在等待的线程的条件时，它可以调用Condition对象的signal()或signalAll()方法来唤醒等待的线程。</p><ul><li>signal()：唤醒一个等待此Condition的线程。如果有多个线程在等待，则选择其中的一个进行唤醒。</li><li>signalAll()：唤醒所有等待此Condition的线程。</li></ul><blockquote><p>可以把Condition实例看作对应的等待队列，不同的线程可以调用不同的等待队列的await方法，使得当前线程进入当前的等待队列中 </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 等待队列 Condition实例</span></span><br><span class="line"><span class="comment">// 唤醒线程：signal或signalAll</span></span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.Test9&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test9</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Condition</span> <span class="variable">waitBreadQueue</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">Condition</span> <span class="variable">waitCoffeeQueue</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">hasBread</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">hasCoffee</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">while</span> (!hasCoffee) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        log.debug(<span class="string">&quot;等待咖啡&quot;</span>);</span><br><span class="line">                        waitCoffeeQueue.await(); <span class="comment">// 等咖啡队列</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 收到咖啡&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t1 释放锁&quot;</span>);</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">while</span> (!hasBread) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        log.debug(<span class="string">&quot;等待面包&quot;</span>);</span><br><span class="line">                        waitBreadQueue.await(); <span class="comment">// 等面包队列</span></span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                log.debug(<span class="string">&quot;t2 收到面包&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;t2 释放锁&quot;</span>);</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">        handleCoffee();</span><br><span class="line">        sleep(<span class="number">1000</span>);</span><br><span class="line">        handleBread();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleCoffee</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;发咖啡&quot;</span>);</span><br><span class="line">            hasCoffee = <span class="literal">true</span>;</span><br><span class="line">            waitCoffeeQueue.signal(); <span class="comment">// 唤醒等待咖啡的线程</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">handleBread</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;发面包&quot;</span>);</span><br><span class="line">            hasBread = <span class="literal">true</span>;</span><br><span class="line">            waitBreadQueue.signal(); <span class="comment">// 唤醒等待面包的线程</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/ff3e63ff47fa40bdb03fc4c7c12fa562.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><p><strong>如有错误，欢迎指正！！！</strong> </p><p><strong>图源来自网络，侵删！</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java并发编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUC并发编程1(初识进程和线程)</title>
      <link href="/2025/04/20/JUC1/"/>
      <url>/2025/04/20/JUC1/</url>
      
        <content type="html"><![CDATA[<hr><h1><span id="初识进程和线程">初识进程和线程</span></h1><h2><span id="初识进程">初识进程：</span></h2><h3><span id="定义">定义：</span></h3><blockquote><ul><li><strong>进程（Process）</strong>是计算机中的程序关于某数据集合上的一次运行活动，<strong>是系统进行资源分配的基本单位</strong>，是操作系统结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体；在当代面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，进程是程序的实体。（百度百科）</li><li>进程由程序、数据和进程控制块三部分组成。</li></ul></blockquote><h3><span id="什么是进程">什么是进程？</span></h3><blockquote><p><strong>狭义定义：</strong>进程是正在运行的程序的实例。<br> <strong>广义定义：</strong>进程是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元，也是基本的执行单元。</p></blockquote><p> eg：进程可以看做是程序的实例，你可以打开多个程序，每一个程序就是一个进程（比如你重复打开QQ登录不同的用户，每一个用户登录的那个程序就是一个进程）。</p><p><img src="/./../images/1233cabe61b54721850681d0663a50c8.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>如果你关闭一个窗口，那么这个进程也就结束了</p><h3><span id="概念"><img src="/./../images/ad4871a439f34b2d9c6aedf8e8ce943c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> 概念：</span></h3><p><strong>1.进程是一个实体。</strong></p><p><img src="/./../images/3f50ff49935c491bb2201366b6aab548.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p>进程包括文本区域、堆栈、数据区域。</p><ul><li>文本区域：存储处理器执行的代码</li><li>堆栈：存储变量和进程执行期间使用的动态分配的内存</li><li>数据区域：存储着活动过程调用的指令和本地变量</li></ul></blockquote><p><strong>2.进程是一个执行中的程序。</strong></p><blockquote><p>程序是没有生命的，只有执行一个程序才能称之为进程（进行中的程序）</p></blockquote><h3><span id="进程存储在哪里">进程存储在哪里？</span></h3><blockquote><p><strong>1.内存：</strong></p><p>​    当一个程序被执行时，操作系统会为其创建一个或多个进程，并将这些进程的数据加载到内存中。</p><p>eg：现在我只启动了一个程序的实例，操作系统会启动多个进程并行执行任务。</p><p><img src="/./../images/0ce4d9ea9ff7466f9a1b08bc4416686f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/0fe795a0f536431ba398cd96b457f36e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>2.硬盘：</strong></p><p>​    虽然进程的主要活动区域是在内存中，但在某些情况下，进程相关的数据也可能被保存到硬盘上。</p><ul><li><strong>交换空间（Swap Space）：</strong>当物理内存不足时，操作系统可能会将一些不活跃的内存页写入到硬盘上的交换分区或交换文件中，以释放内存给更需要的进程使用。这被称为“分页”或“交换”。</li><li><strong>持久存储：</strong>某些应用可能选择将部分进程状态或数据周期性地保存到硬盘上，比如检查点机制（checkpointing），以便在崩溃后可以恢复。</li></ul><p><strong>3.操作系统：</strong></p><p> 操作系统内部维护着一张进程表，记录了所有当前正在运行或已停止但尚未完全结束的进程的信息。这张表包含了进程ID（PID）、父进程ID（PPID）、优先级、状态等元数据，它们通常存储在内核内存中。</p></blockquote><h3><span id="进程的状态转换">进程的状态转换</span></h3><p><img src="/./../images/547be5cf4e4a41dfaff87e26a3cf450d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>1）就绪状态（Ready）：</strong><br>     进程已获得除处理器外的所需资源，等待分配处理器资源；只要分配了处理器进程就可执行。就绪进程可以按多个优先级来划分队列。例如，当一个进程由于时间片用完而进入就绪状态时，排入低优先级队列；当进程由I&#x2F;O操作完成而进入就绪状态时，排入高优先级队列。<br> <strong>2）运行状态(Running)：</strong><br>     进程占用处理器资源；处于此状态的进程的数目小于等于处理器的数目。在没有其他进程可以执行时(如所有进程都在阻塞状态)，通常会自动执行系统的空闲进程。<br> <strong>3）阻塞状态(Blocked)：</strong><br>     由于进程等待某种条件（如I&#x2F;O操作或进程同步），在条件满足之前无法继续执行。该事件发生前即使把处理器资源分配给该进程，也无法运行。</p></blockquote><h2><span id="初识线程">初识线程</span></h2><h3><span id="什么是线程">什么是线程？</span></h3><p>1.是程序执行流的最小单位。</p><p>2.线程是进程最小执行单元。</p><p>3.进程是操作系统进行资源分配和调度的基本单位，每个进程至少包含一个线程，这个初始创建的线程称为主线程。</p><h3><span id="并发和并行的区别">并发和并行的区别</span></h3><blockquote><p><strong>1.并发：</strong></p><p>​    并发指的是系统能够支持多个任务在同一时间段内交替执行的能力。这意味着即使表面上看起来多个任务是“同时”进行的，实际上它们可能是在快速切换执行状态，轮流使用处理器资源</p><p><strong>2.并行：</strong></p><p>​    并行则是指真正地同时执行多个任务，通常需要利用多核处理器或多台计算机来实现。并行计算的目标是加快单个任务或一组任务的完成速度，通过将任务分解成子任务并在不同处理器或计算机上同时执行来达成这一目的</p></blockquote><h3><span id="线程的状态转换">线程的状态转换</span></h3><p><img src="/./../images/aff0a50633d56e8c46c4175c27f879e6.jpeg" alt="img"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>1.新建（New）：</strong><br>     当创建了一个线程对象但还没有调用start()方法时，线程处于新建状态。在这个状态下，线程还未准备好执行。<br> <strong>2.可运行（Runnable）：</strong><br>     调用了线程的start()方法后，线程进入可运行状态。这意味着线程已经准备好，可以被调度执行，但实际上是否正在执行取决于操作系统的线程调度器。<br> <strong>3.运行中（Running）：</strong><br>     当线程调度器选择了该线程并分配了CPU时间片后，线程进入运行中状态，开始执行其run()方法中的代码。<br> <strong>4.阻塞&#x2F;等待（Blocked&#x2F;Waiting）：</strong><br>   线程可能由于多种原因离开运行状态而进入阻塞或等待状态，例如：</p><ul><li>等待获取同步锁以进入临界区。</li><li>调用了如wait()方法等待另一个线程的通知。</li><li>请求I&#x2F;O操作未完成等。</li><li>在这种状态下，线程暂时不活跃，直到某种条件满足（如获得了锁或者收到了通知），它将重新回到可运行状态。</li></ul><p><strong>5.终止（Terminated&#x2F;Dead）：</strong><br>     线程完成了执行（即run()方法正常结束）或者因为异常退出，则进入终止状态。到达这个状态后，线程的生命期结束，不能再恢复执行。 </p></blockquote><h1><span id="java线程">Java线程</span></h1><h2><span id="如何构造一个线程">如何构造一个线程？</span></h2><p>通过Thread类可以创建线程对象，通过start方法启动线程。</p><h2><span id="thread类的参数">Thread类的参数</span></h2><p><img src="/./../images/b5cdd7138a734847bf6f33d9da79f922.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>1.ThreadGroup group :</strong></p><p>​    这是目标线程所属的线程组。线程组（ThreadGroup）允许你对一组线程进行批量管理（例如，中断所有线程或检查它们的状态）。如果你不打算使用线程组来管理线程，可以将此参数设为null，这样新的线程就不会被分配到特定的线程组中。</p><p><strong>2.Runnable target :</strong></p><p>​    这是一个实现了Runnable接口的对象。Runnable接口要求实现一个无返回值的run()方法，该方法定义了线程启动时应执行的代码。通过提供一个Runnable对象给Thread构造函数，你实际上是在告诉这个线程它需要执行的任务是什么。</p><p><strong>3.String name :</strong> </p><p>​    线程的名称。这是一个字符串，用于标识线程，便于调试和日志记录。虽然每个线程都有一个默认名称（如Thread-0, Thread-1等），但为线程指定一个有意义的名字可以使调试过程更加容易。</p><p><strong>4.long stackSize :</strong></p><p>​    建议的堆栈大小。这是在线程创建时建议给该线程分配的堆栈大小（以字节为单位）。需要注意的是，这个参数只是一个建议，并不一定能够精确地控制实际分配的堆栈大小。对于大多数应用来说，除非有特殊需求，否则通常可以忽略这个参数或者传入值为0，表示使用平台或JVM默认的堆栈大小。</p><h2><span id="创建线程的方法">创建线程的方法</span></h2><h3><span id="通过重写thread类中的run方法">通过重写Thread类中的run方法</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;running...&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">t1.start();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="通过runnable创建任务对象传给thread类">通过Runnable创建任务对象传给Thread类</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Runnable</span> <span class="variable">task1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;running...&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task1, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="通过futuretask接收线程返回值">通过FutureTask接收线程返回值</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FutureTask&lt;Integer&gt; task1 = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Callable</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                log.info(<span class="string">&quot;running....&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task1, <span class="string">&quot;t3&quot;</span>);</span><br><span class="line">t3.start();</span><br><span class="line">log.info(<span class="string">&quot;futuretask:&#123;&#125;&quot;</span>, task1.get());</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>这里重点说一下：</p><p>FutureTask中的构造器接收的是Callable对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">FutureTask</span><span class="params">(Callable&lt;V&gt; callable)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (callable == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="built_in">this</span>.callable = callable;</span><br><span class="line">    <span class="built_in">this</span>.state = NEW;       <span class="comment">// ensure visibility of callable</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>其实这样写更加直观：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Callable</span> <span class="variable">callable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Callable</span>&lt;Object&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;callable running&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;callable&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">FutureTask&lt;Object&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(callable);</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask, <span class="string">&quot;t4&quot;</span>);</span><br><span class="line">t4.start();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>你会不会有这样一个疑惑，既然创建任务对象的是Callable这个类，那能不能在创建线程的时候传递Callable对象呢？</p><p>答案是否定的，FutureTask对象之所以能传递给Thread对象，是因为FutureTask实现了Runnable接口，而Callable并没有实现Runnable接口。</p><p><img src="/./../images/390441ca08cb48cf84136a217d0b99fc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/c7f005d22aa04746b4c8ad4b69b85fff.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  FutureTask类间接实现的Runnable接口<img src="/./../images/a3ed4464ff2747b583fcc9ca1ca0a600.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>Callable本身是就是一个接口，所以我们创建的Callable对象都是实现这个接口，是这个接口的实现类。</p><h2><span id="线程存储在哪里">线程存储在哪里？</span></h2><p>更详细的需要了解一下JVM：<a href="https://blog.csdn.net/m0_73569492/article/details/146131544?spm=1001.2014.3001.5502">Java虚拟机</a></p><p><img src="/./../images/0cc303f3eaa35afa5e51030f5ca2573f.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>​    每个线程启动后，虚拟机就会为其分配一块栈内存。 每个栈由多个栈帧（Frame）组成，对应着每次方法调用时所占用的内存，每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法。</p><p><img src="/./../images/8697076b84c54eb3bf52d0a7e4a436d8.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="线程的上下文切换">线程的上下文切换</span></h2><h3><span id="什么是线程的上下文切换">什么是线程的上下文切换？</span></h3><p>​    当CPU从执行一个线程切换到执行另一个线程时，这个过程就叫做线程的上下文切换</p><h3><span id="为什么会上下文切换原因">为什么会上下文切换（原因）？</span></h3><ul><li><strong>时间片轮转：</strong>这是最常见的一种情况，在分时系统中，为了公平地分配CPU资源给所有正在运行的进程或线程，操作系统会为每个线程分配一个固定的时间片段（称为时间片）。当一个线程的时间片用完后，即使它还没有完成工作，也会被挂起，以便让其他线程有机会运行。</li><li><strong>I&#x2F;O操作等待：</strong>当线程执行过程中需要等待外部资源（如磁盘读写、网络请求等）时，线程会进入阻塞状态，此时操作系统会选择另一个就绪状态的线程来使用CPU资源。这样可以避免CPU空闲等待I&#x2F;O操作完成。</li><li><strong>优先级抢占：</strong>如果系统支持基于优先级的调度算法，那么当一个更高优先级的线程变为就绪状态时，操作系统可能会中断当前较低优先级的线程，将其挂起，并将CPU资源分配给高优先级线程。</li><li><strong>线程休眠：</strong>程序中有时会主动让线程休眠一段时间（例如调用Thread.sleep()方法），在此期间，该线程会让出CPU，使得其他线程有机会运行。</li><li><strong>锁竞争：</strong>当多个线程试图访问共享资源而需要获取互斥锁时，未能获得锁的线程将会被挂起，直到持有锁的线程释放了锁。这也会引起上下文切换。</li><li><strong>硬件中断：</strong>硬件设备触发的中断信号（例如键盘输入、鼠标移动、定时器到期等）可能导致当前线程暂停执行，以便处理中断服务程序。处理完中断后，可能恢复原来的线程继续执行，也可能根据调度策略选择另一个线程执行。</li><li><strong>用户模式与内核模式切换：</strong>某些操作需要从用户模式切换到内核模式才能执行（比如系统调用）。这种模式切换本身虽然不是直接的上下文切换，但通常伴随着一些上下文保存和恢复的工作，类似于上下文切换的过程。</li></ul><p>Java 中的线程状态（Thread.State枚举类）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">State</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a thread which has not yet started.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        NEW,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a runnable thread.  A thread in the runnable</span></span><br><span class="line"><span class="comment">         * state is executing in the Java virtual machine but it may</span></span><br><span class="line"><span class="comment">         * be waiting for other resources from the operating system</span></span><br><span class="line"><span class="comment">         * such as processor.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        RUNNABLE,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a thread blocked waiting for a monitor lock.</span></span><br><span class="line"><span class="comment">         * A thread in the blocked state is waiting for a monitor lock</span></span><br><span class="line"><span class="comment">         * to enter a synchronized block/method or</span></span><br><span class="line"><span class="comment">         * reenter a synchronized block/method after calling</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@link</span> Object#wait() Object.wait&#125;.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        BLOCKED,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a waiting thread.</span></span><br><span class="line"><span class="comment">         * A thread is in the waiting state due to calling one of the</span></span><br><span class="line"><span class="comment">         * following methods:</span></span><br><span class="line"><span class="comment">         * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> Object#wait() Object.wait&#125; with no timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> #join() Thread.join&#125; with no timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> LockSupport#park() LockSupport.park&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * &lt;p&gt;A thread in the waiting state is waiting for another thread to</span></span><br><span class="line"><span class="comment">         * perform a particular action.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * For example, a thread that has called &lt;tt&gt;Object.wait()&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">         * on an object is waiting for another thread to call</span></span><br><span class="line"><span class="comment">         * &lt;tt&gt;Object.notify()&lt;/tt&gt; or &lt;tt&gt;Object.notifyAll()&lt;/tt&gt; on</span></span><br><span class="line"><span class="comment">         * that object. A thread that has called &lt;tt&gt;Thread.join()&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">         * is waiting for a specified thread to terminate.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        WAITING,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a waiting thread with a specified waiting time.</span></span><br><span class="line"><span class="comment">         * A thread is in the timed waiting state due to calling one of</span></span><br><span class="line"><span class="comment">         * the following methods with a specified positive waiting time:</span></span><br><span class="line"><span class="comment">         * &lt;ul&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> #sleep Thread.sleep&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> Object#wait(long) Object.wait&#125; with timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> #join(long) Thread.join&#125; with timeout&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> LockSupport#parkNanos LockSupport.parkNanos&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         *   &lt;li&gt;&#123;<span class="doctag">@link</span> LockSupport#parkUntil LockSupport.parkUntil&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment">         * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TIMED_WAITING,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Thread state for a terminated thread.</span></span><br><span class="line"><span class="comment">         * The thread has completed execution.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TERMINATED;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>1.NEW（新建）：</strong><br>     线程状态为尚未启动。这意味着线程对象已经被创建，但start()方法还未被调用。<br> <strong>2.RUNNABLE（可运行）：</strong><br>     线程状态为可运行。一个处于此状态的线程正在Java虚拟机中执行，但它可能正在等待来自操作系统的其他资源，比如处理器时间。<br> <strong>3.BLOCKED（阻塞）：</strong><br>     线程状态为因等待监视器锁而被阻塞。当一个线程试图进入一个同步块或方法，或者在调用了Object.wait()后重新进入同步块&#x2F;方法时，如果当前没有获得所需的监视器锁，就会处于这种状态。<br> <strong>4.WAITING（等待）：</strong><br>     线程状态为等待。线程会因为调用以下方法之一而进入此状态：无超时的Object.wait()、无超时的Thread.join()、LockSupport.park()。在这种状态下，线程在等待另一个线程执行特定动作，如通知或终止。<br> <strong>5.TIMED_WAITING（计时等待）：</strong><br>     线程状态为带有指定等待时间的等待。线程会因为调用以下带有超时参数的方法之一而进入此状态：Thread.sleep()、带超时的Object.wait(long)、带超时的Thread.join(long)、LockSupport.parkNanos()、LockSupport.parkUntil()。<br> <strong>6.TERMINATED（终止）：</strong><br> 线程状态为已终止。这意味着线程已经完成了执行。</p><p><img src="/./../images/3c857fc568d74458b77747f350723524.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>图片来源：<a href="https://www.bilibili.com/video/BV16J411h7Rd/?p=23&spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=e34fd69a904ae2667b5c5e7a85ba95c9">JUC并发编程-黑马程序员</a> </p><h2><span id="thread常用方法">Thread常用方法</span></h2><p><strong>菜鸟教程：</strong></p><p><a href="https://www.runoob.com/java/java-multithreading.html">Java 多线程编程 | 菜鸟教程Java 多线程编程 Java 给多线程编程提供了内置的支持。 一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。 多线程是多任务的一种特别的形式，但多线程使用了更小的资源开销。 这里定义和线程相关的另一个术语 - 进程：一个进程包括由操作系统分配的内存空间，包含一个或多个线程。一个线程不能独立的存在，它必须是进程的一部分。一个进程一直运行，直到所有的非守护线程都结束运行后才能结束。 ..<img src="/./../images/icon-default.png" alt="img">https://www.runoob.com/java/java-multithreading.html</a></p><blockquote><p><strong>1.启动线程</strong></p><ul><li>start(): 启动线程，并调用run()方法。</li></ul><p><strong>2.获取信息</strong></p><ul><li>getName(): 返回线程的名称。</li><li>setName(String name): 设置线程的名称。</li><li>getId(): 返回线程的唯一标识符。</li><li>getPriority(): 返回线程的优先级。</li><li>setPriority(int newPriority): 更改线程的优先级。</li><li>isAlive(): 测试线程是否处于活动状态（即已启动但尚未死亡）。</li><li>currentThread(): 返回对当前正在执行的线程对象的引用。</li><li>activeCount(): 返回当前线程组中的活跃线程数量。</li></ul><p><strong>3.睡眠和等待</strong></p><ul><li>sleep(long millis): 使当前正在执行的线程暂停一段时间。</li><li>join(): 等待线程终止。</li><li>yield(): 暂停当前正在执行的线程对象，并允许其他具有相同优先级的线程获得运行机会。</li></ul><p><strong>4.中断线程</strong></p><ul><li>interrupt(): 中断线程。</li><li>isInterrupted(): 测试线程是否已被中断。</li><li>static interrupted(): 测试当前线程是否已被中断，并清除中断状态。</li></ul><p><strong>5.守护线程</strong></p><ul><li>isDaemon(): 测试线程是否为守护线程。</li><li>setDaemon(boolean on): 将此线程标记为守护线程或用户线程。</li></ul><p><strong>6.处理异常</strong></p><ul><li>uncaughtExceptionHandler getUncaughtExceptionHandler(): 返回该线程的未捕获异常处理器。</li><li>void setUncaughtExceptionHandler(Thread.UncaughtExceptionHandler eh): 设置该线程的未捕获异常处理器。</li><li>static Thread.UncaughtExceptionHandler getDefaultUncaughtExceptionHandler(): 返回默认的未8捕获异常处理器。</li><li>static void setDefaultUncaughtExceptionHandler(Thread.UncaughtExceptionHandler eh): 设置默认的未捕获异常处理器。</li></ul><p><strong>7.栈跟踪</strong></p><ul><li>StackTraceElement[] getStackTrace(): 返回表示该线程堆栈转储的数组。</li></ul></blockquote><h2><span id="线程运行">线程运行</span></h2><h3><span id="并发执行start">并发执行（start）</span></h3><blockquote><p><strong>t1.start();</strong></p><p><strong>t2.start();</strong></p></blockquote><p>两个线程抢夺CPU资源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;thread:t1:  &#123;&#125;&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;thread:t2:  &#123;&#125;&quot;</span>, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/7602f29a93aa444f925a871704e970e1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="运行态转阻塞态sleep">运行态转阻塞态（sleep）</span></h3><blockquote><p><strong>sleep();</strong></p></blockquote><p>调用 sleep 会让当前线程从 Running 进入 Timed Waiting 状态（阻塞）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">50</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;NEW t1: &#123;&#125;&quot;</span>, t1.getState()); <span class="comment">// 新建线程t1，没有运行</span></span><br><span class="line">t1.start();</span><br><span class="line">log.info(<span class="string">&quot;RUNNABLE t1: &#123;&#125;&quot;</span>, t1.getState()); <span class="comment">// 运行线程</span></span><br><span class="line">sleep(<span class="number">100</span>);</span><br><span class="line">log.info(<span class="string">&quot;TIMED_WAITING t1: &#123;&#125;&quot;</span>, t1.getState()); <span class="comment">// sleep休眠，导致进入阻塞</span></span><br><span class="line">sleep(<span class="number">1000</span>);</span><br><span class="line">log.info(<span class="string">&quot;TERMINATED t1: &#123;&#125;&quot;</span>, t1.getState()); <span class="comment">// 线程结束，终止态</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/1379633fd7674ac2be33a9259ff3f87c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="运行态转就绪态yield">运行态转就绪态（yield）</span></h3><blockquote><p><strong>Thread.yield(); &#x2F;&#x2F; 让出cpu</strong></p></blockquote><p>调用 yield 会让当前线程从 Running 进入 Runnable 就绪状态，然后调度执行其它线程</p><p>就绪态：拿到了除了cpu以外的所有资源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i ++) &#123;</span><br><span class="line">            cnt ++;</span><br><span class="line">            log.debug(<span class="string">&quot;t1:&#123;&#125;&quot;</span>, cnt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i ++) &#123;</span><br><span class="line">            Thread.<span class="keyword">yield</span>(); <span class="comment">// 让出cpu</span></span><br><span class="line">            cnt ++;</span><br><span class="line">            log.debug(<span class="string">&quot;--------------------------------------&gt;t2:&#123;&#125;&quot;</span>, cnt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/3d65c517c46e48f08c378d0b18751b0b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="中断线程进入阻塞态interrupt">中断线程进入阻塞态（interrupt）</span></h3><blockquote><p><strong>t1.interrupt();</strong></p><p><strong>this.isInterrupted()</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">50</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;end....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">t1.interrupt();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id><img src="/./../images/55ac760a1a3a476491feeb320f2ea26f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><p>说明中断线程，不会阻止线程继续往下运行 </p><p><strong>当我们需要使用interrupt中断线程时：</strong></p><p> 我们可以采用判断中断信号的方式来中断程序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">50</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.isInterrupted()) &#123;</span><br><span class="line">                    log.debug(<span class="string">&quot;中断....&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;end....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">sleep(<span class="number">500</span>);</span><br><span class="line">t1.interrupt();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/5d6799f9eefb49b9b840558fcb320963.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="线程优先级priority">线程优先级（priority）</span></h3><blockquote><p> <strong>t1.setPriority(Thread.MAX_PRIORITY);<br> t2.setPriority(Thread.MIN_PRIORITY);</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i ++) &#123;</span><br><span class="line">            cnt ++;</span><br><span class="line">            log.debug(<span class="string">&quot;t1:&#123;&#125;&quot;</span>, cnt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">1000</span>; i ++) &#123;</span><br><span class="line">            Thread.<span class="keyword">yield</span>(); <span class="comment">// 让出cpu</span></span><br><span class="line">            cnt ++;</span><br><span class="line">            log.debug(<span class="string">&quot;--------------------------------------&gt;t2:&#123;&#125;&quot;</span>, cnt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">t1.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">t2.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/84bca2abd1c542c690d6cddc24307dab.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="等待线程join">等待线程（join）</span></h3><blockquote><p><strong>t1.join();</strong></p><p>阻塞等待线程执行完毕（苦苦等待）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        cnt ++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">log.debug(<span class="string">&quot;cnt:&#123;&#125;&quot;</span>, cnt);</span><br><span class="line">t1.join();</span><br><span class="line">log.debug(<span class="string">&quot;cnt:&#123;&#125;&quot;</span>, cnt);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/646b5d0ad0e14ac78d8ea911ed99ca61.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>t1.join(100);</strong> </p><p>表示阻塞等待100毫秒，没有执行完我也不等了（爱来来，不来拉倒） </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t1.start();</span><br><span class="line">log.debug(<span class="string">&quot;cnt:&#123;&#125;&quot;</span>, cnt);</span><br><span class="line">t1.join(<span class="number">100</span>);</span><br><span class="line">log.debug(<span class="string">&quot;cnt:&#123;&#125;&quot;</span>, cnt);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <img src="/./../images/593e691e045b44e98449f745f60d5b0d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="打断park进程park">打断park进程（park）</span></h3><blockquote><p> <strong>LockSupport.park();</strong></p><p>用于线程的阻塞（即“停车”）。它在并发编程中提供了比传统等待&#x2F;通知机制更灵活和高效的线程阻塞与唤醒功能</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;unparking...&quot;</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;1.thread: &#123;&#125;&quot;</span>,<span class="built_in">this</span>.isInterrupted());</span><br><span class="line">        LockSupport.park();</span><br><span class="line">        log.debug(<span class="string">&quot;2.thread: &#123;&#125;&quot;</span>,<span class="built_in">this</span>.isInterrupted());</span><br><span class="line">        log.debug(<span class="string">&quot;parking....&quot;</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;3.thread: &#123;&#125;&quot;</span>,<span class="built_in">this</span>.isInterrupted());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">t1.start();</span><br><span class="line">sleep(<span class="number">500</span>);</span><br><span class="line">t1.interrupt();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/41968b31c8a5439098e60605b2555017.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="守护线程">守护线程</span></h2><blockquote><p>​    守护线程（Daemon Thread）是Java中一种特殊的后台线程，它不是应用程序的核心部分。当Java程序仅剩下守护线程在运行时，JVM会自动退出程序执行，这意味着程序已经结束了其所有用户线程的执行。守护线程通常用于执行一些辅助性的工作，比如垃圾回收、内存泄漏检测等，这些工作并不影响程序的主要逻辑。（<strong>非守护线程全部结束了，守护线程也会自动结束，这就意味着只要非守护线程结束了，所有的线程就都结束了，守护线程就扮演一个不太重要的角色</strong>）</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">Thread</span> <span class="variable">deamon</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;deamon&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;deamon........&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">undeamon</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;undeamon&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;undeamon.......&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(<span class="number">10</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">deamon.setDaemon(<span class="literal">true</span>); <span class="comment">// 将其设置为守护线程</span></span><br><span class="line">undeamon.start();</span><br><span class="line">undeamon.join();</span><br><span class="line">deamon.start();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/c365bf7d978947f0b76cfb967be35aa9.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>通过运行结果可以发现，守护线程没有执行</p><hr><h1><span id="线程安全">线程安全</span></h1><h2><span id="初识线程安全">初识线程安全</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            cnt ++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            cnt --;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line">t1.join();</span><br><span class="line">t2.join();</span><br><span class="line">log.debug(<span class="string">&quot;&#123;&#125;&quot;</span>, cnt);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>第一次运行：16:39:48 [main] c.thread - 26146</p><p>第二次运行：16:41:10 [main] c.thread - 12260</p><p>第三次运行：16:41:23 [main] c.thread - -9234</p><blockquote><p><strong>—&gt; 很显然，这三次运行结果都不一样，如何导致的呢？</strong></p><p>​    操作系统使用调度算法将CPU时间分割成一系列的时间段，即时间片，轮流为每个进程或线程分配时间片来执行。</p><p>​    在Java 中对静态变量的自增，自减并不是原子操作，通过JVM虚拟机的类加载器将一个命令生成多条JVM字节码指令。</p><p>​    所以在进行多线程并发运行时，可能会引起时间片流转带来的线程上下文切换，从而导致因为不恰当的执行时序而出现的不正确的结果（竞态条件）。 </p></blockquote><h2><span id="什么是线程安全">什么是线程安全？</span></h2><blockquote><p>​    线程安全是指一个函数、方法或某个代码段可以在多线程环境下正确执行，不会因为并发访问导致数据不一致或其他错误。当多个线程同时访问共享资源（如变量、数据结构或设备）时，如果没有适当的同步机制来管理这些访问，就可能导致竞态条件、死锁、资源争用等问题。</p><p>​     无状态的对象一定是线程安全的。（无状态可以简单认为成，对象中无成员变量，也就是所有的操作都是基于传入的参数进行的）</p></blockquote><p><strong>—&gt; 如何判断一个对象是否需要设计成线程安全？</strong></p><p>​    一个对象是否需要是线程安全的取决于它是否被多个线程访问。这指的是在程序中访问对象的方式，而不是对象要实现的功能。</p><p><strong>—&gt; 怎么使得对象是线程安全的？</strong></p><ul><li>要使得对象是线程安全的，需要采用同步机制来协调对对象可变状态的访问。</li><li>Java中主要的同步机制是关键字synchronized，提供一种独特的加锁方式，这个同步还包括volatile类型的变量，显式锁和原子变量。</li></ul><h2><span id="线程安全类">线程安全类</span></h2><blockquote><p>​     <strong>当多个线程都能访问某个类时，这个类始终能表现出正确的行为，那么就称这个类是线程安全的。</strong></p><p>​    <strong>当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程如何交替执行，并且在主调代码中不需要任何额外的同步或协调，这个类都能表现出正确的行为，那么这个类就是线程安全的。</strong></p></blockquote><p>—&gt; 我的理解是，这个类不依赖多线程的调度顺序，自身实现了线程安全(doge)</p><h2><span id="临界区">临界区</span></h2><blockquote><p>   临界区（Critical Section）是指在多线程编程中，一段访问共享资源（如数据或设备）的代码块，这段代码的执行必须是互斥的，即在同一时间只能由一个线程执行，以避免多个线程同时访问共享资源导致的数据不一致或其他并发问题。临界区的概念对于确保程序的正确性和稳定性至关重要。（一段代码块内如果存在对共享资源的多线程读写操作，称这段代码块为临界区 ）</p><p>​    <strong>简单来说，临界区是指在多线程程序中的一段代码，这段代码访问共享资源（如变量、数据结构或外部设备），并且需要确保在同一时间只能由一个线程执行，以避免并发问题。</strong></p></blockquote><p> —-&gt; 我的理解就是会发生多线程安全问题的代码区域(doge)</p><h2><span id="竞态条件">竞态条件</span></h2><blockquote><p>​    竞态条件（Race Condition） 是指在多线程或并发编程中，程序的行为依赖于不受控制的时间顺序或线程的交错执行顺序。当两个或多个线程尝试同时访问和修改同一个共享资源（如变量、数据结构等），且至少有一个线程执行写操作时，如果没有适当的同步机制来控制这些访问的顺序，就可能发生竞态条件。这会导致不确定的结果或程序错误。</p></blockquote><p>—&gt; 我的理解就是因为执行顺序而带来的多线程并发问题(doge)</p><h2><span id="防止临界区出现竞态条件">防止临界区出现竞态条件</span></h2><blockquote><p>​     防止临界区出现竞态条件的核心在于确保在同一时间只有一个线程能够访问和修改共享资源。这通常通过使用同步机制来实现，以保证对临界区的互斥访问。</p></blockquote><h3><span id="方式">方式：</span></h3><blockquote><p><strong>1. 使用 synchronized 关键字</strong></p><ul><li>在Java中，synchronized 关键字可以用于方法或代码块，以确保任意时刻只有一个线程可以执行被 synchronized 保护的代码。</li></ul><p><strong>2. 使用显式锁（如 ReentrantLock）</strong></p><ul><li>Java 提供了更灵活的显式锁机制，如 ReentrantLock，它可以提供比 synchronized 更丰富的功能，例如尝试获取锁、定时等待等。</li></ul><p><strong>3. 使用原子变量</strong></p><ul><li>对于一些简单的操作，可以使用 java.util.concurrent.atomic 包中的原子类，如 AtomicInteger，它们提供了无锁的线程安全操作。</li></ul><p><strong>4. 使用并发集合</strong></p><ul><li>对于涉及集合的操作，可以考虑使用 java.util.concurrent 包提供的并发集合类，这些类内部实现了高效的并发控制机制，允许在大多数情况下无阻塞地读取和有条件地写入。</li></ul><p><strong>5. 设计模式的应用</strong></p><ul><li>某些设计模式也有助于避免竞态条件，比如单例模式（Double-Checked Locking）、工厂模式等。正确应用这些模式可以帮助开发者更轻松地编写线程安全的代码。</li></ul></blockquote><h2><span id="锁sychronized">锁(sychronized)</span></h2><h3><span id="概念">概念：</span></h3><blockquote><p>​    在Java中，synchronized 是一个关键字，用于控制对共享资源的访问，确保在同一时间只有一个线程能够执行被 synchronized 修饰的方法或代码块。这有助于避免竞态条件和数据不一致问题，是实现线程安全的一种方式。  </p></blockquote><p>​    <strong>synchronized 实际是用对象锁保证了临界区内代码的原子性，临界区内的代码对外是不可分割的，不会被线程切换所打断。</strong>    </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">  <span class="comment">// 临界区</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="comment">// 临界区</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 下面来看一个例子（因为锁粒度导致的性能差别）：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 时间戳</span></span><br><span class="line"><span class="type">long</span> <span class="variable">ts</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                cnt ++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                cnt--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line">t1.join();</span><br><span class="line">t2.join();</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">ed</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">log.debug(<span class="string">&quot;cnt=&#123;&#125;,cost=&#123;&#125;&quot;</span>, cnt, ed-ts);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 时间戳</span></span><br><span class="line"><span class="type">long</span> <span class="variable">ts</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">                cnt ++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">                cnt --;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line">t1.join();</span><br><span class="line">t2.join();</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">ed</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">log.debug(<span class="string">&quot;cnt=&#123;&#125;,cost=&#123;&#125;&quot;</span>, cnt, ed-ts);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>第一个运行结果：08:48:18 [main] c.thread.Test1 - cnt&#x3D;0,cost&#x3D;41</p><p>第二个运行结果：08:48:59 [main] c.thread.Test2 - cnt&#x3D;0,cost&#x3D;2</p><ul><li>可以发现第二种加锁的方式的性能要比第一种要好，因为加锁的粒度影响了线程的上下文切换所带来的性能降低。</li><li>第一种加锁方式对每一个操作进行加锁，当操作完成锁释放，两个线程来争夺cpu的使用权，导致线程上下文切换。</li><li>第二种加锁方式，将整个操作锁住了，当这一整个操作结束前锁不会释放，因此第二种方式的执行流程一般是先执行t1再执行t2，或者先执行t2再执行t1（顺序执行）</li></ul><h3><span id="面向对象改进">面向对象改进：</span></h3><p>构建线程安全类，把要加锁的操作进行封装</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ThreadSafe</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Room</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dec</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            cnt--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> cnt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Room</span> <span class="variable">room</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Room</span>();</span><br><span class="line"><span class="comment">// 时间戳</span></span><br><span class="line"><span class="type">long</span> <span class="variable">ts</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            room.add();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t2&quot;</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            room.dec();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line">t1.join();</span><br><span class="line">t2.join();</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">ed</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">log.debug(<span class="string">&quot;cnt=&#123;&#125;,cost=&#123;&#125;&quot;</span>, room.get(), ed-ts);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 结果：09:19:01 [main] c.thread.Test3 - cnt&#x3D;0,cost&#x3D;26</p><h3><span id="方法上的sychronized">方法上的sychronized</span></h3><p><strong>1.实例方法</strong></p><p>当你在一个实例方法上使用 synchronized 关键字时，它相当于在方法内部的所有代码周围包裹了一个 synchronized(this) 同步块。这意味着每次只有一个线程可以执行该实例的任何同步方法。</p><blockquote><p>public synchronized void test(){</p><p>}<br> 等价于<br> public void test(){<br>   synchronized (this) {</p><p>  }<br> }</p></blockquote><p><strong>2.静态方法</strong> </p><p>对于静态方法，synchronized 锁定的是类的 Class 对象，而不是某个特定的实例。这意味着无论创建了多少个该类的实例，同一时间只有一个线程可以执行该类的任何同步静态方法。 </p><blockquote><p>public static synchronized void test3(){</p><p>}<br> 等价于<br> public static void test4(){<br>   synchronized (Room.class) {</p><p>  }<br> }</p></blockquote><h2><span id="线程八锁">线程八锁</span></h2><h3><span id="1-同一个类的不同实例上的同步方法"><strong>1. 同一个类的不同实例上的同步方法</strong></span></h3><blockquote><p>如果有两个不同的实例对象，即使它们调用的是同一个同步方法，由于每个对象都有自己的锁，因此这两个方法可以并行执行。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Number1</span> <span class="variable">number1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number1</span>();</span><br><span class="line">        <span class="type">Number1</span> <span class="variable">number2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number1</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number1::a, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number2::b, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock1&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;a &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;b &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>运行结果：</p><p>10:04:11 [t1] c.lock1 - a 1742609051383<br> 10:04:11 [t2] c.lock1 - b 1742609051383 </p><h3><span id="2-静态同步方法与实例同步方法">2. 静态同步方法与实例同步方法</span></h3><blockquote><p>静态同步方法锁定的是Class对象，而实例同步方法锁定的是实例对象。这意味着它们不会相互影响，可以并行执行。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock2&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;&#123;&#125;: 实例方法 &#123;&#125;&quot;</span>, Thread.currentThread().getName(), System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;&#123;&#125;: 静态方法 &#123;&#125;&quot;</span>, Thread.currentThread().getName(), System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Number2</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number2</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::a,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(Number2::b,<span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>运行结果：</p><p>09:54:18 [t2] c.lock2 - t2: 静态方法 1742608458384<br> 09:54:18 [t1] c.lock2 - t1: 实例方法 1742608458384</p><p>可以看出来，这两个线程同时调用对应的方法 ，所以这两个线程是并行执行的</p><h3><span id="3-静态同步方法之间的同步">3. 静态同步方法之间的同步</span></h3><blockquote><p>所有对静态同步方法的调用都共享同一个锁（即Class对象），因此不能并行执行 </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(Number3::a, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(Number3::b, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock3&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number3</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">       log.debug(<span class="string">&quot;a &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">       log.debug(<span class="string">&quot;b &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>执行结果：</p><p>09:59:48 [t1] c.lock3 - a 1742608788365<br> 09:59:48 [t2] c.lock3 - b 1742608788373</p><h3><span id="4-实例同步方法之间的同步">4. 实例同步方法之间的同步</span></h3><blockquote><p>同一对象实例的所有同步实例方法共享同一个锁（即该对象实例），因此不能并行执行。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Number4</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number4</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::a,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::b,<span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock1&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;a &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;b &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>运行结果：</p><p>10:05:29 [t1] c.lock1 - a 1742609129540<br> 10:05:29 [t2] c.lock1 - b 1742609129548 </p><h3><span id="5-静态同步代码块与实例同步代码块">5. 静态同步代码块与实例同步代码块</span></h3><blockquote><p> 静态同步代码块锁定的是Class对象，而实例同步代码块锁定的是实例对象，因此它们不会相互阻塞。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Number5</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number5</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::method, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::method, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock5&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot; this running : &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">synchronized</span> (Number5.class) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;class running : &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>运行结果：</p><p><img src="/./../images/1f85e35ee7e345acbfed4e7acef46cd2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="6-不同对象作为锁的同步代码块">6. 不同对象作为锁的同步代码块</span></h3><blockquote><p>如果同步代码块使用不同的对象作为锁，则它们之间不会相互阻塞。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock6</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Number6</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number6</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::a, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::b, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock6&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number6</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;lock1---&gt; a : &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;lock2---&gt; b: &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>执行结果：</p><p>10:17:45 [t1] c.lock6 - lock1—&gt; a : 1742609865149<br> 10:17:45 [t2] c.lock6 - lock2—&gt; b: 1742609865149 </p><h3><span id="7-锁的重入性">7. 锁的重入性</span></h3><blockquote><p>Java中的锁是可重入的，这意味着同一个线程可以多次获取同一个锁而不会导致死锁。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock7&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock7</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Number7</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number7</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::a, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::b, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock7&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number7</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;</span><br><span class="line">        b();</span><br><span class="line">        log.debug(<span class="string">&quot;a: &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;b: &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 运行结果：</p><p>10:22:43 [t1] c.lock7 - b: 1742610163030<br> 10:22:43 [t1] c.lock7 - a: 1742610163037<br> 10:22:43 [t2] c.lock7 - b: 1742610163037</p><h3><span id="8-锁的释放">8. 锁的释放</span></h3><blockquote><p>当一个线程退出同步方法或同步代码块时，它会自动释放锁。如果异常发生且未在同步块内捕获，锁也会被释放 </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lock8</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Number8</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Number8</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::a, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(number::a, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Slf4j(topic = &quot;c.lock8&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number8</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span>&#123;</span><br><span class="line">        log.debug(<span class="string">&quot;a : &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> scanner.nextInt();</span><br><span class="line">        <span class="keyword">if</span> (next == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.debug(<span class="string">&quot;running &#123;&#125;&quot;</span>, System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <img src="/./../images/9c4b45ba90a14584bc32672b6c3949d4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>解释一下：t1线程调用a，拿到锁，但是由于输入操作抛出异常，自动释放锁，锁被t2拿到继续执行 </p><h2><span id="局部变量的线程安全分析">局部变量的线程安全分析</span></h2><blockquote><p>局部变量在Java中是线程安全的，原因在于每个线程都会有自己的方法调用栈，局部变量存储在这个栈中，因此它们不会被多个线程共享。这意味着不同的线程执行同一方法时，各自使用的局部变量是完全独立的，不存在一个线程能够访问另一个线程的局部变量的情况。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.thread&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">                num ++;</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;&#123;&#125;: &#123;&#125; ----- &#123;&#125;&quot;</span>,Thread.currentThread().getName(), num, System.currentTimeMillis());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Task</span>(), <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Task</span>(), <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>运行结果：</p><p>10:59:13 [t1] c.thread - t1: 100000 —– 1742612353780<br> 10:59:13 [t2] c.thread - t2: 100000 —– 1742612353780</p><p><strong>—-&gt; 为什么局部变量是线程安全的？</strong></p><blockquote><p>​    当一个方法被调用时，Java虚拟机会为该方法的执行分配一个新的栈帧（Stack Frame），这个栈帧包含了方法执行期间所需的所有信息，包括局部变量、操作数栈等。对于基本数据类型（如int, float等）的局部变量，它们直接存储在栈帧中；而对于对象引用类型的局部变量，虽然实际的对象存储在堆内存中，但引用本身仍然存储在栈帧中。</p><p>​    由于每个线程都有自己的栈空间，因此每个线程在执行同一方法时使用的局部变量实际上是不同的副本，这些副本之间互不干扰。这就保证了局部变量的线程安全性。</p></blockquote><h2><span id="常见的线程安全类">常见的线程安全类</span></h2><blockquote><p><strong>1.String：</strong></p><ul><li>String 类是不可变的（immutable），这意味着一旦创建后就不能被修改。由于其不可变性，String 对象本身是线程安全的。</li></ul><p><strong>2.Integer：</strong></p><ul><li>类似于 String，Integer 也是不可变类。因此，它的实例在多线程环境下也是线程安全的。</li></ul><p><strong>3.StringBuffer：</strong></p><ul><li>StringBuffer 提供了与 StringBuilder 类似的API，但所有公共方法都是同步的，使其成为线程安全的。然而，由于同步带来的开销，在单线程环境中推荐使用 StringBuilder。</li></ul><p><strong>4.Random：</strong></p><ul><li>虽然 Random 不是严格意义上的线程安全类，但如果多个线程同时使用同一个 Random 实例，则可能会遇到性能瓶颈。对于高并发场景，可以考虑使用 ThreadLocalRandom，它为每个线程提供独立的随机数生成器，从而避免了同步问题。</li></ul><p><strong>5.Vector 和 Hashtable：</strong></p><ul><li>这两个类是早期集合框架的一部分，它们的方法都是同步的，所以从技术上讲它们是线程安全的。但是，由于其同步机制可能导致性能问题，在现代应用中更倾向于使用 ArrayList 和 HashMap 结合适当的同步措施或使用 java.util.concurrent 包下的类。</li></ul><p><strong>6.java.util.concurrent 包下的类：</strong></p><ul><li>此包提供了丰富的线程安全工具和集合，适用于各种并发编程需求</li></ul></blockquote><p>看一个String源码中的substring方法来分析一下线程安全：</p><p>​    String 类是不可变的，这意味着一旦创建后就不能被修改。所有看似“修改”字符串的操作（如concat, substring等）实际上都是创建了一个新的String对象。由于其不可变性，多个线程可以共享同一个String实例而无需担心并发修改的问题，因此它是线程安全的。 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回一个从指定开始索引到指定结束索引的子字符串</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> beginIndex 子字符串的起始索引，包含该索引处的字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> endIndex 子字符串的结束索引，不包含该索引处的字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 一个新的字符串，包含从beginIndex到endIndex-1的字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> StringIndexOutOfBoundsException 如果beginIndex小于0，endIndex大于字符串长度，或beginIndex大于endIndex</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">substring</span><span class="params">(<span class="type">int</span> beginIndex, <span class="type">int</span> endIndex)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查起始索引是否小于0</span></span><br><span class="line">    <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(beginIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 检查结束索引是否超过字符串长度</span></span><br><span class="line">    <span class="keyword">if</span> (endIndex &gt; value.length) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(endIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算子字符串的长度</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">subLen</span> <span class="operator">=</span> endIndex - beginIndex;</span><br><span class="line">    <span class="comment">// 检查子字符串长度是否小于0</span></span><br><span class="line">    <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(subLen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果子字符串与当前字符串相同，则返回当前字符串实例，否则创建并返回一个新的字符串实例</span></span><br><span class="line">    <span class="keyword">return</span> ((beginIndex == <span class="number">0</span>) &amp;&amp; (endIndex == value.length)) ? <span class="built_in">this</span></span><br><span class="line">            : <span class="keyword">new</span> <span class="title class_">String</span>(value, beginIndex, subLen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用字符数组的一部分初始化字符串。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 字符数组，从中复制字符串的值。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> offset 开始复制的起始索引。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> count 从字符数组中复制的字符数量。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> StringIndexOutOfBoundsException 如果offset或count为负，或者offset+count大于value的长度，则抛出此异常。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">String</span><span class="params">(<span class="type">char</span> value[], <span class="type">int</span> offset, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查offset是否为负</span></span><br><span class="line">    <span class="keyword">if</span> (offset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(offset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 检查count是否为负，如果是，则抛出异常</span></span><br><span class="line">    <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (count &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(count);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果count为0，确保offset不超过字符数组的长度</span></span><br><span class="line">        <span class="keyword">if</span> (offset &lt;= value.length) &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = <span class="string">&quot;&quot;</span>.value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 注意：offset或count可能接近-1&gt;&gt;&gt;1。</span></span><br><span class="line">    <span class="comment">// 确保offset+count不超过字符数组的长度</span></span><br><span class="line">    <span class="keyword">if</span> (offset &gt; value.length - count) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(offset + count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从字符数组中复制指定范围的字符到新字符串</span></span><br><span class="line">    <span class="built_in">this</span>.value = Arrays.copyOfRange(value, offset, offset+count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回一个从指定开始索引到指定结束索引的子字符串</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> beginIndex 子字符串的起始索引，包含该索引处的字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> endIndex 子字符串的结束索引，不包含该索引处的字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 一个新的字符串，包含从beginIndex到endIndex-1的字符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> StringIndexOutOfBoundsException 如果beginIndex小于0，endIndex大于字符串长度，或beginIndex大于endIndex</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">substring</span><span class="params">(<span class="type">int</span> beginIndex, <span class="type">int</span> endIndex)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查起始索引是否小于0</span></span><br><span class="line">    <span class="keyword">if</span> (beginIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(beginIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 检查结束索引是否超过字符串长度</span></span><br><span class="line">    <span class="keyword">if</span> (endIndex &gt; value.length) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(endIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算子字符串的长度</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">subLen</span> <span class="operator">=</span> endIndex - beginIndex;</span><br><span class="line">    <span class="comment">// 检查子字符串长度是否小于0</span></span><br><span class="line">    <span class="keyword">if</span> (subLen &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StringIndexOutOfBoundsException</span>(subLen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果子字符串与当前字符串相同，则返回当前字符串实例，否则创建并返回一个新的字符串实例</span></span><br><span class="line">    <span class="keyword">return</span> ((beginIndex == <span class="number">0</span>) &amp;&amp; (endIndex == value.length)) ? <span class="built_in">this</span></span><br><span class="line">            : <span class="keyword">new</span> <span class="title class_">String</span>(value, beginIndex, subLen);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Native方法，用于数组的高效复制</span></span><br><span class="line"><span class="comment"> * 它支持在数组之间进行元素的批量复制，包括源数组和目标数组的指定位置，以及要复制的长度</span></span><br><span class="line"><span class="comment"> * 此方法由JDK内部优化，提供了比手动循环复制元素更高效的实现</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> src 源数组，其元素将被复制</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> srcPos 源数组中开始复制的位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dest 目标数组，将接收复制的元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> destPos 目标数组中开始粘贴的位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> length 要复制的元素数量</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 注意：这个方法是native的，意味着它是由底层非Java代码（如C或C++）实现的</span></span><br><span class="line"><span class="comment"> * 它通常用于执行低级操作，如直接内存访问，以提高性能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">arraycopy</span><span class="params">(Object src,  <span class="type">int</span>  srcPos,</span></span><br><span class="line"><span class="params">                                    Object dest, <span class="type">int</span> destPos,</span></span><br><span class="line"><span class="params">                                    <span class="type">int</span> length)</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="线程安全分析案例">线程安全分析案例</span></h2><p>解释下列代码：</p><p>模拟卖票过程，总共有2000张票，然后2000个人来买，每个人能买1~5张票，看会不会出现超卖情况。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j(topic = &quot;c.thread&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExerciseSell</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TicketWindow</span> <span class="variable">ticketWindow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TicketWindow</span>(<span class="number">2000</span>);</span><br><span class="line">        List&lt;Thread&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 用来存储买出去多少张票</span></span><br><span class="line">        List&lt;Integer&gt; sellCount = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2000</span>; i++) &#123;</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// 分析这里的竞态条件</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ticketWindow.sell(randomAmount()); <span class="comment">// 模拟每个人买随机张票，会不会出现超卖</span></span><br><span class="line">                sellCount.add(count);</span><br><span class="line">            &#125;);</span><br><span class="line">            list.add(t);</span><br><span class="line">            t.start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 等待所有线程执行完成</span></span><br><span class="line">        list.forEach((t) -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                t.join();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 买出去的票求和</span></span><br><span class="line">        log.debug(<span class="string">&quot;selled count:&#123;&#125;&quot;</span>,sellCount.stream().mapToInt(c -&gt; c).sum());</span><br><span class="line">        <span class="comment">// 剩余票数</span></span><br><span class="line">        log.debug(<span class="string">&quot;remainder count:&#123;&#125;&quot;</span>, ticketWindow.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Random 为线程安全</span></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">    <span class="comment">// 随机 1~5</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">randomAmount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> random.nextInt(<span class="number">5</span>) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TicketWindow</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TicketWindow</span><span class="params">(<span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = count; <span class="comment">//初始化票</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count; <span class="comment">// 剩余票</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sell</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.count &gt;= amount) &#123;</span><br><span class="line">            <span class="built_in">this</span>.count -= amount; <span class="comment">// 卖掉</span></span><br><span class="line">            <span class="keyword">return</span> amount;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>执行结果：</p><p>12:38:10 [main] c.thread - selled count:2003<br> 12:38:10 [main] c.thread - remainder count:0</p><p><strong>—&gt; 出现超卖情况 ，为什么？</strong></p><p>因为在进行买票逻辑时并不是原子性的，在线程并发过程中会出现竞态条件。</p><p>修改买票逻辑：加上sychronized关键字</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">sell</span><span class="params">(<span class="type">int</span> amount)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.count &gt;= amount) &#123;</span><br><span class="line">        <span class="built_in">this</span>.count -= amount; <span class="comment">// 卖掉</span></span><br><span class="line">        <span class="keyword">return</span> amount;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 再运行一下，结果为：</p><p>12:39:46 [main] c.thread - selled count:2000<br> 12:39:46 [main] c.thread - remainder count:0</p><hr><p><strong>参考资料：</strong></p><p><strong>1.百度百科</strong></p><p><strong>2.《Java并发编程编程实战》</strong></p><p><strong>3.视频：*<em><a href="https://www.bilibili.com/video/BV16J411h7Rd/?p=83&spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=e34fd69a904ae2667b5c5e7a85ba95c9">Java并发编程-黑马程序员</a>*</em></strong></p><hr><p><strong>如有错误，欢迎指正！！！</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java并发编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oracle基本语法</title>
      <link href="/2025/04/20/Oracle/"/>
      <url>/2025/04/20/Oracle/</url>
      
        <content type="html"><![CDATA[<h1><span id="前言">前言：</span></h1><blockquote><p>1.使用的数据库不同，所使用的语法也略有不同</p><p>2.SQL对大小写不敏感</p><p>3.Oracle中对引号里面的内容大小写敏感</p><p>3.表空间名、文件路径……等需要用单引号将其包含</p><p>4.一般引号里面的内容需要大写</p></blockquote><hr><h1><span id="准备工作">准备工作：</span></h1><p><strong>安装tips：</strong><a href="https://blog.csdn.net/m0_73569492/article/details/139752761?spm=1001.2014.3001.5501">PLSQL、Oracle以及客户端远程连接服务器笔记（仅供参考）-CSDN博客</a></p><blockquote><p>（1）.Win+R打开services.msc</p><p> <img src="/./../images/66f21500c6889f5bcedc4d9d35afd3f2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> （2）启动一些服务：</p><p>（qwq我不知道哪些有用，哪些没用，所以我都把打开了，不知道有没有负面影响，大家参考一下别的博客吧）</p><p><img src="/./../images/14d9eb7b4c10dd713aed7092ce49302b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p></blockquote><hr><h1><span id="登录">登录：</span></h1><h2><span id="1打开sql-plus命令行工具">1.打开SQL Plus命令行工具</span></h2><h3><span id="第一种方式">第一种方式：</span></h3><p><img src="/./../images/d22f6a21e6fe7c298f14cc4c9ac5e7ca.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="第二种方式">第二种方式：</span></h3><blockquote><p>（1）win+R 打开cmd</p><p><img src="/./../images/1ed922a4a00b95425d8d0efd76d3311f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>（2）输入sqlplus</p><p><img src="/./../images/ebc2811f72afc289d8f1dea3bce83143.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p></blockquote><h2><span id="2以不同用户登录">2.以不同用户登录</span></h2><blockquote><p><strong>注意：</strong></p><p>1.使用用户口令这种形式登录的时候，是不显示密码的，口令输入的时候是不显示的，直接输就好</p><p>2.若是想以显示密码的形式输入，直接在用户名那一块输入：用户名&#x2F;密码</p><p>3.超级管理员（sys）输入时需要注意指定 as sysdba</p></blockquote><h4><span id="system普通管理员">SYSTEM（普通管理员）：</span></h4><p><img src="/./../images/150ff3d4c0894edfa6605790d3110aad.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="sys超级管理员">SYS(超级管理员)：</span></h4><blockquote><h5><span id="不显示密码方式">不显示密码方式：</span></h5><p>用户名：SYS</p><p>密码：sys密码 as sysdba</p><p><img src="/./../images/3abea06f433979383dd0d214cbbca90a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h5><span id="显示密码方式">显示密码方式：</span></h5><p>用户名：sys&#x2F;sys密码 as sysdba</p><p><img src="/./../images/904f8705b5d5e728bb206d3fa3cab571.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p></blockquote><h4><span id="scott普通用户"><strong>SCOTT（普通用户）：</strong></span></h4><h5><span id="若是出现被锁住的情况">若是出现被锁住的情况：<img src="/./../images/f5e98d05ffb12c89c35ebf8471e9a104.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h5><h5><span id="解决方法">解决方法：</span></h5><blockquote><p>（1）登录超级管理员账户，</p><p><img src="/./../images/5ec0cf3f2f86a2dd7d0988837066cd5b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>（2）输入alter user 用户名 account unlock; </p><p> <img src="/./../images/906ad87ef7add1c30ffe69c40a50be01.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>（3）重新登录即可：</p><p><img src="/./../images/c28535fe5646d39e25bbc211a65828a1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p></blockquote><hr><h1><span id="sql基本命令">SQL基本命令</span></h1><p><img src="/./../images/98658ad698cd7b5a48f441016869fa34.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="1数据定义语言ddl">1.数据定义语言（DDL）</span></h1><h2><span id="数据库操作">数据库操作</span></h2><h3><span id="查询所有用户">查询所有用户：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span>(OWNER) <span class="keyword">from</span> all_tables;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="查看当前用户">查看当前用户：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/b9f03916007d4bd174be2ed464017538.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="创建表空间">创建表空间：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> tablespace 表空间名 datafile <span class="string">&#x27;存储路径\***.dbf&#x27;</span> size 空间大小;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/24aef2d0cb1fe0191097b17fd1294117.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="创建用户并指定其表空间">创建用户并指定其表空间：</span></h3><p>（指定表空间需要先创建表空间，如果不指定表空间，就会按照默认空间存储）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> 用户名 identified <span class="keyword">by</span> 密码 <span class="keyword">default</span> tablespace 表空间;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/924f0a327e10c2568c15518c3a86c42e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="给用户授予dba的权限超级管理员">给用户授予dba的权限（超级管理员）：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> dba <span class="keyword">to</span> 用户;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id><img src="/./../images/bc0384bd54b4e601d5559602c6c8631e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><h3><span id="删除表空间">删除表空间：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> tablespace 表空间名 including contents <span class="keyword">and</span> datafiles;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/8d1b79d04f89ecd80ae390f568854c2d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="删除用户超级管理员">删除用户（超级管理员）：</span></h3><blockquote><p>（1）查看用户是否有活跃对话</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sid <span class="keyword">as</span> session_id, serial# <span class="keyword">from</span> v$session <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;用户名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/9af806c2c99cf6062fdc7571e420de59.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>（2）如果查询结果显示有活动的会话，结束这些会话</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill session <span class="string">&#x27;session_id, serial#&#x27;</span> immediate;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> (3）删除用户</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> 用户名 cascade;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/63dd338382437ad93ce4b38f2929268e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  </p></blockquote><h3><span id="切换用户登录">切换用户登录：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn 用户名<span class="operator">/</span>密码</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/a292d3f38a92840137bbb4247c9b7687.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="表操作">表操作</span></h2><h3><span id="查询">查询：</span></h3><h4><span id="查询某个用户下所有表名"><strong>查询某个用户下所有表名：</strong></span></h4><p>（用户名注意大写）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> dba_tables <span class="keyword">where</span> owner <span class="operator">=</span> <span class="string">&#x27;用户名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/be6ce051047552442d03be89b4e2274b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="查询某个用户下表个数">查询某个用户下表个数：</span></h4><p>（用户名注意大写）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> all_tables <span class="keyword">where</span> OWNER <span class="operator">=</span> <span class="string">&#x27;用户名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/367f672553435c3ac232705527ed7f41.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="查询某个用户的表结构">查询某个用户的表结构：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> 用户名.表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/171a028451208aa6929f37c7671424f3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="查询指定表的建表语句">查询指定表的建表语句：</span></h4><p>（表名、用户名注意大写）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_metadata.get_ddl(<span class="string">&#x27;TABLE&#x27;</span>, <span class="string">&#x27;表名&#x27;</span>,<span class="string">&#x27;用户名&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/8ad81ae56c0961d80e7a51125ad81097.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="创建">创建：</span></h3><h4><span id="数据类型">数据类型：</span></h4><p><img src="/./../images/a47b10c00ca70607ce74f5815b32a3c0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="创建表空间">创建表空间：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> tablespace 表空间名 datafile <span class="string">&#x27;文件路径\文件名.dbf&#x27;</span> size 表空间大小;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id><img src="/./../images/d31d2556cebf7fadca29ee70400fcf45.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h5><p> <img src="/./../images/c88dc810ae93a774b0880d84bc972c83.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="创建表">创建表：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#创建表</span><br><span class="line"><span class="keyword">create table</span> 表名(</span><br><span class="line"></span><br><span class="line">        字段<span class="number">1</span> 字段<span class="number">1</span>类型,</span><br><span class="line"></span><br><span class="line">        字段<span class="number">2</span> 字段<span class="number">2</span>类型,</span><br><span class="line"></span><br><span class="line">        字段<span class="number">3</span> 字段<span class="number">3</span>类型,</span><br><span class="line"></span><br><span class="line">        .......</span><br><span class="line"></span><br><span class="line">        字段n 字段n类型</span><br><span class="line"></span><br><span class="line">) ;       </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/70a79f2192ebf673580f916ed795af6f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="给表添加注释">给表添加注释：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comment <span class="keyword">on</span> <span class="keyword">table</span> 表名 <span class="keyword">is</span> <span class="string">&#x27;注释&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <img src="/./../images/97a48f36749ac3b74a04af96d6ad44dd.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="给字段添加注释">给字段添加注释：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comment <span class="keyword">on</span> <span class="keyword">column</span> 表名.字段名 <span class="keyword">is</span> <span class="string">&#x27;注释&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/991d95413bf6e1e11abd85f4486120c1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="表备份">表备份：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> 用户名.备份表名 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 用户名.需要备份的表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/fc79e9c62d2d7dd97d2d76a759d2419b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/878fa76ee8e2b04a3a1b01f815d2713d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/31ea1e34d5ad34cd6c52fb315e950768.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="给表添加一列">给表添加一列：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> (字段名 字段类型 约束条件);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/893c185ac9697fe5de01fec32bea7f7d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="修改">修改：</span></h3><h4><span id="重命名表">重命名表：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 用户名.旧表名 rename <span class="keyword">to</span> 新表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/02bb529b23d639e86c703f3fa368bea3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="添加字段">添加字段：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 用户名.表名 <span class="keyword">add</span> 新字段名 新字段类型 <span class="keyword">default</span> <span class="string">&#x27;默认值&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/1ba09a5aa85313b72caaa0d11ffb5cc6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="修改字段名">修改字段名：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 用户名.表名 rename <span class="keyword">column</span> 旧字段名 <span class="keyword">to</span> 新字段名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/6162c20c11fddf5d7b05fe031f4a6775.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="修改数据类型">修改数据类型：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> T1.emp1 modify temp <span class="type">varchar</span>(<span class="number">30</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/cd672986b9de36355caf918cbf7d0fb6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="删除">删除：</span></h3><h4><span id="删除表字段">删除表字段：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 用户名.表名 <span class="keyword">drop</span> <span class="keyword">column</span> 字段名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/9252aab3e184421c2f4b4fdf356d69df.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="删除表">删除表：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/2adba3f4a8316d7a8e910eb3b71e5e33.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="删除表空间">删除表空间：</span></h4><blockquote><p>（1）查看是否有其它用户在使用该表空间：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_users <span class="keyword">where</span> default_tablespace<span class="operator">=</span><span class="string">&#x27;表空间名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/c62561547930d3006de3a9de405c050b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> （2）若有，则删除这些用户或者将这些用户迁移到别的表空间</p><p>（3）删除表空间</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> tablespace 表空间名 including contents <span class="keyword">and</span> datafiles;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/68a0992605cde01197c229e6a0d14b78.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/a5d08f83c758e1703f5485adb6b222a1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p></blockquote><h4><span id="删除指定表并重新创建该表">删除指定表并重新创建该表：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/0d70f6f41a838eb41e51f763fd174cc7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="2数据操作语言dml">2.数据操作语言（DML）</span></h1><h2><span id="添加数据insert">添加数据（insert）</span></h2><blockquote><p>注意：</p><p>1.插入数据注意顺序</p><p>2.插入的数据大小要合法</p></blockquote><h3><span id="给指定字段添加数据">给指定字段添加数据：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 (字段<span class="number">1</span>，字段<span class="number">2.</span>.....) <span class="keyword">values</span>(值<span class="number">1</span>， 值<span class="number">2.</span>.....);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/2a3256069ff327c8945b6f69822356b7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="给表中批量添加数据">给表中批量添加数据：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">all</span> <span class="keyword">into</span> 用户名.表名(字段<span class="number">1</span>，字段<span class="number">2</span>，字段<span class="number">3.</span>.....) <span class="keyword">values</span>(值<span class="number">1</span>，值<span class="number">2</span>，值<span class="number">3.</span>......)</span><br><span class="line">           <span class="keyword">into</span> 用户名.表名(字段<span class="number">1</span>，字段<span class="number">2</span>，字段<span class="number">3.</span>.....) <span class="keyword">values</span>(值<span class="number">1</span>，值<span class="number">2</span>，值<span class="number">3.</span>......)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/61865314512c23512107c56044ae0c24.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="修改数据update">修改数据（update）</span></h2><h3><span id="修改数据">修改数据：</span></h3><p> 注意：如果没有条件，则会修改整张表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>，字段<span class="number">2</span><span class="operator">=</span>值<span class="number">2.</span>.....[<span class="keyword">where</span> 条件];</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/448d63d4009d26e3c68c01e68cab276e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="删除数据delete">删除数据（delete）</span></h2><h3><span id="删除数据">删除数据：</span></h3><p>注意：如果没有条件，则会删除整张表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id><img src="/./../images/a5bd875aa6273652f31415e3072e95cd.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h2><hr><h1><span id="3数据查询语言dql">3.数据查询语言（DQL）</span></h1><h2><span id="编写顺序">编写顺序：</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> [<span class="keyword">distinct</span><span class="operator">|</span><span class="keyword">all</span>] 字段列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> 表名</span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span> 查询条件</span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组字段列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">having</span> 分组后条件列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序字段列表:<span class="keyword">asc</span>或者<span class="keyword">desc</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>作示范的表结构：</strong></p><p><img src="/./../images/84ea121a93f55bd7ce1e91018f26ff6b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>表名：T_STUDENT</p><p><img src="/./../images/267618462c80e1e2dc172b7893a712d3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="执行顺序">执行顺序：</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> 表名 : 从哪张表查询</span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span> 条件 ：查询条件</span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组条件 ：分组</span><br><span class="line"></span><br><span class="line"><span class="keyword">having</span> 分组后查询条件 ：分组后查询条件</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> 字段列表 ：选择字段</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序方式 ：对查询结果进行排序</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="基本查询">基本查询</span></h2><h3><span id="查询多个字段">查询多个字段：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>，字段<span class="number">2</span>，字段<span class="number">3.</span>..<span class="keyword">from</span> 表名;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="设置别名">设置别名：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>[<span class="keyword">as</span> 别名<span class="number">1</span>]，字段<span class="number">2</span> [<span class="keyword">as</span> 别名<span class="number">2</span>]......<span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/517a020e1d96342be7c4ebc307573c1c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="去除重复记录">去除重复记录：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段列表 <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="条件查询">条件查询</span></h2><h3><span id="语法">语法：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件列表;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id><img src="/./../images/1f49d960e33577adfcdf7eeb3dd409fb.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><h3><span id="条件">条件：</span></h3><table><thead><tr><th>比较运算符</th><th>功能</th></tr></thead><tbody><tr><td><strong>&gt;</strong></td><td></td></tr><tr><td><strong>&gt;&#x3D;</strong></td><td></td></tr><tr><td><strong>&lt;</strong></td><td></td></tr><tr><td><strong>&lt;&#x3D;</strong></td><td></td></tr><tr><td><strong>&#x3D;</strong></td><td></td></tr><tr><td><strong>&lt;&gt; 或 !&#x3D;</strong></td><td><strong>不等于</strong></td></tr><tr><td><strong>between…and…</strong></td><td><strong>在某个范围之内</strong></td></tr><tr><td><strong>in(…)</strong></td><td><strong>在in之后的括号中，多选一</strong></td></tr><tr><td><strong>like 占位符</strong></td><td><strong>模糊匹配（_匹配单个字符，%匹配任意个字符）</strong></td></tr><tr><td><strong>is null</strong></td><td></td></tr><tr><td><strong>and 或 &amp;&amp;</strong></td><td><strong>并且</strong></td></tr><tr><td><strong>or 或 ||</strong></td><td><strong>或</strong></td></tr><tr><td><strong>not 或 !</strong></td><td><strong>非</strong></td></tr></tbody></table><h2><span id="聚合函数">聚合函数</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 聚合函数(字段列表) <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/3ace072af958dfe6d3bde283221dd218.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>注意：</strong></p><blockquote><p>​    对一列进行计算 所有null值不参与聚合函数的计算</p></blockquote><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><strong>count</strong></td><td><strong>统计数量</strong></td></tr><tr><td><strong>max</strong></td><td><strong>最大值</strong></td></tr><tr><td><strong>min</strong></td><td><strong>最小值</strong></td></tr><tr><td><strong>avg</strong></td><td><strong>平均值</strong></td></tr><tr><td><strong>sum</strong></td><td><strong>求和</strong></td></tr></tbody></table><h2><span id="分组查询">分组查询</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">group</span> <span class="keyword">by</span> 分组字段名 [<span class="keyword">having</span> 分组后过滤条件];</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><table><thead><tr><th><strong>where</strong></th><th><code>**分组之前执行,不满足where条件的不参与分组,where不能对聚合函数进行判断**</code></th></tr></thead><tbody><tr><td><strong>having</strong></td><td><code>**分组之后对结果进行过滤,having可以对聚合函数进行判断**</code></td></tr></tbody></table><p><strong>eg:</strong></p><p><img src="/./../images/78d82815420085ae4f6ffc9443e03a69.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="排序查询">排序查询</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 <span class="keyword">order</span> <span class="keyword">by</span> 字段<span class="number">1</span> 排序方式<span class="number">1</span>, 字段<span class="number">2</span> 排序方式<span class="number">2</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><table><thead><tr><th><strong>asc</strong></th><th><strong>升序（默认）</strong></th></tr></thead><tbody><tr><td><strong>desc</strong></td><td><strong>降序</strong></td></tr></tbody></table><p><img src="/./../images/e0e447c4e53eb881a3d2ca119f8c122e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="分页查询">分页查询</span></h2><p>（oracle查询没有limit关键字，引入rownum进行分页查询）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> rownum rn, t.<span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">    (<span class="keyword">select</span> 字段 <span class="keyword">from</span> t_student) t <span class="keyword">where</span> rownum <span class="operator">&lt;=</span> 终止行</span><br><span class="line">)</span><br><span class="line"> <span class="keyword">where</span> rn <span class="operator">&gt;=</span> 起始行;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/340d704c3e8871247b5079b97015783a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="4数据控制语言dcl">4.数据控制语言（DCL）</span></h1><h2><span id="管理用户">管理用户</span></h2><h3><span id="查看当前用户">查看当前用户：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>切换用户：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">connect</span> 用户名<span class="operator">/</span>密码;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/7d8df788d4b7667511eb525c30c9fb50.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p><strong>注意连接到数据库超级管理员的时候：</strong></p><p>可能会出现以下错误：</p><p><img src="/./../images/a8bad2101b308c24cfc3cf82c5f2ec9f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>解决方法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">connect</span> sys<span class="operator">/</span>密码 <span class="keyword">as</span> sysdba</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <img src="/./../images/297797dfaa5c031c14e9365107675c8f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p></blockquote><h2><span id="权限控制">权限控制</span></h2><h3><span id="查询用户权限">查询用户权限：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dba_sys_privs <span class="keyword">where</span> grantee<span class="operator">=</span><span class="string">&#x27;用户名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="授予权限">授予权限：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> 权限 <span class="keyword">to</span> 用户;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><table><thead><tr><th>权限</th><th>说明</th></tr></thead><tbody><tr><td>create session</td><td>登录权限</td></tr><tr><td>create table</td><td>创建表的权限</td></tr><tr><td>drop any table</td><td>删除任意表</td></tr><tr><td>insert any table</td><td>向任意表中插入行</td></tr><tr><td>update any table</td><td>修改任意表中行的权限</td></tr><tr><td>select on 表名</td><td>查看指定表的权限</td></tr></tbody></table><p> eg：</p><p><img src="/./../images/e344ac75542629b9995d51ba8338f84e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="回收权限">回收权限：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--回收用户权限</span></span><br><span class="line"><span class="keyword">revoke</span> 权限 <span class="keyword">from</span> 用户;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> <span class="keyword">select</span> <span class="keyword">on</span> 用户<span class="number">2.</span>表<span class="number">2</span> <span class="keyword">from</span> 用户<span class="number">1</span>; #回收用户<span class="number">1</span>查看表<span class="number">2</span>的权限</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/ab244ed7fd0b1f6c9a79630b31c6dd7b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="函数">函数</span></h1><h2><span id="使用">使用</span></h2><blockquote><p>一般形式：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 函数 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>如果只是想看函数的返回结果可以使用以下形式:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 函数 <span class="keyword">from</span> sys.dual;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p></blockquote><h2><span id="sysdual">sys.dual</span></h2><blockquote><p>dual是一个虚拟表，用来构成select的语法规则，oracle保证dual里面永远只有一条记录</p></blockquote><h2><span id="字符串函数">字符串函数</span></h2><p>eg:</p><p> <img src="/./../images/fbd7bde2422e621029ccc8f9bf8fc83e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/aff1fc564b0dbf782e06085d37208f48.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> <img src="/./../images/6d53f8c375e4951c76cf448f727c3baa.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  </p><h2><span id="数值函数">数值函数</span></h2><p>eg： </p><p><img src="/./../images/d35471f1e6cab7e11b2ff38e3d721f95.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/999125838c56af81d8756c65263e2f8c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/fcb1a731c4f4ec18f369f08adaa7363b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="日期函数">日期函数</span></h2><h3><span id="日期表示"><strong>日期表示:</strong></span></h3><blockquote><p>日期-月份-年份  </p><p>eg：21-9月-2024</p></blockquote><h3><span id="函数概述">函数概述：</span></h3><h3><span id="eg">eg:</span></h3><h4><span id="sysdate">sysdate：</span></h4><p><img src="/./../images/17ad51f6237a5327854f372804366892.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="next_day">next_day():</span></h4><h4><span id="last_day"><img src="/./../images/e08719c1055fcb17765d98bc6d3ddb27.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  last_day():<img src="/./../images/0f022250245f8b0ea4916e0dd82db41e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h4><h4><span id="round">round() :</span></h4><h4><span id="add_months"><img src="/./../images/23be81f71051dc1cabc63465775b0bf5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  add_months():<img src="/./../images/d8f48457ab44c11cc639dc599fbf072d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h4><h4><span id="months_between">months_between():</span></h4><p><img src="/./../images/f50866725db8a186ff28bffa7ee12280.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="extract">extract():</span></h4><p><img src="/./../images/9ad1eaa3306788dd61d99e0128bba509.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="约束">约束</span></h1><h2><span id="概念">概念</span></h2><blockquote><p>​        约束是作用于表中字段上的规则，用于限制存储在表中的数据</p><p>​        约束可以在创建表&#x2F;修改表的时候添加</p></blockquote><h2><span id="分类">分类</span></h2><table><thead><tr><th>约束</th><th>描述</th><th>关键字</th></tr></thead><tbody><tr><td>非空约束</td><td>限制该字段的数据不能为null</td><td>not null</td></tr><tr><td>唯一约束</td><td>保证该字段的所有数据都是唯一的、不重复的</td><td>unique</td></tr><tr><td>主键约束</td><td>主键是一行数据的唯一标识，要求非空且唯一</td><td>primary key</td></tr><tr><td>默认约束</td><td>保存数据时，如果未指定该字段的值，则采用默认值</td><td>default</td></tr><tr><td>检查约束</td><td>保证字段值满足某一条件</td><td>check</td></tr><tr><td>外键约束</td><td>用来让两张表的数据之间建立连接，保证数据的一致性和完整性</td><td>foreign key</td></tr></tbody></table><p><strong>建表时添加约束：</strong></p><p><img src="/./../images/40829ad61cb440a75560116ef1150827.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/4361af9477a8300dfc31b28afe51f905.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <strong>sql语句添加：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> constraints 约束名称 <span class="keyword">primary key</span>(列名);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/c1e4e29e2fd27c6a347a60f6e42df8a0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="外键约束">外键约束</span></h2><blockquote><p><strong>子表（从表）</strong>：具有外键的表</p><p><strong>父表（主表）</strong>：外键所关联的表</p><p>FOREIGN KEY约束可以与另外一个表的PRIMARY KEY及UNIQUE关联</p></blockquote><h3><span id="添加外键">添加外键：</span></h3><h4><span id="在创建表的时候添加">在创建表的时候添加：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constraint</span> 外键名称 <span class="keyword">foreign key</span>(外键) <span class="keyword">references</span> 表名(外键关联的键)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/15280ebfce7b2df8fd7b27dff7e357a2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreign key</span>(列名) <span class="keyword">references</span> 外键关联的表名</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/dd8465a2c2df1e2ede3033ac36d3c708.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="sql语句添加alter">sql语句添加（alter）：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add constraint</span> 外键名称 <span class="keyword">foreign key</span>(列名) <span class="keyword">references</span> 表名(外键关联的键);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/95b469abf6c04f1f7729a5e768e0c87f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="查询外键">查询外键</span></h3><h4><span id="根据外键名称查看外键所在位置">根据外键名称查看外键所在位置：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_cons_columns cl <span class="keyword">where</span> cl.constraint_name<span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;外键名称&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/59bb57a88e5f365f8eb73c9eab603a71.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="查找表的外键">查找表的外键：</span></h4><p>（包括名称，引用表的表名和对应的列名）</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_constraints c <span class="keyword">where</span> c.constraint_type<span class="operator">=</span><span class="string">&#x27;R&#x27;</span> <span class="keyword">and</span> c.table_name<span class="operator">=</span><span class="built_in">upper</span>(<span class="string">&#x27;表名&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/03c84c702efc3edb60fdc407380dd4f1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="删除外键">删除外键</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">drop</span> <span class="keyword">constraint</span> 外键名称;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/e6ca24642a85ab1b2c34b909573e2ab0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="多表查询">多表查询</span></h1><h2><span id="基本概念">基本概念</span></h2><blockquote><p><strong>自然连接（内连接）：</strong>左表与右表中每一个元组进行条件匹配，满足条件的才会查询出来</p><p><strong>自连接：</strong>同一个表内的查询</p><p><strong>外连接：</strong></p><ul><li>左外连接：左表中的元组不会丢失，即每一个左表中的元素都可查出，若右表没有匹配的，就置为空</li><li>右外连接：右表中的元组不会丢失，即每一个右表中的元素都可查出，若左表没有匹配的，就置为空</li><li>全连接：左右表的悬浮元组都会加入到最后的查询结果中</li></ul></blockquote><h2><span id="基本结构">基本结构</span></h2><h3><span id="内连接外连接">内连接+外连接：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询的字段名 <span class="keyword">from</span> 左表 [<span class="keyword">inner</span><span class="operator">|</span><span class="keyword">left</span><span class="operator">|</span><span class="keyword">right</span><span class="operator">|</span><span class="keyword">full</span>] <span class="keyword">join</span> 右表 <span class="keyword">on</span> 连接条件;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="自连接">自连接：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 别名.查询的字段名（列名）<span class="keyword">from</span> 表<span class="number">1</span> 别名<span class="number">1</span>, 表<span class="number">1</span> 别名<span class="number">2</span> <span class="keyword">where</span> 连接条件;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="关系运算">关系运算</span></h2><p><img src="/./../images/7f967bbc883e1dbeda945687d8bd6cb1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="大学模式">大学模式：</span></h2><p><img src="/./../images/e0fc8f8f8539bbc29022e483a46d2cea.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> <img src="/./../images/c7e5a14881782b631e589aa16e3e02e2.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/8605943ddda38fd8208784f660974792.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/0582f19eec2c4abba90f7147f044155a.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/4059de81e3f06c988f800b1a9481d45f.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/88a754eb7e21b8203df37cbe1b8cc101.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/809a520c7a01692fb16ca9d1edcfb273.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/7114e28ca3873c75d96c919a183d8ef7.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>首先以黑书里面的<a href="https://db-book.com/">大学模式</a>为例：</p><h3><span id="创建基本表结构">创建基本表结构：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> classroom</span><br><span class="line">(building <span class="type">varchar</span>(<span class="number">15</span>),</span><br><span class="line"> room_number <span class="type">varchar</span>(<span class="number">7</span>),</span><br><span class="line"> capacity <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (building, room_number)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> department</span><br><span class="line">(dept_name <span class="type">varchar</span>(<span class="number">20</span>), </span><br><span class="line"> building <span class="type">varchar</span>(<span class="number">15</span>), </span><br><span class="line"> budget <span class="type">numeric</span>(<span class="number">12</span>,<span class="number">2</span>) <span class="keyword">check</span> (budget <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (dept_name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> course</span><br><span class="line">(course_id <span class="type">varchar</span>(<span class="number">8</span>), </span><br><span class="line"> title <span class="type">varchar</span>(<span class="number">50</span>), </span><br><span class="line"> dept_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line"> credits <span class="type">numeric</span>(<span class="number">2</span>,<span class="number">0</span>) <span class="keyword">check</span> (credits <span class="operator">&gt;</span> <span class="number">0</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (course_id),</span><br><span class="line"> <span class="keyword">foreign key</span> (dept_name) <span class="keyword">references</span> department (dept_name)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> instructor</span><br><span class="line">(ID <span class="type">varchar</span>(<span class="number">5</span>), </span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">not null</span>, </span><br><span class="line"> dept_name <span class="type">varchar</span>(<span class="number">20</span>), </span><br><span class="line"> salary <span class="type">numeric</span>(<span class="number">8</span>,<span class="number">2</span>) <span class="keyword">check</span> (salary <span class="operator">&gt;</span> <span class="number">29000</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (ID),</span><br><span class="line"> <span class="keyword">foreign key</span> (dept_name) <span class="keyword">references</span> department (dept_name)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> section</span><br><span class="line">(course_id <span class="type">varchar</span>(<span class="number">8</span>), </span><br><span class="line">         sec_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line"> semester <span class="type">varchar</span>(<span class="number">6</span>)</span><br><span class="line"><span class="keyword">check</span> (semester <span class="keyword">in</span> (<span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;Winter&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>)), </span><br><span class="line"> <span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>) <span class="keyword">check</span> (<span class="keyword">year</span> <span class="operator">&gt;</span> <span class="number">1701</span> <span class="keyword">and</span> <span class="keyword">year</span> <span class="operator">&lt;</span> <span class="number">2100</span>), </span><br><span class="line"> building <span class="type">varchar</span>(<span class="number">15</span>),</span><br><span class="line"> room_number <span class="type">varchar</span>(<span class="number">7</span>),</span><br><span class="line"> time_slot_id <span class="type">varchar</span>(<span class="number">4</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (course_id, sec_id, semester, <span class="keyword">year</span>),</span><br><span class="line"> <span class="keyword">foreign key</span> (course_id) <span class="keyword">references</span> course (course_id)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> cascade,</span><br><span class="line"> <span class="keyword">foreign key</span> (building, room_number) <span class="keyword">references</span> classroom (building, room_number)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> teaches</span><br><span class="line">(ID <span class="type">varchar</span>(<span class="number">5</span>), </span><br><span class="line"> course_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line"> sec_id <span class="type">varchar</span>(<span class="number">8</span>), </span><br><span class="line"> semester <span class="type">varchar</span>(<span class="number">6</span>),</span><br><span class="line"> <span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (ID, course_id, sec_id, semester, <span class="keyword">year</span>),</span><br><span class="line"> <span class="keyword">foreign key</span> (course_id, sec_id, semester, <span class="keyword">year</span>) <span class="keyword">references</span> section (course_id, sec_id, semester, <span class="keyword">year</span>)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> cascade,</span><br><span class="line"> <span class="keyword">foreign key</span> (ID) <span class="keyword">references</span> instructor (ID)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> cascade</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> student</span><br><span class="line">(ID  <span class="type">varchar</span>(<span class="number">5</span>), </span><br><span class="line"> name <span class="type">varchar</span>(<span class="number">20</span>)  <span class="keyword">not null</span>, </span><br><span class="line"> dept_name  <span class="type">varchar</span>(<span class="number">20</span>), </span><br><span class="line"> tot_cred  <span class="type">numeric</span>(<span class="number">3</span>,<span class="number">0</span>) <span class="keyword">check</span> (tot_cred <span class="operator">&gt;=</span> <span class="number">0</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (ID),</span><br><span class="line"> <span class="keyword">foreign key</span> (dept_name) <span class="keyword">references</span> department (dept_name)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="keyword">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> takes</span><br><span class="line">(ID <span class="type">varchar</span>(<span class="number">5</span>), </span><br><span class="line"> course_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line"> sec_id <span class="type">varchar</span>(<span class="number">8</span>), </span><br><span class="line"> semester <span class="type">varchar</span>(<span class="number">6</span>),</span><br><span class="line"> <span class="keyword">year</span> <span class="type">numeric</span>(<span class="number">4</span>,<span class="number">0</span>),</span><br><span class="line"> grade         <span class="type">varchar</span>(<span class="number">2</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (ID, course_id, sec_id, semester, <span class="keyword">year</span>),</span><br><span class="line"> <span class="keyword">foreign key</span> (course_id, sec_id, semester, <span class="keyword">year</span>) <span class="keyword">references</span> section (course_id, sec_id, semester, <span class="keyword">year</span>)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> cascade,</span><br><span class="line"> <span class="keyword">foreign key</span> (ID) <span class="keyword">references</span> student (ID)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> cascade</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> advisor</span><br><span class="line">(s_ID  <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line"> i_ID <span class="type">varchar</span>(<span class="number">5</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (s_ID),</span><br><span class="line"> <span class="keyword">foreign key</span> (i_ID) <span class="keyword">references</span>  instructor (ID)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="keyword">null</span>,</span><br><span class="line"> <span class="keyword">foreign key</span> (s_ID) <span class="keyword">references</span>  student (ID)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> cascade</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> time_slot</span><br><span class="line">(time_slot_id <span class="type">varchar</span>(<span class="number">4</span>),</span><br><span class="line"> <span class="keyword">day</span> <span class="type">varchar</span>(<span class="number">1</span>),</span><br><span class="line"> start_hr <span class="type">numeric</span>(<span class="number">2</span>)  <span class="keyword">check</span> (start_hr <span class="operator">&gt;=</span> <span class="number">0</span> <span class="keyword">and</span> start_hr <span class="operator">&lt;</span> <span class="number">24</span>),</span><br><span class="line"> start_min <span class="type">numeric</span>(<span class="number">2</span>)  <span class="keyword">check</span> (start_min <span class="operator">&gt;=</span> <span class="number">0</span> <span class="keyword">and</span> start_min <span class="operator">&lt;</span> <span class="number">60</span>),</span><br><span class="line"> end_hr <span class="type">numeric</span>(<span class="number">2</span>)  <span class="keyword">check</span> (end_hr <span class="operator">&gt;=</span> <span class="number">0</span> <span class="keyword">and</span> end_hr <span class="operator">&lt;</span> <span class="number">24</span>),</span><br><span class="line"> end_min <span class="type">numeric</span>(<span class="number">2</span>)  <span class="keyword">check</span> (end_min <span class="operator">&gt;=</span> <span class="number">0</span> <span class="keyword">and</span> end_min <span class="operator">&lt;</span> <span class="number">60</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (time_slot_id, <span class="keyword">day</span>, start_hr, start_min)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create table</span> prereq</span><br><span class="line">(course_id <span class="type">varchar</span>(<span class="number">8</span>), </span><br><span class="line"> prereq_id <span class="type">varchar</span>(<span class="number">8</span>),</span><br><span class="line"> <span class="keyword">primary key</span> (course_id, prereq_id),</span><br><span class="line"> <span class="keyword">foreign key</span> (course_id) <span class="keyword">references</span> course (course_id)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> cascade,</span><br><span class="line"> <span class="keyword">foreign key</span> (prereq_id) <span class="keyword">references</span> course (course_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="插入数据">插入数据：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> prereq;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> time_slot;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> advisor;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> takes;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> student;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> teaches;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> section;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> instructor;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> course;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> department;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> classroom;</span><br><span class="line"><span class="keyword">insert into</span> classroom <span class="keyword">values</span> (<span class="string">&#x27;Packard&#x27;</span>, <span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;500&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> classroom <span class="keyword">values</span> (<span class="string">&#x27;Painter&#x27;</span>, <span class="string">&#x27;514&#x27;</span>, <span class="string">&#x27;10&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> classroom <span class="keyword">values</span> (<span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;3128&#x27;</span>, <span class="string">&#x27;70&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> classroom <span class="keyword">values</span> (<span class="string">&#x27;Watson&#x27;</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;30&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> classroom <span class="keyword">values</span> (<span class="string">&#x27;Watson&#x27;</span>, <span class="string">&#x27;120&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> department <span class="keyword">values</span> (<span class="string">&#x27;Biology&#x27;</span>, <span class="string">&#x27;Watson&#x27;</span>, <span class="string">&#x27;90000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> department <span class="keyword">values</span> (<span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;100000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> department <span class="keyword">values</span> (<span class="string">&#x27;Elec. Eng.&#x27;</span>, <span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;85000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> department <span class="keyword">values</span> (<span class="string">&#x27;Finance&#x27;</span>, <span class="string">&#x27;Painter&#x27;</span>, <span class="string">&#x27;120000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> department <span class="keyword">values</span> (<span class="string">&#x27;History&#x27;</span>, <span class="string">&#x27;Painter&#x27;</span>, <span class="string">&#x27;50000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> department <span class="keyword">values</span> (<span class="string">&#x27;Music&#x27;</span>, <span class="string">&#x27;Packard&#x27;</span>, <span class="string">&#x27;80000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> department <span class="keyword">values</span> (<span class="string">&#x27;Physics&#x27;</span>, <span class="string">&#x27;Watson&#x27;</span>, <span class="string">&#x27;70000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;BIO-101&#x27;</span>, <span class="string">&#x27;Intro. to Biology&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;BIO-301&#x27;</span>, <span class="string">&#x27;Genetics&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;BIO-399&#x27;</span>, <span class="string">&#x27;Computational Biology&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;Intro. to Computer Science&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;Game Design&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;CS-315&#x27;</span>, <span class="string">&#x27;Robotics&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;Image Processing&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;CS-347&#x27;</span>, <span class="string">&#x27;Database System Concepts&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;EE-181&#x27;</span>, <span class="string">&#x27;Intro. to Digital Systems&#x27;</span>, <span class="string">&#x27;Elec. Eng.&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;FIN-201&#x27;</span>, <span class="string">&#x27;Investment Banking&#x27;</span>, <span class="string">&#x27;Finance&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;HIS-351&#x27;</span>, <span class="string">&#x27;World History&#x27;</span>, <span class="string">&#x27;History&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;MU-199&#x27;</span>, <span class="string">&#x27;Music Video Production&#x27;</span>, <span class="string">&#x27;Music&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> course <span class="keyword">values</span> (<span class="string">&#x27;PHY-101&#x27;</span>, <span class="string">&#x27;Physical Principles&#x27;</span>, <span class="string">&#x27;Physics&#x27;</span>, <span class="string">&#x27;4&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;10101&#x27;</span>, <span class="string">&#x27;Srinivasan&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;65000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;12121&#x27;</span>, <span class="string">&#x27;Wu&#x27;</span>, <span class="string">&#x27;Finance&#x27;</span>, <span class="string">&#x27;90000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;15151&#x27;</span>, <span class="string">&#x27;Mozart&#x27;</span>, <span class="string">&#x27;Music&#x27;</span>, <span class="string">&#x27;40000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;22222&#x27;</span>, <span class="string">&#x27;Einstein&#x27;</span>, <span class="string">&#x27;Physics&#x27;</span>, <span class="string">&#x27;95000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;32343&#x27;</span>, <span class="string">&#x27;El Said&#x27;</span>, <span class="string">&#x27;History&#x27;</span>, <span class="string">&#x27;60000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;33456&#x27;</span>, <span class="string">&#x27;Gold&#x27;</span>, <span class="string">&#x27;Physics&#x27;</span>, <span class="string">&#x27;87000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;45565&#x27;</span>, <span class="string">&#x27;Katz&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;75000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;58583&#x27;</span>, <span class="string">&#x27;Califieri&#x27;</span>, <span class="string">&#x27;History&#x27;</span>, <span class="string">&#x27;62000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;76543&#x27;</span>, <span class="string">&#x27;Singh&#x27;</span>, <span class="string">&#x27;Finance&#x27;</span>, <span class="string">&#x27;80000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;76766&#x27;</span>, <span class="string">&#x27;Crick&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="string">&#x27;72000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;83821&#x27;</span>, <span class="string">&#x27;Brandt&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;92000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> instructor <span class="keyword">values</span> (<span class="string">&#x27;98345&#x27;</span>, <span class="string">&#x27;Kim&#x27;</span>, <span class="string">&#x27;Elec. Eng.&#x27;</span>, <span class="string">&#x27;80000&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;BIO-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;Painter&#x27;</span>, <span class="string">&#x27;514&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;BIO-301&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Painter&#x27;</span>, <span class="string">&#x27;514&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;Packard&#x27;</span>, <span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;H&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Packard&#x27;</span>, <span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;F&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;3128&#x27;</span>, <span class="string">&#x27;E&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;3128&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-315&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Watson&#x27;</span>, <span class="string">&#x27;120&#x27;</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Watson&#x27;</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;3128&#x27;</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;CS-347&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;3128&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;EE-181&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;Taylor&#x27;</span>, <span class="string">&#x27;3128&#x27;</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;FIN-201&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Packard&#x27;</span>, <span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;HIS-351&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Painter&#x27;</span>, <span class="string">&#x27;514&#x27;</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;MU-199&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;Packard&#x27;</span>, <span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> section <span class="keyword">values</span> (<span class="string">&#x27;PHY-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;Watson&#x27;</span>, <span class="string">&#x27;100&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;10101&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;10101&#x27;</span>, <span class="string">&#x27;CS-315&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;10101&#x27;</span>, <span class="string">&#x27;CS-347&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;12121&#x27;</span>, <span class="string">&#x27;FIN-201&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;15151&#x27;</span>, <span class="string">&#x27;MU-199&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;22222&#x27;</span>, <span class="string">&#x27;PHY-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;32343&#x27;</span>, <span class="string">&#x27;HIS-351&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;45565&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;45565&#x27;</span>, <span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;76766&#x27;</span>, <span class="string">&#x27;BIO-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;76766&#x27;</span>, <span class="string">&#x27;BIO-301&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;83821&#x27;</span>, <span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;83821&#x27;</span>, <span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;83821&#x27;</span>, <span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> teaches <span class="keyword">values</span> (<span class="string">&#x27;98345&#x27;</span>, <span class="string">&#x27;EE-181&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;00128&#x27;</span>, <span class="string">&#x27;Zhang&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;102&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;12345&#x27;</span>, <span class="string">&#x27;Shankar&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;32&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;19991&#x27;</span>, <span class="string">&#x27;Brandt&#x27;</span>, <span class="string">&#x27;History&#x27;</span>, <span class="string">&#x27;80&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;23121&#x27;</span>, <span class="string">&#x27;Chavez&#x27;</span>, <span class="string">&#x27;Finance&#x27;</span>, <span class="string">&#x27;110&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;44553&#x27;</span>, <span class="string">&#x27;Peltier&#x27;</span>, <span class="string">&#x27;Physics&#x27;</span>, <span class="string">&#x27;56&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;45678&#x27;</span>, <span class="string">&#x27;Levy&#x27;</span>, <span class="string">&#x27;Physics&#x27;</span>, <span class="string">&#x27;46&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;54321&#x27;</span>, <span class="string">&#x27;Williams&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;54&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;55739&#x27;</span>, <span class="string">&#x27;Sanchez&#x27;</span>, <span class="string">&#x27;Music&#x27;</span>, <span class="string">&#x27;38&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;70557&#x27;</span>, <span class="string">&#x27;Snow&#x27;</span>, <span class="string">&#x27;Physics&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;76543&#x27;</span>, <span class="string">&#x27;Brown&#x27;</span>, <span class="string">&#x27;Comp. Sci.&#x27;</span>, <span class="string">&#x27;58&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;76653&#x27;</span>, <span class="string">&#x27;Aoi&#x27;</span>, <span class="string">&#x27;Elec. Eng.&#x27;</span>, <span class="string">&#x27;60&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;98765&#x27;</span>, <span class="string">&#x27;Bourikas&#x27;</span>, <span class="string">&#x27;Elec. Eng.&#x27;</span>, <span class="string">&#x27;98&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> student <span class="keyword">values</span> (<span class="string">&#x27;98988&#x27;</span>, <span class="string">&#x27;Tanaka&#x27;</span>, <span class="string">&#x27;Biology&#x27;</span>, <span class="string">&#x27;120&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;00128&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;00128&#x27;</span>, <span class="string">&#x27;CS-347&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;A-&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;12345&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;12345&#x27;</span>, <span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;12345&#x27;</span>, <span class="string">&#x27;CS-315&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;12345&#x27;</span>, <span class="string">&#x27;CS-347&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;19991&#x27;</span>, <span class="string">&#x27;HIS-351&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;23121&#x27;</span>, <span class="string">&#x27;FIN-201&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;C+&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;44553&#x27;</span>, <span class="string">&#x27;PHY-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;B-&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;45678&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;F&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;45678&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;B+&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;45678&#x27;</span>, <span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;54321&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;A-&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;54321&#x27;</span>, <span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;B+&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;55739&#x27;</span>, <span class="string">&#x27;MU-199&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;A-&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;76543&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;76543&#x27;</span>, <span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;76653&#x27;</span>, <span class="string">&#x27;EE-181&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;98765&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Fall&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;C-&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;98765&#x27;</span>, <span class="string">&#x27;CS-315&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Spring&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;98988&#x27;</span>, <span class="string">&#x27;BIO-101&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> takes <span class="keyword">values</span> (<span class="string">&#x27;98988&#x27;</span>, <span class="string">&#x27;BIO-301&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;Summer&#x27;</span>, <span class="string">&#x27;2018&#x27;</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;00128&#x27;</span>, <span class="string">&#x27;45565&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;12345&#x27;</span>, <span class="string">&#x27;10101&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;23121&#x27;</span>, <span class="string">&#x27;76543&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;44553&#x27;</span>, <span class="string">&#x27;22222&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;45678&#x27;</span>, <span class="string">&#x27;22222&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;76543&#x27;</span>, <span class="string">&#x27;45565&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;76653&#x27;</span>, <span class="string">&#x27;98345&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;98765&#x27;</span>, <span class="string">&#x27;98345&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> advisor <span class="keyword">values</span> (<span class="string">&#x27;98988&#x27;</span>, <span class="string">&#x27;76766&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;45 &#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;11&#x27;</span>, <span class="string">&#x27;45 &#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;45 &#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;14&#x27;</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;15&#x27;</span>, <span class="string">&#x27;45 &#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;16&#x27;</span>, <span class="string">&#x27;50&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> time_slot <span class="keyword">values</span> (<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;12&#x27;</span>, <span class="string">&#x27;30&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> prereq <span class="keyword">values</span> (<span class="string">&#x27;BIO-301&#x27;</span>, <span class="string">&#x27;BIO-101&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> prereq <span class="keyword">values</span> (<span class="string">&#x27;BIO-399&#x27;</span>, <span class="string">&#x27;BIO-101&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> prereq <span class="keyword">values</span> (<span class="string">&#x27;CS-190&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> prereq <span class="keyword">values</span> (<span class="string">&#x27;CS-315&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> prereq <span class="keyword">values</span> (<span class="string">&#x27;CS-319&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> prereq <span class="keyword">values</span> (<span class="string">&#x27;CS-347&#x27;</span>, <span class="string">&#x27;CS-101&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> prereq <span class="keyword">values</span> (<span class="string">&#x27;EE-181&#x27;</span>, <span class="string">&#x27;PHY-101&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="内连接-自然连接">内连接 （自然连接）</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询的字段（列名）<span class="keyword">from</span> 左表 <span class="keyword">inner</span> <span class="keyword">join</span> 右边 <span class="keyword">on</span> 连接条件;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/53212883411440b6c476354688598089.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="外连接">外连接</span></h2><h3><span id="左外连接">左外连接</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询的字段名（列名）<span class="keyword">from</span> 左表 <span class="keyword">left</span> <span class="keyword">join</span> 右表 <span class="keyword">on</span> 连接条件;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id><img src="/./../images/15d70b19a53e84723c86870af92d60ce.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h2><h3><span id="右外连接">右外连接</span></h3><h2><span id><img src="/./../images/e2545ef8dfe819b25711e6ca4d9d1519.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h2><h3><span id="全连接">全连接</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询出的字段名（列名） <span class="keyword">from</span> 左表 <span class="keyword">full</span> <span class="keyword">join</span> 右表 <span class="keyword">on</span> 连接条件;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/d4f47a3733ffb6efc263550d72f979fe.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="自连接">自连接</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 别名.查询的字段名（列名）<span class="keyword">from</span> 表<span class="number">1</span> 别名<span class="number">1</span>, 表<span class="number">1</span> 别名<span class="number">2</span> <span class="keyword">where</span> 连接条件;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id><img src="/./../images/4ecfafa24c16d6298db3985d7953512c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h2><hr><h1><span id="视图">视图</span></h1><h2><span id="基本概念">基本概念</span></h2><blockquote><ol><li>视图是一个虚拟表，视图不在数据库中存储数据，视图的行和列来自于子查询所返回的结果</li><li>视图名不允许与基本表重名</li><li>可以通过视图对数据进行增删改查：insert、delete、select</li><li>基本表中的数据改变时，视图中的数据也会动态更新</li></ol></blockquote><h2><span id="基本操作">基本操作</span></h2><h3><span id="查看视图">查看视图</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> Vcourse;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/acd5e779356e0606b132ba64e3b1dc42.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="创建视图">创建视图</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">or</span> replace] [&#123;force<span class="operator">|</span>noforce&#125;] <span class="keyword">view</span> 视图名(别名列表) <span class="keyword">as</span> 子查询;</span><br><span class="line"><span class="comment">--or replace:如果视图已存在，则用新视图替换旧视图</span></span><br><span class="line"><span class="comment">--force:基本表不存在，也可以创建视图，但是创建的视图不能正常使用</span></span><br><span class="line"><span class="comment">--noforce:基本表不存在，不能创建视图</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/45cddd93de2c0ed55b545584187d31c4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/f35f0585e9eafe6c48050ff1feb2b556.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="修改视图">修改视图</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> 视图名 <span class="keyword">as</span> 子查询;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/5029e83e9639805f7466b7ccd0a348f4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="删除视图">删除视图</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> [if <span class="keyword">exists</span>] 视图名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/72a1904051fc3f1d9c2d60315ffc86aa.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><p>子查询</p><hr><p> <strong>如有错误，欢迎指正！！！</strong></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL基础篇</title>
      <link href="/2025/04/20/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2025/04/20/%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1><span id="数据库基本操作">数据库基本操作</span></h1><h2><span id="启动与停止">启动与停止</span></h2><h3><span id="1第一种方式">1.第一种方式：</span></h3><p>1&gt;以管理员身份运行cmd</p><p><img src="/./../images/ac080b10ac8650e1bf5e67a4a1a75103.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>2&gt;在命令行窗口中输入:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">启动:net <span class="keyword">start</span> mysql80</span><br><span class="line"></span><br><span class="line">停止:net stop mysql80</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="2第二种方式">2.第二种方式:</span></h3><p>1&gt;Win+R快捷方式打开如下：</p><p>​    输入：services.msc</p><p><img src="/./../images/6fc1b7d2c1fdcc7b1a94719343811175.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>2&gt;找到MySQL80</p><p><img src="/./../images/ea8abd1cafd0e33732a76753c906cd3c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>3&gt;双击：</p><p><img src="/./../images/2a01f3f2bce1cbfc19f29ab88a20bd61.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>4&gt;这里我选择的是开机自启动</p><h1><span id><img src="/./../images/7cbd89b62b69a93c874143ca2ae5c8b0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h1><h2><span id="客户端连接">客户端连接</span></h2><h3><span id="1第一种方式通过mysql提供的客户端命令行工具">1.第一种方式：通过MySQL提供的客户端命令行工具</span></h3><p><img src="/./../images/b1fb09eb5076df7a20e20fbe61c7a3d2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/b81ba769770f4205354d6d004f2cbbac.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="2第二种方式通过命令行工具执行命令">2.第二种方式：通过命令行工具执行命令</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql [<span class="operator">-</span>h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>] [<span class="operator">-</span>P <span class="number">3306</span>] <span class="operator">-</span>u 用户 <span class="operator">-</span>p</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>注意：</strong></p><p>1.[]中可省略</p><p>2.使用这种方式时，需要配置PATH环境变量</p><p><img src="/./../images/c683121a0f127ba426d1de530b2e2dd2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"><img src="/./../images/9ba35c53decf1b4f210059bb0290dd2d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h1><span id="sql">SQL</span></h1><p><img src="/./../images/733b17b5bb882f7d80a76e4a28bd69b5.jpeg" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="1ddl数据定义语言">1.DDL(数据定义语言)</span></h2><h3><span id="数据库操作">数据库操作</span></h3><h4><span id="查询所有数据库">查询所有数据库:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="查询当前数据库">查询当前数据库:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> database();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="创建数据库">创建数据库:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database [if <span class="keyword">not</span> <span class="keyword">exists</span>] 数据库名 [<span class="keyword">default</span> charset 字符集] [<span class="keyword">collate</span> 排序规则];</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="删除数据库">删除数据库:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database [if <span class="keyword">exists</span>] 数据库名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="使用数据库">使用数据库:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="表操作">表操作</span></h3><h4><span id="查询">查询：</span></h4><h5><span id="查询当前数据库所有表">查询当前数据库所有表：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="查询表结构">查询表结构:</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="查询指定表的建表语句">查询指定表的建表语句:</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="创建">创建：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> 表名(</span><br><span class="line"></span><br><span class="line">        字段<span class="number">1</span> 字段<span class="number">1</span>类型[comment <span class="string">&#x27;注释&#x27;</span>],</span><br><span class="line"></span><br><span class="line">        字段<span class="number">2</span> 字段<span class="number">2</span>类型[comment <span class="string">&#x27;注释&#x27;</span>],</span><br><span class="line"></span><br><span class="line">        字段<span class="number">3</span> 字段<span class="number">3</span>类型[comment <span class="string">&#x27;注释&#x27;</span>],</span><br><span class="line"></span><br><span class="line">        .......</span><br><span class="line"></span><br><span class="line">        字段n 字段n类型[comment <span class="string">&#x27;注释&#x27;</span>]</span><br><span class="line"></span><br><span class="line">) [comment <span class="string">&#x27;注释&#x27;</span>];       </span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="修改">修改：</span></h4><h5><span id="添加字段">添加字段：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 <span class="keyword">add</span> 字段名 类型(长度) [comment <span class="string">&#x27;注释&#x27;</span>] [约束];</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="修改数据类型">修改数据类型：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 modify 字段名 新数据类型(长度);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="修改表名">修改表名：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter table</span> 表名 rename <span class="keyword">to</span> 新表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="删除">删除：</span></h4><h5><span id="删除表">删除表：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> [if <span class="keyword">exists</span>] 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="删除指定表并重新创建该表">删除指定表并重新创建该表：</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h2><span id="2dml数据操作语言">2.DML(数据操作语言)</span></h2><h3><span id="添加数据insert">添加数据（insert）</span></h3><h4><span id="给指定字段添加数据">给指定字段添加数据：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 (字段<span class="number">1</span>，字段<span class="number">2.</span>.....) <span class="keyword">values</span>(值<span class="number">1</span>， 值<span class="number">2.</span>.....);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="给全部字段添加数据">给全部字段添加数据：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 <span class="keyword">values</span>(值<span class="number">1</span>， 值<span class="number">2.</span>.....);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="批量添加数据">批量添加数据：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> 表名 (字段<span class="number">1</span>，字段<span class="number">2.</span>.....) <span class="keyword">values</span>(值<span class="number">1</span>， 值<span class="number">2.</span>.....),(值<span class="number">1</span>， 值<span class="number">2.</span>.....),(值<span class="number">1</span>， 值<span class="number">2.</span>.....);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert into</span> 表名 <span class="keyword">values</span>(值<span class="number">1</span>， 值<span class="number">2.</span>.....),(值<span class="number">1</span>， 值<span class="number">2.</span>.....),(值<span class="number">1</span>， 值<span class="number">2.</span>.....);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>注意：</strong></p><blockquote><p>​    1.插入数据时要按注意顺序</p><p>​    2.字符串和日期型数据应该包含在引号中</p><p>​    3.插入的数据大小要合法</p></blockquote><h3><span id="修改数据update">修改数据（update）</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段<span class="number">1</span><span class="operator">=</span>值<span class="number">1</span>，字段<span class="number">2</span><span class="operator">=</span>值<span class="number">2.</span>.....[<span class="keyword">where</span> 条件];</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>注意：</strong></p><blockquote><p>​    如果没有条件，则会修改整张表</p></blockquote><h3><span id="删除数据delete">删除数据（delete）</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件]</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>注意：</strong></p><blockquote><p>​    1.如果没有条件，则会删除整张表的数据</p><p>​    2.delete不能删除某一字段的值</p></blockquote><hr><h2><span id="3dql数据查询语言">3.DQL(数据查询语言)</span></h2><h3><span id="编写顺序">编写顺序：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> 表名列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">where</span> 条件列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组字段列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">having</span> 分组后条件列表</span><br><span class="line"></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序字段列表</span><br><span class="line"></span><br><span class="line">limit 分页参数;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="基本查询">基本查询</span></h3><h4><span id="查询多个字段">查询多个字段：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>，字段<span class="number">2</span>，字段<span class="number">3.</span>..<span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="设置别名">设置别名：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段<span class="number">1</span>[<span class="keyword">as</span> 别名<span class="number">1</span>]，字段<span class="number">2</span> [<span class="keyword">as</span> 别名<span class="number">2</span>]......<span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="去除重复记录">去除重复记录：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> 字段列表 <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="条件查询">条件查询</span></h3><p><strong>语法：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件列表;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>条件：</strong></p><table><thead><tr><th>比较运算符</th><th>功能</th></tr></thead><tbody><tr><td><strong>&gt;</strong></td><td></td></tr><tr><td><strong>&gt;&#x3D;</strong></td><td></td></tr><tr><td><strong>&lt;</strong></td><td></td></tr><tr><td><strong>&lt;&#x3D;</strong></td><td></td></tr><tr><td><strong>&#x3D;</strong></td><td></td></tr><tr><td><strong>&lt;&gt; 或 !&#x3D;</strong></td><td><strong>不等于</strong></td></tr><tr><td><strong>between…and…</strong></td><td><strong>在某个范围之内</strong></td></tr><tr><td><strong>in(…)</strong></td><td><strong>在in之后的括号中，多选一</strong></td></tr><tr><td><strong>like 占位符</strong></td><td><strong>模糊匹配（_匹配单个字符，%匹配任意个字符）</strong></td></tr><tr><td><strong>is null</strong></td><td></td></tr><tr><td><strong>and 或 &amp;&amp;</strong></td><td><strong>并且</strong></td></tr><tr><td><strong>or 或 ||</strong></td><td><strong>或</strong></td></tr><tr><td><strong>not 或 !</strong></td><td><strong>非</strong></td></tr></tbody></table><p><strong>eg：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#二、条件查询</span><br><span class="line">#<span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件列表;</span><br><span class="line">#<span class="number">1.</span>查询年龄等于<span class="number">25</span>的员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>查询年龄小于<span class="number">20</span>的员工</span><br><span class="line"><span class="keyword">select</span>  <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">&lt;</span> <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>查询没有身份证信息的员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> idcard <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>查询有身份证信息的员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> idcard <span class="keyword">is</span> <span class="keyword">not null</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span>查询年龄不等于<span class="number">18</span>的员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">!=</span> <span class="number">18</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">&lt;&gt;</span> <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">6.</span>查询年龄在<span class="number">20</span>岁到<span class="number">25</span>岁(包含<span class="number">25</span>)之间的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">&gt;</span> <span class="number">20</span> <span class="operator">&amp;&amp;</span> age <span class="operator">&lt;=</span> <span class="number">25</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">&gt;</span> <span class="number">20</span> <span class="keyword">AND</span> age <span class="operator">&lt;=</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">#两端都包含</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="keyword">between</span> <span class="number">15</span> <span class="keyword">and</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">7.</span>查询性别为女且年龄小于<span class="number">25</span>的员工信息</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> gender <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span> <span class="operator">&amp;&amp;</span> age <span class="operator">&lt;</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">8.</span>查询年龄等于<span class="number">15</span>或者<span class="number">20</span>或者<span class="number">25</span>的员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">15</span> <span class="operator">||</span> age <span class="operator">=</span> <span class="number">20</span> <span class="operator">||</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">15</span> <span class="keyword">or</span> age <span class="operator">=</span> <span class="number">20</span> <span class="keyword">or</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="keyword">in</span>(<span class="number">15</span>, <span class="number">20</span>, <span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">#<span class="number">9.</span>查询姓名为两个字的员工 模糊匹配</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;___&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">10.</span>查询身份证号最后一位为X的员工</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> idcard <span class="keyword">like</span> <span class="string">&#x27;%X&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="聚合函数">聚合函数</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 聚合函数(字段列表) <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>注意：</strong></p><blockquote><p>​    对一列进行计算 所有null值不参与聚合函数的计算</p></blockquote><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><strong>count</strong></td><td><strong>统计数量</strong></td></tr><tr><td><strong>max</strong></td><td><strong>最大值</strong></td></tr><tr><td><strong>min</strong></td><td><strong>最小值</strong></td></tr><tr><td><strong>avg</strong></td><td><strong>平均值</strong></td></tr><tr><td><strong>sum</strong></td><td><strong>求和</strong></td></tr></tbody></table><p><strong>eg：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#三、聚合函数</span><br><span class="line">#对一列进行计算 所有<span class="keyword">null</span>值不参与聚合函数的计算</span><br><span class="line">#<span class="keyword">select</span> 聚合函数(字段列表) <span class="keyword">from</span> 表名;</span><br><span class="line"></span><br><span class="line">#<span class="number">1.</span>统计数量</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>统计企业员工的平均年龄</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">avg</span>(age) <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>最大年龄</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(age) <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>最小年龄</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(age) <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span>统计北京地区员工年龄之和</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(age) <span class="keyword">from</span> emp <span class="keyword">where</span> workaddress <span class="operator">=</span> <span class="string">&#x27;北京&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="分组查询">分组查询</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件] <span class="keyword">group</span> <span class="keyword">by</span> 分组字段名 [<span class="keyword">having</span> 分组后过滤条件];</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><table><thead><tr><th><strong>where</strong></th><th><code>**分组之前执行,不满足where条件的不参与分组,where不能对聚合函数进行判断**</code></th></tr></thead><tbody><tr><td><strong>having</strong></td><td><code>**分组之后对结果进行过滤,having可以对聚合函数进行判断**</code></td></tr></tbody></table><p><strong>eg：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>根据性别分组， 统计男性与女性的数量</span><br><span class="line"><span class="keyword">select</span> gender, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>根据性别分组，统计男性和女性的平均年龄</span><br><span class="line"><span class="keyword">select</span>  gender, <span class="built_in">avg</span>(age) <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>查询年龄小于<span class="number">25</span>的员工, 并根据工作地址分组，获取员工数量大于等于<span class="number">3</span>的工作地址</span><br><span class="line"><span class="keyword">select</span> workaddress, <span class="built_in">count</span>(<span class="operator">*</span>) address_count <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">&lt;=</span> <span class="number">25</span> <span class="keyword">group</span> <span class="keyword">by</span> workaddress <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="排序查询">排序查询</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 <span class="keyword">order</span> <span class="keyword">by</span> 字段<span class="number">1</span> 排序方式<span class="number">1</span>, 字段<span class="number">2</span> 排序方式<span class="number">2</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><table><thead><tr><th><strong>asc</strong></th><th><strong>升序（默认）</strong></th></tr></thead><tbody><tr><td><strong>desc</strong></td><td><strong>降序</strong></td></tr></tbody></table><p><strong>eg：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>根据年龄对公司员工进行升序排序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>根据年龄对公司员工进行降序排序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">desc</span></span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>根据年龄升序 根据id降序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span>, id <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="分页查询"><strong>分页查询</strong></span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名 limit 起始索引, 查询记录数;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>eg：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>查询第<span class="number">1</span>页员工数据，每页展示<span class="number">2</span>条记录</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp limit <span class="number">0</span>, <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>查询第<span class="number">2</span>页员工数据，每页展示<span class="number">10</span>条数据 <span class="comment">------&gt;(页码 - 1)*页展示记录数</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp limit <span class="number">2</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h2><span id="4dcl数据控制语言">4.DCL(数据控制语言)</span></h2><h3><span id="管理用户">管理用户</span></h3><p><strong>注意：</strong></p><blockquote><p>​    主机名可以使用%通配</p></blockquote><h4><span id="查询用户">查询用户：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="创建用户">创建用户：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@‘主机名’ identified <span class="keyword">by</span> <span class="string">&#x27;密码&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="修改用户密码"><strong>修改用户密码：</strong></span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span> identified <span class="keyword">with</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;新密码&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="删除用户">删除用户：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="权限控制">权限控制</span></h3><table><thead><tr><th>权限</th><th>说明</th></tr></thead><tbody><tr><td>all, all privileges</td><td>所有权限</td></tr><tr><td>select</td><td>查询数据</td></tr><tr><td>insert</td><td>插入数据</td></tr><tr><td>update</td><td>修改数据</td></tr><tr><td>delete</td><td>删除数据</td></tr><tr><td>alter</td><td>修改表</td></tr><tr><td>drop</td><td>删除数据库&#x2F;表&#x2F;视图</td></tr><tr><td>create</td><td>创建数据库&#x2F;表</td></tr></tbody></table><h4><span id="查询权限">查询权限:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="授予权限">授予权限:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> 权限列表 <span class="keyword">on</span> 数据库名.表名 <span class="keyword">to</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>注意：</strong></p><blockquote><p>​    授权时数据库名和表名可以用*进行通配，代表所有</p></blockquote><h4><span id="撤销权限">撤销权限:</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">revoke</span> 权限列表 <span class="keyword">on</span> 数据库名.表名 <span class="keyword">from</span> <span class="string">&#x27;用户名&#x27;</span>@<span class="string">&#x27;主机名&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><hr><h1><span id="函数">函数</span></h1><h2><span id="查看函数返回结果">查看函数返回结果</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">+</span> 函数;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="字符串函数">字符串函数</span></h2><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td><code>concat(s1, s2, s3...sn)</code></td><td><code>拼接</code></td></tr><tr><td><code>lower(s)</code></td><td><code>转小写</code></td></tr><tr><td><code>upper(s)</code></td><td><code>转大写</code></td></tr><tr><td><code>lpad(s, n, pad)</code></td><td><code>左填充，用pad对s进行左填充以达到n个字符</code></td></tr><tr><td><code>rpad(s, n, pad)</code></td><td><code>右填充，用pad对s进行右填充以达到n个字符</code></td></tr><tr><td><code>trim(s) </code></td><td><code>去掉s头部和尾部的空格</code></td></tr><tr><td><code>substring(s, st, len)</code></td><td><code>截取从st开始的len个字符 st从1开始</code></td></tr></tbody></table><p>eg：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#concat</span><br><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;Karry&#x27;</span>,<span class="string">&#x27; Wang&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#lower</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">lower</span>(<span class="string">&#x27;HELLO&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#upper</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">upper</span>(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#lpad</span><br><span class="line"><span class="keyword">select</span> lpad(<span class="string">&#x27;01&#x27;</span>, <span class="number">9</span>, <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#rpad</span><br><span class="line"><span class="keyword">select</span> rpad(<span class="string">&#x27;01&#x27;</span>, <span class="number">9</span>, <span class="string">&#x27;-&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#trim</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(<span class="string">&#x27;  010  101   &#x27;</span>);</span><br><span class="line"></span><br><span class="line">#substring</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;Hello World&#x27;</span>, <span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">#<span class="number">1</span></span><br><span class="line"><span class="keyword">update</span> emp <span class="keyword">set</span> working<span class="operator">=</span>lpad(working, <span class="number">5</span>, <span class="string">&#x27;0&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="数值函数">数值函数</span></h2><table><thead><tr><th><strong>函数</strong></th><th><strong>功能</strong></th></tr></thead><tbody><tr><td><code>ceil(x)</code></td><td><code>向上取整</code></td></tr><tr><td><code>floor(x)</code></td><td><code>向下取整</code></td></tr><tr><td><code>mod(x, y)</code></td><td><code>返回x % y</code></td></tr><tr><td><code>rand()</code></td><td><code>返回0~1内的随机数</code></td></tr><tr><td><code>round(x, y)</code></td><td><code>求x四舍五入的值，保留y位小数</code></td></tr></tbody></table><p>eg： </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#生成一个六位验证码</span><br><span class="line"><span class="keyword">select</span> rpad(round(rand()<span class="operator">*</span><span class="number">1000000</span>, <span class="number">0</span>), <span class="number">6</span>, round(rand()<span class="operator">*</span><span class="number">10</span>, <span class="number">0</span>));</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="日期函数">日期函数</span></h2><table><thead><tr><th><strong>函数</strong></th><th><strong>功能</strong></th></tr></thead><tbody><tr><td><code>curdate()</code></td><td><code>返回当前日期</code></td></tr><tr><td><code>curtime()</code></td><td><code>返回当前时间</code></td></tr><tr><td><code>now()</code></td><td><code>返回当前日期和时间</code></td></tr><tr><td><code>year(date)</code></td><td><code>获取date的年份</code></td></tr><tr><td><code>month(date)</code></td><td><code>获取date的月份</code></td></tr><tr><td><code>day(date)</code></td><td><code>获取date的日期</code></td></tr><tr><td><code>date_add(date, interval expr type)</code></td><td><code>返回一个日期加上一个时间间隔expr后的时间值</code></td></tr><tr><td><code>datediff(date1, date2)</code></td><td><code>返回起始时间date1和结束时间date2之间的天数(date1 - date2)</code></td></tr></tbody></table><p>eg: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> date_add(now(), <span class="type">interval</span> <span class="number">70</span> <span class="keyword">day</span>);</span><br><span class="line"><span class="keyword">select</span> date_add(now(), <span class="type">interval</span> <span class="number">70</span> <span class="keyword">month</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> datediff(now(), <span class="string">&#x27;2022-9-21&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#根据入职时长倒序排序</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="keyword">select</span> name, datediff(now(), entrydate) <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> datediff(now(), entrydate) <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="流程函数">流程函数</span></h2><table><thead><tr><th><strong>函数</strong></th><th><strong>功能</strong></th></tr></thead><tbody><tr><td><code>if(value, t, f)</code></td><td><code>如果val为true，返回t，否则返回f</code></td></tr><tr><td><code>ifnull(value1, value2)</code></td><td><code>如果val1不为空，返回val1，否则返回val2</code></td></tr><tr><td><code>case when [val1] then [res1]... else [default] end</code></td><td><code>如果val1为true，返回res1，否则返回default默认值</code></td></tr><tr><td><code>case [expr] when [val1] then [res1]...else [default] end</code></td><td><code>如果expr=val1，返回res1，否则返回default默认值</code></td></tr></tbody></table><p>eg: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> if(<span class="literal">true</span>, <span class="string">&#x27;ok&#x27;</span>, <span class="string">&#x27;no&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span>  ifnull(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> ifnull(<span class="keyword">null</span>, <span class="string">&#x27;default&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="literal">true</span> <span class="keyword">then</span> <span class="string">&#x27;ok&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;no&#x27;</span> <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">when</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">then</span> <span class="string">&#x27;yes&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;no&#x27;</span> <span class="keyword">end</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>eg:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name,</span><br><span class="line">       workaddress,</span><br><span class="line">       <span class="keyword">case</span> workaddress <span class="keyword">when</span> <span class="string">&#x27;南京&#x27;</span> <span class="keyword">then</span> <span class="string">&#x27;一线城市&#x27;</span></span><br><span class="line">                        <span class="keyword">when</span> <span class="string">&#x27;重庆&#x27;</span> <span class="keyword">then</span> <span class="string">&#x27;一线城市&#x27;</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="string">&#x27;二线城市&#x27;</span> <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">as</span> citydiffer</span><br><span class="line"><span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>eg:</strong> </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    id,</span><br><span class="line">    name,</span><br><span class="line">    (<span class="keyword">case</span> <span class="keyword">when</span> math <span class="operator">&gt;=</span> <span class="number">85</span> <span class="keyword">then</span> <span class="string">&#x27;优秀&#x27;</span> <span class="keyword">when</span> math <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">then</span> <span class="string">&#x27;及格&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;不及格&#x27;</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;数学&#x27;</span>,</span><br><span class="line">    (<span class="keyword">case</span> <span class="keyword">when</span> English <span class="operator">&gt;=</span> <span class="number">85</span> <span class="keyword">then</span> <span class="string">&#x27;优秀&#x27;</span> <span class="keyword">when</span> English <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">then</span> <span class="string">&#x27;及格&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;不及格&#x27;</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;英语&#x27;</span>,</span><br><span class="line">    (<span class="keyword">case</span> <span class="keyword">when</span> Chinese <span class="operator">&gt;=</span> <span class="number">85</span> <span class="keyword">then</span> <span class="string">&#x27;优秀&#x27;</span> <span class="keyword">when</span> Chinese <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">then</span> <span class="string">&#x27;及格&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;不及格&#x27;</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">&#x27;语文&#x27;</span></span><br><span class="line"><span class="keyword">from</span> score;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="约束">约束</span></h1><h2><span id="概述">概述</span></h2><h3><span id="概念">概念：</span></h3><blockquote><p>​        约束是作用于表中字段上的规则，用于限制存储在表中的数据</p><p>​        约束可以在创建表&#x2F;修改表的时候添加</p></blockquote><h3><span id="目的">目的：</span></h3><blockquote><p>​        保证数据库中数据的正确性、有效性和完整性</p></blockquote><h3><span id="分类">分类：</span></h3><table><thead><tr><th>约束</th><th>描述</th><th>关键字</th></tr></thead><tbody><tr><td>非空约束</td><td>限制该字段的数据不能为null</td><td>not null</td></tr><tr><td>唯一约束</td><td>保证该字段的所有数据都是唯一的、不重复的</td><td>unique</td></tr><tr><td>主键约束</td><td>主键是一行数据的唯一标识，要求非空且唯一</td><td>primary key (自增:auto_increment)</td></tr><tr><td>默认约束</td><td>保存数据时，如果未指定该字段的值，则采用默认值</td><td>default</td></tr><tr><td>检查约束</td><td>保证字段值满足某一条件</td><td>check</td></tr><tr><td>外键约束</td><td>用来让两张表的数据之间建立连接，保证数据的一致性和完整性</td><td>foreign key</td></tr></tbody></table><h2><span id="约束演示">约束演示</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> <span class="keyword">user</span>(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">int</span> <span class="keyword">check</span> ( age <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> age <span class="operator">&lt;=</span> <span class="number">120</span> ) comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    status <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;1&#x27;</span> comment <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">    gender <span class="type">char</span>(<span class="number">1</span>) comment <span class="string">&#x27;性别&#x27;</span></span><br><span class="line">) comment <span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="外键约束">外键约束</span></h2><h3><span id="概念">概念</span></h3><blockquote><p>​    <strong>子表（从表）</strong>：具有外键的表</p><p>​    <strong>父表（主表）</strong>：外键所关联的表</p></blockquote><h3><span id="语法">语法</span></h3><h4><span id="添加外键">添加外键</span></h4><p><strong>sql语句添加：</strong></p><blockquote><p><strong>alter table (从表) add constraint 外键名称 foreign key (外键字段名) references 主表(主键);</strong></p></blockquote><p><strong>创建表时添加：</strong> </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create table</span> emp1(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">int</span> <span class="keyword">check</span> ( age <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> age <span class="operator">&lt;=</span> <span class="number">120</span> ) comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    job <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;职位&#x27;</span>,</span><br><span class="line">    salary <span class="type">int</span> comment <span class="string">&#x27;薪资&#x27;</span>,</span><br><span class="line">    entrydate <span class="type">date</span> comment <span class="string">&#x27;入职时间&#x27;</span>,</span><br><span class="line">    managerid <span class="type">int</span> comment <span class="string">&#x27;直属领导id&#x27;</span>,</span><br><span class="line">    dept_id <span class="type">int</span> comment <span class="string">&#x27;部门id&#x27;</span>,</span><br><span class="line">    <span class="keyword">constraint</span> dept_id_fk <span class="keyword">foreign key</span> (dept_id) <span class="keyword">references</span> dept(id)</span><br><span class="line">)comment <span class="string">&#x27;员工表&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>eg：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#添加外键</span><br><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">add constraint</span> fk_emp_dept_id <span class="keyword">foreign key</span> (dept_id) <span class="keyword">references</span> dept(id);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="删除外键">删除外键</span></h4><blockquote><p><strong>alter table 从表 drop foreign key 外键名称；</strong></p></blockquote><p> eg：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#删除外键</span><br><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">drop</span> <span class="keyword">foreign key</span> fk_emp_dept_id;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="指定外键删除x2f更新行为">指定外键删除&#x2F;更新行为</span></h4><table><thead><tr><th>行为</th><th>说明</th></tr></thead><tbody><tr><td><strong>not action &#x2F;</strong> <strong>restrict</strong></td><td>默认行为，当父表删除或更新记录时，如果当前记录对应的父表与子表有关联，则不予删除或更新</td></tr><tr><td><strong>cascade</strong></td><td>当父表删除或更新记录时，如果有外键关联父表与子表，则也删除或者更新外键在子表中的记录</td></tr><tr><td><strong>set null</strong></td><td>当父表删除或更新记录时，如果有外键关联父表与子表，则设置子表中该外键为null</td></tr><tr><td><strong>set default</strong></td><td>当父表删除或更新记录时，如果有外键关联父表与子表，则设置子表中该外键为默认值（innodb不支持）</td></tr></tbody></table><blockquote><p><strong>alter table (从表) add constraint 外键名称 foreign key (外键字段名) references 主表(主键) on update 行为 on delete 行为;</strong></p></blockquote><p> eg：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#指定外键更新或删除行为</span><br><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">add constraint</span> fk_emp_dept_id <span class="keyword">foreign key</span> (dept_id) <span class="keyword">references</span> dept(id) <span class="keyword">on</span> <span class="keyword">update</span> cascade <span class="keyword">on</span> <span class="keyword">DELETE</span> cascade;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="example">example：</span></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#主表</span><br><span class="line"><span class="keyword">create table</span> dept(</span><br><span class="line">    id <span class="type">int</span> auto_increment <span class="keyword">primary key</span> comment <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">not null</span> comment <span class="string">&#x27;部门名称&#x27;</span></span><br><span class="line">)comment <span class="string">&#x27;部门表&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#从表</span><br><span class="line"><span class="keyword">create table</span> emp(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary key</span> auto_increment comment <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">    age <span class="type">int</span> <span class="keyword">check</span> ( age <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> age <span class="operator">&lt;=</span> <span class="number">120</span> ) comment <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">    job <span class="type">varchar</span>(<span class="number">20</span>) comment <span class="string">&#x27;职位&#x27;</span>,</span><br><span class="line">    salary <span class="type">int</span> comment <span class="string">&#x27;薪资&#x27;</span>,</span><br><span class="line">    entrydate <span class="type">date</span> comment <span class="string">&#x27;入职时间&#x27;</span>,</span><br><span class="line">    managerid <span class="type">int</span> comment <span class="string">&#x27;直属领导id&#x27;</span>,</span><br><span class="line">    dept_id <span class="type">int</span> comment <span class="string">&#x27;部门id&#x27;</span></span><br><span class="line">)comment <span class="string">&#x27;员工表&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#插入数据</span><br><span class="line"><span class="keyword">insert into</span> dept(name) <span class="keyword">values</span> (<span class="string">&#x27;研发部&#x27;</span>), (<span class="string">&#x27;市场部&#x27;</span>), (<span class="string">&#x27;销售部&#x27;</span>), (<span class="string">&#x27;外交部&#x27;</span>);</span><br><span class="line"><span class="keyword">insert into</span> emp(id, name, age, job, salary, entrydate, managerid, dept_id) <span class="keyword">values</span></span><br><span class="line">                                                                               (<span class="number">1</span>, <span class="string">&#x27;成朗&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;外交官&#x27;</span>, <span class="number">5000</span>, <span class="string">&#x27;1-1-1&#x27;</span>, <span class="number">1</span>, <span class="number">4</span>),</span><br><span class="line">                                                                               (<span class="number">2</span>, <span class="string">&#x27;庄文杰&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;学生&#x27;</span>, <span class="number">3000</span>, <span class="string">&#x27;1-1-1&#x27;</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">#外键约束</span><br><span class="line">#添加外键</span><br><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">add constraint</span> fk_emp_dept_id <span class="keyword">foreign key</span> (dept_id) <span class="keyword">references</span> dept(id);</span><br><span class="line">#删除外键</span><br><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">drop</span> <span class="keyword">foreign key</span> fk_emp_dept_id;</span><br><span class="line">#指定外键更新或删除行为</span><br><span class="line"><span class="keyword">alter table</span> emp <span class="keyword">add constraint</span> fk_emp_dept_id <span class="keyword">foreign key</span> (dept_id) <span class="keyword">references</span> dept(id) <span class="keyword">on</span> <span class="keyword">update</span> cascade <span class="keyword">on</span> <span class="keyword">DELETE</span> cascade;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="多表查询">多表查询</span></h1><h2><span id="多表关系">多表关系</span></h2><h3><span id="一对多多对一">一对多（多对一）</span></h3><blockquote><p>在多的一方建立外键，指向一的一方的主键</p></blockquote><h3><span id="多对多中间表">多对多（中间表）</span></h3><blockquote><p>建立第三张中间表，中间表至少包含两个外键，分别关联多方主键</p></blockquote><h3><span id="一对一单表拆分">一对一（单表拆分）</span></h3><blockquote><p>在任意一方加入外键，关联另外一方的主键，并且设置外键为唯一的（unique）</p></blockquote><h2><span id="多表查询概述">多表查询概述</span></h2><h3><span id="笛卡尔积">笛卡尔积</span></h3><p>两个集合所有组合的情况</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#多表查询</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp, dept;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="消除无效笛卡尔积">消除无效笛卡尔积</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#多表查询</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp, dept <span class="keyword">where</span> emp.dept_id <span class="operator">=</span> dept.id;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="多表查询分类">多表查询分类</span></h2><h3><span id="连接查询">连接查询</span></h3><h4><span id="外连接">外连接</span></h4><p><strong>左外连接：</strong></p><p><img src="/./../images/05a0f6d0b47e762207d779244391fbab.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p>​    查询左表所有数据，以及两张表交集部分数据</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">left</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件...;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>右外连接：</strong></p><p><img src="/./../images/546c8893507a607443d49565ec7f1701.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p>​    查询右表所有数据，以及两张表交集部分数据</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">right</span> [<span class="keyword">outer</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件...;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> eg:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#左外连接</span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.name <span class="keyword">from</span> emp e <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br><span class="line">#右外连接</span><br><span class="line"><span class="keyword">select</span> d.<span class="operator">*</span>, e.<span class="operator">*</span> <span class="keyword">from</span> emp e <span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="内连接">内连接</span></h4><p><img src="/./../images/8e97fbe608e51b4aca43e395febc36e6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><p>​    相当于查询两张表交集部分数据</p></blockquote><h5><span id="隐式内连接">隐式内连接</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span>, 表<span class="number">2</span> <span class="keyword">where</span> 条件...;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="显式内连接">显式内连接</span></h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> [<span class="keyword">inner</span>] <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 连接条件...;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>eg:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#显式内连接</span><br><span class="line"><span class="keyword">select</span> emp.name, dept.name <span class="keyword">from</span> emp, dept <span class="keyword">where</span> emp.dept_id <span class="operator">=</span> dept.id;</span><br><span class="line">#隐式内连接</span><br><span class="line"><span class="keyword">select</span> emp.name, dept.name <span class="keyword">from</span> emp <span class="keyword">inner</span> <span class="keyword">join</span> dept <span class="keyword">where</span> emp.dept_id <span class="operator">=</span> dept.id;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="自连接">自连接</span></h4><blockquote><p>​    当前表与自身的连接查询，自连接必须使用表别名</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> 别名<span class="number">1</span> <span class="keyword">join</span> 表<span class="number">1</span> 别名<span class="number">2</span> <span class="keyword">on</span> 条件...;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>eg:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#自连接</span><br><span class="line"><span class="keyword">select</span> e1.name, e2.name <span class="keyword">from</span> emp e1 <span class="keyword">join</span> emp e2 <span class="keyword">on</span> e1.managerid <span class="operator">=</span> e2.managerid;</span><br><span class="line"><span class="keyword">select</span> e1.<span class="operator">*</span>, e2.name <span class="keyword">from</span> emp e1 <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> emp e2 <span class="keyword">on</span> e1.managerid <span class="operator">=</span> e2.managerid;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="联合查询">联合查询</span></h3><p><strong>union查询</strong></p><blockquote><p>把多次查询的结果合并起来，形成一个新的查询结果集</p><p><strong>union:</strong></p><p>​        对查询结果进行去重操作</p><p><strong>union all:</strong></p><p>​        将查询结果直接输出</p><p><strong>注意：</strong></p><p>​        联合查询的多张表字段列表个数及类型必须保持一致，查询结果的字段名称为第一次查询字段名</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">1</span> ... <span class="keyword">union</span> [<span class="keyword">all</span>] <span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表<span class="number">2</span> ...;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>eg:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#联合查询</span><br><span class="line"><span class="keyword">select</span> emp.name, emp.age, emp.salary <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&lt;=</span> <span class="number">5000</span> <span class="keyword">union</span></span><br><span class="line">                                                          <span class="keyword">select</span> emp.name, emp.age, emp.salary <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="operator">&gt;=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="子查询嵌套查询">子查询（嵌套查询）</span></h3><h5><span id="概念">概念</span></h5><blockquote><p>​    SQL语句中嵌套select语句，成为嵌套查询（子查询）</p></blockquote><h5><span id="语法">语法</span></h5><p><img src="/./../images/d8ae77fa79ac248f0315035160324ffb.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span><span class="operator">/</span><span class="keyword">update</span><span class="operator">/</span><span class="keyword">delete</span><span class="operator">/</span><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">where</span> column1 <span class="operator">=</span> (<span class="keyword">select</span> column1 <span class="keyword">from</span> 表<span class="number">2</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="分类">分类</span></h5><p>按子查询结果：</p><blockquote><p>标量子查询，列子查询， 行子查询，表子查询 </p></blockquote><p>按子查询位置</p><blockquote><p>where之后、from之后、select之后</p></blockquote><h5><span id="标量子查询单个值">标量子查询（单个值）</span></h5><blockquote><p>​    子查询返回结果为单个值（数字，字符串，日期……）</p><p>​    <strong>常用操作符</strong>：&#x3D; 等于</p><p>​               &lt;&gt; 不等于</p><p>​                &gt; 大于</p><p>​               &gt;&#x3D; 大于等于</p><p>​                &lt; 小于</p><p>​               &lt;&#x3D; 小于等于</p></blockquote><p>eg： </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id <span class="operator">=</span> (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;外交部&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> entrydate <span class="operator">&gt;=</span> (<span class="keyword">select</span> entrydate <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;成朗&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="列子查询一列">列子查询（一列）</span></h5><blockquote><p>​    子查询返回结果为一列（可以是多行）</p><p>​    <strong>常见操作符：</strong></p><p>​                in     在指定的集合范围之内，多选一</p><p>​                not in  不在指定集合范围之内</p><p>​                any    子查询返回列表中，有任何一个满足即可</p><p>​                some  与any相同 </p><p>​                all     子查询返回列表的所有值都必须满足</p></blockquote><p> eg：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;外交部&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;销售部&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="keyword">all</span>(<span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id <span class="operator">=</span> (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;外交部&#x27;</span>));</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> salary <span class="operator">&gt;</span> <span class="keyword">some</span>(<span class="keyword">select</span> salary <span class="keyword">from</span> emp <span class="keyword">where</span> dept_id <span class="operator">=</span> (<span class="keyword">select</span> id <span class="keyword">from</span> dept <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;销售部&#x27;</span>));</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="行子查询一行">行子查询（一行）</span></h5><blockquote><p>​    子查询返回结果为一行</p><p>​    <strong>常见操作符：</strong></p><p>​                &#x3D;        等于</p><p>​                &lt;&gt;       不等于</p><p>​                in       在集合范围之内 </p><p>​                not in    不在集合范围之内</p></blockquote><p>eg： </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> (salary, managerid) <span class="operator">=</span> (<span class="keyword">select</span> salary, emp.managerid <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;成朗&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h5><span id="表子查询多行多列">表子查询（多行多列）</span></h5><blockquote><p>​    子查询返回结果为多行多列</p><p>​    <strong>常见操作符：</strong></p><p>​                in 在集合范围之内</p><p>​        </p></blockquote><p> eg：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> (salary, dept_id) <span class="keyword">in</span> (<span class="keyword">select</span> salary, dept_id <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;成朗&#x27;</span> <span class="keyword">or</span> name <span class="operator">=</span> <span class="string">&#x27;庄文杰&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, dept.name <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> entrydate <span class="operator">&gt;=</span> <span class="string">&#x27;1-1-1&#x27;</span>) e, dept <span class="keyword">where</span> e.dept_id <span class="operator">=</span> dept.id;</span><br><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.<span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> entrydate <span class="operator">&gt;=</span> <span class="string">&#x27;1-1-1&#x27;</span>) e <span class="keyword">left</span> <span class="keyword">join</span> dept d <span class="keyword">on</span> e.dept_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="事务">事务</span></h1><h2><span id="简介来自百度百科">简介（来自百度百科）</span></h2><blockquote><p><strong>概念：</strong>数据库事务( transaction)是访问并可能操作各种数据项的一个数据库操作序列，这些操作要么全部执行,要么全部不执行，<strong>是一个不可分割的工作单位</strong>。事务由事务开始与事务结束之间执行的全部数据库操作组成</p><p><strong>注意：默认MySQL的事务是自动提交的</strong>，也就是说，当执行一条DML语句，MySQL会立即隐式的提交事务</p></blockquote><h2><span id="操作控制事务">操作（控制事务）</span></h2><h3><span id="查看x2f设置事务提交方式">查看&#x2F;设置事务提交方式</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#为<span class="number">1</span>是自动提交 为<span class="number">0</span>是手动提交</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@autocommit</span>; #查看事务提交方式</span><br><span class="line"><span class="keyword">set</span> @<span class="variable">@autocommit</span> <span class="operator">=</span> <span class="number">0</span>; #设置事务提交方式</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/a8d9af9f10dc60866ca3584575535c59.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>为1表示当前事务提交方式为自动提交 </p><p><img src="/./../images/eb0537e017cd074520bf502c1a6bba9e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>为0表示当前事务提交方式为手动提交 </p><h3><span id="提交事务">提交事务</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#提交事务 : 当设置了手动提交方式后，必须有<span class="keyword">commit</span>指令</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="回滚事务">回滚事务</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#回滚事务 : 当出现异常，可以回滚事务</span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="开始事务">开始事务</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#开启事务</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#开启事务</span><br><span class="line"><span class="keyword">begin</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="四大特性acid">四大特性（ACID）</span></h2><h3><span id="原子性">原子性</span></h3><blockquote><p>事务是不可分割的最小操作单位元，要么全部成功，要么全部失败</p></blockquote><h3><span id="一致性">一致性</span></h3><blockquote><p>事务完成时，必须使所有数据都保持一致状态</p></blockquote><h3><span id="隔离性">隔离性</span></h3><blockquote><p>数据库系统提供的隔离机制，保证事务在不受外部并发操作影响到独立环境下运行</p></blockquote><h3><span id="持久性">持久性</span></h3><blockquote><p>事务一旦提交或回滚，它对数据库的改变就是永久的</p></blockquote><h2><span id="并发事务问题">并发事务问题</span></h2><table><thead><tr><th>问题</th><th>描述</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读到另外一个事务还没有提交的数据</td></tr><tr><td>不可重复读</td><td>一个事务先后读取同一条记录，但两次读取到的数据不同</td></tr><tr><td>幻读</td><td>一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在，好像出现了“幻影”</td></tr></tbody></table><h2><span id="事务隔离级别">事务隔离级别</span></h2><blockquote><p><strong>事务的隔离级别越高，数据越安全，但是性能越低</strong></p></blockquote><h3><span id="分类隔离级别从低到高">分类(隔离级别从低到高)：</span></h3><table><thead><tr><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th></tr></thead><tbody><tr><td><strong>read uncommitted</strong></td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td><strong>read committed (Oracle默认)</strong></td><td>N</td><td>Y</td><td>Y</td></tr><tr><td><strong>repeatable read (MySQL默认)</strong></td><td>N</td><td>N</td><td>Y</td></tr><tr><td><strong>serialzable</strong></td><td>N</td><td>N</td><td></td></tr></tbody></table><p><strong>注意：</strong> Y表示在当前隔离级别下，当前某种并发事务问题会出现，反之，N表示不会出现</p><h3><span id="查看事务隔离级别">查看事务隔离级别：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#查看事务隔离级别</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@transaction_isolation</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/25e79a2a6d7c8be51af679ac6f37b302.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="设置事务隔离级别">设置事务隔离级别：</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#设置事务隔离级别</span><br><span class="line"><span class="keyword">set</span> [session<span class="operator">|</span><span class="keyword">global</span>] transaction isolation level &#123;read uncommitted <span class="operator">|</span> read committed <span class="operator">|</span> repeatable read<span class="operator">|</span> serializable&#125;;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>eg:</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> session transaction isolation level serializable;</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@transaction_isolation</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/0ffe58a3f92f853373d7476bd3214f63.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>注意：</strong></p><blockquote><p>session: 只对当前客户端窗口有效<br> global:对所有客户端的绘画窗口都有效</p></blockquote><h3><span id="演示">演示</span></h3><p>打开cmd连接mysql，打开两个窗口进行演示</p><p><img src="/./../images/ac0c44e29b5dfbd34a1bad8114cfaaf1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="脏读">脏读</span></h4><p>一个事务读取到了另外一个事务未提交的数据</p><p><img src="/./../images/8765510e33f653e26934eea96425d710.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="不可重复读">不可重复读</span></h4><p>同样的SQL在同一个事务中查询出来的数据不一样</p><p><img src="/./../images/77ac2ddb7946d1579cb12dd007c5f0ba.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="可重复读">可重复读</span></h4><p>同样的SQL在同一个事务中查询出来的数据一致</p><p><img src="/./../images/3d7ff5a576a06cdb55d45dccc555d5d6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="幻读"><img src="/./../images/95206a2ea351c0cff54e465f13ff6a32.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> 幻读</span></h4><p>插入数据的时候提示重复，查询却提示为空</p><p><img src="/./../images/870f8d9242415395c11e74a6dc95705e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="规避幻读serializable">规避幻读(serializable)</span></h4><p>右侧光标闪烁表示堵塞，在等待左侧事务提交了才能继续执行</p><p><img src="/./../images/56b09a4902944be08c07af42cc511d5f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/a550816af52d19c65c6a518a4c80268f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><p><strong>如有错误，欢迎指正！！！</strong></p><p><a href="https://blog.csdn.net/m0_73569492/article/details/139204460?spm=1001.2014.3001.5501">所有笔记总结目录-CSDN博客</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java面向对象编程</title>
      <link href="/2025/04/20/Java%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"/>
      <url>/2025/04/20/Java%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1><span id="什么是面向对象编程oop">什么是面向对象编程(OOP)?</span></h1><blockquote><p>它将数据和相关操作封装在对象中，通过对象之间的交互来解决问题。</p><p>简单来说，就是世界上所有的物品，都可以是一个对象，对象是一种特殊的数据结构，里面存储物品的相关属性信息，类似于一张表结构。</p><p>类就相当于对象的一个模版，结构相同的对象可以使用同一个类来构造</p></blockquote><hr><h1><span id="jvm虚拟机">JVM虚拟机</span></h1><h3><span id="jvm是什么">JVM是什么?</span></h3><blockquote><p>JVM（Java虚拟机）并不是直接安装在操作系统上的一个单独的实体或文件夹，而是一种抽象的计算模型，它通常是由一个程序或者软件包的一部分来实现的。当你在计算机上安装Java运行环境（例如，Java Development Kit, JDK 或者 Java Runtime Environment, JRE）时，实际上就包含了JVM的实现</p><p>当你运行一个Java程序时，比如通过命令行输入java YourProgramName，操作系统会调用相应的Java执行文件，这个执行文件负责初始化JVM，并加载、验证、解释执行Java字节码。因此，从操作系统的角度来看，<strong>JVM是在程序运行时动态创建的一个进程，它存在于内存中</strong></p></blockquote><h3><span id="jvm工作流程">JVM工作流程</span></h3><blockquote><ol><li>编译：Java源代码被编译成字节码（.class文件）。</li><li>加载：类加载器将字节码加载到内存中。</li><li>验证：验证字节码是否符合JVM规范。</li><li>准备与解析：为类变量分配内存并设置初始值，将符号引用转换为直接引用。</li><li>执行：执行引擎负责执行字节码，通过解释或即时编译的方式。</li><li>垃圾回收：自动管理内存，释放不再使用的对象占用的空间。</li></ol></blockquote><h3><span id="jvm特点">JVM特点</span></h3><blockquote><p>JVM提供了一个安全、可移植的执行环境，使得Java程序能够“<strong>一次编写，到处运行</strong>”。它通过将Java程序编译成字节码，并在目标平台上通过JVM解释或编译成机器码来执行，从而实现了跨平台的能力 </p></blockquote><h1><span id="java程序的运行">Java程序的运行</span></h1><blockquote><p>Java程序是在内存里的JVM虚拟机上运行的</p><p>运行一个java程序时，先把JVM虚拟机运行到内存，再将程序运行到虚拟机中</p><p>虚拟机将内存划分为栈内存、堆内存、方法区来配合执行java程序</p></blockquote><blockquote><ul><li><strong>方法区</strong> ： 存放类文件</li><li><strong>栈内存</strong> ： 方法执行是放在栈里面的</li><li><strong>堆内存</strong> ： 对象存放在堆中的</li></ul></blockquote><hr><h1><span id="类的基本语法">类的基本语法</span></h1><h2><span id="构造器">构造器</span></h2><h3><span id="什么是构造器">什么是构造器？</span></h3><p>是一种特殊方法，无返回值类型声明，方法名与类名一致</p><p>构造器包含无参构造器和有参构造器（重载方法）</p><p><img src="/./../images/fa743b96a9594b40a884038a549d3c4a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/6038c88f6c1a42ed9555646411e7f8e6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="构造器的特点">构造器的特点</span></h3><p>创建对象时会立即调用构造器，即可以创建对象时可以立即为对象赋值</p><p><img src="/./../images/05197ca2a45d4e1798a9ccf947bad846.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/fe7893301f334170a2065050588150ab.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="注意">注意</span></h3><ul><li>类默认自带一个无参构造器</li><li>如果类定义了有参构造器，类默认的无参构造器就没有了</li></ul><h2><span id="this">this</span></h2><h3><span id="this是什么">this是什么?</span></h3><ul><li>this是一个变量，可以用在方法中，来拿到当前对象</li><li>哪个对象调用这个方法，this就拿到哪个对象</li></ul><h3><span id="this的应用场景">this的应用场景</span></h3><p>解决变量名冲突问题</p><p><img src="/./../images/76cd6a7b51c94db4b16dd00e48c2fe49.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="封装">封装</span></h2><h3><span id="面向对象三大特征">面向对象三大特征</span></h3><p>封装、继承、多态</p><h3><span id="封装的设计要求">封装的设计要求</span></h3><blockquote><p><strong>类就是一种封装（合理隐藏，合理暴露）</strong></p><ul><li><strong>合理隐藏</strong> ：private(私有)关键字修饰成员变量，使得变量只能在本类中直接访问</li><li><strong>合理暴露</strong> ：public(公开)修饰的get和set方法使得成员变量可以取值和赋值</li></ul></blockquote><p><img src="/./../images/ad94db177d114032a07a918022cb3d07.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <img src="/./../images/2df1b552ed0a49288c76f34f9527dd88.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="javabean实体类">Javabean(实体类)</span></h2><h3><span id="什么是实体类">什么是实体类？</span></h3><p>是一种特殊类，类中要满足如下需求：</p><ol><li>类中的成员变量全部私有，并提供public修饰的getter&#x2F;setter方法</li><li>类中需要提供一个无参构造器，有参构造器可选</li></ol><p><img src="/./../images/ba5936a442ae45118dc229991e713243.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/f15b10f8315d4bc7bb482d084fee7121.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="实体类的作用">实体类的作用</span></h3><p>创建它的对象，存取数据（封装数据） </p><h3><span id="实体类的应用场景">实体类的应用场景</span></h3><p>实体类的对象只负责数据存取，而对数据的业务处理交给其他类的对象来完成，以实现数据和数据业务处理相分离</p><p><img src="/./../images/893846c2adcd435bb81ad9a28f582284.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/60c7a48c66894aa19c8e3617bbe8ca0e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="static静态">static（静态）</span></h2><h3><span id="定义">定义</span></h3><blockquote><p><strong>概念</strong>：静态，可以修饰成员变量、成员方法</p><p><strong>分类</strong>：成员变量按照有无static修饰，分为静态变量（类变量）和 实例变量（对象的变量）</p><p><strong>静态变量的应用场景</strong>： 如果某个数据只需要一份，且希望能够被共享（访问修改）。</p><ul><li>静态变量（类变量）：有static修饰，属于类，在计算机中只有一份，会被类的全部对象共享</li><li>实例变量（对象的变量） ： 无static修饰，属于每个对象的</li></ul></blockquote><p><img src="/./../images/41524b752c4244e7aa363269a96a1bd9.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="访问静态变量的方法">访问静态变量的方法</span></h3><p>类名.静态变量（推荐）</p><p>对象.静态变量</p><p><img src="/./../images/6ef0383eb7d348a5b973966134cf57be.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="static修饰方法">static修饰方法</span></h3><ul><li><strong>应用场景：</strong></li></ul><p>​        如果这个方法仅仅是为了实现一个功能而不需要访问对象数据，这个方法就可以直接定          义成静态方法</p><p>​        做工具类：工具类没有创建对象的必要，建议将工具类的构造器私有</p><ul><li><strong>调用静态方法:</strong></li></ul><p>​         类名.静态方法（推荐）</p><p>​         对象名.静态方法 （不推荐）</p><h3><span id="注意"><img src="/./../images/4b83466771d940f2ba09ec5e07bd439b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  注意</span></h3><ul><li>静态方法中可以直接访问静态成员，不可以直接访问实例成员</li><li>实例方法中既可以直接访问静态成员，也可以直接访问实例成员</li><li>实例方法中可以出现this关键字，静态方法中不可以出现this关键字</li></ul><hr><h1><span id="继承">继承</span></h1><h2><span id="概念">概念</span></h2><h3><span id="继承的优点">继承的优点</span></h3><p>提高代码的重用性，减少一些代码书写</p><h3><span id="继承是什么">继承是什么？</span></h3><p>Java中提供一个关键字extends，用这个关键字，可以让两个类建立起父子关系</p><h3><span id="继承的特点">继承的特点</span></h3><blockquote><ul><li>单继承 ：一个类只能继承一个直接父类</li><li>多层继承 ：Java不支持多继承，但支持多层继承</li><li>祖宗类 ：Object是所有类的祖宗类，应该类要么手动继承Object、要么默认继承、             Object要么间接继承Object</li><li>就近原则：优先访问自己类中，自己类中没有才会访问父类                                 super关键字可以指定访问父类的成员：super.父类成员变量&#x2F;方法</li></ul></blockquote><p><img src="/./../images/05a161aa31724b4389ab45e54c808b6e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/b52806e1bc05480fbc09df1bd7c9b929.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/140b3ec7efd441f1b09fbebae5d7134d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  <img src="/./../images/5876ca86b0bb49a9b97e4c5031b25301.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/65166a4595594030a44775d22cc57875.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="语法">语法</span></h2><h3><span id="基本语法">基本语法</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">A</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>解释：</p><p>A为父类（基类 或 超类），B为子类（派生类），子类能得到父类中的所有非私有属性方法 ，子类的对象是由子类和父类共同完成的。</p><p><img src="/./../images/920c4f02d25e4039b433d5c7e1854614.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/19d7adb9d3d944bb9a3fdd82fefe6f4b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="权限修饰符"><img src="/./../images/344fa3a7386b4fcfb45a63b01e011cd7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  权限修饰符</span></h3><blockquote><p>继承允许一个类（子类）继承另一个类（父类）的属性和方法。<br>子类可以覆盖或扩展父类的行为。</p><p>在Java中，通过关键字extends实现继承关系。</p><p>访问控制修饰符public、protected、default（即无修饰符）和private决定了成员的可见性。</p><ul><li>public修饰的成员可以在任何地方被访问，包括不同包中的类。</li><li>protected修饰的成员可以被同一包中的类以及不同包中的子类访问。</li><li>default修饰的成员仅限于同一包内的类访问。</li><li>private修饰的成员只允许在同一类内部访问。</li></ul></blockquote><table><thead><tr><th><strong>private</strong></th><th>只能本类</th></tr></thead><tbody><tr><td><strong>缺省</strong></td><td>本类、同一个包中的类</td></tr><tr><td><strong>protected</strong></td><td>本类，同一个包中的类、子孙类中</td></tr><tr><td><strong>public</strong></td><td>任意位置</td></tr></tbody></table><p>范围：private &lt; 缺省 &lt; protected &lt; public</p><p><strong>1.四种修饰符修饰的方法在同一个类中都可访问</strong> </p><p> <img src="/./../images/480b6851beff47af8451b37a8d61df5a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>2.在同一个包下 只能访问public protected default</strong></p><p> <img src="/./../images/194247762ced46ccaa2e6c20097c5a68.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>3.在其他包的子类中，可以访问父类的受保护方法、共有方法</strong></p><p><img src="/./../images/f0c3686e81b149dab462a4f64f75e518.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>4. 在另一个包中，只能访问public修饰的方法</strong></p><p><img src="/./../images/2aae4043b50c4aca82f6d096c9a77d83.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="方法重写">方法重写</span></h3><h4><span id="定义">定义</span></h4><p>当子类觉得父类中某个方法不好用或者无法满足自己的需求时，子类可以重写一个方法名称、参数列表一样的方法，去覆盖父类的这个方法，这就是方法重写。’</p><h4><span id="语法声明不变重新实现">语法（声明不变，重新实现）</span></h4><blockquote><ul><li><ol><li>子类重写父类方法，子类的访问权限必须大于父类</li></ol></li><li><ol start="2"><li>重写的方法返回类型，必须与被重写方法的返回值类型一样，或者范围更小</li></ol></li><li><ol start="3"><li>私有方法、静态方法不能被重写</li></ol></li></ul></blockquote><p><strong>方法重写的校验注解（标志</strong>）：要求方法名称和形参列表与被重写方法一致</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="comment">// 方法重写的校验注解（标志）：要求方法名称和形参列表与被重写方法一致</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>eg： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        s.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方法重写 : 方法名称，形参列表必须一样</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">People</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;父类&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">People</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> score;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 方法重写的校验注解（标志）：要求方法名称和形参列表与被重写方法一致</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;子类&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> 例子：</p><p>重写Object的toString方法：</p><p><img src="/./../images/e380e6da9266462cb5ce22829db81104.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/09dd383185ba4068899a5e0e74db5341.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Film</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Film</span>(<span class="string">&quot;《野孩子》&quot;</span>, <span class="number">35</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Film</span> <span class="keyword">extends</span> <span class="title class_">Object</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> price;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\tStudentname：&quot;</span> + name + <span class="string">&quot;\n\tprice：&quot;</span> + price + <span class="string">&quot;\n\tid:&quot;</span> + id + <span class="string">&quot;\n\t9.13不见不散&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Film</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Film</span><span class="params">(String name, <span class="type">int</span> price, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.price = price;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="子类构造器">子类构造器</span></h3><h4><span id="特点">特点</span></h4><p>子类的全部构造器，都会先调用父类构造器，再执行自己</p><h4><span id="语法">语法</span></h4><p><strong>子类构造器是如何实现调用父类构造器的：</strong></p><p>默认情况下，子类全部构造器的第一行代码都是super()（写不写都有),它会调用父类的无参构造器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 子类构造器都会先调用父类的构造器，再执行自己的构造器</span></span><br><span class="line">        <span class="type">Son</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Father</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Father&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Father</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;666&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Son</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">666</span>); <span class="comment">//指定调用父类有参构造器</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Son&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="this调用兄弟构造器">this(…)调用兄弟构造器</span></h3><h4><span id="语法">语法</span></h4><p><img src="/./../images/12b6ee337d7240d2aa2b8050774e68be.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="注意">注意</span></h4><p>this(…)和super(…)都要写在构造器的第一行，而且两种不能同时出现</p><h1><span id="多态">多态</span></h1><h2><span id="概念">概念</span></h2><h3><span id="定义">定义</span></h3><blockquote><p>多态是在继承&#x2F;实现情况下的一种抽象，表现为:对象多态、行为多态。</p><p>多态是对象、行为的多态，Java中属性（成员变量）不谈多态。</p></blockquote><p><img src="/./../images/2ac89e8fcbfe46c499251337bdd35815.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="多态的条件">多态的条件</span></h3><blockquote><p>1.有继承&#x2F;实现关系</p><p>2.存在父类引用子类对象</p><p>3.存在方法重写 </p></blockquote><h3><span id="多态的优点">多态的优点</span></h3><blockquote><p><strong>提高代码的通用性和可扩展性：</strong></p><p>多态允许你编写更加通用的代码，通过父类或接口类型的引用可以操作任何子类的对象。这意味着，如果需要添加新的子类，通常不需要修改已有的代码，只需添加新的子类即可。这种扩展性符合开闭原则（Open&#x2F;Closed Principle），即对扩展开放，对修改关闭。</p><p><strong>减少代码冗余：</strong></p><p>由于多态允许你通过一个共同的接口来访问不同类型的对象，因此减少了代码的重复。你可以在一个地方编写代码来处理所有子类的对象，而不需要为每个子类单独编写类似的代码。<br>增强程序的灵活性：<br>多态性增强了程序的灵活性，因为你可以更容易地更改或替换系统中的组件。如果一个模块需要被替换或升级，只要新模块实现了相同的接口，那么大多数情况下无需修改其他部分的代码。</p><p><strong>提高开发效率：</strong><br>多态性简化了代码的设计和实现过程，使得开发人员能够更快速地开发出高质量的应用程序。</p><p><strong>易于维护：</strong><br>基于继承关系，只需要维护父类代码，就可以保证所有继承自该父类的子类都会得到更新。这提高了代码的复用性，同时也降低了维护工作的复杂度。</p><p><strong>解耦：</strong><br>多态有助于降低模块间的耦合度，因为它们之间可以通过接口进行通信，而不是直接依赖于具体的实现类。这使得系统的各个部分更加独立，易于理解和修改。</p></blockquote><h3><span id="使用多态的好处">使用多态的好处</span></h3><blockquote><ol><li>在多态形式下，右边对象是解耦合的，便于扩展与维护</li><li>定义方法时，使用父类的形参，则该方法可以接收一切子类对象，扩展性更强、更便利。</li></ol></blockquote><h2><span id="多态下类型转换">多态下类型转换</span></h2><h3><span id="语法">语法</span></h3><blockquote><p>自动类型转换： 父类 变量名 &#x3D; new 子类();</p><p>强制类型转换 ： <strong>子类 变量名 &#x3D; （子类）父类变量；</strong></p></blockquote><p><img src="/./../images/075cbbd36a0d4348a410f93929531547.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="注意">注意</span></h3><p>运行时如果发现强转后类型与真实类型不符，则会报类型转换异常(ClassCastException)的错误来</p><h3><span id="java建议">Java建议</span></h3><p>使用instanceof关键字，判断当前对象的真实类型，再进行强转</p><p><img src="/./../images/f0be806d3b34476f84a1b3aad2fb3471.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="面向对象高级">面向对象高级</span></h1><h2><span id="final关键字">final关键字</span></h2><h3><span id="语法">语法</span></h3><table><thead><tr><th><strong>修饰类</strong></th><th>该类是最终类，特点是不能被继承了</th></tr></thead><tbody><tr><td><strong>修饰方法</strong></td><td>该方法被称为最终方法，特点是不能被重写了</td></tr><tr><td><strong>修饰变量</strong></td><td>该变量有且仅能被赋值一次</td></tr></tbody></table><p> <img src="/./../images/af595f9acaa44b2b9264041dc40a0a66.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="变量分类">变量分类</span></h3><blockquote><p><strong>1.局部变量:</strong> 定义在方法内部或者某个代码块内的变量。这些变量只在定义它们的方法或代码块内有效。</p><p><strong>2.成员变量:</strong> 定义在类内部但方法外部的变量。成员变量对整个类都是可见的，并且每个对象都有其独立的一份副本。</p><p>3**.静态变量:** 通过static关键字声明的成员变量。静态变量被所有对象共享，只有一个副本存在于内存中 </p></blockquote><h3><span id="注意">注意</span></h3><blockquote><ul><li>final修饰基本类型的变量，变量存储的数据不能被改变</li><li>final修饰引用类型的变量（如数组），变量存储的地址不能被改变，但地址所指向对象的内容是可以被改变的</li></ul></blockquote><p><img src="/./../images/538edb68245444e0bd7700f53cbba31a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/e274edec086542ae864716adff02f90a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="常量">常量</span></h2><h3><span id="概念">概念</span></h3><blockquote><p>定义 ：使用static final修饰的成员变量就称之为常量</p><p>作用： 常用于记录系统的配置信息</p></blockquote><h2><span id="单例类设计模式">单例类（设计模式）</span></h2><h3><span id="概念">概念</span></h3><p>作用 ： 确保每个类只能创建一个对象<br> 分类 ：饿汉式和懒汉式</p><h3><span id="语法">语法</span></h3><blockquote><ol><li>饿汉式单例 ：拿到对象的时候，对象就已经创建好了</li></ol><p> 写法 ：<br>   1.把类的构造器私有<br>   2.定义一个类变量记住类的一个对象<br>   3.定义一个类方法，返回对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单例类 ： 饿汉式单例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.定义一个类变量记住类的一个对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.将构造器私有</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">A</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 定义一个类方法返回对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> A <span class="title function_">getObject</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><blockquote><ol start="2"><li>懒汉式单例 ：拿到对象的时候，对象才创建</li></ol><p> 写法:<br>   1.把类的构造器私有<br>   2.定义一个静态变量用于存储对象<br>   3.定义一个静态方法，保证返回的是同一个对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 单例类 ： 懒汉式单例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line"><span class="comment">//    2.定义一个静态变量用于存储对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> B b;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    1.把类的构造器私有</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">B</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    3.定义一个静态方法，保证返回的是同一个对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> B <span class="title function_">getObject</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (b == <span class="literal">null</span>) &#123;</span><br><span class="line">            b = <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>使用</p><p><img src="/./../images/814b73b62c6a480fa07ecd38d493dbd0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="枚举类">枚举类</span></h2><h3><span id="概念">概念</span></h3><p>枚举类 ： 枚举是一种特殊的类</p><p>特点 ：<br> 枚举类的第一行只能写枚举类的对象名称，且要逗号隔开<br> 这些名称本质是常量，每个常量都记住了枚举类的一个对象<br> 枚举类的构造器都是私有的(写不写都只能是私有的，因此，枚举类对外不能创建对象)</p><p>应用场景：信息分类和标志</p><p><img src="/./../images/199309b6397b42a8afe58d341bf796bf.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="语法">语法</span></h3><p>写法：<br> 修饰符 enum 枚举类名 {<br>   名称1,名称2,……<br>   其他成员…<br> }</p><p> <img src="/./../images/40f183060edc4467a046af7bb9df782f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      枚举类 ： 枚举是一种特殊的类</span></span><br><span class="line"><span class="comment">      写法：</span></span><br><span class="line"><span class="comment">      修饰符 enum 枚举类名 &#123;</span></span><br><span class="line"><span class="comment">          名称1,名称2,......</span></span><br><span class="line"><span class="comment">          其他成员...</span></span><br><span class="line"><span class="comment">      &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      特点 ：</span></span><br><span class="line"><span class="comment">      枚举类的第一行只能写枚举类的对象名称，且要逗号隔开</span></span><br><span class="line"><span class="comment">      这些名称本质是常量，每个常量都记住了枚举类的一个对象</span></span><br><span class="line"><span class="comment">      枚举类的构造器都是私有的(写不写都只能是私有的，因此，枚举类对外不能创建对象)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      应用场景：</span></span><br><span class="line"><span class="comment">      1.信息分类和标志</span></span><br><span class="line"><span class="comment">      2.</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">A</span> <span class="variable">a1</span> <span class="operator">=</span> A.A1;</span><br><span class="line">        System.out.println(a1);</span><br><span class="line"></span><br><span class="line">        <span class="type">A</span> <span class="variable">a2</span> <span class="operator">=</span> A.A2;</span><br><span class="line">        System.out.println(a2.toString());</span><br><span class="line"></span><br><span class="line">        <span class="type">A</span> <span class="variable">a3</span> <span class="operator">=</span> A.A3;</span><br><span class="line">        System.out.println(a3.name());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ordinal() : 获取枚举对象的序号，从0开始</span></span><br><span class="line">        System.out.println(a1.ordinal());</span><br><span class="line">        System.out.println(a2.ordinal());</span><br><span class="line">        System.out.println(a3.ordinal());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="抽象类">抽象类</span></h2><h3><span id="概念">概念</span></h3><blockquote><p><strong>抽象类(abstract) :</strong> 它就是抽象的意思，可以用它修饰类、成员方法<br><strong>作用 ：</strong>被子类继承，实现父类中的抽象方法</p><p><strong>核心特点 :</strong></p><p>​      有得有失(得到了抽象方法的能力，失去了创建对象的能力)<br>​      抽象类不能创建对象<br>​      抽象类中可以有抽象方法，也可以有非抽象方法<br><strong>特点 ：</strong><br>1.抽象类不能创建对象，仅作为一种特殊的父类，让子类继承并实现<br>2.抽象类中不一定要有抽象方法，有抽象方法的类必须是抽象类<br>3.一个类继承抽象类，必须重写玩抽象类的全部抽象方法，否则这个类也必须定义成抽象类</p><p><strong>应用场景</strong></p><p>模板方法设计模式</p></blockquote><h3><span id="语法">语法</span></h3><blockquote><p>修饰符 abstract class 类名{<br>修饰符 abstract 返回值类型 方法名称(形参列表)<br>}</p></blockquote><p><img src="/./../images/54b4c6b3f877477c8e7e64e7e9726653.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/6137a1dcd4bb4803b8d4a2f93d83057e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="接口">接口</span></h2><h3><span id="概念">概念</span></h3><blockquote><p><strong>接口 ：</strong>Java提供了一个关键字interface来定义接口<br><strong>接口的好处 ：</strong></p><p>​      1. 弥补了类单继承的不足，一个类同时可以实现多个接口</p><p>​      2. 让程序可以面向接口编程，更利于实现程序的解耦合</p><p><strong>接口与类：</strong></p><ul><li>接口与接口 ：多继承，一个接口可以继承多个接口</li><li>接口与类：多实现，一个接口可以有多个实现方法</li><li>类与类： 单继承，一个类只能继承一个直接父类</li></ul></blockquote><h3><span id="语法">语法</span></h3><h4><span id="传统接口写法interface">传统接口写法(interface)：</span></h4><p>1.接口中定义常量，可以省略public static final<br> 2.接口中定义抽象方法，可以省略public abstract</p><blockquote><p>public interface 接口名{<br>&#x2F;&#x2F; 成员变量 (常量)<br>&#x2F;&#x2F; 成员方法 (抽象方法)<br>}</p></blockquote><p><img src="/./../images/7c05179d8f084ba4b48eaad4a1190d6c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="类实现接口implements">类实现接口（implements）</span></h4><p><strong>解析：</strong></p><p>​    接口是用来被类实现 (implements)的,实现接口的类是接口类，一个类可以实现多个接口 ：<br> <strong>写法：</strong></p><blockquote><p>修饰符 class 实现类类名 implements 接口名1,接口名2,接口名3, … {<br>&#x2F;&#x2F; 实现类实现多个接口，必须重写完全部接口的全部抽象方法，否则实现类要被定义成抽象类<br>}</p></blockquote><p><img src="/./../images/9ba50b46840a40fbbc3c1662c757eabb.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="接口继承接口extends">接口继承接口(extends)</span></h4><p><strong>解析 ：</strong></p><p>​     接口可以继承接口，接口可以继承多个接口，接口继承接口，必须使用extends关键字 ：<br> <strong>写法：</strong></p><blockquote><p> public interface 接口名 extends 接口名1,接口名2,接口名3, … {<br> &#x2F;&#x2F; 成员变量 (常量)<br> }</p></blockquote><p><img src="/./../images/355e8400d4264dc89b8980415a0c4817.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <strong>注意 ：</strong></p><ol><li>接口不能创建对象</li></ol><h3><span id="接口新增的三种方法从jdk8开始">接口新增的三种方法（从jdk8开始）</span></h3><blockquote><p><strong>1. 默认方法(实例方法)</strong> : 使用default修饰，默认会被加上public修饰<br>注意 : 只能使用接口的实现类对象调用</p><p><strong>2. 私有方法 :</strong> 必须用private修饰(jdk9开始支持)</p><p>注意 : 只能使用接口中其它实例方法来调用</p><p><strong>3. 类方法(静态方法) :</strong> 使用static修饰,默认会被加上public修饰<br>注意 :只能用接口名来调用</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="comment">// 从jdk8开始接口新增的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 默认方法(实例方法) : 使用default修饰，默认会被加上public修饰</span></span><br><span class="line">    <span class="comment">// 注意 : 只能使用接口的实现类对象调用</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A.show()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 私有方法 : 必须用private修饰(jdk9开始支持)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">show1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A.show1()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 类方法(静态方法) : 使用static修饰,默认会被加上public修饰</span></span><br><span class="line">    <span class="comment">// 注意 :只能用接口名来调用</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">show2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;A.show2()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="抽象类与接口的区别">抽象类与接口的区别</span></h3><h4><span id="相同点">相同点：</span></h4><blockquote><p><strong>1. 抽象性：</strong>它们都可以包含抽象方法，这些方法只有声明而没有具体的实现（body），需要被继承或实现的子类去完成具体的实现。<br><strong>2. 不可实例化：</strong>接口和抽象类本身都不能被实例化，即不能使用new关键字创建它们的对象。如果需要使用，必须通过继承抽象类或实现接口的具体子类来创建实例。<br><strong>3. 方法实现：</strong>无论是继承抽象类还是实现接口的类，都需要提供抽象方法的具体实现。如果一个类继承了一个包含抽象方法的抽象类，或者实现了包含抽象方法的接口，那么这个类也必须是抽象的，除非它提供了所有抽象方法的实现。<br><strong>4. 引用：</strong>接口或抽象类的引用可以指向它们的具体子类或实现类的实例。这意味着你可以使用抽象类或接口类型的变量来引用其实现或继承类的对象，这是多态性的体现。<br><strong>5. 设计目的：</strong>它们都是面向对象设计的一部分，用于定义类之间的关系，提供了一种方式来描述类的公共行为或状态，有助于代码的组织和复用。</p></blockquote><h4><span id="不同点">不同点 ：</span></h4><blockquote><p><strong>1. 实现方式：</strong><br>接口中的所有方法默认都是抽象的（无实现体），从Java 8开始引入了默认方法（default methods）和静态方法（static methods），可以在接口中提供具体实现。<br>抽象类可以包含具体实现的方法（即非抽象方法），也可以包含抽象方法。<br><strong>2. 继承限制：</strong><br>Java中的类只能继承一个抽象类，即只支持单一继承。<br>类可以实现多个接口，支持多重继承的效果。<br><strong>3. 成员变量：</strong><br>接口只能包含常量（默认为public static final），不允许包含实例变量（非静态变量）。<br>抽象类可以包含实例变量、常量以及其他类型的成员变量。<br><strong>4. 构造函数：</strong><br>接口中不允许包含构造函数。<br>抽象类可以包含构造函数，这些构造函数可以被子类使用。<br><strong>5. 方法访问修饰符：</strong><br>接口中的方法默认是public的，尽管从Java 9开始允许私有方法的存在，但这些方法并不是为了外部实现类使用。<br>抽象类中的方法可以有不同的访问级别，如public、protected或private。<br><strong>6. 实现要求：</strong><br>实现接口的类必须提供接口中所有抽象方法的具体实现，除非该类也被声明为抽象类。<br>继承抽象类的子类可以选择性地实现抽象类中的抽象方法，也可以直接继承抽象类中的具体方法。<br><strong>7. 设计意图：</strong><br>抽象类通常用于提供一组默认的行为和一些需要子类实现的方法，可以看作是一系列相关类的基础模板。<br>接口主要用于定义行为规范，即定义了一组方法签名，表示类具备某种能力或遵循某种协议。<br><strong>8. 使用场景：</strong><br>抽象类适合于那些有很多通用行为的类，这些行为可以被具体化并直接继承。<br>接口适合于定义类应该具备的行为，而不管这些行为是如何实现的。</p></blockquote><p>以上是chatgpt生成的，在我看来抽象类与接口在语法上的区别最主要是：</p><p>抽象类可以定义对象和实例方法，抽象类中abstract修饰的方法（即抽象方法）必须由子类进行重写。</p><p>接口中定义的大多数是方法头以及常量，没有具体方法的实现，接口中方法的实现要依据接口的实现类来完成具体方法的实施（方法重写），接口可以看作为框架，而实现类可以看作框架中所填的东西</p><p>抽象类只能单继承，接口可以多实现</p><h2><span id="代码块">代码块</span></h2><h3><span id="概念">概念</span></h3><p>定义 ： 代码块是类的5大成分之一（成员变量、构造器、方法、代码块、内部类）</p><p>分类 ： 静态代码块和实例代码块</p><h3><span id="语法">语法</span></h3><h4><span id="1-静态代码块">1. 静态代码块：</span></h4><p>​        <strong>格式 ：</strong> static{}</p><p>​        <strong>特点 :</strong> 类加载时自动执行，由于类只会加载一次，所以静态代码块也只会执行一次</p><p>​        <strong>作用 ：</strong>完成类的初始化</p><p><img src="/./../images/bdf60f0859374f4a8ef185f36cdfb2c3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>解析：</strong></p><p>静态代码块与类一起加载，所以先执行静态代码块再执行main方法 </p><p><strong>eg：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeDemo1</span> &#123;</span><br><span class="line">    <span class="comment">// 静态代码块 : 有static修饰, 静态代码块在类加载的时候执行，只执行一次。</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String[] card = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">13</span>];</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        card[<span class="number">0</span>] = <span class="string">&quot;A&quot;</span>;</span><br><span class="line">        card[<span class="number">1</span>] = <span class="string">&quot;2&quot;</span>;</span><br><span class="line">        card[<span class="number">2</span>] = <span class="string">&quot;3&quot;</span>;</span><br><span class="line">        card[<span class="number">3</span>] = <span class="string">&quot;4&quot;</span>;</span><br><span class="line">        card[<span class="number">4</span>] = <span class="string">&quot;5&quot;</span>;</span><br><span class="line">        card[<span class="number">5</span>] = <span class="string">&quot;6&quot;</span>;</span><br><span class="line">        card[<span class="number">6</span>] = <span class="string">&quot;7&quot;</span>;</span><br><span class="line">        card[<span class="number">7</span>] = <span class="string">&quot;8&quot;</span>;</span><br><span class="line">        card[<span class="number">8</span>] = <span class="string">&quot;9&quot;</span>;</span><br><span class="line">        card[<span class="number">9</span>] = <span class="string">&quot;10&quot;</span>;</span><br><span class="line">        card[<span class="number">10</span>] = <span class="string">&quot;J&quot;</span>;</span><br><span class="line">        card[<span class="number">11</span>] = <span class="string">&quot;Q&quot;</span>;</span><br><span class="line">        card[<span class="number">12</span>] = <span class="string">&quot;K&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(Arrays.toString(card));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="2-实例代码块">2. 实例代码块：</span></h4><p>​        <strong>格式：</strong>{}</p><p>​        <strong>特点 ：</strong> 每次创建对象时，执行实例代码块，并在构造器前执行</p><p>​        <strong>作用 ：</strong> 完成对象的初始化</p><p><img src="/./../images/19c7d3e6ed0142ffb02f9c23e49e547f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>解析:</strong></p><p>每次创建对象实例代码块中的内容都会执行</p><p><strong>eg：</strong></p><p><img src="/./../images/e356d8e8ee9a425bbd2836032fd76c59.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="内部类">内部类</span></h2><h3><span id="概念">概念</span></h3><p>定义 ： 一个类定义在另一个类的内部。这个类就是内部类</p><p>内部类访问外部类：</p><p> 成员内部类可以直接访问外部类的静态成员，也可以直接访问外部类的实例成员</p><h3><span id="语法">语法</span></h3><p><strong>写法：</strong></p><p><img src="/./../images/8a0209733608498c92979fa75895d3b5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> <strong>使用：</strong></p><p><img src="/./../images/9aaa235e67744ad7a821fe0cd53735bc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="匿名内部类">匿名内部类</span></h3><h4><span id="概念">概念</span></h4><blockquote><ol><li>是一种特殊的局部内部类</li><li>匿名：程序员不需要为这个类声明名字，默认有个隐藏的名字</li><li>匿名内部类实际上那个是有名字 : 外部类名$编号</li><li>匿名内部类本质是一个子类</li></ol></blockquote><h4><span id="语法">语法</span></h4><blockquote><p>new 类或者接口(参数值…) {<br>类体 ：一般是方法重写<br>}</p></blockquote><p>eg：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      匿名内部类</span></span><br><span class="line"><span class="comment">       概念</span></span><br><span class="line"><span class="comment">       1. 是一种特殊的局部内部类</span></span><br><span class="line"><span class="comment">       2. 匿名：程序员不需要为这个类声明名字，默认有个隐藏的名字</span></span><br><span class="line"><span class="comment">       3. 匿名内部类实际上那个是有名字 : 外部类名$编号</span></span><br><span class="line"><span class="comment">       4. 匿名内部类本质是一个子类</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       应用场景 ：</span></span><br><span class="line"><span class="comment">       语法</span></span><br><span class="line"><span class="comment">       new 类或者接口(参数值...) &#123;</span></span><br><span class="line"><span class="comment">       类体 ：一般是方法重写</span></span><br><span class="line"><span class="comment">     &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">        a1.cry();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 匿名内部类</span></span><br><span class="line">        <span class="type">Animal</span> <span class="variable">a2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cry</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;匿名内部类&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cry</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;汪汪汪&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cry</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;喵喵喵&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">win</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>(<span class="string">&quot;登录窗口&quot;</span>);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">panel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        win.add(panel);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">btn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">        panel.add(btn);</span><br><span class="line">        win.setSize(<span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line">        win.setLocationRelativeTo(<span class="literal">null</span>);</span><br><span class="line">        win.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        win.setVisible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        btn.addActionListener(<span class="keyword">new</span> <span class="title class_">ActionListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLickListener</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actionPerformed</span><span class="params">(ActionEvent e)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="lambda表达式">Lambda表达式 :</span></h2><h3><span id="概念">概念</span></h3><blockquote><p> 数学中的函数 : f(x) &#x3D; 2x + 1<br> Java中的函数(Lambda表达式): (x) -&gt; 2x + 1<br> 作用 ： 用Lambda函数替代某些匿名类对象<br> 注意 : Lambda表达式只能替代函数式接口的匿名内部类<br> 函数式接口 : 有且仅有一个抽象方法的接口</p></blockquote><h3><span id="语法">语法</span></h3><blockquote><p>写法 :<br>(被重写方法的形参列表) -&gt; {<br>被重写方法的方法体代码<br>}</p></blockquote><h3><span id="lambda省略规则">Lambda省略规则：</span></h3><blockquote><ol><li>参数类型全部可以省略不写</li><li>如果只有一个参数，参数类型省略的同时 “()”也可以省略, 但多个参数不能省略 “()”</li><li>如果Lambda表达式方法体只有一行代码，可以省略大括号, 同时要省略分号 “;” 如果这行代码是return语句，也必须去掉return</li></ol></blockquote><p>eg：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     Lambda表达式 :</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     数学中的函数 : f(x) = 2x + 1</span></span><br><span class="line"><span class="comment">     Java中的函数(Lambda表达式): (x) -&gt; 2x + 1</span></span><br><span class="line"><span class="comment">     作用 ： 用Lambda函数替代某些匿名类对象</span></span><br><span class="line"><span class="comment">     注意 : Lambda表达式只能替代函数式接口的匿名内部类</span></span><br><span class="line"><span class="comment">     函数式接口 : 有且仅有一个抽象方法的接口</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     语法</span></span><br><span class="line"><span class="comment">     写法 :</span></span><br><span class="line"><span class="comment">        (被重写方法的形参列表) -&gt; &#123;</span></span><br><span class="line"><span class="comment">           被重写方法的方法体代码</span></span><br><span class="line"><span class="comment">     &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Lambda省略规则：</span></span><br><span class="line"><span class="comment">     1. 参数类型全部可以省略不写</span></span><br><span class="line"><span class="comment">     2. 如果只有一个参数，参数类型省略的同时 &quot;()&quot;也可以省略, 但多个参数不能省略 &quot;()&quot;</span></span><br><span class="line"><span class="comment">     3. 如果Lambda表达式方法体只有一行代码，可以省略大括号, 同时要省略分号 &quot;;&quot; 如果这行代码是return语句，也必须去掉return</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      getWindow();</span><br><span class="line">      test1();</span><br><span class="line">      test2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getWindow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JFrame</span> <span class="variable">win</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JFrame</span>(<span class="string">&quot;登录窗口&quot;</span>);</span><br><span class="line">        <span class="type">JPanel</span> <span class="variable">panel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">        win.add(panel);</span><br><span class="line">        <span class="type">JButton</span> <span class="variable">btn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;登录&quot;</span>);</span><br><span class="line">        panel.add(btn);</span><br><span class="line">        win.setSize(<span class="number">300</span>, <span class="number">200</span>);</span><br><span class="line">        win.setLocationRelativeTo(<span class="literal">null</span>);</span><br><span class="line">        win.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        win.setVisible(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        btn.addActionListener(e -&gt; System.out.println(<span class="string">&quot;ok&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Lambda 表达式</span></span><br><span class="line">        <span class="type">Swim</span> <span class="variable">s11</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;函数式接口&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        Student1[] stu = <span class="keyword">new</span> <span class="title class_">Student1</span>[<span class="number">6</span>];</span><br><span class="line">        stu[<span class="number">0</span>] = <span class="keyword">new</span> <span class="title class_">Student1</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>, <span class="number">1</span>);</span><br><span class="line">        stu[<span class="number">1</span>] = <span class="keyword">new</span> <span class="title class_">Student1</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">19</span>, <span class="number">2</span>);</span><br><span class="line">        stu[<span class="number">2</span>] = <span class="keyword">new</span> <span class="title class_">Student1</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">20</span>, <span class="number">3</span>);</span><br><span class="line">        stu[<span class="number">3</span>] = <span class="keyword">new</span> <span class="title class_">Student1</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">21</span>, <span class="number">4</span>);</span><br><span class="line">        stu[<span class="number">4</span>] = <span class="keyword">new</span> <span class="title class_">Student1</span>(<span class="string">&quot;钱七&quot;</span>, <span class="number">22</span>, <span class="number">5</span>);</span><br><span class="line">        stu[<span class="number">5</span>] = <span class="keyword">new</span> <span class="title class_">Student1</span>(<span class="string">&quot;孙八&quot;</span>, <span class="number">23</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        Arrays.sort(stu, (Student1 o1, Student1 o2) -&gt; o2.getAge() - o1.getAge());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Student1 s : stu) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student1</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@FunctionalInterface</span> <span class="comment">//声明函数式接口的注解</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Swim</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">swimming</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="api">API</span></h1><h2><span id="基础类型操作">基础类型操作</span></h2><h3><span id="math-类">Math 类:</span></h3><blockquote><p>Math.abs(int a): 返回 a 的绝对值。<br>Math.sqrt(double a): 返回 a 的平方根。<br>Math.pow(double a, double b): 返回 a 的 b 次方。<br>Math.round(double a): 四舍五入 a 至最接近的整数。</p></blockquote><h3><span id="integer-类">Integer 类:</span></h3><blockquote><p>Integer.parseInt(String s): 将字符串 s 转换为整数。<br>Integer.toString(int value): 将整数 value 转换为字符串。</p></blockquote><h2><span id="字符串处理">字符串处理</span></h2><blockquote><p>String 类:<br>String.trim(): 删除字符串两端的空白字符。<br>String.split(String regex): 按照正则表达式 regex 分割字符串。<br>String.toLowerCase(): 将字符串转换为小写。<br>String.toUpperCase(): 将字符串转换为大写。<br>String.replace(char oldChar, char newChar): 替换字符串中的某个字符。<br>String.format(String format, Object… args): 格式化字符串。</p></blockquote><h2><span id="集合操作">集合操作</span></h2><h3><span id="list-接口">List 接口:</span></h3><p>List.add(Object o): 向列表添加元素。<br> List.remove(Object o): 从列表移除元素。<br> List.contains(Object o): 判断列表是否包含元素。</p><h3><span id="arraylist-类">ArrayList 类:</span></h3><blockquote><p>ArrayList.addAll(Collection c): 添加集合中的所有元素。<br>ArrayList.subList(int fromIndex, int toIndex): 返回列表的一个视图。</p></blockquote><h3><span id="set-接口">Set 接口:</span></h3><blockquote><p>Set.add(Object o): 向集合添加元素。<br>Set.remove(Object o): 从集合移除元素。</p></blockquote><h3><span id="map-接口">Map 接口:</span></h3><blockquote><p>Map.put(Object key, Object value): 存储键值对。<br>Map.get(Object key): 获取键对应的值。<br>Map.containsKey(Object key): 判断是否存在键。</p></blockquote><h2><span id="文件与ix2fo">文件与I&#x2F;O</span></h2><h3><span id="files-类">Files 类:</span></h3><blockquote><p>Files.readAllLines(Path path): 读取文件的所有行。<br>Files.write(Path path, byte[] bytes): 将字节数组写入文件。<br>Files.deleteIfExists(Path path): 删除文件（如果存在）。</p></blockquote><h3><span id="file-类">File 类:</span></h3><blockquote><p>File.exists(): 检查文件或目录是否存在。<br>File.mkdir(): 创建单个目录。<br>File.listFiles(): 获取目录下的文件列表。</p></blockquote><h2><span id="输入输出流">输入输出流</span></h2><h3><span id="inputstreamx2foutputstream-类">InputStream&#x2F;OutputStream 类:</span></h3><blockquote><p>InputStream.read(): 读取一个字节。<br>OutputStream.write(byte b): 写入一个字节。</p></blockquote><h3><span id="bufferedreaderx2fbufferedwriter-类">BufferedReader&#x2F;BufferedWriter 类:</span></h3><blockquote><p>BufferedReader.readLine(): 读取一行。<br>BufferedWriter.write(String str): 写入字符串。</p></blockquote><h2><span id="日期与时间">日期与时间</span></h2><h3><span id="localdate-类">LocalDate 类:</span></h3><blockquote><p>LocalDate.now(): 获取当前日期。<br>LocalDate.of(int year, int month, int dayOfMonth): 创建指定日期。</p></blockquote><h3><span id="localdatetime-类">LocalDateTime 类:</span></h3><blockquote><p>LocalDateTime.now(): 获取当前日期时间。<br>LocalDateTime.parse(String text): 解析日期时间字符串。</p></blockquote><h2><span id="异常处理">异常处理</span></h2><blockquote><p>throw:<br>throw new IllegalArgumentException(“Invalid argument”);: 抛出一个异常。<br>try-catch-finally:<br>try { … } catch (Exception e) { … } finally { … }: 处理异常。</p></blockquote><h2><span id="并发编程">并发编程</span></h2><h3><span id="thread-类">Thread 类:</span></h3><blockquote><p>Thread.sleep(long millis): 使当前线程休眠。<br>Thread.start(): 启动线程。<br>Thread.join(): 等待线程结束。</p></blockquote><h3><span id="runnable-接口">Runnable 接口:</span></h3><blockquote><p>run(): 线程体。</p></blockquote><h3><span id="executorservice-接口">ExecutorService 接口:</span></h3><blockquote><p>submit(Runnable task): 提交一个可运行的任务。</p></blockquote><hr><h1><span id="异常">异常</span></h1><h2><span id="java的异常体系"><strong>java的异常体系</strong></span></h2><p><img src="/./../images/42280bd91d2e46c49e73bb53c73c1001.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="分类">分类</span></h2><h3><span id="运行时异常继承自runtimeexception">运行时异常（继承自RuntimeException）</span></h3><p>特点：编译不报错（即写代码不报错），运行出错</p><p><img src="/./../images/ea45ec276d48443cb084205d800039d4.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  <img src="/./../images/fb55ce52089545f3bdee91f8eb931ac6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/1950a92fb8fa44f59521316199fe7fd3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  eg：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 运行时异常</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">// 运行异常：编译不报错，但是运行出错, 继承自RuntimeException</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 数组越界</span></span><br><span class="line">       <span class="type">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">       System.out.println(arr[<span class="number">3</span>]);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 除数为0</span></span><br><span class="line">       System.out.println(<span class="number">10</span> / <span class="number">0</span>);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 空指针异常</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       System.out.println(str1);</span><br><span class="line">       System.out.println(str1.length());</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="编译时异常">编译时异常</span></h3><p>特点：编译时异常：编译出错，必须处理，继承自Exception</p><p><img src="/./../images/814eef9354404260bfcfb575c9454112.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="异常处理">异常处理</span></h2><h3><span id="抛出异常throws">抛出异常（throws）</span></h3><p>特点：在方法上使用throws关键字，可以将方法内部出现的异常抛出去给调用者处理</p><p>语法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">方法 <span class="keyword">throws</span> 异常<span class="number">1</span>， 异常<span class="number">2</span>， 异常<span class="number">3.</span>.&#123;</span><br><span class="line"> ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>eg：</p><p><img src="/./../images/f704bf1d3c964ec6be2cbbc5a24c820e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="捕获异常trycatch">捕获异常（try…catch）</span></h3><p>特点：直接捕获程序出现的异常</p><p>语法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">  <span class="comment">// 监视可能出现异常的代码</span></span><br><span class="line"> &#125;<span class="keyword">catch</span>(异常<span class="number">1</span> 变量)&#123;</span><br><span class="line">  <span class="comment">// 处理异常1</span></span><br><span class="line"> &#125;<span class="keyword">catch</span>(异常<span class="number">2</span> 变量)&#123;</span><br><span class="line">  <span class="comment">// 处理异常2</span></span><br><span class="line"> &#125;...</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>e.printStackTrace() 可以打印异常原因</p><p>eg：</p><p><img src="/./../images/da8b8df9b2784136b822ec92932e79bc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="异常作用">异常作用</span></h2><blockquote><ol><li>抛运行时异常 : 返回一个异常给上层调用者</li></ol><p> throw new RuntimeException(“除数不能为0”);</p><p> 2.抛编译时异常 ： 返回一个异常给上层调用者<br> throw new Exception(“除数不能为0”);</p></blockquote><p> <img src="/./../images/21faac47929e4b2ca89bbeb0eedebf1e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="自定义异常">自定义异常</span></h2><h3><span id="自定义运行时异常">自定义运行时异常</span></h3><h4><span id="写法">写法：</span></h4><blockquote><ol><li>继承自RuntimeException</li><li>构造方法：无参，有参</li><li>抛出：throw new 异常类(“xxx”)创建异常对象并抛出</li></ol></blockquote><h4><span id="语法">语法：</span></h4><p><img src="/./../images/39f6abb18f74470dbb4a72a0378ccabf.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="自定义编译时异常">自定义编译时异常</span></h3><h4><span id="写法">写法：</span></h4><blockquote><ol><li>继承自Exception</li><li>构造方法：无参，有参</li><li>抛出：throw new 异常类(“xxx”)创建异常对象并抛出</li></ol></blockquote><h4><span id="语法">语法：</span></h4><p><img src="/./../images/af4e719103244b81b0fa9c832dbea738.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/3239505297714810be89995de5376b6c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="泛型">泛型</span></h1><h2><span id="认识">认识</span></h2><blockquote><p>定义类、接口、方法时，同时声明了一个或多个类型变量（如：<e>）称为泛型类，泛型接口，泛型方法，统称为泛型</e></p></blockquote><h2><span id="语法">语法</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayList</span>&lt;E&gt;&#123;</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/d995febc3ec74036ba18a93e02d6cda7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="自定义泛型类">自定义泛型类</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修饰符 class 类名&lt;类型变量, 类型变量, ...&gt; &#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 泛型类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     MyArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">MyArrayList</span>&lt;&gt;();</span><br><span class="line">     list.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">     list.add(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">     list.add(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">     list.remove(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">     System.out.println(list.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyArrayList</span>&lt;E&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ArrayList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.add(e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.remove(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> list.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="自定义泛型接口">自定义泛型接口</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修饰符 interface 接口名&lt;类型变量, 类型变量, ...&gt; &#123;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        MyInterface&lt;String&gt; myInterface = <span class="keyword">new</span> <span class="title class_">MyInterfaceClass</span>&lt;&gt;();</span><br><span class="line">        myInterface.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        myInterface.add(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        System.out.println(myInterface.remove(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line">        System.out.println(myInterface.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MyInterface</span>&lt;E&gt;&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E e)</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(E e)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyInterfaceClass</span> &lt;E&gt; <span class="keyword">implements</span> <span class="title class_">MyInterface</span>&lt;E&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;E&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        list.add(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(E e)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.remove(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;MyInterfaceClass&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;list=&quot;</span> + list +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="泛型方法">泛型方法</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">修饰符 &lt;类型变量, 类型变量, ...&gt; 返回值类型 方法名(参数列表) &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/35b9a0e309b14de997f4507032ef5594.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="通配符">通配符</span></h2><h3><span id="语法">语法</span></h3><h4><span id="定义"><strong>定义 ：</strong></span></h4><blockquote><p>就是“?”,可以在“使用泛型”的时候代表一切类型</p></blockquote><h4><span id="泛型上下限"><strong>泛型上下限：</strong></span></h4><h5><span id="上限">上限：</span></h5><p>语法 ：</p><blockquote><p>？extend A </p></blockquote><p>解释 ： 能接收到的是A或者其子类</p><h5><span id="下限">下限：</span></h5><blockquote><p>？super A</p></blockquote><p>解释： ？能接收到的是A或者其父类</p><h3><span id="例子">例子</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ArrayList&lt;girl&gt; girls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        girls.add(<span class="keyword">new</span> <span class="title class_">girl</span>());</span><br><span class="line">        girls.add(<span class="keyword">new</span> <span class="title class_">girl</span>());</span><br><span class="line">        go(girls);</span><br><span class="line">        ArrayList&lt;boy&gt; boys = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); </span><br><span class="line">        boys.add(<span class="keyword">new</span> <span class="title class_">boy</span>());</span><br><span class="line">        boys.add(<span class="keyword">new</span> <span class="title class_">boy</span>());</span><br><span class="line">        go(boys);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ? : 通配符</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">go</span><span class="params">(ArrayList&lt;? extends Student&gt; cars)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">girl</span> <span class="keyword">extends</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">boy</span> <span class="keyword">extends</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="泛型支持的类型">泛型支持的类型</span></h2><h3><span id="概念">概念</span></h3><p>泛型不支持基本数据类型，只能支持对象类型（引用数据类型）</p><p><img src="/./../images/adaf728998a74308bccbbd3f8a46de5d.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p> 泛型底层是用Object来接数据</p><h3><span id="包装类">包装类</span></h3><h4><span id="概念">概念</span></h4><blockquote><p>自动包装 ： 基本数据类型可以自动转换为包装类型</p><p>自动拆箱 ：把包装类型的对象直接给基本数据类型的数据</p></blockquote><table><thead><tr><th>基本数据类型</th><th>对应包装类</th></tr></thead><tbody><tr><td>byte</td><td>Byte</td></tr><tr><td>short</td><td>Short</td></tr><tr><td>int</td><td>Integer</td></tr><tr><td>long</td><td>Long</td></tr><tr><td>char</td><td>Character</td></tr><tr><td>float</td><td>Float</td></tr><tr><td>double</td><td>Double</td></tr><tr><td>boolean</td><td>Boolean</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 手工包装</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">it1</span> <span class="operator">=</span> Integer.valueOf(<span class="number">21</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">it2</span> <span class="operator">=</span> Integer.valueOf(<span class="number">21</span>);</span><br><span class="line">System.out.println(it1 == it2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动包装 ： 基本数据类型可以自动转换为包装类型</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">it3</span> <span class="operator">=</span> <span class="number">21</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">it4</span> <span class="operator">=</span> <span class="number">21</span>;</span><br><span class="line">System.out.println(it3 == it4);</span><br><span class="line"><span class="comment">// 自动拆箱 ：把包装类型的对象直接给基本数据类型的数据</span></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> it3;</span><br><span class="line">System.out.println(i);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>eg:</p><blockquote><ul><li>ArrayList<byte> bytes &#x3D; new ArrayList&lt;&gt;();</byte></li><li>ArrayList<short> shorts &#x3D; new ArrayList&lt;&gt;();</short></li><li>ArrayList<integer> integers &#x3D; new ArrayList&lt;&gt;();</integer></li><li>ArrayList<long> longs &#x3D; new ArrayList&lt;&gt;();</long></li><li>ArrayList<float> floats &#x3D; new ArrayList&lt;&gt;();</float></li><li>ArrayList<double> doubles &#x3D; new ArrayList&lt;&gt;();</double></li><li>ArrayList<character> characters &#x3D; new ArrayList&lt;&gt;();</character></li><li>ArrayList<boolean> booleans &#x3D; new ArrayList&lt;&gt;();</boolean></li></ul></blockquote><h4><span id="功能">功能：</span></h4><blockquote><p>Integer.toString() : 基本类型转字符串</p><p>Integer.parseInt() : 字符串转基本数据类型</p><p>Integer.valueOf() : 字符串转基本类型</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 1.把基本类型的数据转换成字符串</span></span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">921</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> Integer.toString(j);</span><br><span class="line">System.out.println(str + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Integer</span> <span class="variable">it5</span> <span class="operator">=</span> j;</span><br><span class="line"><span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> it5.toString();</span><br><span class="line">System.out.println(str1 + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.把字符串数值转换成对应的基本数据类型</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;12345&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> Integer.parseInt(str2);</span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> Integer.valueOf(str2);</span><br><span class="line">System.out.println(x + <span class="number">1</span>);</span><br><span class="line">System.out.println(y + <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>Byte 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span> <span class="title function_">parseByte</span><span class="params">(String s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Byte <span class="title function_">valueOf</span><span class="params">(<span class="type">byte</span> b)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Byte <span class="title function_">valueOf</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> Short 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">short</span> <span class="title function_">parseShort</span><span class="params">(String s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Short <span class="title function_">valueOf</span><span class="params">(<span class="type">short</span> s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Short <span class="title function_">valueOf</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> Integer 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">parseInt</span><span class="params">(String s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> Long 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">parseLong</span><span class="params">(String s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">valueOf</span><span class="params">(<span class="type">long</span> l)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">valueOf</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> Float 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">float</span> <span class="title function_">parseFloat</span><span class="params">(String s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Float <span class="title function_">valueOf</span><span class="params">(<span class="type">float</span> f)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Float <span class="title function_">valueOf</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> Double 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">parseDouble</span><span class="params">(String s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Double <span class="title function_">valueOf</span><span class="params">(<span class="type">double</span> d)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Double <span class="title function_">valueOf</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> Boolean 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">parseBoolean</span><span class="params">(String s)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">valueOf</span><span class="params">(<span class="type">boolean</span> b)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">valueOf</span><span class="params">(String s)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> Character 类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">toUpperCase</span><span class="params">(<span class="type">char</span> ch)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">toLowerCase</span><span class="params">(<span class="type">char</span> ch)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Character <span class="title function_">valueOf</span><span class="params">(<span class="type">char</span> c)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h1><span id="集合">集合</span></h1><h2><span id="集合体系">集合体系</span></h2><p><img src="/./../images/1c79f34b2b1a4182a9cf89e24be28061.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="语法">语法</span></h2><p><a href="https://blog.csdn.net/m0_73569492/article/details/133365650?ops_request_misc=%7B%22request_id%22:%22666F25AF-998A-4B0E-A806-FBC04DE8562E%22,%22scm%22:%2220140713.130102334.pc_blog.%22%7D&request_id=666F25AF-998A-4B0E-A806-FBC04DE8562E&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-133365650-null-null.nonecase&utm_term=java&spm=1018.2226.3001.4450">Java语法学习总结-CSDN博客文章浏览阅读83次。Java学习语法总结<img src="/./../images/favicon32.x-icon" alt=" ">https://blog.csdn.net/m0_73569492&#x2F;article&#x2F;details&#x2F;133365650?ops_request_misc&#x3D;%257B%2522request%255Fid%2522%253A%2522666F25AF-998A-4B0E-A806-FBC04DE8562E%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id&#x3D;666F25AF-998A-4B0E-A806-FBC04DE8562E&amp;biz_id&#x3D;0&amp;utm_medium&#x3D;distribute.pc_search_result.none-task-blog-2<del>blog</del>first_rank_ecpm_v1~rank_v31_ecpm-1-133365650-null-null.nonecase&amp;utm_term&#x3D;java&amp;spm&#x3D;1018.2226.3001.4450</a></p><h3><span id="迭代">迭代</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Collection&lt;String&gt; c = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">c.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">c.add(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">c.add(<span class="string">&quot;java&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代 ： 遍历容器</span></span><br><span class="line">Iterator&lt;String&gt; it = c.iterator();</span><br><span class="line"><span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> it.next();</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Iterator&lt;String&gt; it1 = c.iterator(); it1.hasNext();) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> it1.next();</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (String s : c) &#123;</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="collection">Collection  <img src="/./../images/7d174ac7f18b4ed7add99b55c21c6df7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></span></h3><h3><span id="map">map</span></h3><p><img src="/./../images/1a43d99e8da845e9bdf51e9301cd66f3.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="stream流">Stream流</span></h1><h2><span id="概念">概念</span></h2><h3><span id="认识stream流">认识Stream流</span></h3><p>在Java中，Stream 是一个来自Java 8的新特性，它<strong>提供了一种高效且易于使用的处理数据的方式，尤其是集合数据</strong>。Stream API支持并行操作，可以极大地提高处理大量数据时的性能。下面是一些关于Java Stream的基本概念和用法：</p><blockquote><p><strong>源(Source):</strong> 数据源可以是集合(Collection)、数组(Array)或是任何提供数据的接口。</p><p><strong>管道(Pipeline):</strong> Stream API的操作都是通过一系列称为“管道”的方法调用来完成的。这些操作可以分为中间操作(Intermediate operations)和终端操作(Terminal operations)。</p><p><strong>中间操作：</strong>如filter, map, flatMap等，它们返回一个新的流，并且可以链接起来形成流水线。</p><p><strong>终端操作：</strong>如forEach, collect, reduce, toArray等，执行这个操作后会从流产生结果，之后流不能再被使用。</p><p><strong>内部迭代：</strong>与传统的外部迭代（例如使用for-each循环）不同，Stream API采用内部迭代的方式来遍历元素。</p></blockquote><h3><span id="优势">优势</span></h3><p>Stream流结合Lambda的语法风格来编程，功能强大，性能高效，代码简洁，可读性好</p><blockquote><p><strong>1.简化代码：</strong>使用Stream流，可以通过更简洁的代码实现复杂的数据处理逻辑，减少了传统循环和条件语句的使用，使得代码更加清晰易懂。</p><p><strong>2.提高可读性：</strong>Stream API的设计采用了函数式编程的思想，使得代码的意图更加明确。通过组合多个操作（如filter、map、reduce等），可以创建出易于理解的表达式。</p><p><strong>3.提高性能：</strong>Stream流内部使用了优化的迭代器，并且支持延迟执行（Lazy Evaluation）。这意味着只有当执行终端操作时，中间操作才会被执行，从而可能减少不必要的计算。</p><p><strong>4.内置并行处理：</strong>Stream API支持并行流（Parallel Streams），可以在多核处理器上并行处理数据，无需显式管理多线程，即可提高处理大数据集时的性能。</p><p><strong>5.不变性：</strong>Stream操作通常不会修改源数据结构，而是生成新的结果。这种不可变性有助于避免副作用，并且在多线程环境中更容易实现安全的数据处理。</p><p><strong>6.统一的API：</strong>Stream API为不同的数据源提供了一致的处理方式，无论是集合、数组还是其他数据源，都可以使用相同的流操作进行处理。</p><p><strong>7.延迟加载：</strong>对于某些数据源（如无限流或远程数据流），Stream API允许按需处理数据，即只在需要时才加载和处理数据的一部分，这有助于节省内存和提高效率。</p></blockquote><h3><span id="初识stream流">初识Stream流</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       list.add(<span class="string">&quot;马亮&quot;</span>);</span><br><span class="line">       list.add(<span class="string">&quot;周正&quot;</span>);</span><br><span class="line">       list.add(<span class="string">&quot;成朗&quot;</span>);</span><br><span class="line">       list.add(<span class="string">&quot;周末&quot;</span>);</span><br><span class="line">       list.add(<span class="string">&quot;安安&quot;</span>);</span><br><span class="line">       list.add(<span class="string">&quot;小波&quot;</span>);</span><br><span class="line">       list.add(<span class="string">&quot;小明&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 需求 ：将集合中周开头且名字为两个字的名字放在一个集合里面去</span></span><br><span class="line">       <span class="comment">// 传统写法</span></span><br><span class="line">       List&lt;String&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       <span class="keyword">for</span> (String name : list) &#123;</span><br><span class="line">           <span class="keyword">if</span>(name.startsWith(<span class="string">&quot;周&quot;</span>) &amp;&amp; name.length() == <span class="number">2</span>)&#123;</span><br><span class="line">               list2.add(name);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(list2);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// Stream流写法</span></span><br><span class="line">       <span class="type">List</span> <span class="variable">newList</span> <span class="operator">=</span> list.stream().filter(name -&gt; name.startsWith(<span class="string">&quot;周&quot;</span>)).</span><br><span class="line">               filter(name -&gt; name.length() == <span class="number">2</span>).collect(Collectors.toList());</span><br><span class="line">       System.out.println(newList);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// Stream流写法</span></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="stream流的使用步骤">Stream流的使用步骤</span></h2><p><img src="/./../images/8adfb1c439c54d01bec63123133bdadc.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><blockquote><h3><span id="1-创建stream">1. 创建Stream:</span></h3><p>​    从集合（如List, Set等）、数组或其他数据源创建一个Stream。这通常是通过调用集合的stream()或者parallelStream()方法来实现的，也可以使用Arrays.stream(array)来从数组创建流。</p><h3><span id="2中间操作">2.中间操作:</span></h3><p>中间操作是对流进行的一系列操作，它们可以被链接在一起。常见的中间操作包括：</p><ul><li><strong>filter(Predicate<t> predicate): 过滤流中的元素。</t></strong></li><li><strong>map(Function&lt;T, R&gt; mapper): 将流中的元素映射为另一个流。</strong></li><li><strong>flatMap(Function&lt;T, Stream<r>&gt; mapper): 将流中的每个值都转换为一个流，然后将所有的流连接成一个流。</r></strong></li><li><strong>sorted(), sorted(Comparator<t> comparator): 对流中的元素进行排序。</t></strong></li><li><strong>distinct(): 去除重复的元素。</strong></li></ul><p>中间操作返回一个新的流，因此可以链式调用。</p><h3><span id="3-终端操作">3. 终端操作:</span></h3><p>终端操作会消费流并产生结果。常见的终端操作包括：</p><ul><li><strong>forEach(Consumer<t> action): 对流中的每个元素执行一个动作。</t></strong></li><li><strong>collect(Collector&lt;T,A,R&gt; collector): 将流转换为另一种形式，如转换为集合。</strong></li><li><strong>reduce(BinaryOperator<t>), reduce(T identity, BinaryOperator<t>): 对流中的元素进行归约。</t></t></strong></li><li><strong>anyMatch(Predicate<t>), allMatch(Predicate<t>), noneMatch(Predicate<t>): 检查是否至少&#x2F;全部&#x2F;没有一个元素满足条件。</t></t></t></strong></li><li><strong>findFirst(), findAny(): 查找第一个&#x2F;任意一个元素。</strong></li><li><strong>count(): 计算流中的元素数量。</strong></li><li><strong>max(Comparator<t>), min(Comparator<t>): 找到最大&#x2F;最小元素。</t></t></strong></li></ul><p>终端操作执行后，流会被消费掉，不能再次使用。</p><h3><span id="4可选的管道操作">4.可选的管道操作:</span></h3><p>在中间操作和终端操作之间，还可以插入一些其他操作来改变流的行为，例如peek(Consumer<t> action)用于调试，它会在每个元素传递给下一个操作之前执行一个动作。</t></p></blockquote><h2><span id="stream流具体操作">Stream流具体操作</span></h2><h3><span id="1-获取数据流">1. 获取数据流</span></h3><blockquote><ul><li>获取集合的数据流（Collection）: default Stream<e> stream();</e></li></ul><p>​           </p><ul><li>获取Map集合的Stream流</li></ul><p>​            1. 获取键流 ： map.keySet().stream()</p><p>​             2.获取值流 : map.values().stream()</p><p>​             3.获取键值对流 : map.entrySet().stream()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map集合，获取Stream流</span></span><br><span class="line"> Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"> <span class="comment">// 1. 获取键流</span></span><br><span class="line"> Stream&lt;String&gt; keyStream = map.keySet().stream();</span><br><span class="line"> <span class="comment">// 2. 获取值流</span></span><br><span class="line"> Stream&lt;Integer&gt; valueStream = map.values().stream();</span><br><span class="line"> <span class="comment">// 3. 获取键值对流</span></span><br><span class="line"> Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; entryStream = map.entrySet().stream();</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><ul><li>获取数组的数据流：</li></ul><p>​            <strong>Arrays类</strong> ( static <t> Stream<t> stream(T[] array)):</t></t></p><p>​                     <strong>Arrays.stream()</strong>      </p><p>​            <strong>Stream类</strong>(default Stream<t> of(T… values);): </t></p><p>​                     <strong>Stream.of()</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Arrays类 : static &lt;T&gt; Stream&lt;T&gt; stream(T[] array);</span></span><br><span class="line">String[] names = &#123;<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;李四&quot;</span>, <span class="string">&quot;王五&quot;</span>&#125;;</span><br><span class="line">Stream&lt;String&gt; stream = Arrays.stream(names);</span><br><span class="line">System.out.println(stream.count());</span><br><span class="line"><span class="comment">// Stream类 : default Stream&lt;T&gt; stream(T... values);</span></span><br><span class="line">Stream&lt;String&gt; steam2 = Stream.of(names);</span><br><span class="line">System.out.println(steam2.count());</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p></blockquote><h3><span id="2中间方法调用各种方法对数据流进行处理">2.中间方法(调用各种方法对数据流进行处理)</span></h3><ul><li><strong>filter(Predicate&lt;? super T&gt; predicate) :</strong> 筛选，接收Lambda，从流中排除某些元素</li><li><strong>map(Function&lt;? super T, ? extends R&gt; mapper) :</strong> 映射，接收Lambda，将元素转换成其他形式或提取信息，接收一个函数作为参数，该函数会被应用到每个元素上，并将其映射成一个新的元素。</li><li><strong>distinct()</strong> : 去重，流中所有元素都是唯一的</li><li><strong>limit(long maxSize)</strong> : 截断流，使其元素不超过给定数量</li><li><strong>skip(long n) :</strong> 跳过元素，返回一个扔掉了前n个元素的流，若流中元素不足n个，则返回一个空流，与limit(n)互补</li><li><strong>sorted() :</strong> 排序，自然排序（Comparable）或定制排序（Comparator）</li><li><strong>skip(long n) :</strong> 跳过元素，返回一个扔掉了前n个元素的流，若流中元素不足n个，则返回一个空流，与limit(n)互补</li><li><strong>concat(Stream&lt;? extends T&gt; a, Stream&lt;? extends T&gt; b) :</strong> 合并两个流</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Double&gt; scores = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">scores.add(<span class="number">15.2</span>);</span><br><span class="line">scores.add(<span class="number">19.21</span>);</span><br><span class="line">scores.add(<span class="number">9.21</span>);</span><br><span class="line">scores.add(<span class="number">12.21</span>);</span><br><span class="line">scores.add(<span class="number">9.21</span>);</span><br><span class="line"><span class="comment">// 降序</span></span><br><span class="line">scores.stream().sorted((s1, s2)-&gt;Double.compare(s2, s1)).forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"><span class="comment">// 升序</span></span><br><span class="line">scores.stream().sorted((s1, s2)-&gt;Double.compare(s1, s2)).forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"><span class="comment">// 只要前两名</span></span><br><span class="line">scores.stream().sorted((s1, s2)-&gt;Double.compare(s2, s1)).limit(<span class="number">2</span>).forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"><span class="comment">// 跳过前两名</span></span><br><span class="line">scores.stream().sorted((s1, s2)-&gt;Double.compare(s2, s1)).skip(<span class="number">2</span>).forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"><span class="comment">// 去重 : 如果是自定义对象，就需要重写其hashCode和equals方法</span></span><br><span class="line">scores.stream().distinct().forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"><span class="comment">// 映射/加工 ： 把流上的数据拿出来变成新数据又放到流上去</span></span><br><span class="line">scores.stream().map(score-&gt;score*<span class="number">2</span>).forEach(System.out::println);</span><br><span class="line">System.out.println(<span class="string">&quot;-------------------&quot;</span>);</span><br><span class="line"><span class="comment">// 合并 : a、b两个流合并</span></span><br><span class="line">Stream&lt;String&gt; a = Stream.of(<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line">Stream&lt;String&gt; b = Stream.of(<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>,<span class="string">&quot;f&quot;</span>);</span><br><span class="line">Stream.concat(a,b).forEach(System.out::println);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="3终结方法获取处理的结果">3.终结方法（获取处理的结果）</span></h3><p><strong>1. forEach：</strong></p><p>void forEach(Consumer action) 用于遍历流中的每个元素，并对每个元素应用一个动作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scores.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <strong>2. count：</strong><br> long count() 用于计算流中的元素数量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> scores.stream().count();</span><br><span class="line">System.out.println(<span class="string">&quot;Count: &quot;</span> + count);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>3. reduce</strong><br> Optional<t> reduce(BinaryOperator) 用于将流中的元素反复结合起来，得到一个单一的结果。</t></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Double&gt; maxScore = scores.stream().reduce(Double::max);</span><br><span class="line">maxScore.ifPresent(System.out::println);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>4. anyMatch, allMatch, noneMatch</strong><br> 这些方法分别用于检查是否至少有一个元素、所有元素、没有元素满足给定的条件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">hasScoresAboveTen</span> <span class="operator">=</span> scores.stream().anyMatch(score -&gt; score &gt; <span class="number">10</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;Has scores above ten: &quot;</span> + hasScoresAboveTen);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>5. findFirst, findAny</strong><br> Optional<t> findFirst() 和 Optional<t> findAny() 分别用于获取流中的第一个元素和任意一个元素。</t></t></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Double&gt; firstScore = scores.stream().findFirst();</span><br><span class="line">firstScore.ifPresent(System.out::println);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>6.max</strong></p><p>这里 T 是流中的元素类型，comparator 是一个比较器，用于确定元素之间的大小关系。如果你的元素实现了 Comparable 接口，你可以直接传递 (Comparator.naturalOrder())。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;T&gt; <span class="title function_">max</span><span class="params">(Comparator&lt;? <span class="built_in">super</span> T&gt; comparator)</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>7.min</strong></p><p>与 max 方法类似，Stream API 中的 min 方法用于查找流中的最小元素。min 方法同样返回一个 Optional 对象，这样可以在流为空的情况下避免 NullPointerException。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;T&gt; <span class="title function_">min</span><span class="params">(Comparator&lt;? <span class="built_in">super</span> T&gt; comparator)</span>;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="4收集stream流">4.收集Stream流</span></h3><p>把Stream流操作后的结果转回到集合或者数组中去返回</p><p>Stream流：方便操作集合&#x2F;数组的手段</p><p>集合&#x2F;数组: 开发的目的</p><p> <strong>1. collect：</strong><br> R collect(Collector collector) 用于将流中的元素收集到一个容器中，如 List 或 Set。</p><blockquote><ul><li>collect(Collectors.toMap(Key, Value))</li><li>collect(Collectors.toList())</li><li>collect(Collectors.toSet())</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Double&gt; sortedScores = scores.stream()</span><br><span class="line">                                  .sorted()</span><br><span class="line">                                  .collect(Collectors.toList());</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; persons = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">     persons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">18</span>, <span class="string">&quot;北京&quot;</span>));</span><br><span class="line">     persons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;李四&quot;</span>, <span class="number">19</span>, <span class="string">&quot;上海&quot;</span>));</span><br><span class="line">     persons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;王五&quot;</span>, <span class="number">20</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line">     persons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;赵六&quot;</span>, <span class="number">21</span>, <span class="string">&quot;深圳&quot;</span>));</span><br><span class="line"></span><br><span class="line">      Map&lt;String, Integer&gt; newmap1 = persons.stream().collect(Collectors.toMap(Person::getName, Person::getAge));</span><br><span class="line">      System.out.println(newmap1);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <strong>2. toArray</strong><br> T[] toArray(IntFunction arrayCreator) 用于将流中的元素收集到数组中。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Double[] scoreArray = scores.stream().toArray(Double[]::<span class="keyword">new</span>);</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id></span></h1><h1><span id></span></h1><h1><span id="补充知识">补充知识：</span></h1><h2><span id="可变参数">可变参数</span></h2><p>可变参数：</p><blockquote><p>​    <strong>数据类型…参数名称</strong></p></blockquote><p>可变参数可以接收0个至多个参数以及数组</p><p><strong>注意：</strong></p><blockquote><ol><li>可变参数在方法内部就是一个数组</li><li>一个形参列表中可变参数只能有一个</li><li>可变参数必须放在形参列表的最后面</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">        sum();</span><br><span class="line">        <span class="type">int</span>[] num = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">        sum(num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span>...num)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : num) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">        System.out.println(num.length);</span><br><span class="line">        System.out.println(Arrays.toString(num));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="collections工具类">Collections工具类</span></h2><p>用来操作集合的工具类</p><h3><span id="常用方法">常用方法</span></h3><p>addAll:给集合批量添加元素</p><p>shuffle:打乱List集合中的元素顺序</p><p>sort：对List集合中的元素进行排序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Collections.addAll(list, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;java&quot;</span>, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        Collections.shuffle(list);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="方法">方法</span></h3><p>1.排序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sort(List&lt;T&gt; list): 对列表进行自然排序。</span><br><span class="line">reverse(List&lt;T&gt; list): 反转列表元素的顺序。</span><br><span class="line">shuffle(List&lt;T&gt; list): 随机打乱列表元素的顺序。</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>2.查找</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">binarySearch(List&lt;T&gt; list, T key): 使用二分查找法查找指定元素的位置。</span><br><span class="line">max(Collection&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; coll): 返回集合中的最大元素。</span><br><span class="line">min(Collection&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; coll): 返回集合中的最小元素。</span><br><span class="line">indexOfSubList(List&lt;T&gt; list, List&lt;T&gt; subList): 返回子列表在列表中的索引位置。</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><ol start="3"><li>比较</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">disjoint(Collection&lt;?&gt; c1, Collection&lt;?&gt; c2): 判断两个集合是否没有交集。</span><br><span class="line">equalsIgnoreOrder(List&lt;T&gt; list1, List&lt;T&gt; list2): 比较两个列表的内容是否相同（忽略顺序）</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>4.操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rotate(List&lt;T&gt; list, <span class="type">int</span> distance): 旋转列表元素。</span><br><span class="line">swap(List&lt;T&gt; list, <span class="type">int</span> i, <span class="type">int</span> j): 交换列表中两个位置的元素。</span><br><span class="line">copy(List&lt;T&gt; dest, List&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; src): 复制列表内容到另一个列表。</span><br><span class="line">unmodifiableCollection(Collection&lt;T&gt; c): 创建不可修改的集合。</span><br><span class="line">unmodifiableList(List&lt;T&gt; list): 创建不可修改的列表。</span><br><span class="line">unmodifiableMap(Map&lt;K,V&gt; m): 创建不可修改的映射。</span><br><span class="line">unmodifiableSet(Set&lt;T&gt; s): 创建不可修改的集合。</span><br><span class="line">frequency(Collection&lt;T&gt; collection, Object element): 计算集合中某个元素出现的次数。</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h1><span id="file文件操作">File（文件操作）</span></h1><h2><span id="概念">概念</span></h2><h3><span id="file">File</span></h3><blockquote><p>File是java.io.包下的类，File类的对象，用于代表当前操作系统的文件（文件，文件夹）</p><p>File类 ： 只能对文件本身进行操作，不能读写文件里面存储的数据</p></blockquote><h3><span id="io流">IO流</span></h3><blockquote><p>用来读写数据（可以读写文件或网络中的数据）</p></blockquote><h2><span id="file类语法">File类语法</span></h2><h3><span id="创建file类的对象">创建File类的对象</span></h3><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td><strong>public File(String pathname)</strong></td><td>路径可以是相对路径，也可以是绝对路径</td></tr><tr><td><strong>public File(String parent, String child)</strong></td><td>父目录，子目录</td></tr><tr><td><strong>public File(File parent, String child)</strong></td><td>父目录，子目录</td></tr></tbody></table><blockquote><p> <strong>定义：</strong></p><p> ​     File类的对象可以代表文件&#x2F;文件夹，并可以调用其提供的方法对象文件进行操作</p><p> <strong>绝对路径：</strong></p><p> ​    绝对路径是从文件系统的根目录开始，到目标文件或目录的完整路径（带盘符）</p><p> <strong>相对路径：</strong></p><p> ​    相对路径是指相对于当前工作目录的位置，它不从根目录开始，而是从某个已知的目录开始（在idea中，默认是到你idea工程下直接寻找文件的）</p><p> <strong>特殊符号：</strong></p><ul><li>.&#x2F; 表示当前目录。</li><li>..&#x2F; 表示父目录。</li><li>在Linux&#x2F;Unix中，&#x2F; 表示根目录。</li></ul></blockquote><p> <img src="/./../images/e86b5cc67bcd4211968e080458879db0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="创建文件">创建文件</span></h3><table><thead><tr><th>方法名称</th><th>说明</th></tr></thead><tbody><tr><td><strong>createNewFile()</strong></td><td>创建一个新的空的文件</td></tr><tr><td><strong>mkdir()</strong></td><td>只能创建一级文件夹</td></tr><tr><td><strong>mkdirs()</strong></td><td>可以创建多级文件夹</td></tr></tbody></table><p><img src="/./../images/4a60288f98ba44b4ad5f06a03e799e3b.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="删除文件或文件夹">删除文件或文件夹</span></h3><table><thead><tr><th><strong>方法名称</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>delete()</strong></td><td>删除文件或空文件夹</td></tr></tbody></table><p> <img src="/./../images/9e8c6c208d304361bc42ccb4c55f10f1.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><strong>注意：</strong></p><blockquote><p>delete方法默认只能删除文件和空文件夹，删除后的文件不会进入回收站</p></blockquote><h3><span id="遍历文件目录并获取文件">遍历文件目录并获取文件</span></h3><table><thead><tr><th><strong>方法名称</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>list()</strong></td><td>获取某个目录下的全部一级文件名称</td></tr><tr><td><strong>listFiles()</strong></td><td>获取某个目录下的全部一级文件对象</td></tr></tbody></table><p> <strong>listFiles方法注意事项：</strong></p><blockquote><p>1.空目录处理：<br>如果调用 listFiles() 的 File 对象表示的是一个空目录，则会返回一个长度为零的数组（即 File[0]）</p><p>2.文件过滤：</p><p>​    可以通过传递一个 FilenameFilter 或者 FileFilter 实例给 listFiles() 来过滤文件列表。例如，只列出特定类型的文件或满足某些条件的文件。<br>使用 FilenameFilter 或 FileFilter 时，确保实现了正确的接口，并且过滤逻辑正确无误。</p><p>3.文件不存在或不是目录：<br>如果 File 对象表示的不是一个目录或者该文件不存在，listFiles() 方法可能会返回 null。因此，在使用返回值之前应该检查是否为 null。<br>也可以通过 isDirectory() 方法来确认 File 对象确实代表一个目录。</p><p>4.权限问题：<br>当没有足够的权限访问目录或其内容时，listFiles() 可能会返回 null 或抛出 SecurityException。</p><p>5.异常处理：<br>在某些情况下，如文件系统错误或安全限制，listFiles() 可能会抛出 NullPointerException 或其他异常。应适当处理这些异常情况。</p><p>6.递归遍历：<br>如果需要递归地遍历目录结构，可以考虑使用 FileVisitor 接口与 Files.walkFileTree 方法，或者使用 Apache Commons IO 库中的 FileUtils.listFiles 方法。</p></blockquote><p><img src="/./../images/9e855a4f36284975a4eb2a98c164276a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>案例：查找文件并启动文件 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Findfile</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/&quot;</span>);</span><br><span class="line">            findfile(dir, <span class="string">&quot;HBuilderX.exe&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">      dir: 搜索的目录</span></span><br><span class="line"><span class="comment">      name: 要搜索的文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">findfile</span><span class="params">(File dir, String name)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (dir == <span class="literal">null</span> || !dir.exists() || dir.isFile()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;目录不存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取目录下的所有一级文件或文件夹</span></span><br><span class="line">        File[] files = dir.listFiles();</span><br><span class="line">        <span class="keyword">if</span> (files != <span class="literal">null</span> &amp;&amp; files.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="comment">//System.out.println(&quot;当前目录：&quot; + dir.getAbsolutePath());</span></span><br><span class="line">            <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">                <span class="keyword">if</span> (file != <span class="literal">null</span> &amp;&amp; file.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// 如果是文件</span></span><br><span class="line">                    <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (file.getName().contains(name)) &#123;</span><br><span class="line">                            System.out.println(<span class="string">&quot;找到目标文件在：&quot;</span> + file.getAbsolutePath());</span><br><span class="line">                            <span class="comment">// 启动程序</span></span><br><span class="line">                            <span class="type">Runtime</span> <span class="variable">r</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">                            r.exec(file.getAbsolutePath());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        findfile(file, name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="字符集">字符集</span></h2><h3><span id="介绍">介绍</span></h3><blockquote><p><strong>1.ASCII</strong> (American Standard Code for Information Interchange):<br>ASCII 是最早的字符编码标准之一，它使用7位来表示128个字符，包括英文字母、阿拉伯数字、标点符号及一些控制字符。</p><p><strong>2.GBK</strong> (GB2312-80):<br>GBK 是GB2312的一个扩展版本，它兼容GB2312，并且增加了对繁体中文的支持，以及更多的符号和字符。</p><p><strong>3.Unicode (统一码、万国码):</strong><br>Unicode 是一个旨在覆盖世界上所有字符的字符编码标准，它定义了超过10万个字符的位置，包括几乎所有国家的语言文字。Unicode 最常用的编码形式包括 UTF-8、UTF-16 和 UTF-32。</p><p><strong>4.UTF-8 (Unicode Transformation Format):</strong><br>UTF-8 是Unicode的一种变长字符编码，它兼容ASCII，并且可以根据字符的不同，使用1到4个字节来表示一个字符，对于英文等ASCII字符只需要一个字节，而对于其他语言则可能需要更多字节</p></blockquote><h3><span id="编码操作">编码操作</span></h3><table><thead><tr><th>操作</th><th>说明</th></tr></thead><tbody><tr><td>byte[] getBytes()</td><td>使用平台的默认字符编码将此 String 编码为 byte 序列，  并将结果存储到新的 byte 数组中。</td></tr><tr><td>byte[] getBytes(String charsetName)</td><td>使用指定的字符编码将此 String  编码为 byte 序列，并将结果存储到新的 byte 数组中。</td></tr></tbody></table><p><img src="/./../images/94e6d0640ab84b7685cf8c38a3cba48c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="解码操作">解码操作</span></h3><table><thead><tr><th>操作</th><th>说明</th></tr></thead><tbody><tr><td>String(byte[] bytes)</td><td>根据默认平台字符集将指定的 byte 数组解码为 String。</td></tr><tr><td>String(byte[] bytes, String charsetName)</td><td>根据指定的字符集将指定的 byte 数组解码为 String。</td></tr></tbody></table><p><img src="/./../images/0a676a6ca67944b6ab856f8c71b60ba6.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="io流">IO流</span></h1><h2><span id="体系">体系</span></h2><p><img src="/./../images/984f1deea3d946059c62a512dd277aab.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h2><span id="fileinputstream文件字节输入流">FileInputStream(文件字节输入流) :</span></h2><blockquote><p>作用:</p><p>​    以内存为基准，可以把磁盘文件中的数据以字节的形式读入到内存中去（读字节数据到内存）</p></blockquote><h3><span id="构造器">构造器</span></h3><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>public FileInputStream(String path)</td><td>创建字节输入流管道与源文件接通</td></tr><tr><td>public FileInputStream(File file)</td><td>创建字节输入流管道与源文件接通</td></tr></tbody></table><h3><span id="方法">方法</span></h3><table><thead><tr><th>常用方法</th><th>说明</th></tr></thead><tbody><tr><td>public int read()</td><td>从输入流中读取一个字节数据，返回读取的字节，如果发现没有数据可读会返回-1</td></tr><tr><td>public int read(byte[] b)</td><td>从输入流中读入字节数组，  每次最多读b.length个字节，返回实际读取的字节数，如果发现没有数据可读会返回-1</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputStreamDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      FileInputStream(文件字节输入流) :</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      作用: 以内存为基准，可以把磁盘文件中的数据以字节的形式读入到内存中去（读字节数据到内存）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      构造器:</span></span><br><span class="line"><span class="comment">      public FileInputStream(String path) : 创建字节输入流管道与源文件接通</span></span><br><span class="line"><span class="comment">      public FileInputStream(File file) :  创建字节输入流管道与源文件接通</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      常用方法:</span></span><br><span class="line"><span class="comment">      public int read() : 从输入流中读取一个字节数据，返回读取的字节，如果发现没有数据可读会返回-1</span></span><br><span class="line"><span class="comment">      public int read(byte[] b) : 从输入流中读入字节数组，每次最多读b.length个字节，返回实际读取的字节数，如果发现没有数据可读会返回-1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 创建字节输入流管道与源文件接通</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;IO\\src\\test.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.开始读取文件中的字节并输出</span></span><br><span class="line">        <span class="comment">// (1).每次读取一个字节，性能较差，且读入汉字输出会乱码</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> fis.read(); <span class="comment">// 读入一个字节，返回读取的字节，如果发现没有数据可读会返回-1</span></span><br><span class="line">            <span class="keyword">if</span> (b == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print((<span class="type">char</span>) b);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// (2).读取字节数组，每次最多读b.length个字节，返回实际读取的字节数，如果发现没有数据可读会返回-1</span></span><br><span class="line">        <span class="comment">// 依然无法避免读取汉字输出乱码的问题:存在截断汉字字节的可能性</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;IO\\src\\test01.txt&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="comment">// 定义一个变量记住每次读取多少字节</span></span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="keyword">while</span> ((len = fis2.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(b, <span class="number">0</span>, len);</span><br><span class="line">            System.out.print(str);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         读取文本适合字符流，字节流适合做数据的转移</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 使用字节流读取文件时，如何保证不乱码 ：</span></span><br><span class="line">        <span class="comment">// 1.定义一个与文件一样大的字节数组，一次性读取完文件的全部字节</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;IO\\src\\test02.txt&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] b2 = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">int</span> len2;</span><br><span class="line">        <span class="keyword">while</span> ((len2 = fis3.read(b2)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(b2, <span class="number">0</span>, len2);</span><br><span class="line">            System.out.print(str2);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&quot;</span>);</span><br><span class="line">        <span class="comment">// 2.一次性读完文件的全部字节</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;IO\\src\\test03.txt&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] b3 = fis4.readAllBytes();</span><br><span class="line">        <span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(b3);</span><br><span class="line">        System.out.println(str3);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="fileoutputstream文件字节输出流">FileOutputStream(文件字节输出流)</span></h2><blockquote><p>作用 ：</p><p>​    以内存为基准，把内存中的数据以字节的形式写出到文件中去</p></blockquote><h3><span id="构造器">构造器</span></h3><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>public FileOutputStream(File file)</td><td>创建输出流管道与源文件对象接通</td></tr><tr><td>public FileOutputStream(String filepath)</td><td>创建输出流管道与源文件路径接通</td></tr><tr><td>public FileOutputStream(File file, boolean append)</td><td>创建输出流管道与源文件对象接通， 并且可以指定是否追加数据</td></tr><tr><td>public FileOutputStream(String filepath, boolean append)</td><td>创建输出流管道与源文件路径接通， 并且可以指定是否追加数据</td></tr></tbody></table><h3><span id></span></h3><h3><span id="方法">方法</span></h3><table><thead><tr><th>常用方法</th><th>说明</th></tr></thead><tbody><tr><td>public void write(int b)</td><td>写出单个字节数据</td></tr><tr><td>public void write(byte[] b)</td><td>写出字节数组数据</td></tr><tr><td>public void write(byte[] b, int off, int len)</td><td>写出字节数组数据， 并且可以指定写出的开始位置和写出的长度</td></tr><tr><td>public void close()</td><td>关闭输出流管道</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OutputStreamDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     FileOutputStream(文件字节输出流) :</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     作用 ： 以内存为基准，把内存中的数据以字节的形式写出到文件中去</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     1.构造器：</span></span><br><span class="line"><span class="comment">     public FileOutputStream(File file) : 创建输出流管道与源文件对象接通</span></span><br><span class="line"><span class="comment">     public FileOutputStream(String filepath) : 创建输出流管道与源文件路径接通</span></span><br><span class="line"><span class="comment">     public FileOutputStream(File file, boolean append) : 创建输出流管道与源文件对象接通，并且可以指定是否追加数据</span></span><br><span class="line"><span class="comment">     public FileOutputStream(String filepath, boolean append) : 创建输出流管道与源文件路径接通，并且可以指定是否追加数据</span></span><br><span class="line"><span class="comment">     2.方法：</span></span><br><span class="line"><span class="comment">     public void write(int b): 写出单个字节数据</span></span><br><span class="line"><span class="comment">     public void write(byte[] b): 写出字节数组数据</span></span><br><span class="line"><span class="comment">     public void write(byte[] b, int off, int len): 写出字节数组数据，并且可以指定写出的开始位置和写出的长度</span></span><br><span class="line"><span class="comment">     public void close(): 关闭输出流管道</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 写单个字节数据</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;IO\\src\\test05.txt&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="number">9</span>;</span><br><span class="line">        fos.write(b1);</span><br><span class="line">        fos.close(); <span class="comment">// 关闭输出流管道</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写字节数组数据</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;IO\\src\\test06.txt&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;12345wjk520&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] b2 = str2.getBytes();</span><br><span class="line">        fos2.write(b2);</span><br><span class="line">        fos2.close(); <span class="comment">// 关闭输出流管道</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写字节数组数据，并且可以指定写出的开始位置和写出的长度</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;IO\\src\\test07.txt&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;12345wjk520&quot;</span>;</span><br><span class="line">        <span class="type">byte</span>[] b3 = str3.getBytes();</span><br><span class="line">        fos3.write(b3, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">        fos3.close(); <span class="comment">// 关闭输出流管道</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如何实现写出去的数据能换行</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;IO\\src\\test08.txt&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        fos4.write(<span class="string">&quot;5555\r5622\n4554&quot;</span>.getBytes());</span><br><span class="line">        fos4.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;写出完毕！&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="filereader文件字符输入流">FileReader(文件字符输入流)</span></h2><h3><span id="构造器">构造器</span></h3><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td><code>public FileReader(File file)</code></td><td><code>创建字符输入流管道与源文件接通</code></td></tr><tr><td><code>public FileReader(String filePath)</code></td><td><code>创建字符输入流管道与源文件接通</code></td></tr></tbody></table><h3><span id="方法">方法</span></h3><table><thead><tr><th>常用方法</th><th>说明</th></tr></thead><tbody><tr><td><code>public int read()</code></td><td><code>从输入流中读取一个字符，返回读取的字符， 如果发现没有数据可读会返回-1</code></td></tr><tr><td><code>public int read(char[] buffer)</code></td><td><code>从输入流中读取字符数组，返回读取的字符个数， 如果发现没有数据可读会返回-1</code></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReaderDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      FileReader(文件字符输入流) ：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     作用：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     1.构造器 ：</span></span><br><span class="line"><span class="comment">     public FileReader(File file): 创建字符输入流管道与源文件接通</span></span><br><span class="line"><span class="comment">     public FileReader(String filePath): 创建字符输入流管道与源文件接通</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     2.方法：</span></span><br><span class="line"><span class="comment">     public int read(): 从输入流中读取一个字符，返回读取的字符，如果发现没有数据可读会返回-1</span></span><br><span class="line"><span class="comment">     public int read(char[] buffer): 从输入流中读取字符数组，返回读取的字符个数，如果发现没有数据可读会返回-1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="comment">// 1.创建一个文件字符输入流管道与源文件接通</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileReader</span> <span class="variable">fr1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;IO\\src\\test04.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// 读一个字符</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> fr1.read();</span><br><span class="line">                <span class="keyword">if</span> (b == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.print((<span class="type">char</span>) b);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&quot;</span>);</span><br><span class="line">        <span class="comment">// 读多个字符</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileReader</span> <span class="variable">fr2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;IO\\src\\test10.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">char</span>[] b = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">3</span>];</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> fr2.read(b);</span><br><span class="line">                <span class="keyword">if</span> (len == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.print(<span class="keyword">new</span> <span class="title class_">String</span>(b, <span class="number">0</span>, len));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="filewriter文件字符输出流">FileWriter(文件字符输出流)</span></h2><blockquote><p>作用 ：</p><p>​     以内存为基准，把内存中的数据以字符的形式写到文件中去</p></blockquote><h3><span id="构造器">构造器</span></h3><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>public FileWriter(File file)</td><td>创建一个字符输出流管道与原文件对象接通</td></tr><tr><td>public FileWriter(String filepath)</td><td>创建一个字符输出流管道与文件路径接通</td></tr><tr><td>public FileWriter(File file, boolean append)</td><td>创建一个字符输出流与源文件对象接通， 可以追加数据</td></tr><tr><td>public FileWriter(String filepath, boolean append)</td><td>创建一个字符输出流与文件路径接通， 可以追加数据</td></tr></tbody></table><h3><span id></span></h3><h3><span id="方法">方法</span></h3><table><thead><tr><th>常用方法</th><th>说明</th></tr></thead><tbody><tr><td>void wirte(int c)</td><td>写一个字符出去</td></tr><tr><td>void write(String str)</td><td>写一个字符串出去</td></tr><tr><td>void write(String str, int off, int len)</td><td>写一个字符串的一部分出去, off为起点下标，len为长度</td></tr><tr><td>void write(char[] buffer)</td><td>写一个字符数组出去</td></tr><tr><td>void write(char[] buffer, int off, int len)</td><td>写一个字符数组的一部分出去, off为起点下标，len为长度</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WriterDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        FileWriter(文件字符输出流) :</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        作用 ： 以内存为基准，把内存中的数据以字符的形式写到文件中去</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        1. 构造器：</span></span><br><span class="line"><span class="comment">          public FileWriter(File file) : 创建一个字符输出流管道与原文件对象接通</span></span><br><span class="line"><span class="comment">          public FileWriter(String filepath) : 创建一个字符输出流管道与文件路径接通</span></span><br><span class="line"><span class="comment">          public FileWriter(File file, boolean append) : 创建一个字符输出流与源文件对象接通，可以追加数据</span></span><br><span class="line"><span class="comment">          public FileWriter(String filepath, boolean append) :  创建一个字符输出流与文件路径接通，可以追加数据</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        2. 方法：</span></span><br><span class="line"><span class="comment">        void wirte(int c) : 写一个字符出去</span></span><br><span class="line"><span class="comment">        void write(String str) : 写一个字符串出去</span></span><br><span class="line"><span class="comment">        void write(String str, int off, int len) : 写一个字符串的一部分出去, off为起点下标，len为长度</span></span><br><span class="line"><span class="comment">        void write(char[] buffer) : 写一个字符数组出去</span></span><br><span class="line"><span class="comment">        void write(char[] buffer, int off, int len) : 写一个字符数组的一部分出去, off为起点下标，len为长度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 创建一个文件字符输出流管道与源文件接通</span></span><br><span class="line">        <span class="comment">// 写单个字符进去</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">fw1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;IO\\src\\test11.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">            fw1.write(c);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写字符串进去</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">fw2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;IO\\src\\test12.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">            fw2.write(str);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写字符串的一部分进去</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">fw3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;IO\\src\\test13.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">            fw3.write(str, <span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写字符数组进去</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">fw4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;IO\\src\\test14.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">char</span>[] buffer = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>&#125;;</span><br><span class="line">            fw4.write(buffer);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写字符数组的一部分进去</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">fw5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;IO\\src\\test15.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">char</span>[] buffer = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>&#125;;</span><br><span class="line">            fw5.write(buffer, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">            fw5.flush(); <span class="comment">// 刷新缓冲区，将缓冲区中的数据全部写出去</span></span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="缓冲字节流">缓冲字节流</span></h2><h3><span id="bufferedinputstream缓冲字节输入流-x2f-bufferedoutputstream缓冲字节输出流">BufferedInputStream(缓冲字节输入流) &#x2F; BufferedOutputStream(缓冲字节输出流)：</span></h3><blockquote><p>作用: 提高字节输入输出的效率<br>原理：缓冲字节输入流自带了缓冲池，缓冲输出池也自带缓冲池。</p></blockquote><h3><span id="构造器">构造器</span></h3><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>BufferedInputStream(InputStream is)</td><td>把低级的字节输入流包装成高级的缓冲字节输入流， 提高读数据效率</td></tr><tr><td>BufferedOutputStream(OutputStream os)</td><td>把低级的字节输出流包装成高级的缓冲字节输出流， 提高写数据效率</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BufferIsOs</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        缓冲字节流：</span></span><br><span class="line"><span class="comment">        BufferedInputStream(缓冲字节输入流) / BufferedOutputStream(缓冲字节输出流)：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        作用:  提高字节输入输出的效率</span></span><br><span class="line"><span class="comment">        原理：缓冲字节输入流自带了缓冲池，缓冲输出池也自带缓冲池。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        1. 构造器</span></span><br><span class="line"><span class="comment">         BufferedInputStream(InputStream is) ：把低级的字节输入流包装成高级的缓冲字节输入流，提高读数据效率</span></span><br><span class="line"><span class="comment">         BufferedOutputStream(OutputStream os) ：把低级的字节输出流包装成高级的缓冲字节输出流，提高写数据效率</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span>(</span><br><span class="line">              <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;IO\\src\\test.txt&quot;</span>);</span><br><span class="line">              <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;IO\\src\\test16.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">              <span class="comment">// 把低级的字节输入流包装成高级的缓冲字节输入流</span></span><br><span class="line">              <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(fis);</span><br><span class="line">              <span class="comment">// 把低级的字节输出流包装成高级的缓冲字节输出流</span></span><br><span class="line">              <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(fos);)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 读数据</span></span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span>((len = bis.read(b)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">// 输出数据</span></span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(b, <span class="number">0</span>, len));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 写数据</span></span><br><span class="line">            bos.write(<span class="string">&quot;hello world&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="缓冲字符流">缓冲字符流</span></h2><h3><span id="bufferedreader缓冲字符输入流x2fbufferedwriter缓冲字符输出流">BufferedReader(缓冲字符输入流)&#x2F;BufferedWriter(缓冲字符输出流)</span></h3><blockquote><p>作用：自带字符缓冲池</p></blockquote><h3><span id="构造器">构造器</span></h3><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>public BufferedReader(Reader r)</td><td>把低级的字符输入流包装成高级的缓冲字符输入流</td></tr><tr><td>public BufferedWriter(Writer w)</td><td>把低级的字符输出流包装成高级的缓冲字符输出流</td></tr></tbody></table><h3><span id="缓冲输入流新增">缓冲输入流新增</span></h3><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>public String readLine()</td><td>读取一行数据，并把读取的数据返回，  如果没有数据可读，会返回null</td></tr></tbody></table><h3><span id></span></h3><h3><span id="缓冲输出流新增">缓冲输出流新增</span></h3><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>public void newLine()</td><td>换行，输出平台相关换行符</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BufferRW</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        缓冲字符流：</span></span><br><span class="line"><span class="comment">        BufferedReader(缓冲字符输入流)/BufferedWriter(缓冲字符输出流)</span></span><br><span class="line"><span class="comment">        作用：自带字符缓冲池</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        public BufferedReader(Reader r)：把低级的字符输入流包装成高级的缓冲字符输入流</span></span><br><span class="line"><span class="comment">        public BufferedWriter(Writer w)：把低级的字符输出流包装成高级的缓冲字符输出流</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        缓冲输入流新增：</span></span><br><span class="line"><span class="comment">        public String readLine() throws IOException：读取一行数据，并把读取的数据返回，如果没有数据可读，会返回null</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        缓冲输出流新增:</span></span><br><span class="line"><span class="comment">        public void newLine()：换行，输出平台相关换行符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 缓冲输入流</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileReader</span> <span class="variable">fr1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;IO\\src\\test04.txt&quot;</span>);</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">br1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(fr1);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">char</span>[] c = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = br1.read(c)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(c, <span class="number">0</span>, len));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">&quot;============================&quot;</span>);</span><br><span class="line">        <span class="comment">// readLine()</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileReader</span> <span class="variable">fr2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;IO\\src\\test04.txt&quot;</span>);</span><br><span class="line">             <span class="type">BufferedReader</span> <span class="variable">br2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(fr2);</span><br><span class="line">        ) &#123;</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = br2.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 缓冲输出流</span></span><br><span class="line">        <span class="keyword">try</span> (<span class="type">FileWriter</span> <span class="variable">fw1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;IO\\src\\test17.txt&quot;</span>);</span><br><span class="line">             <span class="type">BufferedWriter</span> <span class="variable">bw1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(fw1);</span><br><span class="line">        ) &#123;</span><br><span class="line">             <span class="type">char</span>[] c1 = <span class="string">&quot;hello world&quot;</span>.toCharArray();</span><br><span class="line">             bw1.write(c1);</span><br><span class="line">             <span class="type">char</span>[] c2 = <span class="string">&quot;你好，中国&quot;</span>.toCharArray();</span><br><span class="line">             bw1.newLine();</span><br><span class="line">             bw1.write(c2);</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="特殊数据流">特殊数据流</span></h2><h3><span id="dataoutputstream数据输出流">DataOutputStream(数据输出流)</span></h3><blockquote><p><strong>作用 ：</strong> 允许把数据和其类型一并写出去<br><strong>构造器：</strong><br>public DataOutputStream(OutputStream out) ； 创建一个数据输出流包装基础的字节输出流<br><strong>常用方法：</strong><br>public final void write(int&#x2F;byte[]&#x2F;byte[]的一部分) : 支持写字节数据入基础的字节输入流<br>public final void writeByte(int v) throws IOException : 把一个byte类型的数据写入基础的字节输入流<br>public final void writeDouble(double v) throws IOException : 把一个double类型的数据写入基础的字节输入流<br>public final void writeUTF(String str) throws IOException : 把一个字符串以UTF-8编码成字节写入基础的字节输入流<br>public final void writeInt(int v) throws IOException : 把一个int类型的数据写入基础的字节输入流<br>public final void writeBoolean(boolean v) throws IOException : 把一个boolean类型的数据写入基础的字节输入流</p></blockquote><h3><span id="datainputstream数据输入流">DataInputStream(数据输入流)</span></h3><blockquote><p><strong>作用 ：</strong> 允许把数据从基础的字节输入流中读出，并且可以读取到其类型<br><strong>构造器：</strong><br>public DataInputStream(InputStream in) ； 创建一个数据输入流包装基础的字节输入流<br><strong>常用方法：</strong><br>public final int read(int&#x2F;byte[]&#x2F;byte[]的一部分) : 读出一个字节数组，或者一个字节数组的一部分<br>public final int readInt() throws IOException : 从基础的字节输入流中读取一个int类型的数据<br>public final double readDouble() throws IOException : 从基础的字节输入流中读取一个double类型的数据<br>public final boolean readBoolean() throws IOException : 从基础的字节输入流中读取一个boolean类型的数据<br>public final String readUTF() throws IOException : 从基础的字节输入流中以UTF-8读取一个字符串<br>public final byte readByte() throws IOException : 从基础的字节输入流中读取一个byte类型的数据</p></blockquote><h2><span id="其他流">其他流</span></h2><h3><span id="inputstreamreader字符输入转换流">InputStreamReader(字符输入转换流)</span></h3><blockquote><p><strong>作用：</strong></p><p>​    解决不同编码时， 字符流读取文本内容乱码问题，将字节输入流转换为字符输入流<br><strong>解决思路：</strong><br>先获取原始的字节输入流，再将其按真实的字符集编码转成字符输入流，这样字符输入流中的字符就不乱码了</p></blockquote><h4><span id="构造器">构造器</span></h4><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td><code>public InputStreamReader(InputStream is)</code></td><td><code>把原始的字节输入流，按照代码默认编码转成字符输入流</code></td></tr><tr><td><code>public InputStreamReader(InputStream is, String charsetName)</code></td><td><code>把原始的字节输入流，按照指定的字符集编码转成字符输入流</code></td></tr></tbody></table><h3><span id="printstreamx2fprintwriter打印流">PrintStream&#x2F;PrintWriter(打印流) :</span></h3><blockquote><p>作用：</p><p>​    打印流可以实现更方便、更高效的打印数据出去，能打印啥出去就是啥出去</p></blockquote><h4><span id="构造器printsteam">构造器（PrintSteam）</span></h4><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>public void PrintStream(OutputStream&#x2F;File&#x2F;String)</td><td>打印流直接通向输出流&#x2F;文件&#x2F;文件路径</td></tr><tr><td>public void PrintStream(String filepath, Charset charset)</td><td>打印流直接通向文件，指定文件编码</td></tr><tr><td>public void PrintStream(OutputStream out, boolean autoFlush)</td><td>打印流直接通向输出流，并且自动刷新</td></tr><tr><td>public void PrintStream(OutputStream out, boolean autoFlush, String encoding)</td><td>打印流直接通向输出流，并且自动刷新，并且指定文件编码</td></tr></tbody></table><h4><span id="方法">方法</span></h4><table><thead><tr><th>常用方法</th><th>说明</th></tr></thead><tbody><tr><td>public void println()</td><td>打印并换行</td></tr><tr><td>public void write(int&#x2F;byte&#x2F;byte[])</td><td>支持字节数据写入</td></tr></tbody></table><h4><span id></span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InputStreamReaderDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        其他流：</span></span><br><span class="line"><span class="comment">        InputStreamReader(字符输入转换流)：</span></span><br><span class="line"><span class="comment">            作用：解决不同编码时， 字符流读取文本内容乱码问题，将字节输入流转换为字符输入流</span></span><br><span class="line"><span class="comment">            解决思路：</span></span><br><span class="line"><span class="comment">                先获取原始的字节输入流，再将其按真实的字符集编码转成字符输入流，这样字符输入流中的字符就不乱码了</span></span><br><span class="line"><span class="comment">            构造器：</span></span><br><span class="line"><span class="comment">                public InputStreamReader(InputStream is) : 把原始的字节输入流，按照代码默认编码转成字符输入流</span></span><br><span class="line"><span class="comment">                public InputStreamReader(InputStream is, String charsetName) : 把原始的字节输入流，按照指定的字符集编码转成字符输入流</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        PrintStream/PrintWriter(打印流) :</span></span><br><span class="line"><span class="comment">                作用： 打印流可以实现更方便、更高效的打印数据出去，能打印啥出去就是啥出去</span></span><br><span class="line"><span class="comment">            PrintStream:</span></span><br><span class="line"><span class="comment">               1. 构造器(PrintStream的打印数据方案) ：</span></span><br><span class="line"><span class="comment">                    public void PrintStream(OutputStream/File/String) : 打印流直接通向输出流/文件/文件路径</span></span><br><span class="line"><span class="comment">                    public void PrintStream(String filepath, Charset charset) : 打印流直接通向文件，指定文件编码</span></span><br><span class="line"><span class="comment">                    public void PrintStream(OutputStream out, boolean autoFlush) : 打印流直接通向输出流，并且自动刷新</span></span><br><span class="line"><span class="comment">                    public void PrintStream(OutputStream out, boolean autoFlush, String encoding) : 打印流直接通向输出流，并且自动刷新，并且指定文件编码</span></span><br><span class="line"><span class="comment">               2. 方法：</span></span><br><span class="line"><span class="comment">                    public void println() : 打印并换行</span></span><br><span class="line"><span class="comment">                    public void write(int/byte/byte[]) : 支持字节数据写入</span></span><br><span class="line"><span class="comment">            PrintWriter:</span></span><br><span class="line"><span class="comment">            1.构造器(PrintWriter的打印数据方案) ：</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**输出乱码问题*/</span></span><br><span class="line">        <span class="comment">//f1();</span></span><br><span class="line">        <span class="comment">/**InputStreamReader解决输出乱码*/</span></span><br><span class="line">        <span class="comment">//f2();</span></span><br><span class="line">        <span class="comment">/**PrintStream打印流*/</span></span><br><span class="line">        f3();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 文件和代码编码不一致会导致输出乱码</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>(</span><br><span class="line">                <span class="comment">// 读入的字节流编码是默认的UTF-8 而word2文件是GBK，所以会输出乱码</span></span><br><span class="line">                <span class="comment">// GBK中中文编码为一个汉字占两个字节</span></span><br><span class="line">                <span class="comment">// UTF-8中中文编码为一个汉字占三个字节</span></span><br><span class="line">                <span class="type">FileInputStream</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;IO\\src\\word2.txt&quot;</span>);</span><br><span class="line">                <span class="type">BufferedInputStream</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(fr);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = br.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(b, <span class="number">0</span>, len));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用InputStreamReader解决乱码问题</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>(</span><br><span class="line">                <span class="comment">// 读入的字节流编码是默认的UTF-8 而word2文件是GBK，所以会输出乱码</span></span><br><span class="line">                <span class="comment">// GBK中中文编码为一个汉字占两个字节</span></span><br><span class="line">                <span class="comment">// UTF-8中中文编码为一个汉字占三个字节</span></span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;IO\\src\\word2.txt&quot;</span>);</span><br><span class="line">                <span class="type">InputStreamReader</span> <span class="variable">isr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is, <span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">                <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(isr);</span><br><span class="line">        ) &#123;</span><br><span class="line">            String str;</span><br><span class="line">            <span class="keyword">while</span> ((str = br.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PrintStream/PrintWriter(打印流) :</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">f3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>(</span><br><span class="line">                <span class="type">PrintStream</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="string">&quot;IO\\src\\test.txt&quot;</span>);</span><br><span class="line">                <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="string">&quot;IO\\src\\test18.txt&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        ) &#123;</span><br><span class="line">            ps.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">            ps.write(<span class="number">97</span>);</span><br><span class="line">            ps.println(<span class="number">123456</span>);</span><br><span class="line"></span><br><span class="line">            pw.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">            pw.write(<span class="number">97</span>);</span><br><span class="line">            pw.println(<span class="number">123456</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2><span id="原始流和缓冲流性能对比">原始流和缓冲流性能对比</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeTest</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        原始流和缓冲流的性能分析：</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">srcPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\Users\\File_IO\\image.jpg&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">destPath</span> <span class="operator">=</span> <span class="string">&quot;D:\\Users\\File_IO\\copy&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            copyFileByByte(srcPath, destPath); <span class="comment">// 使用低级字节流按照字节复制文件</span></span><br><span class="line">            copyFileByBytes(srcPath, destPath); <span class="comment">// 使用低级字节流按字节数组复制文件</span></span><br><span class="line">            copyFileByBufferedChar(srcPath, destPath); <span class="comment">// 使用缓冲流按字节复制文件</span></span><br><span class="line">            copyFileByBufferedChars(srcPath, destPath); <span class="comment">// 使用缓冲流按字节数组复制文件</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用低级字节流按照字节复制文件，统计时间差</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFileByByte</span><span class="params">(String srcPath, String destPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span>(<span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcPath);</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(destPath + <span class="string">&quot;1.jpg&quot;</span>);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">int</span> b;</span><br><span class="line">            <span class="keyword">while</span> ((b = fis.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                fos.write(b);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (FileNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;使用低级字节流按照字节复制文件耗时：&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用低级字节流按字节数组复制文件，统计时间差</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFileByBytes</span><span class="params">(String srcPath, String destPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span>(<span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcPath);</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(destPath + <span class="string">&quot;2.jpg&quot;</span>);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                fos.write(b, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (FileNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;使用低级字节流按字节数组复制文件耗时：&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用缓冲流按字节复制文件，统计时间差</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFileByBufferedChar</span><span class="params">(String srcPath, String destPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span>(<span class="type">FileReader</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(srcPath);</span><br><span class="line">            <span class="type">FileWriter</span> <span class="variable">fw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(destPath + <span class="string">&quot;3.jpg&quot;</span>);</span><br><span class="line">            <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(fr);</span><br><span class="line">            <span class="type">BufferedWriter</span> <span class="variable">bw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(fw);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">int</span> c;</span><br><span class="line">            <span class="keyword">while</span> ((c = br.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bw.write(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (FileNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;使用缓冲流按字节复制文件耗时：&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用缓冲流按字节数组复制文件，统计时间差</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFileByBufferedChars</span><span class="params">(String srcPath, String destPath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span>(<span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcPath);</span><br><span class="line">            <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(destPath + <span class="string">&quot;4.jpg&quot;</span>);</span><br><span class="line">            <span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(fis);</span><br><span class="line">            <span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(fos);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = bis.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(b, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (FileNotFoundException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;使用缓冲流按字节数组复制文件耗时：&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="资源释放问题">资源释放问题</span></h2><h3><span id="1-try-catch-finally">1. try-catch-finally :</span></h3><blockquote><p> finally代码区 : 无论try中的程序是正常执行了,还是出现了异常,最后都一定会执行finally区,除非JVM终止</p></blockquote><h3><span id="2-try-with-resource">2. try-with-resource :</span></h3><blockquote><p>该资源使用完毕后，会自动调用close()方法，不用程序员手动释放资源。</p></blockquote><blockquote><p><strong>语法：</strong><br>   try(定义资源1;定义资源2;…) {<br>     try中的代码;<br>   }catch(Exception e) {<br>     e.printStackTrace();<br>   }<br> }</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.io;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Copy</span> &#123;</span><br><span class="line">    <span class="comment">// 文件复制</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\Users\\File_IO\\copy\\test.txt&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\Users\\File_IO\\copy1\\test2.txt&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\Users\\File_IO\\copy2\\test3.txt&quot;</span>);</span><br><span class="line">        CopyMethod1(file1.getAbsolutePath(), file2.getAbsolutePath());</span><br><span class="line">        CopyMethod2(file1.getAbsolutePath(), file3.getAbsolutePath());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         资源释放:</span></span><br><span class="line"><span class="comment">         1. try-catch-finally :</span></span><br><span class="line"><span class="comment">                finally代码区 : 无论try中的程序是正常执行了,还是出现了异常,最后都一定会执行finally区,除非JVM终止</span></span><br><span class="line"><span class="comment">         2. try-with-resource :</span></span><br><span class="line"><span class="comment">                该资源使用完毕后，会自动调用close()方法，不用程序员手动释放资源。</span></span><br><span class="line"><span class="comment">                语法：</span></span><br><span class="line"><span class="comment">                         try(定义资源1;定义资源2;...) &#123;</span></span><br><span class="line"><span class="comment">                              try中的代码;</span></span><br><span class="line"><span class="comment">                         &#125;catch(Exception e) &#123;</span></span><br><span class="line"><span class="comment">                              e.printStackTrace();</span></span><br><span class="line"><span class="comment">                         &#125;</span></span><br><span class="line"><span class="comment">                     &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// try-catch-finally : 释放资源 (不够简洁)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">CopyMethod1</span><span class="params">(String filename1, String filename2)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fis = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename1);</span><br><span class="line">            <span class="type">byte</span>[] b = fis.readAllBytes();</span><br><span class="line"></span><br><span class="line">            fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(filename2);</span><br><span class="line">            fos.write(b);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 一定会执行:释放资源</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fis != <span class="literal">null</span>) fis.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fos != <span class="literal">null</span>) fos.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try-with-resource : 释放资源 (简洁)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">CopyMethod2</span><span class="params">(String filename1, String filename2)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>(</span><br><span class="line">                <span class="comment">// 只能放置资源对象，用完后会自动关闭释放资源</span></span><br><span class="line">             <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename1);</span><br><span class="line">             <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(filename2);</span><br><span class="line">        ) &#123;</span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = fis.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(b, <span class="number">0</span>, len);</span><br><span class="line">                System.out.print(str);</span><br><span class="line">                fos.write(b, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="io框架">IO框架</span></h2><h3><span id="what-is-框架">what is 框架？</span></h3><blockquote><ul><li>框架(Framework): 是预先写好的代码库或一组工具，旨在简化和加速开发过程</li><li>框架的形式：一般是把类、接口等编译成class形式，再压缩成一个.jar结尾的文件发行出去</li></ul></blockquote><h3><span id="what-is-io框架">what is IO框架？</span></h3><blockquote><ul><li>IO框架：封装了Java提供的对文件、数据进行操作的代码，对外提供了更简单的方式对文件进行操作，对数据进行读写等</li></ul></blockquote><h3><span id="如何导入io框架">如何导入io框架？</span></h3><p>1.commons-io下载链接:<a href="https://commons.apache.org/proper/commons-io/download_io.cgi">Commons IO – Download Apache Commons IO</a></p><ol start="2"><li>下载并解压<img src="/./../images/b81cd57caf8e46c3b586f46fd3d91a5e.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">​</li></ol><p>3.复制jar包导入到项目中<img src="/./../images/4af07d12413f4e74b4ded57b357c811f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/da695ec9e8804d5b8ba0136ebb88c460.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/1a2ea931c6d0481cae7c13c74583af7c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/6d6b14212acf4936884b947a4bdbd4ac.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  <img src="/./../images/6defeee0046a4944abd69f34314b3ca2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/ff53388de9cd48b488ff846167b0b195.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="如何查看io框架的说明文档"><strong>如何查看io框架的说明文档？</strong></span></h3><p><img src="/./../images/7c08018600384bf5bab0adb63876cc07.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/9f2cbd809f154215aac8b44072da6772.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/4963479611424f788bbdf28f5e4dbb69.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="常见方法">常见方法</span></h3><p>FileUtils类：</p><blockquote><ul><li>FileUtils.copyFile(File src, File dest) : 复制文件</li><li>FileUtils.copyDirectory(File src, File dest) : 复制文件夹</li><li>FileUtils.deleteDirectory(File dir) : 删除文件夹</li><li>FileUtils.readFileToString(File file, String encoding) : 读取文件内容</li><li>FileUtils.writeStringToFile(File file, String data, String encoding, boolean append) : 写入文件内容</li></ul></blockquote><p>IOUtils类：</p><blockquote><ul><li>IOUtils.copy(InputStream input, OutputStream output) : 复制文件</li><li>IOUtils.copy(Reader input, Writer output) : 复制文件</li><li>IOUtils.write(byte[] data, OutputStream output, String charsetName) : 写入文件</li></ul></blockquote><hr><h1><span id="多线程">多线程</span></h1><h2><span id="概念">概念</span></h2><blockquote><ul><li>线程 ： 线程是一个程序内部的一条执行流程</li><li>单线程 ： 如果程序只有一条执行流程，那这个程序就是单线程的程序</li><li>多线程 ： 多线程是指从软硬件上实现的多条执行流程的技术(多条线程由CPU负责调度执行)</li><li>进程：</li></ul><p>​        1.正在运行的程序（软件）就是一个独立进程</p><p>​        2.线程属于进程</p><p>​        3.进程中的多个线程其实是并发和并行执行的</p><ul><li>并发（Concurrency）<br>定义：并发是指多个任务在同一时间段内同时运行，但并不一定是在同一时刻同时运行。在并发模式下，多个任务可能在微观层面上交替执行，即它们共享同一套资源（如CPU时间片），并且在不同的时间片段上执行</li><li>并行（Parallelism）<br>定义：并行是指多个任务在同一时间点上同时运行，并且能够同时完成。在并行模式下，多个任务可以分配到不同的处理单元（如多核CPU的不同核心、多个处理器或分布式计算环境中的不同节点）上执行。</li></ul></blockquote><h2><span id="多线程的创建">多线程的创建</span></h2><h3><span id="lt1gt-方式一继承thread类">&lt;1&gt; 方式一：继承Thread类</span></h3><blockquote><p> <strong>step:</strong><br> 1.定义一个子类MyThread类继承线程类java.lang.Thread,重写run()方法<br> 2.创建MyThread类的对象<br> 3.调用线程对象的start方法启动线程(启动后还是执行run方法)<br> <strong>注意：</strong><br> 1.直接调用run方法会当成普通方法执行，此时就相当于是单线程<br> 2.只有调用start方法才是启动一个新的线程执行<br> 3.不要把主线任务放在启动子线程之前</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.code;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">code</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      线程(Thread):</span></span><br><span class="line"><span class="comment">      概念：</span></span><br><span class="line"><span class="comment">      线程 ： 线程是一个程序内部的一条执行流程</span></span><br><span class="line"><span class="comment">      单线程 ： 如果程序只有一条执行流程，那这个程序就是单线程的程序</span></span><br><span class="line"><span class="comment">      多线程 ： 多线程是指从软硬件上实现的多条执行流程的技术(多条线程由CPU负责调度执行)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      多线程的创建：</span></span><br><span class="line"><span class="comment">        &lt;1&gt; 方式一：继承Thread类</span></span><br><span class="line"><span class="comment">                1.定义一个子类MyThread类继承线程类java.lang.Thread,重写run()方法</span></span><br><span class="line"><span class="comment">                2.创建MyThread类的对象</span></span><br><span class="line"><span class="comment">                3.调用线程对象的start方法启动线程(启动后还是执行run方法)</span></span><br><span class="line"><span class="comment">            注意：</span></span><br><span class="line"><span class="comment">                1.直接调用run方法会当成普通方法执行，此时就相当于是单线程</span></span><br><span class="line"><span class="comment">                2.只有调用start方法才是启动一个新的线程执行</span></span><br><span class="line"><span class="comment">                3.不要把主线任务放在启动子线程之前</span></span><br><span class="line"><span class="comment">        &lt;2&gt; 方式二：实现Runnable接口</span></span><br><span class="line"><span class="comment">            -&gt;匿名内部类写法：</span></span><br><span class="line"><span class="comment">                1. 可以创建Runnable接口的匿名内部类对象</span></span><br><span class="line"><span class="comment">                2. 再交给Thread线程对象</span></span><br><span class="line"><span class="comment">                3.再调用线程对象的start方法启动线程</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        注意 ： 前两种方式存在的问题：假如线程需要返回结果，它们所使用的run方法均不能直接返回结果</span></span><br><span class="line"><span class="comment">                如果线程需要返回结果，需要使用Callable接口和FutureTask类来实现</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &lt;3&gt; 方式三： 实现Callable接口和FutureTask类</span></span><br><span class="line"><span class="comment">                1. 创建任务对象：</span></span><br><span class="line"><span class="comment">                        定义一个类实现Callable接口，重写call方法，封装要执行的任务代码和要返回的数据</span></span><br><span class="line"><span class="comment">                        把Callable对象封装成FutureTask(线程任务对象)</span></span><br><span class="line"><span class="comment">                2. 把线程任务对象交给Thread对象</span></span><br><span class="line"><span class="comment">                3. 调用线程对象的start方法启动线程</span></span><br><span class="line"><span class="comment">                4. 调用FutureTask对象的get方法获取线程执行结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**创建方式一：继承Thread类*/</span></span><br><span class="line">       <span class="comment">// StartThread(); // 多线程</span></span><br><span class="line">       <span class="comment">// RunThread();   // 单线程: 直接调用run方法</span></span><br><span class="line">       <span class="comment">// MainBefore();  // 单线程 : 主线程先跑</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//把主线放子线程之前 : 主线程先跑, 还是单线程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">MainBefore</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">mt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程任务代码&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        mt.start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 直接调用run方法 : 单线程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">RunThread</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 1. 创建线程类对象代表线程</span></span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">mt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="comment">// 2. 调用run方法执行线程任务代码</span></span><br><span class="line">        mt.run();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程任务代码&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动线程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">StartThread</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 4. 创建线程类对象代表线程</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">mt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="comment">// 5. 调用start方法启动线程 ： 调用run方法执行的</span></span><br><span class="line">        mt.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程任务代码&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.定义一个子类继承Thread类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="comment">// 2. 重写线程的run方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 3. 在run方法中编写线程的任务代码</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;子线程任务代码&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="lt2gt-方式二实现runnable接口">&lt;2&gt; 方式二：实现Runnable接口</span></h3><blockquote><p> <strong>step -&gt; 匿名内部类写法：</strong></p><p> ​     1. 可以创建Runnable接口的匿名内部类对象</p><p> ​     2. 再交给Thread线程对象</p><p> ​     3.再调用线程对象的start方法启动线程</p><p> <strong>注意 ：</strong></p><p> ​    前两种方式存在的问题：假如线程需要返回结果，它们所使用的run方法均不能直接返回结果<br> ​     如果线程需要返回结果，需要使用Callable接口和FutureTask类来实现</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.code;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadDemo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**创建方式二 ：实现Runnable接口 */</span></span><br><span class="line">        <span class="comment">//StartThread1();</span></span><br><span class="line">         StartThread2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用匿名内部类启动线程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">StartThread1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 3. 创建线程任务对象代表一个线程 : 使用匿名内部类</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;子线程任务代码1 : &quot;</span> + i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 4. 创建线程对象</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 启动线程</span></span><br><span class="line">        t.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;子线程任务代码2 : &quot;</span> + i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程任务代码 : &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用接口实现类启动线程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">StartThread2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 3. 创建线程任务对象代表一个线程</span></span><br><span class="line">        <span class="type">MyRunnable</span> <span class="variable">mr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">        <span class="comment">// 4. 创建线程对象</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(mr);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 启动线程</span></span><br><span class="line">        t.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程任务代码 : &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.定义一个线程任务类来实现Runnable接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="comment">// 2. 重写run方法,设置线程任务</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//线程任务代码</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;子线程任务代码&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="lt3gt-方式三-实现callable接口和futuretask类">&lt;3&gt; 方式三： 实现Callable接口和FutureTask类</span></h3><blockquote><p> <strong>step:</strong></p><ol><li>创建任务对象：</li></ol><p> ​     定义一个类实现Callable接口，重写call方法，封装要执行的任务代码和要返回的数据<br> ​     把Callable对象封装成FutureTask(线程任务对象)</p><ol start="2"><li>把线程任务对象交给Thread对象</li><li>调用线程对象的start方法启动线程</li><li>调用FutureTask对象的get方法获取线程执行结果</li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.code;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadDemo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**创建方式三：实现Callable接口和FutureTask类*/</span></span><br><span class="line">        StartThread1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">StartThread1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 3. 创建Callable接口实现类的对象</span></span><br><span class="line">        <span class="type">MyCallable</span> <span class="variable">callable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCallable</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 4. 把Callable对象封装成真正的线程任务类对象FutureTask对象</span></span><br><span class="line">        <span class="comment">// FutureTask继承Runnable接口，所以可以作为Runnable对象传递给Thread对象</span></span><br><span class="line">        FutureTask&lt;String&gt; task = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;String&gt;(callable);</span><br><span class="line">        <span class="comment">// Runnable task = new FutureTask&lt;String&gt;(callable); [多态写法]</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 5. 创建线程对象，将FutureTask对象传递给Thread构造方法</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">        <span class="comment">// 6. 启动线程</span></span><br><span class="line">        t.start();</span><br><span class="line">        <span class="comment">// 7. 获取线程执行结果（线程执行结束）</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 如果主线程发现第一个线程没有执行完毕，主线程阻塞等待，会让出CPU，让第一个线程执行完毕后，主线程继续往下执行</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> task.get();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 定义一个实现类实现Callable接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyCallable</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 实现call方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= num; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;子线程的和为：&quot;</span> + sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="thread类">Thread类</span></h2><h3><span id="thread类提供的常见构造器">Thread类提供的常见构造器:</span></h3><blockquote><p>public Thread(String name): 创建一个没有指定名称的线程对象<br>public Thread(Runnable target): 封装Runnable对象成为线程对象<br>public Thread(Runnable target, String name): 封装Runnable对象成为线程对象，并指定线程名称</p></blockquote><h3><span id="thread提供的常用方法">Thread提供的常用方法：</span></h3><blockquote><p>public void run(): 线程的任务方法<br>public void start(): 启动线程<br>public String getName(): 获取线程名称，线程名称默认为Thread-0，Thread-1，Thread-2…<br>public void setName(String name): 设置线程名称<br>public static Thread currentThread(): 获取当前正在执行的线程对象<br>public static void sleep (long time): 让当前线程休眠多少毫秒后再继续执行<br>public final void join(): 让调用当前这个方法的线程先执行完</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.code;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">      Thread提供的常用方法：</span></span><br><span class="line"><span class="comment">      public void run(): 线程的任务方法</span></span><br><span class="line"><span class="comment">      public void start(): 启动线程</span></span><br><span class="line"><span class="comment">      public String getName(): 获取线程名称，线程名称默认为Thread-0，Thread-1，Thread-2...</span></span><br><span class="line"><span class="comment">      public void setName(String name): 设置线程名称</span></span><br><span class="line"><span class="comment">      public static Thread currentThread(): 获取当前正在执行的线程对象</span></span><br><span class="line"><span class="comment">      public static void sleep (long time): 让当前线程休眠多少毫秒后再继续执行</span></span><br><span class="line"><span class="comment">      public final void join(): 让调用当前这个方法的线程先执行完</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      Thread类提供的常见构造器:</span></span><br><span class="line"><span class="comment">      public Thread(String name): 创建一个没有指定名称的线程对象</span></span><br><span class="line"><span class="comment">      public Thread(Runnable target): 封装Runnable对象成为线程对象</span></span><br><span class="line"><span class="comment">      public Thread(Runnable target, String name): 封装Runnable对象成为线程对象，并指定线程名称</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      线</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThreadDemo</span>();</span><br><span class="line">        t1.start();</span><br><span class="line">        System.out.println(t1.getName());</span><br><span class="line">        <span class="comment">// 休眠1秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t1.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThreadDemo</span>();</span><br><span class="line">        t2.start();</span><br><span class="line">        System.out.println(t2.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">m</span> <span class="operator">=</span> Thread.currentThread(); <span class="comment">// 获取当前正在执行的线程对象</span></span><br><span class="line">        System.out.println(m.getName()); <span class="comment">// 主线程名字：main</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThreadDemo</span>();</span><br><span class="line">        t3.start();</span><br><span class="line">        t3.setName(<span class="string">&quot;线程3&quot;</span>);</span><br><span class="line">        System.out.println(t3.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThreadDemo</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;:&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><hr><h2><span id="线程同步的方案加锁">线程同步的方案(加锁)</span></h2><h3><span id="方式一-同步代码块">方式一 ： 同步代码块</span></h3><blockquote><p><strong>作用 ：</strong> 把访问共享资源的核心代码给上锁，以保证线程安全<br><strong>格式 ：</strong><br>synchronized(锁对象){<br> &#x2F;&#x2F; 访问共享资源的核心代码<br>}<br><strong>原理 ：</strong> 每次只允许一个线程加锁后进入，执行完毕后自动解锁，其他线程才可以进来执行<br><strong>注意 :</strong> 锁对象必须是同一个，否则无法同步<br><strong>锁对象的选择 ：</strong><br>1.建议使用共享资源作为锁对象,对于实例方法建议使用this作为锁对象<br>2.对于静态方法建议使用字节码(类名.class)对象作为锁对象</p></blockquote><h3><span id="2-方式二-同步方法">2. 方式二 ： 同步方法</span></h3><blockquote><p><strong>作用 :</strong> 把访问共享资源的核心方法给上锁，以保证线程安全<br><strong>格式 :</strong><br>修饰符 synchronized 返回值类型 方法名(参数列表){<br>   &#x2F;&#x2F; 访问共享资源的核心代码<br>}<br><strong>原理 ：</strong> 每次只允许一个线程加锁后进入，执行完毕后自动解锁，其他线程才可以进来执行<br><strong>底层原理 ：</strong> 底层也是隐式锁对象（范围是整个方法）<br> 实例方法的默认锁对象是当前对象 this<br> 静态方法的默认锁对象是 类名.class</p></blockquote><h3><span id="3-方式三-lock锁">3. 方式三 ： lock锁</span></h3><blockquote><p><strong>作用 :</strong> 可以创建锁对象，进行加锁和解锁<br>Lock是接口，不能直接实例化，可以采用它的实现类ReentrantLock来构建锁对象<br><strong>构造器 ：</strong><br>public ReentrantLock() : 获得Lock锁的实现类对象<br><strong>方法：</strong><br>lock() : 获得锁<br>unlock() : 释放锁</p></blockquote><h2><span id="线程池">线程池</span></h2><h3><span id="1定义">1.定义：</span></h3><p>线程池就是一个可以复用线程的技术：</p><p><img src="/./../images/c5d3576f1a7f491dab0f2826bb87ed5a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="线程池的接口-executorservice">线程池的接口 ：ExecutorService</span></h4><p><strong>常用方法:</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Runnable command)</span> : 执行Runnable任务</span><br><span class="line">Future&lt;T&gt; <span class="title function_">submit</span><span class="params">(Callable&lt;T&gt; task)</span> : 执行Callable任务，并返回未来任务对象,</span><br><span class="line">                                     用于获取线程返回的结果               </span><br><span class="line"><span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> :等全部任务完执行成后,关闭线程池</span><br><span class="line">List&lt;Runnable&gt; <span class="title function_">shutdownNow</span><span class="params">()</span> : 关闭线程池，不再接受新的任务，并返回尚未执行的任务列表</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="实现类threadpoolexecutor">实现类：ThreadPoolExecutor</span></h4><p><strong>构造器 ：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                          <span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params">                          <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">                          TimeUnit unit,</span></span><br><span class="line"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue</span></span><br><span class="line"><span class="params">                          ThreadFactory threadFactory,</span></span><br><span class="line"><span class="params">                          RejectedExecutionHandler handler</span></span><br><span class="line"><span class="params">                          )</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p> <strong>参数说明:</strong></p><blockquote><pre><code>（1） corePoolSize：指定线程池的核心线程数量.          核心线程池大小，线程池中常驻的线程数量，          即使没有任务，也会一直存活，直到线程池被关闭。（2） maximumPoolSize：          最大线程池大小，线程池中允许创建的最大线程数量，          如果线程池中线程数量达到这个数量，则后续的任务会被阻塞，等待线程池中线程释放。（3） keepAliveTime：          指定临时线程的存活时间（4） unit：        指定临时线程的存活时间单位（秒、分、时、天）（5） workQueue：        任务队列，用于存放等待被执行的任务，当线程池中的线程数量达到corePoolSize后，后续任务会被存放在workQueue中，等待被执行。（6） threadFactory：        线程工厂，用于创建线程，默认使用Executors.defaultThreadFactory()。（7） handler：        拒绝策略，当线程池中的线程数量达到maximumPoolSize后，后续任务会被拒绝，默认使用AbortPolicy策略，直接抛出异常。</code></pre></blockquote><h3><span id="2-创建线程池">2. 创建线程池:</span></h3><p>方式一: 使用Executors的实现类ThreadPoolExecutor自创建一个线程池对象</p><p><img src="/./../images/35286a4ecdb64dfdadea8c12499efeb7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>方式二：使用Executors(线程池的工具类)调用方法返回不同特点的线程池对象（不建议，有弊端）</p><blockquote><p>public static ExecutorService newFixedThreadPool(int nThreads) : 创建固定大小的线程池, 如果某个线程因为执行异常而结束，则线程池会补充一个新线程来替代该线程</p><p>public static ExecutorService newCachedThreadPool() : 线程数量随任务增加而增加，如果线程任务执行完毕且空闲了60s，则该线程会被回收掉</p><p>public static ExecutorService newSingleThreadExecutor() : 创建一个单线程的线程池，如果这个线程因为执行异常而结束，则线程池会新建一个线程。</p><p>public static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) : 创建一个定长线程池，支持定时及周期性任务执行。</p></blockquote><p><img src="/./../images/8455d607b7864de8bee046d70b0d505c.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="3-临时线程的创建时机">3. 临时线程的创建时机:</span></h3><blockquote><p> 当线程池中的线程数量达到corePoolSize后，后续的任务会被存放在workQueue中，当有新的任务进来时，会先判断workQueue是否已满，<br> 拒绝新任务:<br> workQueue已满，且线程池中的线程数量达到maximumPoolSize，则拒绝新任务，抛出异常</p></blockquote><h3><span id="4-任务拒绝策略">4. 任务拒绝策略</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor.AbortPolicy() : 丢弃任务并抛出RejectedExecutionException异常。(默认策略)</span><br><span class="line">ThreadPoolExecutor.DiscardPolicy() : 丢弃任务，但是不抛出异常。(不推荐)</span><br><span class="line">ThreadPoolExecutor.DiscardOldestPolicy() : 丢弃队列中等待最久的任务，然后把当前任务加到队列中。(不推荐)</span><br><span class="line">ThreadPoolExecutor.CallerRunsPolicy() : 由主线程负责调用任务的run()方法从而绕过线程池直接执行</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.threadpool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        线程池 ：</span></span><br><span class="line"><span class="comment">            1.定义：</span></span><br><span class="line"><span class="comment">                线程池就是一个可以复用线程的技术：</span></span><br><span class="line"><span class="comment">                线程池的接口 ：ExecutorService</span></span><br><span class="line"><span class="comment">                        常用方法:</span></span><br><span class="line"><span class="comment">                            void execute(Runnable command) : 执行Runnable任务</span></span><br><span class="line"><span class="comment">                            Future&lt;T&gt; submit(Callable&lt;T&gt; task) : 执行Callable任务，并返回未来任务对象,用于获取线程返回的结果</span></span><br><span class="line"><span class="comment">                            void shutdown() :等全部任务完执行成后,关闭线程池</span></span><br><span class="line"><span class="comment">                            List&lt;Runnable&gt; shutdownNow() : 关闭线程池，不再接受新的任务，并返回尚未执行的任务列表</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                实现类：ThreadPoolExecutor</span></span><br><span class="line"><span class="comment">                        构造器 ：</span></span><br><span class="line"><span class="comment">                            public ThreadPoolExecutor(int corePoolSize,</span></span><br><span class="line"><span class="comment">                                                    int maximumPoolSize,</span></span><br><span class="line"><span class="comment">                                                    long keepAliveTime,</span></span><br><span class="line"><span class="comment">                                                    TimeUnit unit,</span></span><br><span class="line"><span class="comment">                                                    BlockingQueue&lt;Runnable&gt; workQueue</span></span><br><span class="line"><span class="comment">                                                    ThreadFactory threadFactory,</span></span><br><span class="line"><span class="comment">                                                    RejectedExecutionHandler handler</span></span><br><span class="line"><span class="comment">                                                    )</span></span><br><span class="line"><span class="comment">                        参数说明:</span></span><br><span class="line"><span class="comment">                            （1） corePoolSize：指定线程池的核心线程数量.</span></span><br><span class="line"><span class="comment">                                                核心线程池大小，线程池中常驻的线程数量，</span></span><br><span class="line"><span class="comment">                                                即使没有任务，也会一直存活，直到线程池被关闭。</span></span><br><span class="line"><span class="comment">                            （2） maximumPoolSize：</span></span><br><span class="line"><span class="comment">                                                最大线程池大小，线程池中允许创建的最大线程数量，</span></span><br><span class="line"><span class="comment">                                                如果线程池中线程数量达到这个数量，则后续的任务会被阻塞，等待线程池中线程释放。</span></span><br><span class="line"><span class="comment">                            （3） keepAliveTime：</span></span><br><span class="line"><span class="comment">                                                指定临时线程的存活时间</span></span><br><span class="line"><span class="comment">                            （4） unit：</span></span><br><span class="line"><span class="comment">                                             指定临时线程的存活时间单位（秒、分、时、天）</span></span><br><span class="line"><span class="comment">                            （5） workQueue：</span></span><br><span class="line"><span class="comment">                                            任务队列，用于存放等待被执行的任务，当线程池中的线程数量达到corePoolSize后，后续任务会被存放在workQueue中，等待被执行。</span></span><br><span class="line"><span class="comment">                            （6） threadFactory：</span></span><br><span class="line"><span class="comment">                                            线程工厂，用于创建线程，默认使用Executors.defaultThreadFactory()。</span></span><br><span class="line"><span class="comment">                            （7） handler：</span></span><br><span class="line"><span class="comment">                                            拒绝策略，当线程池中的线程数量达到maximumPoolSize后，后续任务会被拒绝，默认使用AbortPolicy策略，直接抛出异常。</span></span><br><span class="line"><span class="comment">            2. 创建线程池:</span></span><br><span class="line"><span class="comment">                方式一: 使用Executors的实现类ThreadPoolExecutor自创建一个线程池对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                方式二：使用Executors(线程池的工具类)调用方法返回不同特点的线程池对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            3. 临时线程的创建时机:</span></span><br><span class="line"><span class="comment">                    当线程池中的线程数量达到corePoolSize后，后续的任务会被存放在workQueue中，当有新的任务进来时，会先判断workQueue是否已满，</span></span><br><span class="line"><span class="comment">                拒绝新任务:</span></span><br><span class="line"><span class="comment">                    workQueue已满，且线程池中的线程数量达到maximumPoolSize，则拒绝新任务，抛出异常</span></span><br><span class="line"><span class="comment">            4. 任务拒绝策略</span></span><br><span class="line"><span class="comment">                    ThreadPoolExecutor.AbortPolicy() : 丢弃任务并抛出RejectedExecutionException异常。(默认策略)</span></span><br><span class="line"><span class="comment">                    ThreadPoolExecutor.DiscardPolicy() : 丢弃任务，但是不抛出异常。(不推荐)</span></span><br><span class="line"><span class="comment">                    ThreadPoolExecutor.DiscardOldestPolicy() : 丢弃队列中等待最久的任务，然后把当前任务加到队列中。(不推荐)</span></span><br><span class="line"><span class="comment">                    ThreadPoolExecutor.CallerRunsPolicy() : 由主线程负责调用任务的run()方法从而绕过线程池直接执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.创建线程池对象</span></span><br><span class="line">        <span class="comment">// 方式一：使用线程池的实现类ThreadPoolExecutor</span></span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">threadpool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>,</span><br><span class="line">                TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;Runnable&gt;(<span class="number">3</span>), Executors.defaultThreadFactory(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());</span><br><span class="line">        <span class="comment">// 2.使用线程池执行Callable任务</span></span><br><span class="line">       Future&lt;String&gt;[] future = <span class="keyword">new</span> <span class="title class_">Future</span>[<span class="number">5</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="type">MyCallable</span> <span class="variable">myCallable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCallable</span>(i);</span><br><span class="line">            future[i] = threadpool.submit(myCallable);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.获取线程池中的线程执行结果</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> future[i].get();</span><br><span class="line">                System.out.println(result);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.关闭线程池 : 等所有任务执行完，再关闭线程池</span></span><br><span class="line">        threadpool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="5用线程池处理runnable任务">5.用线程池处理Runnable任务</span></h3><blockquote><p>1.创建线程池对象</p><p>2.使用线程池执行任务</p><p>3.关闭线程池 : 等所有任务执行完，再关闭线程池</p></blockquote><p> <img src="/./../images/f4a596379b3f449aae49b9982ceb8c0a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="6用线程池处理callable任务">6.用线程池处理Callable任务</span></h3><blockquote><p>1.创建线程池对象</p><p>2.使用线程池执行Callable任务</p><p>3.获取线程池中的线程执行结果</p><p>4.关闭线程池 : 等所有任务执行完，再关闭线程池</p></blockquote><p> <img src="/./../images/595c2621bf284f0aa639aecf34a47a93.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><hr><h1><span id="网络编程">网络编程</span></h1><h2><span id="基本概念">基本概念</span></h2><h3><span id="定义">定义</span></h3><p> 基本通信架构 ： C&#x2F;S(客户端&#x2F;服务端) 、B&#x2F;S（浏览器&#x2F;服务端）<br> Java提供网络编程的解决方案 ： java.net.*</p><h3><span id="网络编程三要素ip-端口号-协议">网络编程三要素：IP 、端口号、协议</span></h3><blockquote><ul><li>IP地址：IP地址是设备在网络中的地址,是设备在网络中的唯一标识符。</li><li>端口 : 端口号是应用程序在设备中的唯一标识符。</li><li>协议 : 协议是网络通信的规则， 连接和数据在网络中传输的规则。</li></ul></blockquote><h3><span id="ip地址">IP地址</span></h3><blockquote><p>概念 ： 互联网上的唯一标识符，由4个字节组成，每个字节为0~255之间的整数，用点分十进制表示。<br>目前广泛采用的IP地址形式有IPv4和IPv6。</p></blockquote><h3><span id="ip域名">IP域名 ：</span></h3><blockquote><p>概念 ： 用于在互联网上识别和定位王占东人类可读的名称，如<a href="http://www.baidu.com./">www.baidu.com。</a><br>DNS域名解析：域名解析是域名与IP地址之间的转换过程，域名解析服务器负责将域名转换为IP地址。</p></blockquote><blockquote><p> 公网IP地址：<br> 概念：通过互联网访问的IP地址，如：123.123.123.123。</p><p> 内网IP地址：<br> 概念：局域网IP，通过局域网访问的IP地址， 是只能组织机构内部使用的IP地址<br> 范围 ： 192.168.0.1~192.168.255.255</p><p> 本机ip：<br> 127.0.0.1、localhost：代表本机ip，只会寻找当前程序所在的主机</p></blockquote><h3><span id="ip常用指令">ip常用指令</span></h3><blockquote><p>ipconfig：查看本机ip地址<br>ping ip地址： 查看网络是否连通</p></blockquote><h2><span id="ip">IP</span></h2><h3><span id="inetaddress类">InetAddress类</span></h3><p>  在Java中获取ip地址对象的类</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>public static InetAddress getLocalHost()</td><td>获取本地主机的IP地址， 返回一个InetAddress对象</td></tr><tr><td>public String getHostName()</td><td>获取ip地址对象对应的主机名,获取该ip地址对象对应的主机名</td></tr><tr><td>public String getHostAddress()</td><td>获取ip地址对象中的ip地址信息</td></tr><tr><td>public static InetAddress getByName(String host)</td><td>根据ip地址或者域名，返回一个InetAddress对象</td></tr><tr><td>public boolean isReachable(int timeout)</td><td>判断主机在指定毫秒内与该ip对应的主机是否能连通</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InetAddressDemo</span> &#123;</span><br><span class="line">    <span class="comment">// 认识InetAddress类</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 认识InetAddress类获取本机ip和对方ip</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取本机ip</span></span><br><span class="line">            <span class="type">InetAddress</span> <span class="variable">local</span> <span class="operator">=</span> InetAddress.getLocalHost();</span><br><span class="line">            System.out.println(local.getHostAddress()); <span class="comment">// 获取主机ip地址</span></span><br><span class="line">            System.out.println(local.getHostName()); <span class="comment">// 获取主机名称</span></span><br><span class="line">            <span class="comment">// 获取对方ip</span></span><br><span class="line">            <span class="type">InetAddress</span> <span class="variable">remote</span> <span class="operator">=</span> InetAddress.getByName(<span class="string">&quot;www.baidu.com&quot;</span>);</span><br><span class="line">            System.out.println(remote.getHostAddress()); <span class="comment">// 获取百度的ip地址</span></span><br><span class="line">            System.out.println(remote.getHostName()); <span class="comment">// 获取百度的主机名称</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断本机与对方主机是否互通</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">judge</span> <span class="operator">=</span> remote.isReachable(<span class="number">1000</span>); <span class="comment">// 判断在1000ms内是否能与对方主机互通</span></span><br><span class="line">            System.out.println(judge);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="端口">端口</span></h2><h3><span id="概念">概念</span></h3><blockquote><p><strong>端口号：</strong></p><p>0<del>65535，0</del>1023为系统端口，1024<del>49151为用户端口，49152</del>65535为保留端口。</p><p><strong>端口分类：</strong><br>周知端口： 0<del>1023，被预先定义的知名应用占用(如：HTTP占用80， FTP占用21)<br>注册端口： 1024</del>49151，分配给用户进程或某些应用程序<br>动态端口： 49152~65535，动态分配给用户进程，如：浏览器，游戏等<br>注意：我们开发程序一般使用注册端口，且一个设备中不能出现重复的端口号，否则报错</p></blockquote><h2><span id="协议">协议</span></h2><h3><span id="概念">概念</span></h3><blockquote><p>网络通信协议：网络上通信的设备，事先规定的连接规则，以及传输数据的规则<br>开放式网络互联标准：OSI网络参考模型（理论）<br>TCP&#x2F;IP协议：事实上的国际标准</p></blockquote><h3><span id="传输层的两个通信协议">传输层的两个通信协议：</span></h3><blockquote><p>UDP：用户数据报协议 -&gt; 无连接、不可靠[通信效率高]<br>TCP：传输控制协议 -&gt; 有连接、可靠[三次握手]</p></blockquote><h3><span id></span></h3><h2><span id="udp"><strong>UDP</strong></span></h2><h3><span id="udp通信的实现">UDP通信的实现：</span></h3><p>​        java.net.DatagramSocket类来实现UDP通信</p><h3><span id></span></h3><h3><span id="datagramsocket类创建客户端和服务端">DatagramSocket类：创建客户端和服务端</span></h3><h4><span id="构造器">构造器</span></h4><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>public DatagramSocket()</td><td>创建客户端的Socket对象，系统会随机分配一个端口号</td></tr><tr><td>public DatagramSocket(int port)</td><td>创建客户端的Socket对象，指定端口号</td></tr></tbody></table><h4><span id="方法">方法：</span></h4><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>public void send(DatagramPacket p)</td><td>发送数据包</td></tr><tr><td>public void receive(DatagramPacket p)</td><td>接收数据包</td></tr></tbody></table><h3><span id="datagrampacket类创建数据包"><strong>DatagramPacket类：创建数据包</strong></span></h3><h4><span id="构造器">构造器：</span></h4><p><strong>1. public DatagramPacket(byte[] buf, int length, InetAddress address, int port) : 创建发出去的数据包对象</strong></p><blockquote><p><strong>参数：</strong></p><ul><li>buf：数据包中的数据，数组</li><li>length：数据包中的数据的长度</li><li>address：接收方的ip地址</li><li>port：接收方的端口号</li></ul></blockquote><p><strong>2.public DatagramPacket(byte[] buf, int length) : 创建接收到的数据包对象</strong></p><blockquote><p><strong>参数：</strong></p><ul><li>buf：数据包中的数据，数组</li><li>length：数据包中的数据的长度</li></ul></blockquote><h3><span id="一发一收">一发一收：</span></h3><p><img src="/./../images/b51da04bbfc24230926e2979e5406ffe.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="创建客户端">创建客户端：</span></h4><blockquote><p>1.创建发送端对象<br>2.创建数据包，封装数据 ： 64kb以内<br>3.让发送端发送数据包<br>4.关闭发送端</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.udp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UDP的客户端：实现一发一收</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">     1.创建发送端对象</span></span><br><span class="line"><span class="comment">     2.创建数据包，封装数据 ： 64kb以内</span></span><br><span class="line"><span class="comment">     3.让发送端发送数据包</span></span><br><span class="line"><span class="comment">     4.关闭发送端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPClientDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.创建发送端对象</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.创建数据包，封装数据 ： 64kb以内</span></span><br><span class="line">        <span class="type">byte</span>[] data = <span class="string">&quot;我是客户端&quot;</span>.getBytes();</span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(data, data.length, InetAddress.getByName(<span class="string">&quot;localhost&quot;</span>), <span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.让发送端发送数据包</span></span><br><span class="line">        socket.send(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 关闭发送端</span></span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="创建服务端">创建服务端：</span></h4><blockquote><p>1.创建接收对象<br>2.接收数据<br>3.看数据<br>4.获取对方ip<br>5.释放资源</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.udp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UDP的服务端：一发一收</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">     1.创建接收对象</span></span><br><span class="line"><span class="comment">     2.接收数据</span></span><br><span class="line"><span class="comment">     3.看数据</span></span><br><span class="line"><span class="comment">     4.获取对方ip</span></span><br><span class="line"><span class="comment">     5.释放资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPSeverDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器启动&quot;</span>);</span><br><span class="line">        <span class="comment">// UDP的服务端</span></span><br><span class="line">        <span class="comment">// 1.创建接收对象</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.接收数据</span></span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">64</span>];</span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.接受数据，封装到数据包对象的字节数组中</span></span><br><span class="line">        ds.receive(packet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.看数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buf);</span><br><span class="line">        System.out.println(<span class="string">&quot;收到了&quot;</span> + str);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.获取对方ip</span></span><br><span class="line">        System.out.println(<span class="string">&quot;来自：&quot;</span> + packet.getAddress().getHostAddress() + <span class="string">&quot;:&quot;</span> + packet.getPort());</span><br><span class="line"></span><br><span class="line">        ds.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="多发多收">多发多收</span></h3><p>多个客户端可以对同一个服务端发送数据，发送的数据可以是源源不断的</p><p><img src="/./../images/6079e0ca6b344d3a9fe65edb55b47bd2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/a000b6ed0d3448df8e20866239d8cb01.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="客户端">客户端：</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.udp2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="comment">// UDP的客户端 : 实现多发多收</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPClientDemo2</span> &#123;</span><br><span class="line">    <span class="comment">// UDP的客户端</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端启动&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.创建发送端对象</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.使用while 循环，让用户输入数据</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请输入要发送的数据：&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;exit&quot;</span>.equals(data)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;客户端退出&quot;</span>);</span><br><span class="line">                socket.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果用户输入的不是 exit，就发送数据包</span></span><br><span class="line">            <span class="type">byte</span>[] bytes = data.getBytes();</span><br><span class="line">            <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(bytes, bytes.length, InetAddress.getByName(<span class="string">&quot;localhost&quot;</span>), <span class="number">8088</span>);</span><br><span class="line">            <span class="comment">// 3.让发送端发送数据包</span></span><br><span class="line">            socket.send(packet);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="服务端">服务端 ：</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.udp2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramPacket;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="comment">// UDP的服务端 : 实现多发多收</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UDPSeverDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务器启动&quot;</span>);</span><br><span class="line">        <span class="comment">// UDP的服务端</span></span><br><span class="line">        <span class="comment">// 1.创建接收对象</span></span><br><span class="line">        <span class="type">DatagramSocket</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramSocket</span>(<span class="number">8088</span>);</span><br><span class="line">        <span class="comment">// 2. 创建数据包对象</span></span><br><span class="line">        <span class="type">byte</span>[] buf = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">64</span>];</span><br><span class="line">        <span class="type">DatagramPacket</span> <span class="variable">packet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DatagramPacket</span>(buf, buf.length);</span><br><span class="line">        <span class="comment">// 3. 使用while 循环，不断接受数据</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3.接受数据，封装到数据包对象的字节数组中</span></span><br><span class="line">            ds.receive(packet);</span><br><span class="line">            <span class="comment">// 4.看数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buf, <span class="number">0</span>, packet.getLength());</span><br><span class="line">            System.out.println(<span class="string">&quot;收到了&quot;</span> + str);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.获取对方ip</span></span><br><span class="line">            System.out.println(<span class="string">&quot;来自：&quot;</span> + packet.getAddress().getHostAddress() + <span class="string">&quot;:&quot;</span> + packet.getPort());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="tcp">TCP</span></h2><h3><span id="tcp通信的实现">TCP通信的实现</span></h3><blockquote><ul><li>TCP客户端是通过java.net.Socket类来实现TCP通信</li><li>TCP服务端是通过java.net.ServerSocket类来实现的</li></ul></blockquote><h3><span id="客户端socket类">客户端Socket类：</span></h3><p>TCP客户端是通过java.net.Socket类来实现TCP通信</p><h4><span id="构造器">构造器：</span></h4><blockquote><ul><li>public Socket(String host,int port)：创建客户端的Socket对象，指定服务器的IP地址和端口号</li></ul></blockquote><h4><span id="方法">方法：</span></h4><blockquote><ul><li>public InputStream getInputStream()：获取网络字节输入流对象</li><li>public OutputStream getOutputStream()：获取网络字节输出流对象</li></ul></blockquote><h3><span id="服务端seversocket类">服务端SeverSocket类：</span></h3><h4><span id="构造器">构造器</span></h4><blockquote><ul><li>public ServerSocket(int port) throws IOException : 为服务端程序注册端口</li></ul></blockquote><h4><span id="方法">方法</span></h4><blockquote><ul><li>public Socket accept() throws IOException : 阻塞等待客户端的连接请求，一旦与某个客户端成功连接，则返回服务端这边的Socket对象</li></ul></blockquote><h3><span id="一发一收">一发一收</span></h3><p><img src="/./../images/c9390b258dbe48e5b75fd5869079dd1a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="客户端">客户端</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.DatagramSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPClientDemo</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       java.net.Socket类来实现TCP通信的客户端</span></span><br><span class="line"><span class="comment">        Socket类：</span></span><br><span class="line"><span class="comment">        构造器：</span></span><br><span class="line"><span class="comment">        public Socket(String host,int port)：创建客户端的Socket对象，指定服务器的IP地址和端口号</span></span><br><span class="line"><span class="comment">        方法：</span></span><br><span class="line"><span class="comment">        public InputStream getInputStream()：获取网络字节输入流对象</span></span><br><span class="line"><span class="comment">        public OutputStream getOutputStream()：获取网络字节输出流对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        public void close()：关闭Socket对象</span></span><br><span class="line"><span class="comment">        public InetAddress getInetAddress()：获取服务器的IP地址</span></span><br><span class="line"><span class="comment">        public int getPort()：获取服务器的端口号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 客户端 ： 实现TCP通信下的一发一收</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.常见的Socket管道对象，请求与服务器的Socket建立连接</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8888</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端连接成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.通过Socket管道，获取一个字节输出流，写数据到服务器</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.将输出流包装成特殊数据输出流</span></span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.写数据</span></span><br><span class="line">        dos.writeInt(<span class="number">100</span>);</span><br><span class="line">        dos.writeDouble(<span class="number">3.14</span>);</span><br><span class="line">        dos.writeUTF(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5.关闭资源</span></span><br><span class="line">        dos.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="服务端">服务端</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.tcp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPSeverDemo</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        TCP服务端是通过java.net.ServerSocket类来实现的.</span></span><br><span class="line"><span class="comment">        SeverSocket</span></span><br><span class="line"><span class="comment">        构造器</span></span><br><span class="line"><span class="comment">        public ServerSocket(int port) throws IOException : 为服务端程序注册端口</span></span><br><span class="line"><span class="comment">        方法</span></span><br><span class="line"><span class="comment">        public Socket accept() throws IOException : 阻塞等待客户端的连接请求，一旦与某个客户端成功连接，则返回服务端这边的Socket对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// TCP服务端 : 实现一发一收</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.创建一个ServerSocket对象，注册端口8888</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">8888</span>);</span><br><span class="line">        <span class="comment">// 2.阻塞等待客户端的连接请求，一旦与某个客户端成功连接，则返回服务端这边的Socket对象</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();</span><br><span class="line">        <span class="comment">// 3.通过Socket对象，获取一个字节输入流，读取客户端发送的数据</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="comment">// 4.包装字节输入流:将字节数输入流包装成特殊数据输入流</span></span><br><span class="line">        <span class="type">DataInputStream</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(is);</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> dis.readInt();</span><br><span class="line">        <span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> dis.readDouble();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> dis.readUTF();</span><br><span class="line">        <span class="comment">// 5.读数据</span></span><br><span class="line">        System.out.println(len);</span><br><span class="line">        System.out.println(sum);</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        <span class="comment">// 6.释放资源</span></span><br><span class="line">        dis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="多发多收">多发多收</span></h3><p><img src="/./../images/85d6b0573bb44ef79912f4825e4bb0c0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="客户端">客户端</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.tcp2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPClientDemo</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       java.net.Socket类来实现TCP通信的客户端</span></span><br><span class="line"><span class="comment">        Socket类：</span></span><br><span class="line"><span class="comment">        构造器：</span></span><br><span class="line"><span class="comment">        public Socket(String host,int port)：创建客户端的Socket对象，指定服务器的IP地址和端口号</span></span><br><span class="line"><span class="comment">        方法：</span></span><br><span class="line"><span class="comment">        public InputStream getInputStream()：获取网络字节输入流对象</span></span><br><span class="line"><span class="comment">        public OutputStream getOutputStream()：获取网络字节输出流对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        public void close()：关闭Socket对象</span></span><br><span class="line"><span class="comment">        public InetAddress getInetAddress()：获取服务器的IP地址</span></span><br><span class="line"><span class="comment">        public int getPort()：获取服务器的端口号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 客户端 ： 实现TCP通信下的多发多收</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端启动&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.常见的Socket管道对象，请求与服务器的Socket建立连接</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端连接成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.通过Socket管道，获取一个字节输出流，写数据到服务器</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.将输出流包装成特殊数据输出流</span></span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.写数据 ： 循环写</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请输入客户端要发送的数据：&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;exit&quot;</span>.equals(line)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;客户端退出&quot;</span>);</span><br><span class="line">                <span class="comment">// 5.关闭资源</span></span><br><span class="line">                socket.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dos.writeUTF(line);</span><br><span class="line">            dos.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="服务端">服务端</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.tcp2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPSeverDemo</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        TCP服务端是通过java.net.ServerSocket类来实现的.</span></span><br><span class="line"><span class="comment">        SeverSocket</span></span><br><span class="line"><span class="comment">        构造器</span></span><br><span class="line"><span class="comment">        public ServerSocket(int port) throws IOException : 为服务端程序注册端口</span></span><br><span class="line"><span class="comment">        方法</span></span><br><span class="line"><span class="comment">        public Socket accept() throws IOException : 阻塞等待客户端的连接请求，一旦与某个客户端成功连接，则返回服务端这边的Socket对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// TCP服务端 : 实现多发多收</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端启动....&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.创建一个ServerSocket对象，注册端口9999</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9999</span>);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();</span><br><span class="line">        <span class="comment">// 2.通过Socket对象，获取一个字节输入流，读取客户端发送的数据</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">        <span class="comment">// 3.包装字节输入流:将字节数输入流包装成特殊数据输入流</span></span><br><span class="line">        <span class="type">DataInputStream</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 循环等待读取客户端发送的消息</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 5. 等待收消息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> dis.readUTF();</span><br><span class="line">            System.out.println(<span class="string">&quot;收到客户端说:&quot;</span> + line);</span><br><span class="line">            <span class="comment">// 客户端的ip和端口</span></span><br><span class="line">            System.out.println(socket.getInetAddress() + <span class="string">&quot;:&quot;</span> + socket.getPort());</span><br><span class="line">            System.out.println(<span class="string">&quot;--------------------------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="tcp通信支持与多个客户端同时通信">TCP通信—支持与多个客户端同时通信</span></h3><p><img src="/./../images/0c59d33bac90402683a6f0c93d82b56a.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/df3accea6ac74541b675625942da1755.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="方法">方法：</span></h4><blockquote><p>1.循环接收客户端的连接请求</p><p>2.当接收到客户端的请求后，将socket对象交给子线程处理</p><p>3.子线程实现对客户端发送数据的处理逻辑</p></blockquote><h4><span id="客户端多开实例">客户端（多开实例）</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.tcp3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPClientDemo</span> &#123;</span><br><span class="line">    <span class="comment">// 客户端 ： 支持多个客户端开发</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端启动&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.常见的Socket管道对象，请求与服务器的Socket建立连接</span></span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9998</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;客户端连接成功&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.通过Socket管道，获取一个字节输出流，写数据到服务器</span></span><br><span class="line">        <span class="type">OutputStream</span> <span class="variable">os</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.将输出流包装成特殊数据输出流</span></span><br><span class="line">        <span class="type">DataOutputStream</span> <span class="variable">dos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataOutputStream</span>(os);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.写数据 ： 循环写</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请输入客户端要发送的数据：&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> sc.nextLine();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;exit&quot;</span>.equals(line)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;客户端退出&quot;</span>);</span><br><span class="line">                <span class="comment">// 5.关闭资源</span></span><br><span class="line">                socket.close();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dos.writeUTF(line);</span><br><span class="line">            dos.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="服务端">服务端</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.tcp3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPSeverDemo</span> &#123;</span><br><span class="line">    <span class="comment">// TCP服务端 : 支持多个客户端开发</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">         服务端 ： 实现多个客户端通信</span></span><br><span class="line"><span class="comment">         主线程：负责接收客户端连接</span></span><br><span class="line"><span class="comment">         子线程：负责与客户端通信</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;服务端启动....&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.创建一个ServerSocket对象，注册端口9999</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(<span class="number">9998</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 2.调用accept方法，等待客户端连接</span></span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> ss.accept();</span><br><span class="line">            <span class="comment">// 3.把这个客户端管道交给独立的子线程处理</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TCPSeverReader</span>(socket).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="子线程">子线程</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.tcp3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.net.Socket;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子线程：处理客户端发来的数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TCPSeverReader</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    Socket socket;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TCPSeverReader</span><span class="params">(Socket socket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.socket = socket;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">                <span class="type">DataInputStream</span> <span class="variable">dis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataInputStream</span>(is))&#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> dis.readUTF();</span><br><span class="line">                System.out.println(name + <span class="string">&quot;收到客户端说:&quot;</span> + line);</span><br><span class="line">                System.out.println(<span class="string">&quot;--------------------------&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="注意">注意</span></h2><h3><span id="多开实例设置">多开实例设置</span></h3><p>1.如果要实现多个客户端给服务端发送消息，需要打开以下设置（多开实例）</p><p><img src="/./../images/b6141a5903a748678cbc304e3f1d5bcf.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/b2b105ee4e304dceac30bc7186bd0add.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p><img src="/./../images/c994ea3a9ccd444d867b9c31a74f7506.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>示例：</p><p><img src="/./../images/a54f31965f984186991e9e48858200cb.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动">  这样子客户端就可以启动多个</p><hr><h1><span id="java高级技术">Java高级技术</span></h1><h2><span id="junit">Junit</span></h2><h3><span id="简介">简介：</span></h3><blockquote><p>JUnit 是一个用于Java编程语言的单元测试框架。<br>它支持编写和运行可重复的测试，以验证您的代码是否按预期工作。</p></blockquote><h3><span id="步骤">步骤：</span></h3><blockquote><p>1.导入依赖： 将Junit框架的jar包导入到项目中(注意：IDEA集成了Junit框架，不需要手动导入)<br>2.为业务类编写测试类，为业务方法编写测试方法，测试方法要求：公共、无参、无返回值<br>3.测试方法上必须声明@Test注解<br>4.运行测试</p></blockquote><h3><span id="eg">eg：</span></h3><p><strong>业务类：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.Junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printNumber</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="literal">null</span> || name.equals(<span class="string">&quot;&quot;</span>)) System.out.println(<span class="string">&quot;名字为空&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> System.out.println(<span class="string">&quot;名字长度是：&quot;</span> + name.length());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">GetMaxIndex</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || s.equals(<span class="string">&quot;&quot;</span>)) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> s.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>测试类：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.Junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Junit单元测试框架：</span></span><br><span class="line"><span class="comment">    步骤：</span></span><br><span class="line"><span class="comment">    1.导入依赖： 将Junit框架的jar包导入到项目中(注意：IDEA集成了Junit框架，不需要手动导入)</span></span><br><span class="line"><span class="comment">    2.为业务类编写测试类，为业务方法编写测试方法，测试方法要求：公共、无参、无返回值</span></span><br><span class="line"><span class="comment">    3.测试方法上必须声明@Test注解</span></span><br><span class="line"><span class="comment">    4.运行测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringUtilTest</span> &#123;</span><br><span class="line">    <span class="comment">// 测试方法：public 无参 无返回值 必须加上@Test注解</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPrinNumber</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 测试步骤</span></span><br><span class="line">        StringUtil.printNumber(<span class="string">&quot;Karry Wang&quot;</span>);</span><br><span class="line">        <span class="comment">// 测试用例</span></span><br><span class="line">        StringUtil.printNumber(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        StringUtil.printNumber(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetMaxIndex</span><span class="params">()</span>  &#123;</span><br><span class="line">        <span class="comment">// 测试步骤</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">idx1</span> <span class="operator">=</span> StringUtil.GetMaxIndex(<span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>);</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">// 测试用例</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">idx2</span> <span class="operator">=</span> StringUtil.GetMaxIndex(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx3</span> <span class="operator">=</span> StringUtil.GetMaxIndex(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(idx2);</span><br><span class="line">        System.out.println(idx3);</span><br><span class="line">        <span class="comment">// 做断言测试：判断测试结果与预期结果是否一致</span></span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;本轮测试失败，业务获取的最大索引有问题&quot;</span>, <span class="number">25</span>, idx1);</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;本轮测试失败，业务获取的最大索引有问题&quot;</span>,-<span class="number">1</span>, idx2);</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;本轮测试失败，业务获取的最大索引有问题&quot;</span>,-<span class="number">1</span>, idx3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="反射reflection">反射（Reflection）</span></h2><h3><span id="定义">定义</span></h3><p>加载类，并允许以编程的方式解剖类中的各种成分(成员变量、方法、构造器等)</p><h3><span id="作用">作用</span></h3><blockquote><p>最重要的：做java框架</p><p>1.可以得到类的所有信息，包括：构造器、成员变量、成员方法等<br>2.实现反射调用，破坏封装性<br>3.绕过泛型的约束</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Reflection3</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">         反射的作用：</span></span><br><span class="line"><span class="comment">        1.可以得到类的所有信息，包括：构造器、成员变量、成员方法等</span></span><br><span class="line"><span class="comment">        2.实现反射调用，破坏封装性</span></span><br><span class="line"><span class="comment">        3.绕过泛型的约束</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException &#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        <span class="comment">/**由于泛型约束 ：只能添加String类型元素*/</span></span><br><span class="line">        <span class="comment">// list.add(1.2);</span></span><br><span class="line">        <span class="comment">// list.add(5)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**通过反射可以绕过泛型约束*/</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> list.getClass();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">add</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;add&quot;</span>, Object.class); <span class="comment">// 获取add方法</span></span><br><span class="line">        add.invoke(<span class="number">1.2</span>, list); <span class="comment">// 反射调用add</span></span><br><span class="line"></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h3><span id="步骤">步骤：</span></h3><p><strong>1. 反射第一步：加载类，获取类的字节码：Class对象</strong></p><blockquote><p>获取Class文件的三种方法：<br>1&gt; Class c1 &#x3D; 类名.class<br>2&gt; 调用Class提供方法：Class c2 &#x3D; Class.forName(String package)<br>3&gt; Object提供方法：Class c3 &#x3D; 对象.getClass()</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ithema.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Reflection</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">      反射：</span></span><br><span class="line"><span class="comment">      加载类，并允许以编程的方式解剖类中的各种成分(成员变量、方法、构造器等)</span></span><br><span class="line"><span class="comment">      反射学什么？</span></span><br><span class="line"><span class="comment">      1. 反射第一步：加载类，获取类的字节码：Class对象</span></span><br><span class="line"><span class="comment">      2. 获取类的构造器：Constructor对象</span></span><br><span class="line"><span class="comment">      3. 获取类的成员变量：Field对象</span></span><br><span class="line"><span class="comment">      4. 获取类的方法：Method对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. 加载类，获取类的字节码:获取类</span></span><br><span class="line">        <span class="comment">// 第一种：类.class</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c1</span> <span class="operator">=</span> Student.class;</span><br><span class="line">        System.out.println(<span class="string">&quot;c1: &quot;</span> + c1);</span><br><span class="line">        <span class="comment">// 第二步： 调用Class提供的方法：Class.forName(String package)</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            c2 = Class.forName(<span class="string">&quot;com.ithema.reflect.Student&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;c2: &quot;</span> + c2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;c1 == c2 : &quot;</span> + (c1 == c2)); <span class="comment">// true</span></span><br><span class="line">        <span class="comment">// 第三步：Object提供的方法：Class c3 = 对象.getClass()</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>().getClass();</span><br><span class="line">        System.out.println(<span class="string">&quot;c3: &quot;</span> + c3);</span><br><span class="line">        System.out.println(<span class="string">&quot;c1 == c3 : &quot;</span> + (c1 == c3)); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 获取类中的成分，并对其进行操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取类的信息</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getClassInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Student.class;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取类信息：&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;全类名：&quot;</span> + c.getName()); <span class="comment">// 全类名 : com.ithema.reflect.Student</span></span><br><span class="line">        System.out.println(<span class="string">&quot;类名：&quot;</span> + c.getSimpleName()); <span class="comment">// 类名 : Student</span></span><br><span class="line">        System.out.println(<span class="string">&quot;-------------------------------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>2. 获取类中的成分并操作：</strong></p><p>1&gt; Class从类中获取构造器：</p><table><thead><tr><th>构造器</th><th>说明</th></tr></thead><tbody><tr><td>Constructor[] getConstructors()</td><td>获取全部构造器（只能获取public修饰的）</td></tr><tr><td>Constructor[] getDeclaredConstructors()</td><td>获取全部构造器（包括private、protected、public、default修饰的）</td></tr><tr><td>Constructor<t> getConstructor(Class&lt;?&gt;… parameterTypes)：</t></td><td>获取指定参数类型的构造器（只能获取public修饰的）</td></tr><tr><td>Constructor<t> getDeclaredConstructor(Class&lt;?&gt;… parameterTypes)</t></td><td>获取某个构造器（只要存在就能拿到）</td></tr></tbody></table><table><thead><tr><th>Constructor提供的方法</th><th>说明</th></tr></thead><tbody><tr><td>T newInstance(Object… initargs)</td><td>调用此构造器对象表示的构造器，并传入参数，完成对象的初始化并返回</td></tr><tr><td>public void setAccessible(boolean flag)</td><td>设置为true，表示禁止检查访问控制（暴力反射）</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取类的构造器：Constructor对象</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getConstructorTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">// 1. 加载类，获取类的字节码:获取类</span></span><br><span class="line">       <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Person.class;</span><br><span class="line">       System.out.println(<span class="string">&quot;获取类的构造器：Constructor对象: &quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line">       <span class="comment">// 2.获取全部构造器</span></span><br><span class="line">       Constructor[] cons = c.getDeclaredConstructors(); <span class="comment">// 获取全部构造器</span></span><br><span class="line">       <span class="keyword">for</span> (Constructor con : cons) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;构造器名字：&quot;</span> + con.getName() + <span class="string">&quot;(参数个数为： &quot;</span>+ con.getParameterCount() + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 3.获取某个构造器 : 无参构造器</span></span><br><span class="line">       <span class="type">Constructor</span> <span class="variable">con1</span> <span class="operator">=</span> c.getDeclaredConstructor(); <span class="comment">// 获取无参构造器</span></span><br><span class="line">       System.out.println(<span class="string">&quot;无参构造器名字：&quot;</span> + con1.getName() + <span class="string">&quot;(参数个数为： &quot;</span>+ con1.getParameterCount() + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">       <span class="comment">// 4.获取某个构造器 ： 有参构造器</span></span><br><span class="line">       <span class="type">Constructor</span> <span class="variable">con2</span> <span class="operator">=</span> c.getDeclaredConstructor(String.class);</span><br><span class="line">       System.out.println(<span class="string">&quot;有参构造器名字：&quot;</span> + con2.getName() + <span class="string">&quot;(参数个数为： &quot;</span>+ con2.getParameterCount() + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 4. 获取构造器的作用依然是创建对象：创建对象</span></span><br><span class="line">       System.out.println(<span class="string">&quot;获取构造器创建对象：&quot;</span>);</span><br><span class="line">       <span class="comment">// 如果是私有构造器，不能直接调用，需要设置访问权限为true（暴力反射）</span></span><br><span class="line">       con1.setAccessible(<span class="literal">true</span>); <span class="comment">// 绕过访问权限，直接访问</span></span><br><span class="line">       <span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> (Person) con1.newInstance(); <span class="comment">// 强转 无参构造器</span></span><br><span class="line">       System.out.println(<span class="string">&quot;无参构造器创建对象：&quot;</span> + p1);</span><br><span class="line"></span><br><span class="line">       con2.setAccessible(<span class="literal">true</span>);</span><br><span class="line">       <span class="type">Person</span> <span class="variable">p2</span> <span class="operator">=</span> (Person)con2.newInstance(<span class="string">&quot;小凯&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;有参构造器创建对象：&quot;</span> + p2);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>​    </p><p>2&gt; Class从类中获取成员变量</p><table><thead><tr><th>成员变量</th><th>说明</th></tr></thead><tbody><tr><td>public Field[] getFields()</td><td>获取全部成员变量（只能获取public修饰的）</td></tr><tr><td>public Field[] getDeclaredFields()</td><td>获取全部成员变量（只要存在就能拿到）</td></tr><tr><td>public Field getField(String name)</td><td>获取某个public成员变量</td></tr><tr><td>public Field getDeclaredField(String name)</td><td>获取某个成员变量（只要存在就能拿到）</td></tr></tbody></table><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>void set(Object obj, Object value)</td><td>将指定对象中的变量设置为指定值</td></tr><tr><td>Object get(Object obj)</td><td>获取指定对象中的变量的值</td></tr><tr><td>public void setAccessible(boolean flag)</td><td>设置为true，表示禁止检查访问控制（暴力反射）</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取类的成员变量：Field对象</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getFieldTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="comment">// 1. 加载类，获取类的字节码:获取类</span></span><br><span class="line">      <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Person.class;</span><br><span class="line">      System.out.println(<span class="string">&quot;获取类的成员变量：Field对象: &quot;</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line">      <span class="comment">// 2.获取全部成员变量</span></span><br><span class="line">      Field[] fields = c.getDeclaredFields();</span><br><span class="line">      <span class="keyword">for</span> (java.lang.reflect.Field field : fields) &#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;成员变量名：&quot;</span> + field.getName() + <span class="string">&quot;，类型：&quot;</span> + field.getType());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 3.获取某个成员变量 : name</span></span><br><span class="line">      <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;成员变量名：&quot;</span> + field.getName() + <span class="string">&quot;，类型：&quot;</span> + field.getType());</span><br><span class="line">      System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 4. 获取成员变量的作用：取值和赋值</span></span><br><span class="line">      <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;小凯&quot;</span>, <span class="number">25</span>);</span><br><span class="line">      field.setAccessible(<span class="literal">true</span>); <span class="comment">// 暴力反射</span></span><br><span class="line">      field.set(p, <span class="string">&quot;Karry&quot;</span>); <span class="comment">// 将p的name属性设置为Karry</span></span><br><span class="line">      System.out.println(p);</span><br><span class="line">      <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> (String) field.get(p);</span><br><span class="line">      System.out.println(<span class="string">&quot;name = &quot;</span> + name);</span><br><span class="line">      System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p>3&gt; Class从类中获取方法（构造器）</p><table><thead><tr><th>方法（包含构造器）</th><th>说明</th></tr></thead><tbody><tr><td>Method[] getMethods()</td><td>获取全部方法（只能获取public修饰的）</td></tr><tr><td>Method[] getDeclaredMethods()</td><td>获取全部方法（包括private、protected、public、default修饰的）</td></tr><tr><td>Method getMethod(String name, Class&lt;?&gt;… parameterTypes)</td><td>获取某个public方法</td></tr><tr><td>Method getDeclaredMethod(String name, Class&lt;?&gt;… parameterTypes)</td><td>获取某个方法（只要存在就能拿到）</td></tr></tbody></table><table><thead><tr><th>Method提供的方法</th><th>说明</th></tr></thead><tbody><tr><td>public Object invoke(Object obj, Object… args)</td><td>出发某个对象的该方法执行</td></tr><tr><td>public void setAccessible(boolean flag)</td><td>设置为true，表示禁止检查访问控制（暴力反射）</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取类的成员方法：Method对象</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMethodTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 1. 加载类，获取类的字节码:获取类</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Person.class;</span><br><span class="line">        System.out.println(<span class="string">&quot;获取类的成员方法：Method对象: &quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">// 2. 获取全部成员方法</span></span><br><span class="line">        Method[] methods = c.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;方法名：&quot;</span> + method.getName() + <span class="string">&quot;，参数个数：&quot;</span> + method.getParameterCount());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. 获取某个方法：getName() 无参数</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;方法名：&quot;</span> + method.getName() + <span class="string">&quot;，参数个数：&quot;</span> + method.getParameterCount());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 获取某个方法：</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method2</span> <span class="operator">=</span> c.getDeclaredMethod(<span class="string">&quot;goodbye&quot;</span>, String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;方法名：&quot;</span> + method2.getName() + <span class="string">&quot;，参数个数：&quot;</span> + method2.getParameterCount());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. 获取方法的作用：执行方法</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;小凯&quot;</span>, <span class="number">25</span>);</span><br><span class="line">        method.setAccessible(<span class="literal">true</span>); <span class="comment">// 暴力反射</span></span><br><span class="line">        method.invoke(p); <span class="comment">// 唤醒p的getName方法 相当于 p.getName();</span></span><br><span class="line"></span><br><span class="line">        method2.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        method2.invoke(p, <span class="string">&quot;小凯&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="注解">注解</span></h2><h3><span id="概念">概念</span></h3><blockquote><ul><li><strong>定义：</strong> Java代码中的特殊标记，比如：@Override，@Test，@Deprecated等。</li><li><strong>作用：</strong>让其他程序根据注解信息来决定怎么执行程序</li><li><strong>作用范围：</strong> 方法、类、构造器、属性、变量、参数等</li><li><strong>原理：</strong></li></ul><ol><li>注解本质上是接口，继承的父类是Annotation，注解中定义的属性本质是抽象方法</li><li>@注解(…)： 其实就是一个实现类对象，实现该注解以及Annotation接口</li></ol><ul><li>注解的解析过程：</li></ul><ol><li>判断类、方法上、成员变量上是否存在注解，并把注解里的内容给解析出来</li><li>如何解析注解内容：</li></ol><p>​    1&gt; 拿到对象：类就拿Class对象，成员方法就拿Method对象……</p><p>​    2&gt; Class、Method、Field、Constructor都实现了AnnotatedElement接口，这些对象都</p><p>​       能够解析注解  </p><table><thead><tr><th>AnnotatedElement接口提供解析注解的方法</th><th>说明</th></tr></thead><tbody><tr><td>public Annotation[] getAnnotations()</td><td>获取当前对象上面的注解</td></tr><tr><td>public T getDecoratedAnnotation(Class<t> annotationClass)</t></td><td>获取指定的注解对象</td></tr><tr><td>public boolean isAnnotationPresent(Class<annotation> annotationClass)</annotation></td><td>判断当前对象是否存在某个注解</td></tr></tbody></table><p><img src="/./../images/a2a3110a96d44266a6278694df4d23a7.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p></blockquote><h3><span id="自定义注解">自定义注解</span></h3><p><strong>语法：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="meta">@interface</span> 注解名称&#123;</span><br><span class="line">    <span class="keyword">public</span> 属性类型 属性名() <span class="keyword">default</span> 默认值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><strong>特殊属性：</strong></p><blockquote><p>​    value （如果注解中只有一个value属性，那么使用注解时value可以省略）</p></blockquote><p><img src="/./../images/6604d66458244a29ae3afa14e81150b2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h3><span id="元注解">元注解</span></h3><h4><span id="定义">定义：</span></h4><blockquote><p>注解注解的注解(用来注解所写注解，限制所写注解)</p></blockquote><p> <img src="/./../images/2b64029093a84d539089055b4d19b872.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><h4><span id="target">@Target：</span></h4><p>定义： 用来定义注解所修饰的范围，比如：方法、类、构造器、属性、变量、参数等<br> 语法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span>:</span><br><span class="line"><span class="number">1.</span> TYPE：类</span><br><span class="line"><span class="number">2.</span> FIELD：属性</span><br><span class="line"><span class="number">3.</span> METHOD：方法</span><br><span class="line"><span class="number">4.</span> PARAMETER：参数</span><br><span class="line"><span class="number">5.</span> CONSTRUCTOR：构造器</span><br><span class="line"><span class="number">6.</span> LOCAL_VARIABLE：局部变量</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h4><span id="retention">@Retention：</span></h4><p>定义：用来定义注解的保留周期，比如：保留在源文件、编译成class文件、运行时<br> 语法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>:</span><br><span class="line"><span class="number">1.</span> SOURCE：保留在源码阶段， 字节码文件中不存在</span><br><span class="line"><span class="number">2.</span> CLASS：保留到字节码文件阶段，运行阶段不存在</span><br><span class="line"><span class="number">3.</span> RUNTIME：一直保留到运行阶段 (一般运用这个)</span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><h2><span id="动态代理">动态代理</span></h2><p>java.lang.reflect.Proxy类： 提供了为对象生成代理对象的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader, </span></span><br><span class="line"><span class="params">Class&lt;?&gt;[] interfaces, InvocationHandler h)</span></span><br></pre></td></tr></table></figure><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p><p><img src="/./../images/e177d39697a4406aaa41094a25376eb2.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"> </p><p>参数：</p><blockquote><p>ClassLoader loader：用于指定用哪个类加载器  </p><p>Class&lt;?&gt;[] interfaces：指定代理对象要实现的接口，也就是有哪些方法,多个接口以数组形式</p><p>InvocationHandler h：用来指定生成的代理对象要干什么事情</p></blockquote><hr><p><em><strong>注意：如有错误，欢迎指正!!!</strong></em></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 1 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title></title>
      <link href="/styles/fish-base.js"/>
      <url>/styles/fish-base.js</url>
      
        <content type="html"><![CDATA[var RENDERER = {POINT_INTERVAL : 5,FISH_COUNT : 3,MAX_INTERVAL_COUNT : 50,INIT_HEIGHT_RATE : 0.5,THRESHOLD : 50,init : function(){this.setParameters();this.reconstructMethods();this.setup();this.bindEvent();this.render();},setParameters : function(){this.$window = $(window);this.$container = $('#jsi-flying-fish-container');this.$canvas = $('<canvas />');this.context = this.$canvas.appendTo(this.$container).get(0).getContext('2d');this.points = [];this.fishes = [];this.watchIds = [];},createSurfacePoints : function(){var count = Math.round(this.width / this.POINT_INTERVAL);this.pointInterval = this.width / (count - 1);this.points.push(new SURFACE_POINT(this, 0));for(var i = 1; i < count; i++){var point = new SURFACE_POINT(this, i * this.pointInterval),previous = this.points[i - 1];point.setPreviousPoint(previous);previous.setNextPoint(point);this.points.push(point);}},reconstructMethods : function(){this.watchWindowSize = this.watchWindowSize.bind(this);this.jdugeToStopResize = this.jdugeToStopResize.bind(this);this.startEpicenter = this.startEpicenter.bind(this);this.moveEpicenter = this.moveEpicenter.bind(this);this.reverseVertical = this.reverseVertical.bind(this);this.render = this.render.bind(this);},setup : function(){this.points.length = 0;this.fishes.length = 0;this.watchIds.length = 0;this.intervalCount = this.MAX_INTERVAL_COUNT;this.width = this.$container.width();this.height = this.$container.height();this.fishCount = this.FISH_COUNT * this.width / 500 * this.height / 500;this.$canvas.attr({width : this.width, height : this.height});this.reverse = false;this.fishes.push(new FISH(this));this.createSurfacePoints();},watchWindowSize : function(){this.clearTimer();this.tmpWidth = this.$window.width();this.tmpHeight = this.$window.height();this.watchIds.push(setTimeout(this.jdugeToStopResize, this.WATCH_INTERVAL));},clearTimer : function(){while(this.watchIds.length > 0){clearTimeout(this.watchIds.pop());}},jdugeToStopResize : function(){var width = this.$window.width(),height = this.$window.height(),stopped = (width == this.tmpWidth && height == this.tmpHeight);this.tmpWidth = width;this.tmpHeight = height;if(stopped){this.setup();}},bindEvent : function(){this.$window.on('resize', this.watchWindowSize);this.$container.on('mouseenter', this.startEpicenter);this.$container.on('mousemove', this.moveEpicenter);this.$container.on('click', this.reverseVertical);},getAxis : function(event){var offset = this.$container.offset();return {x : event.clientX - offset.left + this.$window.scrollLeft(),y : event.clientY - offset.top + this.$window.scrollTop()};},startEpicenter : function(event){this.axis = this.getAxis(event);},moveEpicenter : function(event){var axis = this.getAxis(event);if(!this.axis){this.axis = axis;}this.generateEpicenter(axis.x, axis.y, axis.y - this.axis.y);this.axis = axis;},generateEpicenter : function(x, y, velocity){if(y < this.height / 2 - this.THRESHOLD || y > this.height / 2 + this.THRESHOLD){return;}var index = Math.round(x / this.pointInterval);if(index < 0 || index >= this.points.length){return;}this.points[index].interfere(y, velocity);},reverseVertical : function(){this.reverse = !this.reverse;for(var i = 0, count = this.fishes.length; i < count; i++){this.fishes[i].reverseVertical();}},controlStatus : function(){for(var i = 0, count = this.points.length; i < count; i++){this.points[i].updateSelf();}for(var i = 0, count = this.points.length; i < count; i++){this.points[i].updateNeighbors();}if(this.fishes.length < this.fishCount){if(--this.intervalCount == 0){this.intervalCount = this.MAX_INTERVAL_COUNT;this.fishes.push(new FISH(this));}}},render : function(){requestAnimationFrame(this.render);this.controlStatus();this.context.clearRect(0, 0, this.width, this.height);this.context.fillStyle = 'hsl(0, 0%, 95%)';for(var i = 0, count = this.fishes.length; i < count; i++){this.fishes[i].render(this.context);}this.context.save();this.context.globalCompositeOperation = 'xor';this.context.beginPath();this.context.moveTo(0, this.reverse ? 0 : this.height);for(var i = 0, count = this.points.length; i < count; i++){this.points[i].render(this.context);}this.context.lineTo(this.width, this.reverse ? 0 : this.height);this.context.closePath();this.context.fill();this.context.restore();}};var SURFACE_POINT = function(renderer, x){this.renderer = renderer;this.x = x;this.init();};SURFACE_POINT.prototype = {SPRING_CONSTANT : 0.03,SPRING_FRICTION : 0.9,WAVE_SPREAD : 0.3,ACCELARATION_RATE : 0.01,init : function(){this.initHeight = this.renderer.height * this.renderer.INIT_HEIGHT_RATE;this.height = this.initHeight;this.fy = 0;this.force = {previous : 0, next : 0};},setPreviousPoint : function(previous){this.previous = previous;},setNextPoint : function(next){this.next = next;},interfere : function(y, velocity){this.fy = this.renderer.height * this.ACCELARATION_RATE * ((this.renderer.height - this.height - y) >= 0 ? -1 : 1) * Math.abs(velocity);},updateSelf : function(){this.fy += this.SPRING_CONSTANT * (this.initHeight - this.height);this.fy *= this.SPRING_FRICTION;this.height += this.fy;},updateNeighbors : function(){if(this.previous){this.force.previous = this.WAVE_SPREAD * (this.height - this.previous.height);}if(this.next){this.force.next = this.WAVE_SPREAD * (this.height - this.next.height);}},render : function(context){if(this.previous){this.previous.height += this.force.previous;this.previous.fy += this.force.previous;}if(this.next){this.next.height += this.force.next;this.next.fy += this.force.next;}context.lineTo(this.x, this.renderer.height - this.height);}};var FISH = function(renderer){this.renderer = renderer;this.init();};FISH.prototype = {GRAVITY : 0.4,init : function(){this.direction = Math.random() < 0.5;this.x = this.direction ? (this.renderer.width + this.renderer.THRESHOLD) : -this.renderer.THRESHOLD;this.previousY = this.y;this.vx = this.getRandomValue(4, 10) * (this.direction ? -1 : 1);if(this.renderer.reverse){this.y = this.getRandomValue(this.renderer.height * 1 / 10, this.renderer.height * 4 / 10);this.vy = this.getRandomValue(2, 5);this.ay = this.getRandomValue(0.05, 0.2);}else{this.y = this.getRandomValue(this.renderer.height * 6 / 10, this.renderer.height * 9 / 10);this.vy = this.getRandomValue(-5, -2);this.ay = this.getRandomValue(-0.2, -0.05);}this.isOut = false;this.theta = 0;this.phi = 0;},getRandomValue : function(min, max){return min + (max - min) * Math.random();},reverseVertical : function(){this.isOut = !this.isOut;this.ay *= -1;},controlStatus : function(context){this.previousY = this.y;this.x += this.vx;this.y += this.vy;this.vy += this.ay;if(this.renderer.reverse){if(this.y > this.renderer.height * this.renderer.INIT_HEIGHT_RATE){this.vy -= this.GRAVITY;this.isOut = true;}else{if(this.isOut){this.ay = this.getRandomValue(0.05, 0.2);}this.isOut = false;}}else{if(this.y < this.renderer.height * this.renderer.INIT_HEIGHT_RATE){this.vy += this.GRAVITY;this.isOut = true;}else{if(this.isOut){this.ay = this.getRandomValue(-0.2, -0.05);}this.isOut = false;}}if(!this.isOut){this.theta += Math.PI / 20;this.theta %= Math.PI * 2;this.phi += Math.PI / 30;this.phi %= Math.PI * 2;}this.renderer.generateEpicenter(this.x + (this.direction ? -1 : 1) * this.renderer.THRESHOLD, this.y, this.y - this.previousY);if(this.vx > 0 && this.x > this.renderer.width + this.renderer.THRESHOLD || this.vx < 0 && this.x < -this.renderer.THRESHOLD){this.init();}},render : function(context){context.save();context.translate(this.x, this.y);context.rotate(Math.PI + Math.atan2(this.vy, this.vx));context.scale(1, this.direction ? 1 : -1);context.beginPath();context.moveTo(-30, 0);context.bezierCurveTo(-20, 15, 15, 10, 40, 0);context.bezierCurveTo(15, -10, -20, -15, -30, 0);context.fill();context.save();context.translate(40, 0);context.scale(0.9 + 0.2 * Math.sin(this.theta), 1);context.beginPath();context.moveTo(0, 0);context.quadraticCurveTo(5, 10, 20, 8);context.quadraticCurveTo(12, 5, 10, 0);context.quadraticCurveTo(12, -5, 20, -8);context.quadraticCurveTo(5, -10, 0, 0);context.fill();context.restore();context.save();context.translate(-3, 0);context.rotate((Math.PI / 3 + Math.PI / 10 * Math.sin(this.phi)) * (this.renderer.reverse ? -1 : 1));context.beginPath();if(this.renderer.reverse){context.moveTo(5, 0);context.bezierCurveTo(10, 10, 10, 30, 0, 40);context.bezierCurveTo(-12, 25, -8, 10, 0, 0);}else{context.moveTo(-5, 0);context.bezierCurveTo(-10, -10, -10, -30, 0, -40);context.bezierCurveTo(12, -25, 8, -10, 0, 0);}context.closePath();context.fill();context.restore();context.restore();this.controlStatus(context);}};$(function(){RENDERER.init();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/styles/fish.js"/>
      <url>/styles/fish.js</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/styles/main.css"/>
      <url>/styles/main.css</url>
      
        <content type="html"><![CDATA[/* 鱼塘固定宽度 */canvas:not(#ribbon-canvas), #web_bg {    margin-bottom: -0.5rem;    display: block;    width: 100%;    height: 160px} /* 鱼塘渐变色 */body{ overflow-x: hidden;}#footer { height:160px; background: linear-gradient(  135deg,  rgba(23, 23, 116, 0.2),  rgba(28, 181, 224, 0.2) );}#footer #footer-wrap,#footer-wrap a { color: #000;}#footer #footer-wrap { z-index: 1;} #footer .container { line-height: 0; position: relative; height: 100%; width: 100vw;} /* 侧边栏个人信息卡片动态渐变色 */#aside-content>.card-widget.card-info{    background: linear-gradient(-45deg, rgba(255, 225, 245, 0.6), rgba(255, 225, 225, 0.9), rgba(225, 255, 251, 0.9), rgba(255, 225, 255, 0.6));}[data-theme=dark] #aside-content>.card-widget.card-info {    background: linear-gradient(-45deg, rgb(225, 238, 255),     rgba(225, 255, 253, 0.9),     rgba(225, 243, 255, 0.9),     rgba(255, 225, 253, 0.6));}/* 侧边栏公告栏卡片渐变色 */#aside-content>.card-widget.card-announcement{    background: linear-gradient(-45deg, rgba(255, 225, 245, 0.6),     rgba(255, 225, 225, 0.9),     rgba(225, 255, 251, 0.9),     rgba(255, 225, 255, 0.6));}[data-theme=dark] #aside-content>.card-widget.card-announcement{    background: linear-gradient(-45deg, rgba(255, 225, 245, 0.6),     rgba(255, 225, 225, 0.9),     rgba(225, 255, 251, 0.9),     rgba(255, 225, 255, 0.6));}/* 侧边栏目录最新文章卡片渐变色 */#aside-content>.sticky_layout>.card-widget{    background: linear-gradient(-45deg, rgba(255, 225, 245, 0.6),     rgba(255, 225, 225, 0.9),     rgba(225, 255, 251, 0.9),     rgba(255, 225, 255, 0.6));}[data-theme=dark] #aside-content>.sticky_layout>.card-widget{    background: linear-gradient(-45deg, rgba(255, 225, 245, 0.6),     rgba(255, 225, 225, 0.9),     rgba(225, 255, 251, 0.9),     rgba(255, 225, 255, 0.6));}/* 个人信息Follow me按钮 */#aside-content>.card-widget.card-info>#card-info-btn {    background-color: #3eb8be;    border-radius: 8px;}/*文章页面*//* .layout>#post {    background: linear-gradient(-45deg, rgba(225, 255, 252, 0.8), rgba(255, 225, 229, 0.9), rgba(225, 255, 225, 0.9), rgba(253, 255, 225, 0.8));}[data-theme=dark] .layout>#post {    background: linear-gradient(-45deg, rgba(24,40,72,.2), rgba(35,37,58,.9), rgba(35,37,58,.9), rgba(24,40,72,.2));} *//*主页文章预览页面*/#recent-posts>.recent-post-item{    background: linear-gradient(-45deg, rgba(225, 255, 252, 0.8),     rgba(255, 225, 229, 0.9),     rgba(225, 255, 225, 0.9),     rgba(253, 255, 225, 0.8));}[data-theme=dark] #recent-posts>.recent-post-item{    background: linear-gradient(-45deg, rgba(24,40,72,.2), rgba(35,37,58,.9), rgba(35,37,58,.9), rgba(24,40,72,.2));} /*分类页面*/.layout>#page {    background: linear-gradient(-45deg, rgba(225,235,255,.8), rgba(225,235,255,.9), rgba(225,235,255,.9), rgba(225,235,255,.8));}[data-theme=dark] .layout>#page {    background: linear-gradient(-45deg, rgba(24,40,72,.2), rgba(35,37,58,.9), rgba(35,37,58,.9), rgba(24,40,72,.2));} /*时间轴页面*/.layout>#archive {    background: linear-gradient(-45deg, rgba(225,235,255,.8), rgba(225,235,255,.9), rgba(225,235,255,.9), rgba(225,235,255,.8));}[data-theme=dark] .layout>#archive {    background: linear-gradient(-45deg, rgba(24,40,72,.2), rgba(35,37,58,.9), rgba(35,37,58,.9), rgba(24,40,72,.2));}]]></content>
      
    </entry>
    
    
  
</search>
